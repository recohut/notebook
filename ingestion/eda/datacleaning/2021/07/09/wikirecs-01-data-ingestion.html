<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>WikiRecs Part 1 - Data Ingestion, Loading and Cleaning | reconb</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="WikiRecs Part 1 - Data Ingestion, Loading and Cleaning" />
<meta name="author" content="<a href='https://towardsdatascience.com/how-can-you-tell-if-your-recommender-system-is-any-good-e4a6be02d9c2'>Daniel Saunders</a>" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In this first part of the two part series, we will handle the data side. We will fetch data from wikipedia, store in feather format and register the combined data on recochef. After that, we will perform EDA and extensive cleaning." />
<meta property="og:description" content="In this first part of the two part series, we will handle the data side. We will fetch data from wikipedia, store in feather format and register the combined data on recochef. After that, we will perform EDA and extensive cleaning." />
<link rel="canonical" href="https://nb.recohut.com/ingestion/eda/datacleaning/2021/07/09/wikirecs-01-data-ingestion.html" />
<meta property="og:url" content="https://nb.recohut.com/ingestion/eda/datacleaning/2021/07/09/wikirecs-01-data-ingestion.html" />
<meta property="og:site_name" content="reconb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-07-09T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="WikiRecs Part 1 - Data Ingestion, Loading and Cleaning" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"<a href='https://towardsdatascience.com/how-can-you-tell-if-your-recommender-system-is-any-good-e4a6be02d9c2'>Daniel Saunders</a>"},"dateModified":"2021-07-09T00:00:00-05:00","datePublished":"2021-07-09T00:00:00-05:00","description":"In this first part of the two part series, we will handle the data side. We will fetch data from wikipedia, store in feather format and register the combined data on recochef. After that, we will perform EDA and extensive cleaning.","headline":"WikiRecs Part 1 - Data Ingestion, Loading and Cleaning","mainEntityOfPage":{"@type":"WebPage","@id":"https://nb.recohut.com/ingestion/eda/datacleaning/2021/07/09/wikirecs-01-data-ingestion.html"},"url":"https://nb.recohut.com/ingestion/eda/datacleaning/2021/07/09/wikirecs-01-data-ingestion.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nb.recohut.com/feed.xml" title="reconb" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">reconb</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">WikiRecs Part 1 - Data Ingestion, Loading and Cleaning</h1><p class="page-description">In this first part of the two part series, we will handle the data side. We will fetch data from wikipedia, store in feather format and register the combined data on recochef. After that, we will perform EDA and extensive cleaning.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-07-09T00:00:00-05:00" itemprop="datePublished">
        Jul 9, 2021
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name"><a href='https://towardsdatascience.com/how-can-you-tell-if-your-recommender-system-is-any-good-e4a6be02d9c2'>Daniel Saunders</a></span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      9 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#Ingestion">Ingestion</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#EDA">EDA</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#DataCleaning">DataCleaning</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/recohut/notebook/tree/master/_notebooks/2021-07-09-wikirecs-01-data-ingestion.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/recohut/notebook/master?filepath=_notebooks%2F2021-07-09-wikirecs-01-data-ingestion.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/recohut/notebook/blob/master/_notebooks/2021-07-09-wikirecs-01-data-ingestion.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Frecohut%2Fnotebook%2Fblob%2Fmaster%2F_notebooks%2F2021-07-09-wikirecs-01-data-ingestion.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#Data-ingestion">Data ingestion </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Start-the-ingestion">Start the ingestion </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Data-storage">Data storage </a></li>
<li class="toc-entry toc-h2"><a href="#EDA-and-Data-cleaning">EDA and Data cleaning </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Data-loading">Data loading </a></li>
<li class="toc-entry toc-h3"><a href="#EDA">EDA </a></li>
<li class="toc-entry toc-h3"><a href="#Data-cleaning">Data cleaning </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Remove-consecutive-edits-and-summarize-runs">Remove consecutive edits and summarize runs </a></li>
<li class="toc-entry toc-h4"><a href="#Remove-top-N-most-popular-pages">Remove top N most popular pages </a></li>
<li class="toc-entry toc-h4"><a href="#Remove-users-with-too-many-or-too-few-edits">Remove users with too many or too few edits </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#Build-lookup-tables">Build lookup tables </a></li>
<li class="toc-entry toc-h3"><a href="#Build-test-and-training-set">Build test and training set </a></li>
<li class="toc-entry toc-h3"><a href="#Build-matrix-for-implicit-collaborative-filtering">Build matrix for implicit collaborative filtering </a></li>
<li class="toc-entry toc-h3"><a href="#Saving-artifacts">Saving artifacts </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-07-09-wikirecs-01-data-ingestion.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-ingestion">
<a class="anchor" href="#Data-ingestion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data ingestion<a class="anchor-link" href="#Data-ingestion"> </a>
</h2>
<p>Downloading data from Wikipedia using Wiki API and storing in Google drive. There are more than 11 millions records which would take 6-8 hours in single colab session, so used 10 colab workers to fetch all the data within 30-40 mins.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">sparsh</span><span class="o">-</span><span class="n">ai</span><span class="o">/</span><span class="n">reco</span><span class="o">-</span><span class="n">wikirecs</span>
<span class="o">%</span><span class="n">cd</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">reco</span><span class="o">-</span><span class="n">wikirecs</span><span class="o">/</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">wiki_pull</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">itables.javascript</span> <span class="kn">import</span> <span class="n">load_datatables</span>
<span class="n">load_datatables</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'config.yaml'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">get_sample_of_users</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">'edit_lookback'</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">'outfile'</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>1000500it [07:04, 2379.90it/s]                             </pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Earliest timestamp: 2021-06-21T19:22:49Z
Latest timestamp: 2021-07-08T14:39:42Z
Number of distinct users: 54355
Mean number of edits per user in timeframe: 18.40
Number of distinct pages edited: 401926
Mean number of edits per page in timeframe: 2.49
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>userid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Rodimus Rhyme</td>
      <td>7021208.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Asarlaí</td>
      <td>3215664.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Frank Anchor</td>
      <td>4659544.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>MAHosieAPS</td>
      <td>40684241.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Aranya</td>
      <td>35393771.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>54349</th>
      <td>Penwhale</td>
      <td>125125.0</td>
    </tr>
    <tr>
      <th>54350</th>
      <td>Htetrasme</td>
      <td>174367.0</td>
    </tr>
    <tr>
      <th>54351</th>
      <td>LarTram</td>
      <td>39905917.0</td>
    </tr>
    <tr>
      <th>54352</th>
      <td>Etan J. Tal</td>
      <td>7706243.0</td>
    </tr>
    <tr>
      <th>54353</th>
      <td>Charlton.austin</td>
      <td>26706343.0</td>
    </tr>
  </tbody>
</table>
<p>54354 rows × 2 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Start-the-ingestion">
<a class="anchor" href="#Start-the-ingestion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Start the ingestion<a class="anchor-link" href="#Start-the-ingestion"> </a>
</h3>
<p>I ran the same code from start till this cell, in 10 different colab notebooks, changing start position. The design is a master-worker setup where 1 notebooks was the master one, and 9 are workers.</p>
<p>In master, start=0. In worker 1, start=5000. In worker 2, start=10000, and so on. This start value indicates the number of users. Since there are 54K users, each worker handled 5000 users on average.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">pull_edit_histories</span><span class="p">(</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">'outfile'</span><span class="p">],</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">'file_save_path'</span><span class="p">],</span><span class="n">config</span><span class="p">[</span><span class="s1">'edit_histories_file_pattern'</span><span class="p">]),</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">'users_per_chunk'</span><span class="p">],</span>
    <span class="n">config</span><span class="p">[</span><span class="s1">'earliest_timestamp'</span><span class="p">],</span>
    <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-storage">
<a class="anchor" href="#Data-storage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data storage<a class="anchor-link" href="#Data-storage"> </a>
</h2>
<p>During ingestion, we stored data in feather format parts. Now, we will combine the data and store in compressed parquet format.</p>
<p>We will also register this data on recochef so that we can easily load it anywhere and also make it reusable for future use cases.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pyarrow</span> <span class="kn">import</span> <span class="n">feather</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'config.yaml'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">all_histories</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">'file_save_path'</span><span class="p">]):</span>
    <span class="k">if</span> <span class="s1">'feather'</span> <span class="ow">in</span>  <span class="n">fname</span><span class="p">:</span>
        <span class="n">all_histories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feather</span><span class="o">.</span><span class="n">read_feather</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">'file_save_path'</span><span class="p">],</span><span class="n">fname</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">all_histories</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_histories</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">all_histories</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userid</th>
      <th>user</th>
      <th>pageid</th>
      <th>title</th>
      <th>timestamp</th>
      <th>sizediff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>430714</td>
      <td>Eyetie</td>
      <td>22864890</td>
      <td>List of Samuel L. Jackson performances</td>
      <td>2021-07-08T15:01:39Z</td>
      <td>-19</td>
    </tr>
    <tr>
      <th>1</th>
      <td>430714</td>
      <td>Eyetie</td>
      <td>2879406</td>
      <td>Jeff Corey</td>
      <td>2021-07-07T11:06:50Z</td>
      <td>-13</td>
    </tr>
    <tr>
      <th>2</th>
      <td>430714</td>
      <td>Eyetie</td>
      <td>17130609</td>
      <td>Antonio Soda</td>
      <td>2021-07-05T11:18:51Z</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>430714</td>
      <td>Eyetie</td>
      <td>13270752</td>
      <td>Mr In-Between</td>
      <td>2021-06-21T16:48:00Z</td>
      <td>-48</td>
    </tr>
    <tr>
      <th>4</th>
      <td>430714</td>
      <td>Eyetie</td>
      <td>6816331</td>
      <td>San Giovanni Gemini</td>
      <td>2021-06-15T20:40:18Z</td>
      <td>3378</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">all_histories</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(11081889, 6)</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">all_histories</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 11081889 entries, 0 to 11081888
Data columns (total 6 columns):
 #   Column     Dtype 
---  ------     ----- 
 0   userid     int64 
 1   user       object
 2   pageid     int64 
 3   title      object
 4   timestamp  object
 5   sizediff   int64 
dtypes: int64(3), object(3)
memory usage: 507.3+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">all_histories</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userid</th>
      <th>pageid</th>
      <th>sizediff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1.108189e+07</td>
      <td>1.108189e+07</td>
      <td>1.108189e+07</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1.919552e+07</td>
      <td>3.240817e+07</td>
      <td>1.098695e+02</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.493577e+07</td>
      <td>2.626137e+07</td>
      <td>2.726467e+03</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2.000000e+00</td>
      <td>1.200000e+01</td>
      <td>-1.251584e+06</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>4.390460e+06</td>
      <td>3.908644e+06</td>
      <td>-4.000000e+00</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.748758e+07</td>
      <td>3.087424e+07</td>
      <td>9.000000e+00</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>3.419332e+07</td>
      <td>6.147069e+07</td>
      <td>6.500000e+01</td>
    </tr>
    <tr>
      <th>max</th>
      <td>4.214195e+07</td>
      <td>6.818951e+07</td>
      <td>9.116030e+05</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">all_histories</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">'O'</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>title</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>11081889</td>
      <td>11081889</td>
      <td>11081889</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>52614</td>
      <td>2461545</td>
      <td>7275769</td>
    </tr>
    <tr>
      <th>top</th>
      <td>BrownHairedGirl</td>
      <td>Deaths in 2021</td>
      <td>2021-05-01T16:48:50Z</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>101279</td>
      <td>9709</td>
      <td>206</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">all_histories</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s1">'wikirecs.parquet.gzip'</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">'gzip'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p></p>
<div class="flash">
    <svg class="octicon octicon-info" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>
    <strong>Note: </strong>Data is also registered with <a href="https://github.com/sparsh-ai/recochef/blob/master/src/recochef/datasets/wikirecs.py">recochef</a> for easy access
</div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="EDA-and-Data-cleaning">
<a class="anchor" href="#EDA-and-Data-cleaning" aria-hidden="true"><span class="octicon octicon-link"></span></a>EDA and Data cleaning<a class="anchor-link" href="#EDA-and-Data-cleaning"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">sparsh</span><span class="o">-</span><span class="n">ai</span><span class="o">/</span><span class="n">reco</span><span class="o">-</span><span class="n">wikirecs</span>
<span class="o">%</span><span class="n">cd</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">reco</span><span class="o">-</span><span class="n">wikirecs</span><span class="o">/</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>

<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">git</span><span class="o">+</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">sparsh</span><span class="o">-</span><span class="n">ai</span><span class="o">/</span><span class="n">recochef</span><span class="o">.</span><span class="n">git</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">csr_matrix</span><span class="p">,</span> <span class="n">csc_matrix</span><span class="p">,</span> <span class="n">lil_matrix</span><span class="p">,</span> <span class="n">coo_matrix</span>

<span class="kn">from</span> <span class="nn">recochef.datasets.wikirecs</span> <span class="kn">import</span> <span class="n">WikiRecs</span>

<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">wiki_pull</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="o">%</span><span class="n">load_ext</span> <span class="n">autoreload</span>
<span class="o">%</span><span class="n">autoreload</span> <span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Data-loading">
<a class="anchor" href="#Data-loading" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data loading<a class="anchor-link" href="#Data-loading"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">wikidata</span> <span class="o">=</span> <span class="n">WikiRecs</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">wikidata</span><span class="o">.</span><span class="n">load_interactions</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 11081889 entries, 0 to 11081888
Data columns (total 6 columns):
 #   Column     Dtype 
---  ------     ----- 
 0   USERID     int64 
 1   USERNAME   object
 2   ITEMID     int64 
 3   TITLE      object
 4   TIMESTAMP  object
 5   SIZEDIFF   int64 
dtypes: int64(3), object(3)
memory usage: 507.3+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USERID</th>
      <th>USERNAME</th>
      <th>ITEMID</th>
      <th>TITLE</th>
      <th>TIMESTAMP</th>
      <th>SIZEDIFF</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>430714</td>
      <td>Eyetie</td>
      <td>22864890</td>
      <td>List of Samuel L. Jackson performances</td>
      <td>2021-07-08T15:01:39Z</td>
      <td>-19</td>
    </tr>
    <tr>
      <th>1</th>
      <td>430714</td>
      <td>Eyetie</td>
      <td>2879406</td>
      <td>Jeff Corey</td>
      <td>2021-07-07T11:06:50Z</td>
      <td>-13</td>
    </tr>
    <tr>
      <th>2</th>
      <td>430714</td>
      <td>Eyetie</td>
      <td>17130609</td>
      <td>Antonio Soda</td>
      <td>2021-07-05T11:18:51Z</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>430714</td>
      <td>Eyetie</td>
      <td>13270752</td>
      <td>Mr In-Between</td>
      <td>2021-06-21T16:48:00Z</td>
      <td>-48</td>
    </tr>
    <tr>
      <th>4</th>
      <td>430714</td>
      <td>Eyetie</td>
      <td>6816331</td>
      <td>San Giovanni Gemini</td>
      <td>2021-06-15T20:40:18Z</td>
      <td>3378</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="EDA">
<a class="anchor" href="#EDA" aria-hidden="true"><span class="octicon octicon-link"></span></a>EDA<a class="anchor-link" href="#EDA"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">edit_counts</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'USERID'</span><span class="p">)</span><span class="o">.</span><span class="n">USERID</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">edit_counts</span><span class="p">,</span><span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20000</span><span class="p">,</span><span class="mi">200</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Number of edits by user'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">edit_counts</span><span class="p">,</span><span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Number of edits by user'</span><span class="p">)</span>
<span class="n">num_counts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edit_counts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Median edit counts: </span><span class="si">%d</span><span class="s2">"</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">edit_counts</span><span class="p">))</span>
<span class="n">thres</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">over_thres</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">edit_counts</span> <span class="o">&gt;</span> <span class="n">thres</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Number over threshold </span><span class="si">%d</span><span class="s2">: </span><span class="si">%d</span><span class="s2"> (%.f</span><span class="si">%%</span><span class="s2">)"</span> <span class="o">%</span> <span class="p">(</span><span class="n">thres</span><span class="p">,</span> <span class="n">over_thres</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">over_thres</span><span class="o">/</span><span class="n">num_counts</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Median edit counts: 11
Number over threshold 5: 32145 (61%)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">'USERID'</span><span class="p">,</span><span class="s1">'USERNAME'</span><span class="p">])</span><span class="o">.</span><span class="n">USERID</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>USERID    USERNAME        
754619    BrownHairedGirl     101279
7611264   AnomieBOT            99911
1276024   Lugnuts              84352
30583402  Nikolai Kurbatov     72704
1261736   Red Director         66104
                               ...  
39991728  300kdan                  1
39988349  Kishore123123            1
39980891  Waiting seat             1
39979707  Hayley.bowling           1
35864949  SoccerMom679             1
Name: USERID, Length: 52614, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">'USERID'</span><span class="p">,</span><span class="s1">'USERNAME'</span><span class="p">])</span><span class="o">.</span><span class="n">USERID</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="c1"># plt.ylim([0,20000])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&lt;matplotlib.lines.Line2D at 0x7f31a6c3e050&gt;]</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">page_popularity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">'TITLE'</span><span class="p">,</span><span class="s1">'USERNAME'</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'TITLE'</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">USERNAME</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<span class="n">page_popularity</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1000</span><span class="p">:]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>TITLE
2021 United States Capitol attack             730
Deaths in 2021                                461
Donald Trump                                  288
Second impeachment of Donald Trump            227
Joe Biden                                     226
                                             ... 
Pakistan                                       40
League of Legends                              40
List of coups and coup attempts by country     40
The Penthouse: War in Life                     40
Mao Zedong                                     40
Name: USERNAME, Length: 1000, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">USERNAME</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>10890967    SanAnMan
Name: USERNAME, dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'userid'</span><span class="p">,</span> <span class="s1">'user'</span><span class="p">,</span> <span class="s1">'pageid'</span><span class="p">,</span> <span class="s1">'title'</span><span class="p">,</span>
       <span class="s1">'timestamp'</span><span class="p">,</span> <span class="s1">'sizediff'</span><span class="p">]</span>

<span class="n">oneuser</span> <span class="o">=</span> <span class="n">get_edit_history</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s2">"SanAnMan"</span><span class="p">,</span>
                            <span class="n">latest_timestamp</span><span class="o">=</span><span class="s2">"2021-07-08T22:02:09Z"</span><span class="p">,</span>
                            <span class="n">earliest_timestamp</span><span class="o">=</span><span class="s2">"2020-05-28T22:02:09Z"</span><span class="p">)</span>

<span class="n">oneuser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">oneuser</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">cols</span><span class="p">]</span>
<span class="n">oneuser</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userid</th>
      <th>user</th>
      <th>pageid</th>
      <th>title</th>
      <th>timestamp</th>
      <th>sizediff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>14943992</td>
      <td>SanAnMan</td>
      <td>33275261</td>
      <td>Disney's My Son Pinocchio: Geppetto's Musical ...</td>
      <td>2021-07-08T15:16:51Z</td>
      <td>59</td>
    </tr>
    <tr>
      <th>1</th>
      <td>14943992</td>
      <td>SanAnMan</td>
      <td>67347035</td>
      <td>MasterChef (American season 11)</td>
      <td>2021-07-07T17:59:42Z</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>14943992</td>
      <td>SanAnMan</td>
      <td>35968550</td>
      <td>MasterChef (American season 1)</td>
      <td>2021-07-07T13:32:53Z</td>
      <td>-39</td>
    </tr>
    <tr>
      <th>3</th>
      <td>14943992</td>
      <td>SanAnMan</td>
      <td>39462622</td>
      <td>MasterChef (American season 4)</td>
      <td>2021-07-05T23:19:07Z</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>14943992</td>
      <td>SanAnMan</td>
      <td>224267</td>
      <td>List of South Park episodes</td>
      <td>2021-07-04T22:09:14Z</td>
      <td>-449</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>955</th>
      <td>14943992</td>
      <td>SanAnMan</td>
      <td>37028949</td>
      <td>Christine Hà</td>
      <td>2020-05-29T15:09:12Z</td>
      <td>2</td>
    </tr>
    <tr>
      <th>956</th>
      <td>14943992</td>
      <td>SanAnMan</td>
      <td>64108835</td>
      <td>Christine Ha</td>
      <td>2020-05-29T15:07:58Z</td>
      <td>74</td>
    </tr>
    <tr>
      <th>957</th>
      <td>14943992</td>
      <td>SanAnMan</td>
      <td>37028949</td>
      <td>Christine Hà</td>
      <td>2020-05-29T15:07:57Z</td>
      <td>0</td>
    </tr>
    <tr>
      <th>958</th>
      <td>14943992</td>
      <td>SanAnMan</td>
      <td>39462622</td>
      <td>MasterChef (American season 4)</td>
      <td>2020-05-29T10:34:08Z</td>
      <td>-115</td>
    </tr>
    <tr>
      <th>959</th>
      <td>14943992</td>
      <td>SanAnMan</td>
      <td>36084326</td>
      <td>MasterChef (American season 3)</td>
      <td>2020-05-29T10:33:20Z</td>
      <td>20</td>
    </tr>
  </tbody>
</table>
<p>960 rows × 6 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Data-cleaning">
<a class="anchor" href="#Data-cleaning" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data cleaning<a class="anchor-link" href="#Data-cleaning"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Remove-consecutive-edits-and-summarize-runs">
<a class="anchor" href="#Remove-consecutive-edits-and-summarize-runs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Remove consecutive edits and summarize runs<a class="anchor-link" href="#Remove-consecutive-edits-and-summarize-runs"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="k">def</span> <span class="nf">remove_consecutive_edits</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))))</span>
    
    <span class="n">keyfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="s1">'USERID'</span><span class="p">]],</span><span class="n">x</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="s1">'ITEMID'</span><span class="p">]])</span>
    <span class="n">first_and_last</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">run</span><span class="p">:</span> <span class="p">[</span><span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">[</span><span class="s1">'USERID'</span><span class="p">]],</span>
                                <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">[</span><span class="s1">'USERNAME'</span><span class="p">]],</span>
                                <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">[</span><span class="s1">'ITEMID'</span><span class="p">]],</span>
                                <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">[</span><span class="s1">'TITLE'</span><span class="p">]],</span>
                                <span class="n">run</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">c</span><span class="p">[</span><span class="s1">'TIMESTAMP'</span><span class="p">]],</span>
                                <span class="n">run</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">[</span><span class="s1">'TIMESTAMP'</span><span class="p">]],</span>
                                <span class="nb">sum</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="s1">'SIZEDIFF'</span><span class="p">]])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">run</span><span class="p">]),</span>
                                <span class="nb">len</span><span class="p">(</span><span class="n">run</span><span class="p">)]</span>
    <span class="n">d</span>  <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">first_and_last</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">g</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">keyfunc</span><span class="p">)],</span> 
                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'USERID'</span><span class="p">,</span> <span class="s1">'USER'</span><span class="p">,</span> <span class="s1">'ITEMID'</span><span class="p">,</span> <span class="s1">'TITLE'</span><span class="p">,</span> <span class="s1">'FIRST_TIMESTAMP'</span><span class="p">,</span> <span class="s1">'LAST_TIMESTAMP'</span><span class="p">,</span><span class="s1">'SUM_SIZEDIFF'</span><span class="p">,</span><span class="s1">'CONSECUTIVE_EDITS'</span><span class="p">])</span>
                        
<span class="n">clean_df</span> <span class="o">=</span> <span class="n">remove_consecutive_edits</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 58.4 s, sys: 2.15 s, total: 1min
Wall time: 1min
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Remove-top-N-most-popular-pages">
<a class="anchor" href="#Remove-top-N-most-popular-pages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Remove top N most popular pages<a class="anchor-link" href="#Remove-top-N-most-popular-pages"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">TOPN</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">popularpages</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">'TITLE'</span><span class="p">,</span><span class="s1">'ITEMID'</span><span class="p">,</span><span class="s1">'USERID'</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">'TITLE'</span><span class="p">,</span><span class="s1">'ITEMID'</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">USERNAME</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[</span><span class="o">-</span><span class="n">TOPN</span><span class="p">:]</span>
<span class="n">popularpages</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>TITLE                                                  ITEMID  
93rd Academy Awards                                    63807881    150
2021 Myanmar coup d'état                               66567997    151
Death and funeral of Prince Philip, Duke of Edinburgh  67349313    156
WandaVision                                            59082207    158
2020 United States presidential election               48410011    168
2021 Suez Canal obstruction                            67204875    168
Eurovision Song Contest 2021                           62877212    172
Zack Snyder's Justice League                           64017869    172
COVID-19 vaccine                                       63319438    187
2021 Israel–Palestine crisis                           67620503    189
COVID-19 pandemic                                      62750956    190
Prince Philip, Duke of Edinburgh                       62093       191
GameStop short squeeze                                 66516682    209
Surfside condominium building collapse                 68035614    212
2021                                                   51397       223
Joe Biden                                              145422      226
Second impeachment of Donald Trump                     66310761    227
Donald Trump                                           4848272     288
Deaths in 2021                                         65984422    461
2021 United States Capitol attack                      66307490    730
Name: USERNAME, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">before_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">popular_pageids</span> <span class="o">=</span> <span class="n">popularpages</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">'ITEMID'</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">is_popular_page_edit</span> <span class="o">=</span> <span class="n">clean_df</span><span class="o">.</span><span class="n">ITEMID</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">popular_pageids</span><span class="p">)</span>
<span class="n">clean_df</span> <span class="o">=</span> <span class="n">clean_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">is_popular_page_edit</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">all_histories</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">after_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clean_df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%d</span><span class="s2"> edits (</span><span class="si">%.1f%%</span><span class="s2">) were in top </span><span class="si">%d</span><span class="s2"> popular pages. Length after removing: </span><span class="si">%d</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">is_popular_page_edit</span><span class="p">),</span> 
                                                                                     <span class="mi">100</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">is_popular_page_edit</span><span class="p">)</span><span class="o">/</span><span class="n">before_count</span><span class="p">,</span>
                                                                                     <span class="n">TOPN</span><span class="p">,</span>
                                                                                     <span class="n">after_count</span><span class="p">)</span>
     <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>19231 edits (0.2%) were in top 20 popular pages. Length after removing: 7604316
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Number of unique page ids: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clean_df</span><span class="o">.</span><span class="n">ITEMID</span><span class="o">.</span><span class="n">unique</span><span class="p">())))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Number of unique page ids: 2461524
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Remove-users-with-too-many-or-too-few-edits">
<a class="anchor" href="#Remove-users-with-too-many-or-too-few-edits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Remove users with too many or too few edits<a class="anchor-link" href="#Remove-users-with-too-many-or-too-few-edits"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">MIN_EDITS</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">MAX_EDITS</span> <span class="o">=</span> <span class="mi">10000</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">all_user_edit_counts</span> <span class="o">=</span> <span class="n">clean_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">'USERID'</span><span class="p">,</span><span class="s1">'USER'</span><span class="p">])</span><span class="o">.</span><span class="n">USERID</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="c1"># Remove users with too few edits</span>
<span class="n">keep_user</span> <span class="o">=</span> <span class="n">all_user_edit_counts</span><span class="o">.</span><span class="n">values</span> <span class="o">&gt;=</span> <span class="n">MIN_EDITS</span>

<span class="c1"># Remove users with too many edits</span>
<span class="n">keep_user</span> <span class="o">=</span> <span class="n">keep_user</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">all_user_edit_counts</span><span class="o">.</span><span class="n">values</span> <span class="o">&lt;=</span> <span class="n">MAX_EDITS</span><span class="p">)</span>

<span class="c1"># Remove users with "bot" in the name</span>
<span class="n">is_bot</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'bot'</span> <span class="ow">in</span> <span class="n">username</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">all_user_edit_counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
<span class="n">keep_user</span> <span class="o">=</span> <span class="n">keep_user</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">is_bot</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Keep </span><span class="si">%d</span><span class="s2"> users out of </span><span class="si">%d</span><span class="s2"> (</span><span class="si">%.1f%%</span><span class="s2">)"</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">keep_user</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_user_edit_counts</span><span class="p">),</span> <span class="mi">100</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">keep_user</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">all_user_edit_counts</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Keep 28091 users out of 52593 (53.4%)
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">userids_to_keep</span> <span class="o">=</span> <span class="n">all_user_edit_counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">keep_user</span><span class="p">]</span>

<span class="n">clean_df</span> <span class="o">=</span> <span class="n">clean_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">clean_df</span><span class="o">.</span><span class="n">USERID</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">userids_to_keep</span><span class="p">)]</span>

<span class="n">clean_df</span> <span class="o">=</span> <span class="n">clean_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Length after removing users: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clean_df</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Length after removing users: 5907255
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Build-lookup-tables">
<a class="anchor" href="#Build-lookup-tables" aria-hidden="true"><span class="octicon octicon-link"></span></a>Build lookup tables<a class="anchor-link" href="#Build-lookup-tables"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">lookup</span> <span class="o">=</span> <span class="n">clean_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">'ITEMID'</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">'ITEMID'</span><span class="p">,</span><span class="s1">'TITLE'</span><span class="p">]]</span>
<span class="n">p2t</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">lookup</span><span class="o">.</span><span class="n">ITEMID</span><span class="p">,</span> <span class="n">lookup</span><span class="o">.</span><span class="n">TITLE</span><span class="p">))</span>
<span class="n">t2p</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">lookup</span><span class="o">.</span><span class="n">TITLE</span><span class="p">,</span> <span class="n">lookup</span><span class="o">.</span><span class="n">ITEMID</span><span class="p">))</span>

<span class="c1"># User id to name and back</span>
<span class="n">lookup</span> <span class="o">=</span> <span class="n">clean_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">'USERID'</span><span class="p">])</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">'USERID'</span><span class="p">,</span><span class="s1">'USER'</span><span class="p">]]</span>
<span class="n">u2n</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">lookup</span><span class="o">.</span><span class="n">USERID</span><span class="p">,</span> <span class="n">lookup</span><span class="o">.</span><span class="n">USER</span><span class="p">))</span>
<span class="n">n2u</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">lookup</span><span class="o">.</span><span class="n">USER</span><span class="p">,</span> <span class="n">lookup</span><span class="o">.</span><span class="n">USERID</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">pageids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">clean_df</span><span class="o">.</span><span class="n">ITEMID</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">userids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">clean_df</span><span class="o">.</span><span class="n">USERID</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
 
<span class="n">p2i</span> <span class="o">=</span> <span class="p">{</span><span class="n">pageid</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pageid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pageids</span><span class="p">)}</span>
<span class="n">u2i</span> <span class="o">=</span> <span class="p">{</span><span class="n">userid</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">userid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">userids</span><span class="p">)}</span>


<span class="n">i2p</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p2i</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">i2u</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">u2i</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">n2i</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">u2i</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">n2u</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">u2i</span><span class="p">}</span>
<span class="n">t2i</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">p2i</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">t2p</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p2i</span><span class="p">}</span>

<span class="n">i2n</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">n2i</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">i2t</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">t2i</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Build-test-and-training-set">
<a class="anchor" href="#Build-test-and-training-set" aria-hidden="true"><span class="octicon octicon-link"></span></a>Build test and training set<a class="anchor-link" href="#Build-test-and-training-set"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">histories_test</span> <span class="o">=</span> <span class="n">clean_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">'USERID'</span><span class="p">,</span><span class="s1">'USER'</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">histories_train</span> <span class="o">=</span> <span class="n">dataframe_set_subtract</span><span class="p">(</span><span class="n">clean_df</span><span class="p">,</span> <span class="n">histories_test</span><span class="p">)</span>
<span class="n">histories_train</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">histories_dev</span> <span class="o">=</span> <span class="n">histories_train</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">'USERID'</span><span class="p">,</span><span class="s1">'USER'</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="c1"># Subtract it from the rest to make the final training set</span>
<span class="n">histories_train</span> <span class="o">=</span> <span class="n">dataframe_set_subtract</span><span class="p">(</span><span class="n">histories_train</span><span class="p">,</span> <span class="n">histories_dev</span><span class="p">)</span>
<span class="n">histories_train</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Length of test set: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">histories_test</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Length of dev set: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">histories_dev</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Length of training after removal of test: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">histories_train</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Length of test set: 28091
Length of dev set: 28091
Length of training after removal of test: 5849876
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Number of pages in training set: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">histories_train</span><span class="o">.</span><span class="n">ITEMID</span><span class="o">.</span><span class="n">unique</span><span class="p">())))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Number of users in training set: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">histories_train</span><span class="o">.</span><span class="n">USERID</span><span class="o">.</span><span class="n">unique</span><span class="p">())))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Number of pages with &gt; 1 user editing: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">histories_train</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">'TITLE'</span><span class="p">,</span><span class="s1">'USER'</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'TITLE'</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">USER</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Number of pages in training set: 1962283
Number of users in training set: 28090
Number of pages with &gt; 1 user editing: 644980
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">resurface_userids</span><span class="p">,</span> <span class="n">discovery_userids</span> <span class="o">=</span> <span class="n">get_resurface_discovery</span><span class="p">(</span><span class="n">histories_train</span><span class="p">,</span> <span class="n">histories_dev</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%d</span><span class="s2"> out of </span><span class="si">%d</span><span class="s2"> userids are resurfaced (</span><span class="si">%.1f%%</span><span class="s2">)"</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resurface_userids</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">userids</span><span class="p">),</span> <span class="mi">100</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resurface_userids</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">userids</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">%d</span><span class="s2"> out of </span><span class="si">%d</span><span class="s2"> userids are discovered (</span><span class="si">%.1f%%</span><span class="s2">)"</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">discovery_userids</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">userids</span><span class="p">),</span> <span class="mi">100</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">discovery_userids</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">userids</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>7760 out of 28090 userids are resurfaced (27.6%)
20330 out of 28090 userids are discovered (72.4%)
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Build-matrix-for-implicit-collaborative-filtering">
<a class="anchor" href="#Build-matrix-for-implicit-collaborative-filtering" aria-hidden="true"><span class="octicon octicon-link"></span></a>Build matrix for implicit collaborative filtering<a class="anchor-link" href="#Build-matrix-for-implicit-collaborative-filtering"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">for_implicit</span> <span class="o">=</span> <span class="n">histories_train</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">"USERID"</span><span class="p">,</span><span class="s2">"ITEMID"</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">FIRST_TIMESTAMP</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'FIRST_TIMESTAMP'</span><span class="p">:</span><span class="s1">'edits'</span><span class="p">})</span>
<span class="n">for_implicit</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">'edits'</span><span class="p">]</span> <span class="o">=</span> <span class="n">for_implicit</span><span class="o">.</span><span class="n">edits</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p2i</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">for_implicit</span><span class="o">.</span><span class="n">ITEMID</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>
<span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">u2i</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">for_implicit</span><span class="o">.</span><span class="n">USERID</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>

<span class="n">implicit_matrix_coo</span> <span class="o">=</span> <span class="n">coo_matrix</span><span class="p">((</span><span class="n">for_implicit</span><span class="o">.</span><span class="n">edits</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)))</span>

<span class="n">implicit_matrix</span> <span class="o">=</span> <span class="n">csc_matrix</span><span class="p">(</span><span class="n">implicit_matrix_coo</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Saving-artifacts">
<a class="anchor" href="#Saving-artifacts" aria-hidden="true"><span class="octicon octicon-link"></span></a>Saving artifacts<a class="anchor-link" href="#Saving-artifacts"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">save_pickle</span><span class="p">((</span><span class="n">p2t</span><span class="p">,</span> <span class="n">t2p</span><span class="p">,</span> <span class="n">u2n</span><span class="p">,</span> <span class="n">n2u</span><span class="p">,</span> <span class="n">p2i</span><span class="p">,</span> <span class="n">u2i</span><span class="p">,</span> <span class="n">i2p</span><span class="p">,</span> <span class="n">i2u</span><span class="p">,</span> <span class="n">n2i</span><span class="p">,</span> <span class="n">t2i</span><span class="p">,</span> <span class="n">i2n</span><span class="p">,</span> <span class="n">i2t</span><span class="p">),</span> <span class="s1">'lookup_tables.pickle'</span><span class="p">)</span>
<span class="n">save_pickle</span><span class="p">((</span><span class="n">userids</span><span class="p">,</span> <span class="n">pageids</span><span class="p">),</span> <span class="s1">'users_and_pages.pickle'</span><span class="p">)</span>
<span class="n">save_pickle</span><span class="p">((</span><span class="n">resurface_userids</span><span class="p">,</span> <span class="n">discovery_userids</span><span class="p">),</span> <span class="s1">'resurface_discovery_users.pickle'</span><span class="p">)</span>
<span class="n">save_pickle</span><span class="p">(</span><span class="n">implicit_matrix</span><span class="p">,</span><span class="s1">'implicit_matrix.pickle'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="recohut/notebook"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/ingestion/eda/datacleaning/2021/07/09/wikirecs-01-data-ingestion.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Jupyter notebook database.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/recohut" target="_blank" title="recohut"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
