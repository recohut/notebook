<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Image Similarity Bandit | reconb</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Image Similarity Bandit" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Jupyter notebook database." />
<meta property="og:description" content="Jupyter notebook database." />
<link rel="canonical" href="https://nb.recohut.com/2022/01/06/imgsim-bandit.html" />
<meta property="og:url" content="https://nb.recohut.com/2022/01/06/imgsim-bandit.html" />
<meta property="og:site_name" content="reconb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-06T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Image Similarity Bandit" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-06T00:00:00-06:00","datePublished":"2022-01-06T00:00:00-06:00","description":"Jupyter notebook database.","headline":"Image Similarity Bandit","mainEntityOfPage":{"@type":"WebPage","@id":"https://nb.recohut.com/2022/01/06/imgsim-bandit.html"},"url":"https://nb.recohut.com/2022/01/06/imgsim-bandit.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nb.recohut.com/feed.xml" title="reconb" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">reconb</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Image Similarity Bandit</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-01-06T00:00:00-06:00" itemprop="datePublished">
        Jan 6, 2022
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      2 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/recohut/notebook/tree/master/_notebooks/2022-01-06-imgsim-bandit.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/recohut/notebook/master?filepath=_notebooks%2F2022-01-06-imgsim-bandit.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/recohut/notebook/blob/master/_notebooks/2022-01-06-imgsim-bandit.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Frecohut%2Fnotebook%2Fblob%2Fmaster%2F_notebooks%2F2022-01-06-imgsim-bandit.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-01-06-imgsim-bandit.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1"># !pip install --upgrade --force-reinstall --no-deps kaggle</span>
<span class="c1"># !mkdir ~/.kaggle</span>
<span class="c1"># !cp /content/drive/MyDrive/kaggle.json ~/.kaggle/</span>
<span class="c1"># !chmod 600 ~/.kaggle/kaggle.json</span>

<span class="c1"># !kaggle datasets download -d paramaggarwal/fashion-product-images-dataset</span>

<span class="c1"># !unzip /content/fashion-product-images-dataset.zip</span>

<span class="c1"># image_path = &#39;/content/fashion-dataset/fashion-dataset/images&#39;</span>

<span class="c1"># img_paths = []</span>
<span class="c1"># for path in Path(image_path).rglob(&#39;*.jpg&#39;):</span>
<span class="c1">#     img_paths.append(path)</span>

<span class="c1"># styles = pd.read_csv(&#39;/content/fashion-dataset/fashion-dataset/styles.csv&#39;, error_bad_lines=False)</span>
<span class="c1"># styles.head()</span>

<span class="c1"># styles_small = styles.sample(1000)</span>

<span class="c1"># img_paths_small = [x for x in img_paths if x.stem in styles_small.id.astype(&#39;str&#39;).tolist()]</span>

<span class="c1"># !mkdir -p /content/data/images</span>
<span class="c1"># styles_small.to_csv(&#39;/content/data/styles.csv&#39;, index=False)</span>

<span class="c1"># import shutil</span>
<span class="c1"># for src_file in img_paths_small:</span>
<span class="c1">#     shutil.copy(src_file, &#39;/content/data/images&#39;)</span>

<span class="c1"># import os</span>
<span class="c1"># import zipfile</span>
<span class="c1"># def zipdir(path, ziph):</span>
<span class="c1">#     # ziph is zipfile handle</span>
<span class="c1">#     for root, dirs, files in os.walk(path):</span>
<span class="c1">#         for file in files:</span>
<span class="c1">#             ziph.write(os.path.join(root, file))</span>
<span class="c1"># zipf = zipfile.ZipFile(&#39;data.zip&#39;, &#39;w&#39;, zipfile.ZIP_DEFLATED)</span>
<span class="c1"># zipdir(&#39;/content/data&#39;, zipf)</span>
<span class="c1"># zipf.close()</span>

<span class="c1"># !cp data.zip /content/drive/MyDrive/TempData</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1"># !cp -r /content/drive/MyDrive/TempData/artifacts /content/content/</span>
<span class="c1"># !unzip /content/data.zip</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">img2vec_pytorch</span>
<span class="err">!</span><span class="n">apt</span> <span class="n">install</span> <span class="n">libomp</span><span class="o">-</span><span class="n">dev</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">upgrade</span> <span class="n">faiss</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1"># from img2vec_pytorch import Img2Vec</span>
<span class="c1"># from PIL import Image</span>
<span class="c1"># import faiss</span>
<span class="c1"># import numpy as np</span>
<span class="c1"># import pandas as pd</span>
<span class="c1"># import logging</span>
<span class="c1"># import pickle</span>
<span class="c1"># import os</span>
<span class="c1"># import random</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">image_path</span> <span class="o">=</span> <span class="s1">&#39;/content/content/data/images&#39;</span>
<span class="n">artifact_path</span> <span class="o">=</span> <span class="s1">&#39;/content/content/artifacts&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1"># for path in Path(image_path).rglob(&#39;*.jpg&#39;):</span>
<span class="c1">#     img_paths.append(path)</span>
<span class="c1"># img2vec = Img2Vec(cuda=False)</span>

<span class="c1"># def chunks(lst, n):</span>
<span class="c1">#     &quot;&quot;&quot;Yield successive n-sized chunks from lst.&quot;&quot;&quot;</span>
<span class="c1">#     for i in range(0, len(lst), n):</span>
<span class="c1">#         yield lst[i:i + n]</span>

<span class="c1"># vectors = np.zeros((1,512))</span>
<span class="c1"># for paths in chunks(img_paths,50):</span>
<span class="c1">#   _x = img2vec.get_vec([Image.open(ipath) for ipath in paths])</span>
<span class="c1">#   vectors = np.vstack((vectors,_x))</span>
<span class="c1"># vectors.shape</span>

<span class="c1"># vectors = vectors[1:,:]</span>
<span class="c1"># vectors = vectors.astype(np.float32)</span>

<span class="c1"># item_vectors = {ipath.stem:vectors[iindex] for iindex, ipath in enumerate(img_paths)}</span>
<span class="c1"># item_paths = {ipath.stem:ipath for ipath in img_paths}</span>
<span class="c1"># pickle.dump(item_vectors, open(os.path.join(artifact_path,&quot;item_vectors.p&quot;), &quot;wb&quot;))</span>
<span class="c1"># pickle.dump(item_paths, open(os.path.join(artifact_path,&quot;item_paths.p&quot;), &quot;wb&quot;))</span>

<span class="c1"># dim = np.array(list(item_vectors.values())).shape[1]</span>
<span class="c1"># index = faiss.IndexFlatL2(dim)</span>
<span class="c1"># index.add(np.array(list(item_vectors.values())))</span>
<span class="c1"># faiss.write_index(index,os.path.join(artifact_path,&quot;vector.index&quot;))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">item_vectors</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">artifact_path</span><span class="p">,</span><span class="s2">&quot;item_vectors.p&quot;</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">faiss</span><span class="o">.</span><span class="n">read_index</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">artifact_path</span><span class="p">,</span><span class="s2">&quot;vector.index&quot;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">topk_similar</span><span class="p">(</span><span class="n">itemid</span><span class="p">,</span> <span class="n">topk</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">I</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">item_vectors</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">itemid</span><span class="p">)]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">topk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">item_vectors</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="o">.</span><span class="n">flatten</span><span class="p">()][</span><span class="mi">1</span><span class="p">:]</span>

<span class="k">def</span> <span class="nf">topk_distance</span><span class="p">(</span><span class="n">itemid</span><span class="p">,</span> <span class="n">topk</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">D</span><span class="p">,</span> <span class="n">I</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">item_vectors</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">itemid</span><span class="p">)]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">topk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="nb">list</span><span class="p">(</span><span class="n">item_vectors</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]:</span><span class="n">j</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">D</span><span class="o">.</span><span class="n">flatten</span><span class="p">())}</span>

<span class="k">def</span> <span class="nf">topk_similar2</span><span class="p">(</span><span class="n">ivec</span><span class="p">,</span> <span class="n">topk</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">I</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ivec</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">topk</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">item_vectors</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">feedbackdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;imgid&#39;</span><span class="p">,</span><span class="s1">&#39;feedback&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">feedbackdf</span> <span class="o">=</span> <span class="n">feedbackdf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">((</span><span class="s1">&#39;10017&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;imgid&#39;</span><span class="p">,</span><span class="s1">&#39;feedback&#39;</span><span class="p">]),</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">feedbackdf</span> <span class="o">=</span> <span class="n">feedbackdf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">((</span><span class="s1">&#39;10254&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;imgid&#39;</span><span class="p">,</span><span class="s1">&#39;feedback&#39;</span><span class="p">]),</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">feedbackdf</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>imgid</th>
      <th>feedback</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10017</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10254</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9685</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30862</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>57100</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>41777</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>30855</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>41172</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>29154</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>34046</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>4097</td>
      <td>0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>10017</td>
      <td>1</td>
    </tr>
    <tr>
      <th>12</th>
      <td>10254</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="k">def</span> <span class="nf">topk_dice</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">&gt;</span><span class="n">epsilon</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="mi">20</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">20</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">5</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">recommend</span><span class="p">():</span>
  <span class="n">_x</span> <span class="o">=</span> <span class="n">feedbackdf</span><span class="p">[</span><span class="n">feedbackdf</span><span class="o">.</span><span class="n">feedback</span><span class="o">==</span><span class="s1">&#39;1&#39;</span><span class="p">]</span>
  <span class="n">impressions</span> <span class="o">=</span> <span class="n">feedbackdf</span><span class="o">.</span><span class="n">imgid</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
  <span class="n">likedlist</span> <span class="o">=</span> <span class="n">_x</span><span class="o">.</span><span class="n">imgid</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
  <span class="n">_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">item_vectors</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">likedlist</span><span class="p">]</span>
  <span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span>
  <span class="n">weights</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span>
  <span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
  <span class="n">_x</span> <span class="o">=</span> <span class="n">_x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">topk</span> <span class="o">=</span> <span class="n">topk_dice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">impressions</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">topk</span><span class="p">)</span>
  <span class="n">_x</span> <span class="o">=</span> <span class="n">topk_similar2</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span><span class="n">topk</span><span class="p">)</span>
  <span class="n">_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_x</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">impressions</span><span class="p">]</span>
  <span class="n">_x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">_x</span><span class="p">)</span>
  <span class="n">_y</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">.jpg&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">_x</span><span class="p">)</span>
  <span class="n">_y</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">_y</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">_x</span><span class="p">,</span> <span class="n">_y</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">_x</span><span class="p">,</span><span class="n">_y</span> <span class="o">=</span> <span class="n">recommend</span><span class="p">()</span>
<span class="n">_y</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>20
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea output_execute_result">
<img src="data:image/png;base64,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
" />
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">widgets</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">clear_output</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;max_colwidth&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">ipywidgets</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span>
<span class="n">fbs</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">ToggleButtons</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Like&quot;</span><span class="p">,</span> <span class="s2">&quot;Don&#39;t Like&quot;</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">on_button_clicked</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
  <span class="c1"># Display the message within the output widget.</span>
  <span class="k">with</span> <span class="n">output</span><span class="p">:</span>
    <span class="n">clear_output</span><span class="p">()</span>
    <span class="n">_x</span><span class="p">,</span><span class="n">_y</span> <span class="o">=</span> <span class="n">recommend</span><span class="p">()</span>
    <span class="k">global</span> <span class="n">feedbackdf</span>
    <span class="k">global</span> <span class="n">fbs</span>
    <span class="n">_z</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span> <span class="k">if</span> <span class="n">fbs</span><span class="o">==</span><span class="s1">&#39;Like&#39;</span> <span class="k">else</span> <span class="s1">&#39;0&#39;</span>
    <span class="n">feedbackdf</span> <span class="o">=</span> <span class="n">feedbackdf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">((</span><span class="n">_x</span><span class="p">,</span><span class="n">_z</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;imgid&#39;</span><span class="p">,</span><span class="s1">&#39;feedback&#39;</span><span class="p">]),</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">_y</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">300</span><span class="p">,</span><span class="mi">300</span><span class="p">)))</span>
  
<span class="n">button</span> <span class="o">=</span> <span class="n">ipywidgets</span><span class="o">.</span><span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Recommend next&#39;</span><span class="p">)</span>
<span class="n">button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">on_button_clicked</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">fbs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

</div>



  </div><a class="u-url" href="/2022/01/06/imgsim-bandit.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Jupyter notebook database.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/recohut" target="_blank" title="recohut"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
