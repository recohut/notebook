<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>FinBERT QA | reconb</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="FinBERT QA" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Jupyter notebook database." />
<meta property="og:description" content="Jupyter notebook database." />
<link rel="canonical" href="https://nb.recohut.com/2022/01/29/finbert.html" />
<meta property="og:url" content="https://nb.recohut.com/2022/01/29/finbert.html" />
<meta property="og:site_name" content="reconb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-29T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="FinBERT QA" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-29T00:00:00-06:00","datePublished":"2022-01-29T00:00:00-06:00","description":"Jupyter notebook database.","headline":"FinBERT QA","mainEntityOfPage":{"@type":"WebPage","@id":"https://nb.recohut.com/2022/01/29/finbert.html"},"url":"https://nb.recohut.com/2022/01/29/finbert.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nb.recohut.com/feed.xml" title="reconb" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">reconb</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">FinBERT QA</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-01-29T00:00:00-06:00" itemprop="datePublished">
        Jan 29, 2022
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      8 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/recohut/notebook/tree/master/_notebooks/2022-01-29-finbert.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/recohut/notebook/master?filepath=_notebooks%2F2022-01-29-finbert.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/recohut/notebook/blob/master/_notebooks/2022-01-29-finbert.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Frecohut%2Fnotebook%2Fblob%2Fmaster%2F_notebooks%2F2022-01-29-finbert.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-01-29-finbert.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Data-preprocessing">Data preprocessing<a class="anchor-link" href="#Data-preprocessing"> </a></h3><ol>
<li>Loads and cleans the raw data</li>
<li>Prepares the data for the retriever</li>
<li>Pre-processes and tokenizes the raw cleaned data</li>
<li>Creates vocabulary from the corpus</li>
</ol>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>git clone https://github.com/sparsh9012/FinBERT-QA
<span class="o">%</span><span class="k">cd</span> FinBERT-QA
<span class="kn">from</span> <span class="nn">src.utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">src.process_data</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">collection</span> <span class="o">=</span> <span class="n">load_answers_to_df</span><span class="p">(</span><span class="s2">&quot;data/raw/FiQA_train_doc_final.tsv&quot;</span><span class="p">)</span>
<span class="n">collection</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>docid</th>
      <th>doc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>I'm not saying I don't like the idea of on-the...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>31</td>
      <td>So nothing preventing false ratings besides ad...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>56</td>
      <td>You can never use a health FSA for individual ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>59</td>
      <td>Samsung created the LCD and other flat screen ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>63</td>
      <td>Here are the SEC requirements: The federal sec...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">queries</span> <span class="o">=</span> <span class="n">load_questions_to_df</span><span class="p">(</span><span class="s2">&quot;data/raw/FiQA_train_question_final.tsv&quot;</span><span class="p">)</span>
<span class="n">queries</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>qid</th>
      <th>question</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>What is considered a business expense on a bus...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Claiming business expenses for a business with...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>Transferring money from One business checking ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>Having a separate bank account for business/in...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>Business Expense - Car Insurance Deductible Fo...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">qid_docid</span> <span class="o">=</span> <span class="n">load_qid_docid_to_df</span><span class="p">(</span><span class="s2">&quot;data/raw/FiQA_train_question_doc_final.tsv&quot;</span><span class="p">)</span>
<span class="n">qid_rel</span> <span class="o">=</span> <span class="n">label_to_dict</span><span class="p">(</span><span class="n">qid_docid</span><span class="p">)</span>
<span class="n">qid_docid</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>qid</th>
      <th>docid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>18850</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>14255</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>308938</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>296717</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>100764</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">empty_docs</span><span class="p">,</span> <span class="n">empty_id</span> <span class="o">=</span> <span class="n">get_empty_docs</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
<span class="c1"># Remove empty answers from collection of answers</span>
<span class="n">collection_cleaned</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">empty_id</span><span class="p">)</span>
<span class="c1"># Remove empty answers from qa pairs</span>
<span class="n">qid_docid</span> <span class="o">=</span> <span class="n">qid_docid</span><span class="p">[</span><span class="o">~</span><span class="n">qid_docid</span><span class="p">[</span><span class="s1">&#39;docid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">empty_docs</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">save_tsv</span><span class="p">(</span><span class="s2">&quot;retriever/collection_cleaned.tsv&quot;</span><span class="p">,</span> <span class="n">collection_cleaned</span><span class="p">)</span>

<span class="c1"># Convert collection df to JSON file for document indexer</span>
<span class="n">collection_to_json</span><span class="p">(</span><span class="s2">&quot;retriever/collection_json/docs.json&quot;</span><span class="p">,</span> <span class="s2">&quot;retriever/collection_cleaned.tsv&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">processed_questions</span> <span class="o">=</span> <span class="n">process_questions</span><span class="p">(</span><span class="n">queries</span><span class="p">)</span>
<span class="n">processed_questions</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>qid</th>
      <th>question</th>
      <th>q_processed</th>
      <th>tokenized_q</th>
      <th>q_len</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>What is considered a business expense on a bus...</td>
      <td>what is considered a business expense on a bus...</td>
      <td>[what, is, considered, a, business, expense, o...</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>Claiming business expenses for a business with...</td>
      <td>claiming business expenses for a business with...</td>
      <td>[claiming, business, expenses, for, a, busines...</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>Transferring money from One business checking ...</td>
      <td>transferring money from one business checking ...</td>
      <td>[transferring, money, from, one, business, che...</td>
      <td>10</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>Having a separate bank account for business/in...</td>
      <td>having a separate bank account for business in...</td>
      <td>[having, a, separate, bank, account, for, busi...</td>
      <td>13</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>Business Expense - Car Insurance Deductible Fo...</td>
      <td>business expense   car insurance deductible fo...</td>
      <td>[business, expense, car, insurance, deductible...</td>
      <td>13</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">processed_answers</span> <span class="o">=</span> <span class="n">process_answers</span><span class="p">(</span><span class="n">collection_cleaned</span><span class="p">)</span>
<span class="n">processed_answers</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>docid</th>
      <th>doc</th>
      <th>doc_processed</th>
      <th>tokenized_ans</th>
      <th>ans_len</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>I'm not saying I don't like the idea of on-the...</td>
      <td>im not saying i dont like the idea of on the j...</td>
      <td>[im, not, saying, i, dont, like, the, idea, of...</td>
      <td>76</td>
    </tr>
    <tr>
      <th>1</th>
      <td>31</td>
      <td>So nothing preventing false ratings besides ad...</td>
      <td>so nothing preventing false ratings besides ad...</td>
      <td>[so, nothing, preventing, false, ratings, besi...</td>
      <td>78</td>
    </tr>
    <tr>
      <th>2</th>
      <td>56</td>
      <td>You can never use a health FSA for individual ...</td>
      <td>you can never use a health fsa for individual ...</td>
      <td>[you, can, never, use, a, health, fsa, for, in...</td>
      <td>74</td>
    </tr>
    <tr>
      <th>3</th>
      <td>59</td>
      <td>Samsung created the LCD and other flat screen ...</td>
      <td>samsung created the lcd and other flat screen ...</td>
      <td>[samsung, created, the, lcd, and, other, flat,...</td>
      <td>54</td>
    </tr>
    <tr>
      <th>4</th>
      <td>63</td>
      <td>Here are the SEC requirements: The federal sec...</td>
      <td>here are the sec requirements  the federal sec...</td>
      <td>[here, are, the, sec, requirements, the, feder...</td>
      <td>222</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">avg_ans_count</span> <span class="o">=</span> <span class="n">processed_answers</span><span class="p">[</span><span class="s1">&#39;ans_len&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">avg_q_count</span> <span class="o">=</span> <span class="n">processed_questions</span><span class="p">[</span><span class="s1">&#39;q_len&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average answer length: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">avg_ans_count</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Average question length: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">avg_q_count</span><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total answers: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_answers</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of answers with length greater than 512: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_answers</span><span class="p">[</span><span class="n">processed_answers</span><span class="p">[</span><span class="s1">&#39;ans_len&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">512</span><span class="p">])))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Average answer length: 136
Average question length: 11
Total answers: 57600
Number of answers with length greater than 512: 1233
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">word2index</span><span class="p">,</span> <span class="n">word2count</span> <span class="o">=</span> <span class="n">create_vocab</span><span class="p">(</span><span class="n">processed_answers</span><span class="p">,</span> <span class="n">processed_questions</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Vocab size: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">word2index</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Top </span><span class="si">{}</span><span class="s2"> common words: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="n">Counter</span><span class="p">(</span><span class="n">word2count</span><span class="p">)</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">35</span><span class="p">)))</span>

<span class="n">qid_to_text</span><span class="p">,</span> <span class="n">docid_to_text</span> <span class="o">=</span> <span class="n">id_to_text</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">queries</span><span class="p">)</span>
<span class="n">qid_to_tokenized_text</span><span class="p">,</span> <span class="n">docid_to_tokenized_text</span> <span class="o">=</span> <span class="n">id_to_tokenized_text</span><span class="p">(</span><span class="n">processed_answers</span><span class="p">,</span> <span class="n">processed_questions</span><span class="p">)</span>

<span class="c1"># Save objects to pickle</span>
<span class="n">save_pickle</span><span class="p">(</span><span class="s2">&quot;data/qa_lstm_tokenizer/word2index.pickle&quot;</span><span class="p">,</span> <span class="n">word2index</span><span class="p">)</span>
<span class="n">save_pickle</span><span class="p">(</span><span class="s2">&quot;data/qa_lstm_tokenizer/word2count.pickle&quot;</span><span class="p">,</span> <span class="n">word2count</span><span class="p">)</span>

<span class="c1"># id map to raw text</span>
<span class="n">save_pickle</span><span class="p">(</span><span class="s2">&quot;data/id_to_text/qid_to_text.pickle&quot;</span><span class="p">,</span> <span class="n">qid_to_text</span><span class="p">)</span>
<span class="n">save_pickle</span><span class="p">(</span><span class="s2">&quot;data/id_to_text/docid_to_text.pickle&quot;</span><span class="p">,</span> <span class="n">docid_to_text</span><span class="p">)</span>

<span class="c1"># id map to tokenized text</span>
<span class="n">save_pickle</span><span class="p">(</span><span class="s2">&quot;data/qa_lstm_tokenizer/qid_to_tokenized_text.pickle&quot;</span><span class="p">,</span> <span class="n">qid_to_tokenized_text</span><span class="p">)</span>
<span class="n">save_pickle</span><span class="p">(</span><span class="s2">&quot;data/qa_lstm_tokenizer/docid_to_tokenized_text.pickle&quot;</span><span class="p">,</span> <span class="n">docid_to_tokenized_text</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Vocab size: 85034
Top 35 common words: [(&#39;the&#39;, 371203), (&#39;to&#39;, 233559), (&#39;a&#39;, 201620), (&#39;you&#39;, 166702), (&#39;and&#39;, 163066), (&#39;of&#39;, 157574), (&#39;is&#39;, 129894), (&#39;in&#39;, 120019), (&#39;that&#39;, 111416), (&#39;for&#39;, 89366), (&#39;it&#39;, 83822), (&#39;i&#39;, 74100), (&#39;your&#39;, 68153), (&#39;are&#39;, 67255), (&#39;if&#39;, 60689), (&#39;be&#39;, 59266), (&#39;on&#39;, 58382), (&#39;have&#39;, 55754), (&#39;as&#39;, 50088), (&#39;this&#39;, 49868), (&#39;not&#39;, 49227), (&#39;or&#39;, 46080), (&#39;with&#39;, 45894), (&#39;they&#39;, 44485), (&#39;but&#39;, 41690), (&#39;can&#39;, 38863), (&#39;will&#39;, 36865), (&#39;at&#39;, 35548), (&#39;an&#39;, 31392), (&#39;money&#39;, 31003), (&#39;so&#39;, 29980), (&#39;$&#39;, 29096), (&#39;would&#39;, 28750), (&#39;from&#39;, 28582), (&#39;more&#39;, 27378)]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="FinBERT-QA"><strong>FinBERT-QA</strong><a class="anchor-link" href="#FinBERT-QA"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>git clone https://github.com/sparsh9012/FinBERT-QA
<span class="o">%</span><span class="k">cd</span> FinBERT-QA
<span class="kn">from</span> <span class="nn">src.utils</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Cloning into &#39;FinBERT-QA&#39;...
remote: Enumerating objects: 153, done.
remote: Counting objects: 100% (153/153), done.
remote: Compressing objects: 100% (115/115), done.
remote: Total 1062 (delta 96), reused 79 (delta 38), pack-reused 909
Receiving objects: 100% (1062/1062), 230.70 MiB | 23.22 MiB/s, done.
Resolving deltas: 100% (598/598), done.
Checking out files: 100% (58/58), done.
/content/FinBERT-QA
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install transformers
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">regex</span> <span class="k">as</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using device:&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
<span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">deterministic</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Using device: cuda
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;torch._C.Generator at 0x7f718636cbf0&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">collection</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;retriever/collection_cleaned.tsv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;docid&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;doc&#39;</span><span class="p">})</span>
<span class="c1"># Questions - qid, text</span>
<span class="n">query_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/raw/FiQA_train_question_final.tsv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">queries</span> <span class="o">=</span> <span class="n">query_df</span><span class="p">[[</span><span class="s1">&#39;qid&#39;</span><span class="p">,</span> <span class="s1">&#39;question&#39;</span><span class="p">]]</span>

<span class="c1"># List of empty docs</span>
<span class="n">empty_docs</span> <span class="o">=</span> <span class="n">load_pickle</span><span class="p">(</span><span class="s1">&#39;data/id_to_text/empty_docs.pickle&#39;</span><span class="p">)</span>

<span class="c1"># docid to text mapping</span>
<span class="n">docid_to_text</span> <span class="o">=</span> <span class="n">load_pickle</span><span class="p">(</span><span class="s1">&#39;data/id_to_text/docid_to_text.pickle&#39;</span><span class="p">)</span>
<span class="c1"># qid to text mapping</span>
<span class="n">qid_to_text</span> <span class="o">=</span> <span class="n">load_pickle</span><span class="p">(</span><span class="s1">&#39;data/id_to_text/qid_to_text.pickle&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/raw/FiQA_train_question_doc_final.tsv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[[</span><span class="s2">&quot;qid&quot;</span><span class="p">,</span> <span class="s2">&quot;docid&quot;</span><span class="p">]]</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="o">~</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;docid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">empty_docs</span><span class="p">)]</span>
<span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;question&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;qid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">qid_to_text</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;answer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;docid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">docid_to_text</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>qid</th>
      <th>docid</th>
      <th>question</th>
      <th>answer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>18850</td>
      <td>What is considered a business expense on a bus...</td>
      <td>The IRS Guidance pertaining to the subject.  I...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>14255</td>
      <td>Claiming business expenses for a business with...</td>
      <td>Yes you can claim your business deductions if ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>308938</td>
      <td>Transferring money from One business checking ...</td>
      <td>You should have separate files for each of the...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>296717</td>
      <td>Having a separate bank account for business/in...</td>
      <td>Having a separate checking account for the bus...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>100764</td>
      <td>Having a separate bank account for business/in...</td>
      <td>You don't specify which country you are in, so...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">add_ques_token</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="n">question</span> <span class="o">=</span> <span class="n">string</span> <span class="o">+</span> <span class="s2">&quot; [SEP] &quot;</span>
    <span class="k">return</span> <span class="n">question</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;question&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;question&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">add_ques_token</span><span class="p">)</span>
<span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;seq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;question&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;answer&#39;</span><span class="p">]</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[[</span><span class="s1">&#39;seq&#39;</span><span class="p">]]</span>

<span class="n">dataset</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">17081</span><span class="p">,</span> <span class="s2">&quot;seq&quot;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#34;Is it wise to switch investment strategy frequently? [SEP] My super fund and I would say many other funds give you one free switch of strategies per year.  Some suggest you should change from high growth option to a more balance option once you are say about 10 to 15 years from retirement, and then change to a more capital guaranteed option a few years from retirement. This is a more passive approach and has benefits as well as disadvantages. The benefit is that there is not much work involved, you just change your investment option based on your life stage, 2 to 3 times during your lifetime. This allows you to take more risk when you are young to aim for higher returns, take a balanced approach with moderate risk and returns during the middle part of your working life, and take less risk with lower returns (above inflation) during the latter part of your working life. A possible disadvantage of this strategy is you may be in the higher risk/ higher growth option during a market correction and then change to a more balanced option just when the market starts to pick up again. So your funds will be hit with large losses whilst the market is in retreat and just when things look to be getting better you change to a more balanced portfolio and miss out on the big gains. A second more active approach would be to track the market and change investment option as the market changes. One approach which shouldn&#39;t take much time is to track the index such as the ASX200 (if you investment option is mainly invested in the Australian stock market) with a 200 day Simple Moving Average (SMA). The concept is that if the index crosses above the 200 day SMA the market is bullish and if it crosses below it is bearish. See the chart below:  This strategy will work well when the market is trending up or down but not very well when the market is going sideways, as you will be changing from aggressive to balanced and back too often. Possibly a more appropriate option would be a combination of the two. Use the first passive approach to change investment option from aggressive to balanced to capital guaranteed with your life stages, however use the second active approach to time the change. For example, if you were say in your late 40s now and were looking to change from aggressive to balanced in the near future, you could wait until the ASX200 crosses below the 200 day SMA before making the change. This way you could capture the majority of the uptrend (which could go on for years) before changing from the high growth/aggressive option to the balanced option. If you where after more control over your superannuation assets another option open to you is to start a SMSF, however I would recommend having at least $300K to $400K in assets before starting a SMSF, or else the annual costs would be too high as a percentage of your total super assets.&#34;</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;data/data.txt&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_NONE</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

</div>



  </div><a class="u-url" href="/2022/01/29/finbert.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Jupyter notebook database.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/recohut" target="_blank" title="recohut"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
