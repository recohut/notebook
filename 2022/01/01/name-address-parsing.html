<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Name and Address Parsing | reconb</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Name and Address Parsing" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Recognising Person names and Addresses in a text using NER and NLP modeling techniques" />
<meta property="og:description" content="Recognising Person names and Addresses in a text using NER and NLP modeling techniques" />
<link rel="canonical" href="https://nb.recohut.com/2022/01/01/name-address-parsing.html" />
<meta property="og:url" content="https://nb.recohut.com/2022/01/01/name-address-parsing.html" />
<meta property="og:site_name" content="reconb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-01T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Name and Address Parsing" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-01T00:00:00-06:00","datePublished":"2022-01-01T00:00:00-06:00","description":"Recognising Person names and Addresses in a text using NER and NLP modeling techniques","headline":"Name and Address Parsing","mainEntityOfPage":{"@type":"WebPage","@id":"https://nb.recohut.com/2022/01/01/name-address-parsing.html"},"url":"https://nb.recohut.com/2022/01/01/name-address-parsing.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nb.recohut.com/feed.xml" title="reconb" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">reconb</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Name and Address Parsing</h1><p class="page-description">Recognising Person names and Addresses in a text using NER and NLP modeling techniques</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-01-01T00:00:00-06:00" itemprop="datePublished">
        Jan 1, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      136 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/recohut/notebook/tree/master/_notebooks/2022-01-01-name-address-parsing.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/recohut/notebook/master?filepath=_notebooks%2F2022-01-01-name-address-parsing.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/recohut/notebook/blob/master/_notebooks/2022-01-01-name-address-parsing.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Frecohut%2Fnotebook%2Fblob%2Fmaster%2F_notebooks%2F2022-01-01-name-address-parsing.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-01-01-name-address-parsing.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Get-data-from-MongoDB">Get data from MongoDB<a class="anchor-link" href="#Get-data-from-MongoDB"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">pymongo</span><span class="p">[</span><span class="n">tls</span><span class="p">,</span><span class="n">srv</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="n">tqdm</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span>
<span class="o">%</span><span class="n">reload_ext</span> <span class="n">google</span><span class="o">.</span><span class="n">colab</span><span class="o">.</span><span class="n">data_table</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">pymongo</span> 
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="n">mongo_uri</span> <span class="o">=</span> <span class="s2">&quot;mongodb+srv://&lt;userid&gt;:&lt;pass&gt;@&lt;server&gt;.azure.mongodb.net/&lt;db&gt;?retryWrites=true&amp;w=majority&quot;</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">(</span><span class="n">mongo_uri</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">listdb</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_database_names</span><span class="p">();</span> <span class="n">listdb</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;testdb&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="p">[</span><span class="s1">&#39;testdb&#39;</span><span class="p">]</span>
<span class="n">db</span><span class="o">.</span><span class="n">list_collection_names</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;entities&#39;, &#39;parcels&#39;, &#39;taxes&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="s2">&quot;dbstats&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;$clusterTime&#39;: {&#39;clusterTime&#39;: Timestamp(1598254711, 1),
  &#39;signature&#39;: {&#39;hash&#39;: b&#39;\x19\x92\xd6\x94\x06\xed\xa9\xb5s+\x8e\xcaqn\xb3J\x13_\x1e\xab&#39;,
   &#39;keyId&#39;: 6839689286636273667}},
 &#39;avgObjSize&#39;: 597.6787450874097,
 &#39;collections&#39;: 3,
 &#39;dataSize&#39;: 5494893423.0,
 &#39;db&#39;: &#39;testdb&#39;,
 &#39;fsTotalSize&#39;: 34342961152.0,
 &#39;fsUsedSize&#39;: 11420770304.0,
 &#39;indexSize&#39;: 378994688.0,
 &#39;indexes&#39;: 9,
 &#39;numExtents&#39;: 0,
 &#39;objects&#39;: 9193724,
 &#39;ok&#39;: 1.0,
 &#39;operationTime&#39;: Timestamp(1598254711, 1),
 &#39;scaleFactor&#39;: 1.0,
 &#39;storageSize&#39;: 2160832512.0,
 &#39;views&#39;: 0}</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1"># df1 = pd.DataFrame(list(collection1.find()))</span>
<span class="c1"># print(df1.info())</span>
<span class="c1"># # print(df1.describe())</span>
<span class="c1"># df1.sample(5)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1"># del df1</span>
<span class="c1"># import gc</span>
<span class="c1"># gc.collect()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>258</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">collection2</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s1">&#39;parcels&#39;</span><span class="p">]</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">collection2</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
<span class="nb">max</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">maxL</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cnt</span><span class="p">):</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">max</span><span class="p">:</span>
    <span class="nb">max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
    <span class="n">maxL</span> <span class="o">=</span> <span class="n">xx</span>
<span class="nb">max</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>46</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">cnt</span> <span class="o">=</span> <span class="n">collection2</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">maxL</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>4597</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">collection2</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s1">&#39;parcels&#39;</span><span class="p">]</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">collection2</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
<span class="n">XX</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">maxL</span><span class="p">))</span>
<span class="n">XX</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;df_parcels.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">((</span><span class="n">cnt</span><span class="o">//</span><span class="mi">10000</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
  <span class="n">YY</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
    <span class="n">YY</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
  <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">YY</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;df_parcels.csv&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># pd.DataFrame(next(cursor), index=[j]).to_csv(&#39;df_parcels.csv&#39;, mode=&#39;a&#39;, index=False, header=False)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre> 33%|███▎      | 150/460 [04:52&lt;10:09,  1.97s/it]</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;df_parcels.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">collection2</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="s1">&#39;parcels&#39;</span><span class="p">]</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">collection2</span><span class="o">.</span><span class="n">find</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
<span class="c1"># print(df2.describe())</span>
<span class="c1"># df2.sample(5)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-wrangling">Data wrangling<a class="anchor-link" href="#Data-wrangling"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">probablepeople</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">usaddress</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span>  <span class="nn">probablepeople</span> <span class="k">as</span> <span class="nn">pp</span>
<span class="kn">import</span> <span class="nn">usaddress</span> <span class="k">as</span> <span class="nn">ua</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;punkt&#39;</span><span class="p">)</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;averaged_perceptron_tagger&#39;</span><span class="p">)</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;maxent_ne_chunker&#39;</span><span class="p">)</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s1">&#39;words&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="n">tqdm</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span>
<span class="o">%</span><span class="n">reload_ext</span> <span class="n">autoreload</span>
<span class="o">%</span><span class="n">autoreload</span> <span class="mi">2</span>
<span class="o">%</span><span class="n">reload_ext</span> <span class="n">google</span><span class="o">.</span><span class="n">colab</span><span class="o">.</span><span class="n">data_table</span>
<span class="o">%</span><span class="n">config</span> <span class="n">InlineBackend</span><span class="o">.</span><span class="n">figure_format</span> <span class="o">=</span> <span class="s1">&#39;retina&#39;</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;fivethirtyeight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-notebook&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;sample.p&#39;</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">oor</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 1000 entries, 3605089 to 2516200
Data columns (total 2 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   _id     1000 non-null   object
 1   oor     1000 non-null   object
dtypes: object(2)
memory usage: 23.4+ KB
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">combos</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; US &#39;</span><span class="p">,</span><span class="s1">&#39; USA &#39;</span><span class="p">,</span><span class="s1">&#39; U.S. &#39;</span><span class="p">,</span><span class="s1">&#39; U.S.A. &#39;</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">patch_country</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">cflagz</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
  <span class="n">otext</span> <span class="o">=</span> <span class="n">text</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
  <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">combos</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
      <span class="n">cflagz</span> <span class="o">=</span> <span class="n">i</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">otext</span><span class="p">[:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">cflagz</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">text</span><span class="p">,</span> <span class="n">cflagz</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">patch_household</span><span class="p">(</span><span class="n">xz</span><span class="p">):</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">xz</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Person&#39;</span>
  <span class="k">if</span> <span class="s1">&#39;And&#39;</span> <span class="ow">in</span> <span class="n">xx</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Household&#39;</span><span class="p">:</span><span class="n">xz</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Household&#39;</span>
  <span class="k">return</span> <span class="n">xx</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">tags</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">LABELS</span>
<span class="n">tags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ua</span><span class="o">.</span><span class="n">LABELS</span><span class="p">)</span>
<span class="n">tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">))</span>
<span class="n">additionals</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CountryName&#39;</span><span class="p">,</span> <span class="s1">&#39;Household&#39;</span><span class="p">,</span> <span class="s1">&#39;Type&#39;</span><span class="p">,</span> <span class="s1">&#39;NameConfidence&#39;</span><span class="p">,</span> <span class="s1">&#39;AddrConfidence&#39;</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">]</span>
<span class="n">tags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">additionals</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dfx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
<span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="o">~</span><span class="n">dfx</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1">#   # replace long country name with short one</span>
<span class="c1">#   text = re.sub(&#39;UNITED STATES OF AMERICA&#39;,&#39;US&#39;,text)</span>
<span class="c1">#   # country patch</span>
<span class="c1">#   text, cflag = patch_country(text)</span>
<span class="c1">#   # try and catch</span>
<span class="c1">#   try:</span>
<span class="c1">#     df1 = pd.DataFrame(ua.tag(text)[0], index=[0])</span>
<span class="c1">#     xz = df1.Recipient.values[0]</span>
<span class="c1">#     df2 = patch_household(xz)</span>
<span class="c1">#     xx = pd.concat([df1,df2], axis=1)</span>
<span class="c1">#     xx[&#39;Confidence&#39;] = ua.tag(text)[1]</span>
<span class="c1">#   except:</span>
<span class="c1">#     try:</span>
<span class="c1">#       df2 = patch_household(text)</span>
<span class="c1">#       xx = df2</span>
<span class="c1">#       xx[&#39;Confidence&#39;] = &#39;AddressError&#39;</span>
<span class="c1">#     except:</span>
<span class="c1">#       xx = pd.DataFrame({&#39;Recipient&#39;:text}, index=[0])</span>
<span class="c1">#       xx[&#39;Confidence&#39;] = &#39;PersonError&#39;</span>
<span class="c1">#   # add country label</span>
<span class="c1">#   if cflag!=&#39;&#39;:</span>
<span class="c1">#     xx[&#39;CountryName&#39;] = cflag</span>
    
<span class="c1">#   return xx#.T.to_dict()[0]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">temp</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="c1"># country patch</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;UNITED STATES OF AMERICA&#39;</span><span class="p">,</span><span class="s1">&#39;US&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
  <span class="n">text</span><span class="p">,</span> <span class="n">cflag</span> <span class="o">=</span> <span class="n">patch_country</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="c1"># address parsing</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ua</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">text</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;AddrConfidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ua</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">text</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ua</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">))</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)})</span><span class="o">.</span><span class="n">T</span>
    <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;AddrConfidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Error&#39;</span>
  <span class="c1"># address to name linking</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">xz</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">Recipient</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="n">xz</span> <span class="o">=</span> <span class="n">text</span>
  <span class="c1"># name parsing</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">xz</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;NameConfidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">xz</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">xz</span><span class="p">))</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)})</span><span class="o">.</span><span class="n">T</span>
    <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;NameConfidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Error&#39;</span>
  <span class="c1"># person name patch</span>
  <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Person&#39;</span>
  <span class="k">if</span> <span class="s1">&#39;MiddleName&#39;</span> <span class="ow">in</span> <span class="n">df2</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
    <span class="n">gname</span><span class="p">,</span> <span class="n">mname</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">MiddleName</span><span class="p">,</span> <span class="n">df2</span><span class="o">.</span><span class="n">Surname</span><span class="p">,</span> <span class="n">df2</span><span class="o">.</span><span class="n">GivenName</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">MiddleName</span><span class="p">,</span> <span class="n">df2</span><span class="o">.</span><span class="n">Surname</span><span class="p">,</span> <span class="n">df2</span><span class="o">.</span><span class="n">GivenName</span> <span class="o">=</span> <span class="n">mname</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sname</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">elif</span> <span class="s1">&#39;GivenName&#39;</span> <span class="ow">in</span> <span class="n">df2</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
    <span class="n">gname</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">Surname</span><span class="p">,</span> <span class="n">df2</span><span class="o">.</span><span class="n">GivenName</span>
    <span class="n">df2</span><span class="o">.</span><span class="n">Surname</span><span class="p">,</span> <span class="n">df2</span><span class="o">.</span><span class="n">GivenName</span> <span class="o">=</span> <span class="n">sname</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="c1"># household name patch</span>
  <span class="k">if</span> <span class="s1">&#39;And&#39;</span> <span class="ow">in</span> <span class="n">df2</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Household&#39;</span><span class="p">:</span><span class="n">xz</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Household&#39;</span>
  <span class="c1"># concatenation</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span>  
  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;CountryName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cflag</span> <span class="k">if</span> <span class="n">cflag</span><span class="o">!=</span><span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;CorporationName&#39;</span><span class="p">]),</span> <span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Corporation&#39;</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
  <span class="k">return</span> <span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">errs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">dfx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
<span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="o">~</span><span class="n">dfx</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
    <span class="n">dfx</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">dfx</span><span class="p">[</span><span class="s1">&#39;CorporationName&#39;</span><span class="p">]),</span> <span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Corporation&#39;</span>
  <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">errs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
    <span class="k">pass</span>
<span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>1000it [00:18, 52.66it/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">err_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">errs</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">err_df</span> <span class="o">=</span> <span class="n">err_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">),</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">err_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
<span class="n">err_df</span> <span class="o">=</span> <span class="n">err_df</span><span class="p">[[</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">]]</span>
<span class="n">err_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dfbackup</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dfx</span> <span class="o">=</span> <span class="n">dfbackup</span><span class="p">[</span><span class="n">tags</span><span class="p">]</span>
<span class="n">dfx</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Recipient&#39;</span><span class="p">,</span> <span class="s1">&#39;CountryName&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*$&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="n">dfx</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 989 entries, 0 to 0
Data columns (total 39 columns):
 #   Column                           Non-Null Count  Dtype 
---  ------                           --------------  ----- 
 0   USPSBoxType                      59 non-null     object
 1   CorporationCommitteeType         1 non-null      object
 2   SubaddressType                   18 non-null     object
 3   ZipCode                          703 non-null    object
 4   GivenName                        417 non-null    object
 5   StreetNamePreDirectional         86 non-null     object
 6   CorporationNameAndCompany        4 non-null      object
 7   StreetName                       906 non-null    object
 8   CorporationName                  381 non-null    object
 9   PlaceName                        888 non-null    object
 10  StateName                        807 non-null    object
 11  ShortForm                        1 non-null      object
 12  Surname                          407 non-null    object
 13  CorporationLegalType             106 non-null    object
 14  StreetNamePostType               863 non-null    object
 15  PrefixOther                      7 non-null      object
 16  CorporationNameBranchType        4 non-null      object
 17  AddressNumber                    902 non-null    object
 18  USPSBoxID                        59 non-null     object
 19  MiddleInitial                    152 non-null    object
 20  AddressNumberSuffix              1 non-null      object
 21  CorporationNameBranchIdentifier  9 non-null      object
 22  SuffixOther                      3 non-null      object
 23  LandmarkName                     2 non-null      object
 24  CorporationNameOrganization      57 non-null     object
 25  BuildingName                     52 non-null     object
 26  OccupancyIdentifier              227 non-null    object
 27  MiddleName                       33 non-null     object
 28  StreetNamePreType                16 non-null     object
 29  StreetNamePostDirectional        15 non-null     object
 30  OccupancyType                    170 non-null    object
 31  FirstInitial                     1 non-null      object
 32  SubaddressIdentifier             19 non-null     object
 33  SuffixGenerational               8 non-null      object
 34  Household                        192 non-null    object
 35  Type                             989 non-null    object
 36  NameConfidence                   797 non-null    object
 37  AddrConfidence                   989 non-null    object
 38  Text                             986 non-null    object
dtypes: object(39)
memory usage: 309.1+ KB
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">temp</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;AddrConfidence&#39;</span><span class="p">,</span><span class="s1">&#39;NameConfidence&#39;</span><span class="p">,</span><span class="s1">&#39;Text&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Recipient&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1"># import gradio as gr</span>
<span class="n">gr</span><span class="o">.</span><span class="n">Interface</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Sampling">Sampling<a class="anchor-link" href="#Sampling"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">tqdm</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1"># df.info()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1">#   text = re.sub(&#39;&quot;&#39;,&#39;&#39;,text)</span>
<span class="c1">#   text = re.sub(&#39;,&#39;,&#39;&#39;,text)</span>
<span class="c1">#   text = &#39; &#39;.join(text.split())</span>
<span class="c1">#   return text</span>

<span class="c1"># sampledf = df[[&#39;oor&#39;]].sample(5000, random_state=40)</span>
<span class="c1"># sampledf[&#39;oor&#39;] = sampledf.oor.apply(process_text)</span>
<span class="c1"># sampledf = sampledf.replace(r&#39;^\s*$&#39;, np.nan, regex=True).dropna()</span>
<span class="c1"># msk = np.random.rand(len(sampledf)) &lt; 0.8</span>
<span class="c1"># sampledf[msk].to_csv(&#39;train_28118_21.csv&#39;, index=False, header=None)</span>
<span class="c1"># sampledf[~msk].to_csv(&#39;test_28118_21.csv&#39;, index=False, header=None)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">doccano</span><span class="o">-</span><span class="n">transformer</span>

<span class="kn">import</span> <span class="nn">spacy</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">doccano_transformer.datasets</span> <span class="kn">import</span> <span class="n">NERDataset</span>
<span class="kn">from</span> <span class="nn">doccano_transformer.utils</span> <span class="kn">import</span> <span class="n">read_jsonl</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">read_jsonl</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;file.json1&#39;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="n">NERDataset</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">to_spacy</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">)</span>

<span class="n">TRAIN_DATA</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;entities&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">TRAIN_DATA</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">xx</span><span class="p">))</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">train_spacy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">iterations</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">TRAIN_DATA</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Loaded model &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">model</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">blank</span><span class="p">(</span><span class="s2">&quot;en&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Created blank &#39;en&#39; model&quot;</span><span class="p">)</span> 
    <span class="k">if</span> <span class="s1">&#39;ner&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nlp</span><span class="o">.</span><span class="n">pipe_names</span><span class="p">:</span>
        <span class="n">ner</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">create_pipe</span><span class="p">(</span><span class="s1">&#39;ner&#39;</span><span class="p">)</span>
        <span class="n">nlp</span><span class="o">.</span><span class="n">add_pipe</span><span class="p">(</span><span class="n">ner</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ner</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">get_pipe</span><span class="p">(</span><span class="s2">&quot;ner&quot;</span><span class="p">)</span>
    <span class="c1"># add labels</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">annotations</span> <span class="ow">in</span> <span class="n">TRAIN_DATA</span><span class="p">:</span>
         <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">annotations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;entities&#39;</span><span class="p">):</span>
            <span class="n">ner</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="n">ent</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="c1"># get names of other pipes to disable them during training</span>
    <span class="n">other_pipes</span> <span class="o">=</span> <span class="p">[</span><span class="n">pipe</span> <span class="k">for</span> <span class="n">pipe</span> <span class="ow">in</span> <span class="n">nlp</span><span class="o">.</span><span class="n">pipe_names</span> <span class="k">if</span> <span class="n">pipe</span> <span class="o">!=</span> <span class="s1">&#39;ner&#39;</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">nlp</span><span class="o">.</span><span class="n">disable_pipes</span><span class="p">(</span><span class="o">*</span><span class="n">other_pipes</span><span class="p">):</span>  <span class="c1"># only train NER</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">nlp</span><span class="o">.</span><span class="n">begin_training</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">itn</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Statring iteration &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">itn</span><span class="p">))</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">TRAIN_DATA</span><span class="p">)</span>
            <span class="n">losses</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">text</span><span class="p">,</span> <span class="n">annotations</span> <span class="ow">in</span> <span class="n">TRAIN_DATA</span><span class="p">:</span>
                <span class="n">nlp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">text</span><span class="p">],</span>  <span class="c1"># batch of texts</span>
                    <span class="p">[</span><span class="n">annotations</span><span class="p">],</span>  <span class="c1"># batch of annotations</span>
                    <span class="n">drop</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># dropout - make it harder to memorise data</span>
                    <span class="n">sgd</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>  <span class="c1"># callable to update weights</span>
                    <span class="n">losses</span><span class="o">=</span><span class="n">losses</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nlp</span>

<span class="n">prdnlp</span> <span class="o">=</span> <span class="n">train_spacy</span><span class="p">(</span><span class="n">TRAIN_DATA</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Created blank &#39;en&#39; model
Statring iteration 0
{&#39;ner&#39;: 3007.4073503919476}
Statring iteration 1
{&#39;ner&#39;: 1640.818005657745}
Statring iteration 2
{&#39;ner&#39;: 1289.2707772499139}
Statring iteration 3
{&#39;ner&#39;: 1141.5257107774235}
Statring iteration 4
{&#39;ner&#39;: 915.537918427113}
Statring iteration 5
{&#39;ner&#39;: 880.0738022538334}
Statring iteration 6
{&#39;ner&#39;: 697.9718340145506}
Statring iteration 7
{&#39;ner&#39;: 477.89584190603824}
Statring iteration 8
{&#39;ner&#39;: 450.35748743359136}
Statring iteration 9
{&#39;ner&#39;: 408.3674275620642}
Statring iteration 10
{&#39;ner&#39;: 379.27579749970243}
Statring iteration 11
{&#39;ner&#39;: 346.4166141593435}
Statring iteration 12
{&#39;ner&#39;: 294.0780766001076}
Statring iteration 13
{&#39;ner&#39;: 312.39254089213495}
Statring iteration 14
{&#39;ner&#39;: 306.54315512528}
Statring iteration 15
{&#39;ner&#39;: 394.02619706473706}
Statring iteration 16
{&#39;ner&#39;: 329.8686837863413}
Statring iteration 17
{&#39;ner&#39;: 243.71909372259998}
Statring iteration 18
{&#39;ner&#39;: 201.99860228650502}
Statring iteration 19
{&#39;ner&#39;: 249.2113459896862}
Statring iteration 20
{&#39;ner&#39;: 200.50580345321632}
Statring iteration 21
{&#39;ner&#39;: 203.6012216762892}
Statring iteration 22
{&#39;ner&#39;: 216.91352384181457}
Statring iteration 23
{&#39;ner&#39;: 170.84705919902856}
Statring iteration 24
{&#39;ner&#39;: 164.8909013102319}
Statring iteration 25
{&#39;ner&#39;: 193.93717929963952}
Statring iteration 26
{&#39;ner&#39;: 191.0499136952823}
Statring iteration 27
{&#39;ner&#39;: 144.50596934262782}
Statring iteration 28
{&#39;ner&#39;: 112.48423485208683}
Statring iteration 29
{&#39;ner&#39;: 113.15940568551123}
Statring iteration 30
{&#39;ner&#39;: 136.3830650721747}
Statring iteration 31
{&#39;ner&#39;: 139.7798031159334}
Statring iteration 32
{&#39;ner&#39;: 163.21875928538373}
Statring iteration 33
{&#39;ner&#39;: 115.9297133825796}
Statring iteration 34
{&#39;ner&#39;: 140.93693039396598}
Statring iteration 35
{&#39;ner&#39;: 116.71246354378027}
Statring iteration 36
{&#39;ner&#39;: 170.87708768714472}
Statring iteration 37
{&#39;ner&#39;: 124.15492459404803}
Statring iteration 38
{&#39;ner&#39;: 190.71491197285565}
Statring iteration 39
{&#39;ner&#39;: 162.29246844203396}
Statring iteration 40
{&#39;ner&#39;: 134.55304101952095}
Statring iteration 41
{&#39;ner&#39;: 130.60836013024547}
Statring iteration 42
{&#39;ner&#39;: 136.4238097917081}
Statring iteration 43
{&#39;ner&#39;: 116.86265112170219}
Statring iteration 44
{&#39;ner&#39;: 116.84290412192209}
Statring iteration 45
{&#39;ner&#39;: 89.83010624119373}
Statring iteration 46
{&#39;ner&#39;: 126.09090652288113}
Statring iteration 47
{&#39;ner&#39;: 107.0513673316929}
Statring iteration 48
{&#39;ner&#39;: 114.20797615225301}
Statring iteration 49
{&#39;ner&#39;: 142.1074127770463}
Statring iteration 50
{&#39;ner&#39;: 99.95677993627112}
Statring iteration 51
{&#39;ner&#39;: 100.6022620463675}
Statring iteration 52
{&#39;ner&#39;: 117.44707920697988}
Statring iteration 53
{&#39;ner&#39;: 131.7446203021878}
Statring iteration 54
{&#39;ner&#39;: 132.76734728187301}
Statring iteration 55
{&#39;ner&#39;: 136.53457251871527}
Statring iteration 56
{&#39;ner&#39;: 103.27860139948064}
Statring iteration 57
{&#39;ner&#39;: 121.60806154204668}
Statring iteration 58
{&#39;ner&#39;: 96.05090789835904}
Statring iteration 59
{&#39;ner&#39;: 109.94556900557446}
Statring iteration 60
{&#39;ner&#39;: 96.82272508236082}
Statring iteration 61
{&#39;ner&#39;: 129.51250446670463}
Statring iteration 62
{&#39;ner&#39;: 106.03270599927677}
Statring iteration 63
{&#39;ner&#39;: 115.0976263618546}
Statring iteration 64
{&#39;ner&#39;: 88.34086685584758}
Statring iteration 65
{&#39;ner&#39;: 157.036287102779}
Statring iteration 66
{&#39;ner&#39;: 127.04642437650256}
Statring iteration 67
{&#39;ner&#39;: 79.87674273006331}
Statring iteration 68
{&#39;ner&#39;: 97.72415562350238}
Statring iteration 69
{&#39;ner&#39;: 71.47541468801484}
Statring iteration 70
{&#39;ner&#39;: 86.66635256702929}
Statring iteration 71
{&#39;ner&#39;: 78.28009573217551}
Statring iteration 72
{&#39;ner&#39;: 101.21867063560613}
Statring iteration 73
{&#39;ner&#39;: 113.42253603547707}
Statring iteration 74
{&#39;ner&#39;: 74.02527445586985}
Statring iteration 75
{&#39;ner&#39;: 103.4914064937719}
Statring iteration 76
{&#39;ner&#39;: 108.29772503703303}
Statring iteration 77
{&#39;ner&#39;: 64.16112010122416}
Statring iteration 78
{&#39;ner&#39;: 89.14806470876665}
Statring iteration 79
{&#39;ner&#39;: 80.14840250376568}
Statring iteration 80
{&#39;ner&#39;: 71.5883191063432}
Statring iteration 81
{&#39;ner&#39;: 73.07590399083298}
Statring iteration 82
{&#39;ner&#39;: 81.01268074436088}
Statring iteration 83
{&#39;ner&#39;: 142.55277005220944}
Statring iteration 84
{&#39;ner&#39;: 80.56187383613884}
Statring iteration 85
{&#39;ner&#39;: 56.66002598536001}
Statring iteration 86
{&#39;ner&#39;: 75.48618471345496}
Statring iteration 87
{&#39;ner&#39;: 103.27411897998708}
Statring iteration 88
{&#39;ner&#39;: 80.93598803041472}
Statring iteration 89
{&#39;ner&#39;: 47.13465817053686}
Statring iteration 90
{&#39;ner&#39;: 80.80593497289446}
Statring iteration 91
{&#39;ner&#39;: 80.23257168553066}
Statring iteration 92
{&#39;ner&#39;: 77.76883087722625}
Statring iteration 93
{&#39;ner&#39;: 55.65347701043213}
Statring iteration 94
{&#39;ner&#39;: 89.35111511088353}
Statring iteration 95
{&#39;ner&#39;: 79.00314757735156}
Statring iteration 96
{&#39;ner&#39;: 65.35716067004128}
Statring iteration 97
{&#39;ner&#39;: 56.28587518938693}
Statring iteration 98
{&#39;ner&#39;: 81.71841198099386}
Statring iteration 99
{&#39;ner&#39;: 76.2170802402442}
Statring iteration 100
{&#39;ner&#39;: 88.438144813448}
Statring iteration 101
{&#39;ner&#39;: 75.4497371768358}
Statring iteration 102
{&#39;ner&#39;: 69.0837430945765}
Statring iteration 103
{&#39;ner&#39;: 80.95287750385806}
Statring iteration 104
{&#39;ner&#39;: 56.38978539897921}
Statring iteration 105
{&#39;ner&#39;: 95.56712977220663}
Statring iteration 106
{&#39;ner&#39;: 73.44818791444992}
Statring iteration 107
{&#39;ner&#39;: 96.681513734765}
Statring iteration 108
{&#39;ner&#39;: 83.54745028512359}
Statring iteration 109
{&#39;ner&#39;: 82.28258017513707}
Statring iteration 110
{&#39;ner&#39;: 76.11429767638381}
Statring iteration 111
{&#39;ner&#39;: 70.677842896453}
Statring iteration 112
{&#39;ner&#39;: 78.4114684894903}
Statring iteration 113
{&#39;ner&#39;: 137.80636627675565}
Statring iteration 114
{&#39;ner&#39;: 90.58992412879711}
Statring iteration 115
{&#39;ner&#39;: 77.59162922836748}
Statring iteration 116
{&#39;ner&#39;: 79.11472978560138}
Statring iteration 117
{&#39;ner&#39;: 97.44872156902542}
Statring iteration 118
{&#39;ner&#39;: 82.57921556706805}
Statring iteration 119
{&#39;ner&#39;: 75.03047848060646}
Statring iteration 120
{&#39;ner&#39;: 65.176443017964}
Statring iteration 121
{&#39;ner&#39;: 90.93213611405073}
Statring iteration 122
{&#39;ner&#39;: 88.03100244628864}
Statring iteration 123
{&#39;ner&#39;: 75.11081016588405}
Statring iteration 124
{&#39;ner&#39;: 58.66655925046893}
Statring iteration 125
{&#39;ner&#39;: 69.53560818757661}
Statring iteration 126
{&#39;ner&#39;: 108.68449582282263}
Statring iteration 127
{&#39;ner&#39;: 79.93939748469059}
Statring iteration 128
{&#39;ner&#39;: 97.12128206166695}
Statring iteration 129
{&#39;ner&#39;: 66.71326428212518}
Statring iteration 130
{&#39;ner&#39;: 67.80617238615378}
Statring iteration 131
{&#39;ner&#39;: 71.10694379373025}
Statring iteration 132
{&#39;ner&#39;: 84.93086400565421}
Statring iteration 133
{&#39;ner&#39;: 66.42617340533587}
Statring iteration 134
{&#39;ner&#39;: 66.0006531892533}
Statring iteration 135
{&#39;ner&#39;: 79.0590667040617}
Statring iteration 136
{&#39;ner&#39;: 56.34694879532348}
Statring iteration 137
{&#39;ner&#39;: 93.08590892867396}
Statring iteration 138
{&#39;ner&#39;: 79.48240722942083}
Statring iteration 139
{&#39;ner&#39;: 90.01855674597377}
Statring iteration 140
{&#39;ner&#39;: 94.94601071171311}
Statring iteration 141
{&#39;ner&#39;: 96.33753246334507}
Statring iteration 142
{&#39;ner&#39;: 85.31780860309844}
Statring iteration 143
{&#39;ner&#39;: 64.3502144223992}
Statring iteration 144
{&#39;ner&#39;: 44.76739877565432}
Statring iteration 145
{&#39;ner&#39;: 75.19584754886498}
Statring iteration 146
{&#39;ner&#39;: 85.78498485330329}
Statring iteration 147
{&#39;ner&#39;: 82.02062879539898}
Statring iteration 148
{&#39;ner&#39;: 71.89864816581047}
Statring iteration 149
{&#39;ner&#39;: 101.74886387177537}
Statring iteration 150
{&#39;ner&#39;: 133.50597153341198}
Statring iteration 151
{&#39;ner&#39;: 132.47481127652287}
Statring iteration 152
{&#39;ner&#39;: 97.00087948943128}
Statring iteration 153
{&#39;ner&#39;: 81.35399803779734}
Statring iteration 154
{&#39;ner&#39;: 71.9473191832302}
Statring iteration 155
{&#39;ner&#39;: 75.58573800944022}
Statring iteration 156
{&#39;ner&#39;: 58.370277138800276}
Statring iteration 157
{&#39;ner&#39;: 73.41441315011774}
Statring iteration 158
{&#39;ner&#39;: 83.14729602659024}
Statring iteration 159
{&#39;ner&#39;: 83.61406908567942}
Statring iteration 160
{&#39;ner&#39;: 76.81167139744294}
Statring iteration 161
{&#39;ner&#39;: 98.38295274807352}
Statring iteration 162
{&#39;ner&#39;: 73.19471575157228}
Statring iteration 163
{&#39;ner&#39;: 83.75970380624479}
Statring iteration 164
{&#39;ner&#39;: 81.56307578801851}
Statring iteration 165
{&#39;ner&#39;: 71.0038795760797}
Statring iteration 166
{&#39;ner&#39;: 58.08838273499197}
Statring iteration 167
{&#39;ner&#39;: 87.6794171108352}
Statring iteration 168
{&#39;ner&#39;: 81.24304652928015}
Statring iteration 169
{&#39;ner&#39;: 55.985408498396254}
Statring iteration 170
{&#39;ner&#39;: 66.53066560449322}
Statring iteration 171
{&#39;ner&#39;: 83.74264410141662}
Statring iteration 172
{&#39;ner&#39;: 99.4259252921473}
Statring iteration 173
{&#39;ner&#39;: 68.21956037406137}
Statring iteration 174
{&#39;ner&#39;: 55.43247411461184}
Statring iteration 175
{&#39;ner&#39;: 73.03740028634614}
Statring iteration 176
{&#39;ner&#39;: 48.680459359344745}
Statring iteration 177
{&#39;ner&#39;: 73.34032645578972}
Statring iteration 178
{&#39;ner&#39;: 78.0468099301117}
Statring iteration 179
{&#39;ner&#39;: 85.26513345270467}
Statring iteration 180
{&#39;ner&#39;: 91.54000872509842}
Statring iteration 181
{&#39;ner&#39;: 67.43344801615157}
Statring iteration 182
{&#39;ner&#39;: 58.877072846170535}
Statring iteration 183
{&#39;ner&#39;: 80.61309921560128}
Statring iteration 184
{&#39;ner&#39;: 78.54305049317442}
Statring iteration 185
{&#39;ner&#39;: 82.52507337190778}
Statring iteration 186
{&#39;ner&#39;: 72.6478664494604}
Statring iteration 187
{&#39;ner&#39;: 48.719930834859966}
Statring iteration 188
{&#39;ner&#39;: 78.12825198790429}
Statring iteration 189
{&#39;ner&#39;: 74.57506968209292}
Statring iteration 190
{&#39;ner&#39;: 62.639232915815775}
Statring iteration 191
{&#39;ner&#39;: 81.41843749481622}
Statring iteration 192
{&#39;ner&#39;: 81.44864770046895}
Statring iteration 193
{&#39;ner&#39;: 78.21613277818398}
Statring iteration 194
{&#39;ner&#39;: 62.061153309127164}
Statring iteration 195
{&#39;ner&#39;: 62.953992718801345}
Statring iteration 196
{&#39;ner&#39;: 53.10038627353098}
Statring iteration 197
{&#39;ner&#39;: 98.58842041503256}
Statring iteration 198
{&#39;ner&#39;: 71.83606691682377}
Statring iteration 199
{&#39;ner&#39;: 72.84951195810225}
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1"># modelfile = input(&quot;Enter your Model Name: &quot;)</span>
<span class="c1"># prdnlp.to_disk(modelfile)</span>

<span class="n">prdnlp</span><span class="o">.</span><span class="n">to_disk</span><span class="p">(</span><span class="s1">&#39;ner233&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;ner233&#39;</span><span class="p">),</span><span class="s1">&#39;zip&#39;</span><span class="p">,</span><span class="s1">&#39;/content/ner233&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1"># test.head()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1"># from spacy.scorer import Scorer</span>

<span class="c1"># def evaluate(ner_model, examples):</span>
<span class="c1">#     scorer = Scorer()</span>
<span class="c1">#     for input_, annot in examples:</span>
<span class="c1">#         doc_gold_text = ner_model.make_doc(input_)</span>
<span class="c1">#         gold = GoldParse(doc_gold_text, entities=annot)</span>
<span class="c1">#         pred_value = ner_model(input_)</span>
<span class="c1">#         scorer.score(pred_value, gold)</span>
<span class="c1">#     return scorer.scores</span>

<span class="c1"># examples = [</span>
<span class="c1">#     (&#39;Who is Shaka Khan?&#39;,</span>
<span class="c1">#      [(7, 17, &#39;PERSON&#39;)]),</span>
<span class="c1">#     (&#39;I like London and Berlin.&#39;,</span>
<span class="c1">#      [(7, 13, &#39;LOC&#39;), (18, 24, &#39;LOC&#39;)])</span>
<span class="c1"># ]</span>

<span class="c1"># results = evaluate(prdnlp, examples)</span>

<span class="c1"># def report_scores(scores, e):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     prints precision recall and f_measure</span>
<span class="c1">#     :param scores:</span>
<span class="c1">#     :return:</span>
<span class="c1">#     &quot;&quot;&quot;</span>

<span class="c1">#     precision = &#39;%.2f&#39; % scores[&#39;ents_p&#39;]</span>
<span class="c1">#     recall = &#39;%.2f&#39; % scores[&#39;ents_r&#39;]</span>
<span class="c1">#     f_measure = &#39;%.2f&#39; % scores[&#39;ents_f&#39;]</span>
<span class="c1">#     print(&#39;%-25s %-10s %-10s %-10s&#39; % (e, precision, recall, f_measure))</span>

<span class="c1"># report_scores(results, &#39;x&#39;)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>x                         0.00       0.00       0.00      
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EntityType&#39;</span><span class="p">,</span><span class="s1">&#39;Recipient&#39;</span><span class="p">,</span><span class="s1">&#39;Address&#39;</span><span class="p">,</span>
        <span class="s1">&#39;GivenName&#39;</span><span class="p">,</span><span class="s1">&#39;MiddleName&#39;</span><span class="p">,</span><span class="s1">&#39;SurName&#39;</span><span class="p">,</span><span class="s1">&#39;Household&#39;</span><span class="p">,</span><span class="s1">&#39;Corporation&#39;</span><span class="p">,</span>
        <span class="s1">&#39;StreetAddress&#39;</span><span class="p">,</span><span class="s1">&#39;City&#39;</span><span class="p">,</span><span class="s1">&#39;State&#39;</span><span class="p">,</span><span class="s1">&#39;Zipcode&#39;</span><span class="p">,</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">PAD_TAIL</span> <span class="o">=</span> <span class="s1">&#39;&lt;redacted&gt;&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">household_patch</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">EntityType</span><span class="o">==</span><span class="s1">&#39;Household&#39;</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">Household</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;&amp;&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">Household</span> <span class="k">else</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Household</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">parseit</span><span class="p">(</span><span class="n">text</span><span class="o">+</span><span class="n">PAD_TAIL</span><span class="p">)</span>
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;GivenName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;GivenName&#39;</span><span class="p">]</span>
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;SurName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;SurName&#39;</span><span class="p">]</span>
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;MiddleName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;MiddleName&#39;</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">row</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">add_on</span><span class="p">(</span><span class="n">xx</span><span class="p">):</span>
  <span class="c1"># Address is the combination of street, city, state, zip and country</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;StreetAddress&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;City&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;State&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Zipcode&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span>
  <span class="c1"># default is person, if household column is not empty, then household, same for corporation</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;EntityType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Person&#39;</span>
  <span class="n">xx</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">xx</span><span class="o">.</span><span class="n">Household</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;EntityType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Household&#39;</span>
  <span class="n">xx</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">xx</span><span class="o">.</span><span class="n">Corporation</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;EntityType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Corporation&#39;</span>
  <span class="c1"># default is full name of person, if entity is corporation ,then corporation name, same for household</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Recipient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;SurName&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;GivenName&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;MiddleName&#39;</span><span class="p">]</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Recipient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">Corporation</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">EntityType</span><span class="o">==</span><span class="s1">&#39;Corporation&#39;</span> <span class="k">else</span> <span class="n">row</span><span class="o">.</span><span class="n">Recipient</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Recipient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">Household</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">EntityType</span><span class="o">==</span><span class="s1">&#39;Household&#39;</span> <span class="k">else</span> <span class="n">row</span><span class="o">.</span><span class="n">Recipient</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="c1"># adding household to name field patch</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">household_patch</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="c1"># converting to dictionary format</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*$&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="c1"># return the processed data</span>
  <span class="k">return</span> <span class="n">xx</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">parseit</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
  <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">doc</span> <span class="o">=</span> <span class="n">prdnlp</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">:</span>
    <span class="n">output</span><span class="p">[</span><span class="n">ent</span><span class="o">.</span><span class="n">label_</span><span class="p">]</span> <span class="o">=</span> <span class="n">ent</span><span class="o">.</span><span class="n">text</span>
  
  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">dfx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
  <span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
  
  <span class="k">return</span> <span class="n">dfx</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">parseit</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">add_on</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">X</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">X</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&lt;redacted&gt;&#39;</span>
<span class="c1"># xx = parseit(text); xx</span>
<span class="c1"># xx = pd.DataFrame(xx, index=[0]).T.reset_index(); xx.columns = [&#39;Tag&#39;,&#39;Entity&#39;]; xx</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">func</span><span class="p">(</span><span class="s1">&#39;&lt;redacted&gt;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1"># import gradio as gr</span>
<span class="c1"># inputs = gr.inputs.Textbox(lines=3, label=&#39;Input&#39;)</span>
<span class="c1"># outputs = gr.outputs.Textbox(label=&#39;Output&#39;)</span>
<span class="n">gr</span><span class="o">.</span><span class="n">Interface</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Flair-NER-Model">Flair NER Model<a class="anchor-link" href="#Flair-NER-Model"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">doccano</span><span class="o">-</span><span class="n">transformer</span>
<span class="kn">from</span> <span class="nn">doccano_transformer.datasets</span> <span class="kn">import</span> <span class="n">NERDataset</span>
<span class="kn">from</span> <span class="nn">doccano_transformer.utils</span> <span class="kn">import</span> <span class="n">read_jsonl</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">read_jsonl</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;file_2.json1&#39;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="n">NERDataset</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">to_spacy</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">TRAIN_DATA</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">:</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;entities&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">TRAIN_DATA</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">xx</span><span class="p">))</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">spacy</span>
<span class="kn">from</span> <span class="nn">spacy.gold</span> <span class="kn">import</span> <span class="n">biluo_tags_from_offsets</span>
<span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;en_core_web_sm&#39;</span><span class="p">)</span>
<span class="n">docs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">text</span><span class="p">,</span> <span class="n">annot</span> <span class="ow">in</span> <span class="n">TRAIN_DATA</span><span class="p">:</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">biluo_tags_from_offsets</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">annot</span><span class="p">[</span><span class="s1">&#39;entities&#39;</span><span class="p">])</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;U-&#39;</span><span class="p">,</span><span class="s1">&#39;B-&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">]</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;L-&#39;</span><span class="p">,</span><span class="s1">&#39;I-&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">]</span>
    <span class="n">tmpdocs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span><span class="n">tags</span><span class="p">)]</span>
    <span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmpdocs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">docs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">X</span><span class="p">[</span><span class="s1">&#39;break&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;train&#39;</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
  <span class="n">Xt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">Xt</span> <span class="o">=</span> <span class="n">Xt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
  <span class="n">Xt</span><span class="p">[</span><span class="s1">&#39;break&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">([</span><span class="s1">&#39;train&#39;</span><span class="p">,</span><span class="s1">&#39;val&#39;</span><span class="p">,</span><span class="s1">&#39;test&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Xt</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;break&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;train&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]];</span> <span class="n">train</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;train.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;break&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;val&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]];</span> <span class="n">val</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;val.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;break&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;test&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]];</span> <span class="n">test</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;test.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">flair</span>
<span class="kn">from</span> <span class="nn">flair.data</span> <span class="kn">import</span> <span class="n">Corpus</span>
<span class="kn">from</span> <span class="nn">flair.datasets</span> <span class="kn">import</span> <span class="n">ColumnCorpus</span>

<span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="s1">&#39;ner&#39;</span><span class="p">}</span>

<span class="n">data_folder</span> <span class="o">=</span> <span class="s1">&#39;/content&#39;</span>
<span class="n">corpus</span><span class="p">:</span> <span class="n">Corpus</span> <span class="o">=</span> <span class="n">ColumnCorpus</span><span class="p">(</span><span class="n">data_folder</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span>
                              <span class="n">train_file</span> <span class="o">=</span> <span class="s1">&#39;train.txt&#39;</span><span class="p">,</span>
                              <span class="n">test_file</span> <span class="o">=</span> <span class="s1">&#39;test.txt&#39;</span><span class="p">,</span>
                              <span class="n">dev_file</span> <span class="o">=</span> <span class="s1">&#39;val.txt&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">tag_type</span> <span class="o">=</span> <span class="s1">&#39;ner&#39;</span>
<span class="n">tag_dictionary</span> <span class="o">=</span> <span class="n">corpus</span><span class="o">.</span><span class="n">make_tag_dictionary</span><span class="p">(</span><span class="n">tag_type</span><span class="o">=</span><span class="n">tag_type</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">from</span> <span class="nn">flair.embeddings</span> <span class="kn">import</span> <span class="n">WordEmbeddings</span><span class="p">,</span> <span class="n">StackedEmbeddings</span><span class="p">,</span> <span class="n">FlairEmbeddings</span><span class="p">,</span> <span class="n">CharacterEmbeddings</span>

<span class="n">embedding_types</span> <span class="o">=</span> <span class="p">[</span>

    <span class="n">WordEmbeddings</span><span class="p">(</span><span class="s1">&#39;glove&#39;</span><span class="p">),</span>

    <span class="c1"># comment in this line to use character embeddings</span>
    <span class="c1"># CharacterEmbeddings(),</span>

    <span class="c1"># comment in these lines to use flair embeddings</span>
    <span class="c1"># FlairEmbeddings(&#39;news-forward&#39;),</span>
    <span class="c1"># FlairEmbeddings(&#39;news-backward&#39;),</span>
<span class="p">]</span>

<span class="n">embeddings</span> <span class="p">:</span> <span class="n">StackedEmbeddings</span> <span class="o">=</span> <span class="n">StackedEmbeddings</span><span class="p">(</span><span class="n">embeddings</span><span class="o">=</span><span class="n">embedding_types</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">from</span> <span class="nn">flair.models</span> <span class="kn">import</span> <span class="n">SequenceTagger</span>
<span class="n">tagger</span> <span class="p">:</span> <span class="n">SequenceTagger</span> <span class="o">=</span> <span class="n">SequenceTagger</span><span class="p">(</span><span class="n">hidden_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
                                       <span class="n">embeddings</span><span class="o">=</span><span class="n">embeddings</span><span class="p">,</span>
                                       <span class="n">tag_dictionary</span><span class="o">=</span><span class="n">tag_dictionary</span><span class="p">,</span>
                                       <span class="n">tag_type</span><span class="o">=</span><span class="n">tag_type</span><span class="p">,</span>
                                       <span class="n">use_crf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">from</span> <span class="nn">flair.trainers</span> <span class="kn">import</span> <span class="n">ModelTrainer</span>
<span class="n">trainer</span> <span class="p">:</span> <span class="n">ModelTrainer</span> <span class="o">=</span> <span class="n">ModelTrainer</span><span class="p">(</span><span class="n">tagger</span><span class="p">,</span> <span class="n">corpus</span><span class="p">)</span>
<span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="s1">&#39;/content&#39;</span><span class="p">,</span>
              <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
              <span class="n">mini_batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
              <span class="n">max_epochs</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
              <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2020-09-11 09:30:11,352 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:11,354 Model: &#34;SequenceTagger(
  (embeddings): StackedEmbeddings(
    (list_embedding_0): WordEmbeddings(&#39;glove&#39;)
  )
  (word_dropout): WordDropout(p=0.05)
  (locked_dropout): LockedDropout(p=0.5)
  (embedding2nn): Linear(in_features=100, out_features=100, bias=True)
  (rnn): LSTM(100, 256, batch_first=True, bidirectional=True)
  (linear): Linear(in_features=512, out_features=24, bias=True)
  (beta): 1.0
  (weights): None
  (weight_tensor) None
)&#34;
2020-09-11 09:30:11,357 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:11,359 Corpus: &#34;Corpus: 526 train + 36 dev + 31 test sentences&#34;
2020-09-11 09:30:11,360 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:11,364 Parameters:
2020-09-11 09:30:11,365  - learning_rate: &#34;0.5&#34;
2020-09-11 09:30:11,368  - mini_batch_size: &#34;32&#34;
2020-09-11 09:30:11,373  - patience: &#34;3&#34;
2020-09-11 09:30:11,374  - anneal_factor: &#34;0.5&#34;
2020-09-11 09:30:11,376  - max_epochs: &#34;150&#34;
2020-09-11 09:30:11,377  - shuffle: &#34;True&#34;
2020-09-11 09:30:11,378  - train_with_dev: &#34;False&#34;
2020-09-11 09:30:11,380  - batch_growth_annealing: &#34;False&#34;
2020-09-11 09:30:11,381 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:11,382 Model training base path: &#34;/content&#34;
2020-09-11 09:30:11,384 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:11,385 Device: cuda:0
2020-09-11 09:30:11,387 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:11,388 Embeddings storage mode: cpu
2020-09-11 09:30:11,390 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:11,535 epoch 1 - iter 1/17 - loss 3.43299055 - samples/sec: 224.37 - lr: 0.500000
2020-09-11 09:30:11,674 epoch 1 - iter 2/17 - loss 16.62798858 - samples/sec: 233.49 - lr: 0.500000
2020-09-11 09:30:11,773 epoch 1 - iter 3/17 - loss 12.71970431 - samples/sec: 327.61 - lr: 0.500000
2020-09-11 09:30:11,886 epoch 1 - iter 4/17 - loss 12.07628489 - samples/sec: 288.50 - lr: 0.500000
2020-09-11 09:30:12,011 epoch 1 - iter 5/17 - loss 11.39370499 - samples/sec: 258.89 - lr: 0.500000
2020-09-11 09:30:12,120 epoch 1 - iter 6/17 - loss 10.47585432 - samples/sec: 297.29 - lr: 0.500000
2020-09-11 09:30:12,226 epoch 1 - iter 7/17 - loss 10.23672819 - samples/sec: 315.00 - lr: 0.500000
2020-09-11 09:30:12,327 epoch 1 - iter 8/17 - loss 10.13630027 - samples/sec: 326.75 - lr: 0.500000
2020-09-11 09:30:12,438 epoch 1 - iter 9/17 - loss 9.72696336 - samples/sec: 292.91 - lr: 0.500000
2020-09-11 09:30:12,542 epoch 1 - iter 10/17 - loss 9.41571531 - samples/sec: 317.52 - lr: 0.500000
2020-09-11 09:30:12,654 epoch 1 - iter 11/17 - loss 9.45854959 - samples/sec: 288.96 - lr: 0.500000
2020-09-11 09:30:12,769 epoch 1 - iter 12/17 - loss 9.27839812 - samples/sec: 282.59 - lr: 0.500000
2020-09-11 09:30:12,887 epoch 1 - iter 13/17 - loss 9.43319035 - samples/sec: 280.07 - lr: 0.500000
2020-09-11 09:30:13,009 epoch 1 - iter 14/17 - loss 9.24219717 - samples/sec: 264.80 - lr: 0.500000
2020-09-11 09:30:13,120 epoch 1 - iter 15/17 - loss 9.08057699 - samples/sec: 291.56 - lr: 0.500000
2020-09-11 09:30:13,239 epoch 1 - iter 16/17 - loss 9.04910478 - samples/sec: 272.95 - lr: 0.500000
2020-09-11 09:30:13,321 epoch 1 - iter 17/17 - loss 9.02534998 - samples/sec: 401.20 - lr: 0.500000
2020-09-11 09:30:13,324 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:13,325 EPOCH 1 done: loss 9.0253 - lr 0.5000000
2020-09-11 09:30:13,419 DEV : loss 5.717854976654053 - score 0.8698
2020-09-11 09:30:13,423 BAD EPOCHS (no improvement): 0
saving best model
2020-09-11 09:30:16,358 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:16,472 epoch 2 - iter 1/17 - loss 5.83918762 - samples/sec: 296.08 - lr: 0.500000
2020-09-11 09:30:16,588 epoch 2 - iter 2/17 - loss 6.36326265 - samples/sec: 277.67 - lr: 0.500000
2020-09-11 09:30:16,713 epoch 2 - iter 3/17 - loss 6.86526155 - samples/sec: 258.96 - lr: 0.500000
2020-09-11 09:30:16,825 epoch 2 - iter 4/17 - loss 6.52817869 - samples/sec: 295.13 - lr: 0.500000
2020-09-11 09:30:16,952 epoch 2 - iter 5/17 - loss 6.21855764 - samples/sec: 253.81 - lr: 0.500000
2020-09-11 09:30:17,070 epoch 2 - iter 6/17 - loss 6.00696262 - samples/sec: 275.53 - lr: 0.500000
2020-09-11 09:30:17,186 epoch 2 - iter 7/17 - loss 5.75874615 - samples/sec: 277.33 - lr: 0.500000
2020-09-11 09:30:17,302 epoch 2 - iter 8/17 - loss 6.11816967 - samples/sec: 278.78 - lr: 0.500000
2020-09-11 09:30:17,415 epoch 2 - iter 9/17 - loss 6.44984976 - samples/sec: 288.02 - lr: 0.500000
2020-09-11 09:30:17,530 epoch 2 - iter 10/17 - loss 6.60953989 - samples/sec: 279.91 - lr: 0.500000
2020-09-11 09:30:17,642 epoch 2 - iter 11/17 - loss 6.44363026 - samples/sec: 291.03 - lr: 0.500000
2020-09-11 09:30:17,764 epoch 2 - iter 12/17 - loss 6.50487467 - samples/sec: 263.27 - lr: 0.500000
2020-09-11 09:30:17,875 epoch 2 - iter 13/17 - loss 6.54225309 - samples/sec: 291.79 - lr: 0.500000
2020-09-11 09:30:18,001 epoch 2 - iter 14/17 - loss 6.54856760 - samples/sec: 257.35 - lr: 0.500000
2020-09-11 09:30:18,115 epoch 2 - iter 15/17 - loss 6.56940902 - samples/sec: 282.18 - lr: 0.500000
2020-09-11 09:30:18,222 epoch 2 - iter 16/17 - loss 6.58133185 - samples/sec: 303.36 - lr: 0.500000
2020-09-11 09:30:18,317 epoch 2 - iter 17/17 - loss 6.60969802 - samples/sec: 342.00 - lr: 0.500000
2020-09-11 09:30:18,319 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:18,325 EPOCH 2 done: loss 6.6097 - lr 0.5000000
2020-09-11 09:30:18,418 DEV : loss 7.014471054077148 - score 0.7978
2020-09-11 09:30:18,421 BAD EPOCHS (no improvement): 1
2020-09-11 09:30:18,427 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:18,541 epoch 3 - iter 1/17 - loss 4.26388168 - samples/sec: 286.30 - lr: 0.500000
2020-09-11 09:30:18,669 epoch 3 - iter 2/17 - loss 4.22117805 - samples/sec: 251.47 - lr: 0.500000
2020-09-11 09:30:18,789 epoch 3 - iter 3/17 - loss 4.93522231 - samples/sec: 269.09 - lr: 0.500000
2020-09-11 09:30:18,908 epoch 3 - iter 4/17 - loss 5.27011728 - samples/sec: 272.53 - lr: 0.500000
2020-09-11 09:30:19,023 epoch 3 - iter 5/17 - loss 5.39386015 - samples/sec: 282.34 - lr: 0.500000
2020-09-11 09:30:19,147 epoch 3 - iter 6/17 - loss 5.57506188 - samples/sec: 260.17 - lr: 0.500000
2020-09-11 09:30:19,263 epoch 3 - iter 7/17 - loss 5.80165243 - samples/sec: 280.20 - lr: 0.500000
2020-09-11 09:30:19,377 epoch 3 - iter 8/17 - loss 5.74144500 - samples/sec: 284.49 - lr: 0.500000
2020-09-11 09:30:19,489 epoch 3 - iter 9/17 - loss 5.83528980 - samples/sec: 289.27 - lr: 0.500000
2020-09-11 09:30:19,602 epoch 3 - iter 10/17 - loss 5.94376082 - samples/sec: 285.24 - lr: 0.500000
2020-09-11 09:30:19,719 epoch 3 - iter 11/17 - loss 6.10046205 - samples/sec: 276.22 - lr: 0.500000
2020-09-11 09:30:19,834 epoch 3 - iter 12/17 - loss 6.31112369 - samples/sec: 281.37 - lr: 0.500000
2020-09-11 09:30:19,943 epoch 3 - iter 13/17 - loss 6.59776673 - samples/sec: 296.36 - lr: 0.500000
2020-09-11 09:30:20,049 epoch 3 - iter 14/17 - loss 6.57175589 - samples/sec: 306.47 - lr: 0.500000
2020-09-11 09:30:20,175 epoch 3 - iter 15/17 - loss 6.53515657 - samples/sec: 256.03 - lr: 0.500000
2020-09-11 09:30:20,280 epoch 3 - iter 16/17 - loss 6.45572126 - samples/sec: 308.22 - lr: 0.500000
2020-09-11 09:30:20,363 epoch 3 - iter 17/17 - loss 6.33213214 - samples/sec: 394.86 - lr: 0.500000
2020-09-11 09:30:20,364 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:20,369 EPOCH 3 done: loss 6.3321 - lr 0.5000000
2020-09-11 09:30:20,447 DEV : loss 6.267121315002441 - score 0.7705
2020-09-11 09:30:20,451 BAD EPOCHS (no improvement): 2
2020-09-11 09:30:20,453 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:20,567 epoch 4 - iter 1/17 - loss 5.04142189 - samples/sec: 288.98 - lr: 0.500000
2020-09-11 09:30:20,708 epoch 4 - iter 2/17 - loss 6.17017388 - samples/sec: 229.78 - lr: 0.500000
2020-09-11 09:30:20,842 epoch 4 - iter 3/17 - loss 5.64043872 - samples/sec: 241.44 - lr: 0.500000
2020-09-11 09:30:20,949 epoch 4 - iter 4/17 - loss 5.29508078 - samples/sec: 311.53 - lr: 0.500000
2020-09-11 09:30:21,053 epoch 4 - iter 5/17 - loss 4.82136688 - samples/sec: 311.77 - lr: 0.500000
2020-09-11 09:30:21,174 epoch 4 - iter 6/17 - loss 4.83669527 - samples/sec: 269.39 - lr: 0.500000
2020-09-11 09:30:21,286 epoch 4 - iter 7/17 - loss 4.87344299 - samples/sec: 293.77 - lr: 0.500000
2020-09-11 09:30:21,396 epoch 4 - iter 8/17 - loss 5.19339198 - samples/sec: 292.26 - lr: 0.500000
2020-09-11 09:30:21,504 epoch 4 - iter 9/17 - loss 5.36148289 - samples/sec: 303.14 - lr: 0.500000
2020-09-11 09:30:21,612 epoch 4 - iter 10/17 - loss 5.43170042 - samples/sec: 298.35 - lr: 0.500000
2020-09-11 09:30:21,724 epoch 4 - iter 11/17 - loss 5.40744721 - samples/sec: 290.04 - lr: 0.500000
2020-09-11 09:30:21,838 epoch 4 - iter 12/17 - loss 5.46409893 - samples/sec: 284.06 - lr: 0.500000
2020-09-11 09:30:21,947 epoch 4 - iter 13/17 - loss 5.48474825 - samples/sec: 295.24 - lr: 0.500000
2020-09-11 09:30:22,054 epoch 4 - iter 14/17 - loss 5.34932395 - samples/sec: 303.95 - lr: 0.500000
2020-09-11 09:30:22,167 epoch 4 - iter 15/17 - loss 5.32448457 - samples/sec: 284.46 - lr: 0.500000
2020-09-11 09:30:22,292 epoch 4 - iter 16/17 - loss 5.21404728 - samples/sec: 260.52 - lr: 0.500000
2020-09-11 09:30:22,374 epoch 4 - iter 17/17 - loss 5.10825051 - samples/sec: 394.18 - lr: 0.500000
2020-09-11 09:30:22,375 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:22,380 EPOCH 4 done: loss 5.1083 - lr 0.5000000
2020-09-11 09:30:22,456 DEV : loss 4.367828369140625 - score 0.8491
2020-09-11 09:30:22,459 BAD EPOCHS (no improvement): 3
2020-09-11 09:30:22,461 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:22,570 epoch 5 - iter 1/17 - loss 6.80663157 - samples/sec: 303.24 - lr: 0.500000
2020-09-11 09:30:22,666 epoch 5 - iter 2/17 - loss 5.35868144 - samples/sec: 341.59 - lr: 0.500000
2020-09-11 09:30:22,779 epoch 5 - iter 3/17 - loss 5.17130645 - samples/sec: 288.28 - lr: 0.500000
2020-09-11 09:30:22,892 epoch 5 - iter 4/17 - loss 4.78146195 - samples/sec: 284.10 - lr: 0.500000
2020-09-11 09:30:23,007 epoch 5 - iter 5/17 - loss 4.49372272 - samples/sec: 283.10 - lr: 0.500000
2020-09-11 09:30:23,116 epoch 5 - iter 6/17 - loss 4.40794814 - samples/sec: 296.27 - lr: 0.500000
2020-09-11 09:30:23,233 epoch 5 - iter 7/17 - loss 5.19045050 - samples/sec: 277.11 - lr: 0.500000
2020-09-11 09:30:23,341 epoch 5 - iter 8/17 - loss 5.04928717 - samples/sec: 300.85 - lr: 0.500000
2020-09-11 09:30:23,461 epoch 5 - iter 9/17 - loss 4.83003471 - samples/sec: 268.51 - lr: 0.500000
2020-09-11 09:30:23,569 epoch 5 - iter 10/17 - loss 5.06927426 - samples/sec: 301.46 - lr: 0.500000
2020-09-11 09:30:23,696 epoch 5 - iter 11/17 - loss 4.97240255 - samples/sec: 255.22 - lr: 0.500000
2020-09-11 09:30:23,806 epoch 5 - iter 12/17 - loss 5.07106882 - samples/sec: 294.08 - lr: 0.500000
2020-09-11 09:30:23,929 epoch 5 - iter 13/17 - loss 5.17605252 - samples/sec: 262.74 - lr: 0.500000
2020-09-11 09:30:24,038 epoch 5 - iter 14/17 - loss 5.14826872 - samples/sec: 295.90 - lr: 0.500000
2020-09-11 09:30:24,144 epoch 5 - iter 15/17 - loss 5.33293700 - samples/sec: 305.56 - lr: 0.500000
2020-09-11 09:30:24,257 epoch 5 - iter 16/17 - loss 5.31216620 - samples/sec: 286.96 - lr: 0.500000
2020-09-11 09:30:24,342 epoch 5 - iter 17/17 - loss 5.50642596 - samples/sec: 380.72 - lr: 0.500000
2020-09-11 09:30:24,347 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:24,348 EPOCH 5 done: loss 5.5064 - lr 0.5000000
2020-09-11 09:30:24,428 DEV : loss 7.306588172912598 - score 0.8609
Epoch     5: reducing learning rate of group 0 to 2.5000e-01.
2020-09-11 09:30:24,430 BAD EPOCHS (no improvement): 4
2020-09-11 09:30:24,434 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:24,544 epoch 6 - iter 1/17 - loss 6.96324205 - samples/sec: 296.94 - lr: 0.250000
2020-09-11 09:30:24,658 epoch 6 - iter 2/17 - loss 5.62635350 - samples/sec: 284.77 - lr: 0.250000
2020-09-11 09:30:24,779 epoch 6 - iter 3/17 - loss 5.42040205 - samples/sec: 266.03 - lr: 0.250000
2020-09-11 09:30:24,922 epoch 6 - iter 4/17 - loss 5.56092465 - samples/sec: 226.18 - lr: 0.250000
2020-09-11 09:30:25,033 epoch 6 - iter 5/17 - loss 5.47617340 - samples/sec: 291.45 - lr: 0.250000
2020-09-11 09:30:25,141 epoch 6 - iter 6/17 - loss 5.06147250 - samples/sec: 300.30 - lr: 0.250000
2020-09-11 09:30:25,253 epoch 6 - iter 7/17 - loss 4.85828168 - samples/sec: 288.46 - lr: 0.250000
2020-09-11 09:30:25,371 epoch 6 - iter 8/17 - loss 4.62894660 - samples/sec: 273.66 - lr: 0.250000
2020-09-11 09:30:25,485 epoch 6 - iter 9/17 - loss 4.33706284 - samples/sec: 283.62 - lr: 0.250000
2020-09-11 09:30:25,613 epoch 6 - iter 10/17 - loss 4.21852846 - samples/sec: 253.76 - lr: 0.250000
2020-09-11 09:30:25,719 epoch 6 - iter 11/17 - loss 4.07177886 - samples/sec: 305.92 - lr: 0.250000
2020-09-11 09:30:25,833 epoch 6 - iter 12/17 - loss 3.97449460 - samples/sec: 283.66 - lr: 0.250000
2020-09-11 09:30:25,952 epoch 6 - iter 13/17 - loss 3.94040249 - samples/sec: 272.32 - lr: 0.250000
2020-09-11 09:30:26,055 epoch 6 - iter 14/17 - loss 3.86654231 - samples/sec: 315.98 - lr: 0.250000
2020-09-11 09:30:26,171 epoch 6 - iter 15/17 - loss 3.94532137 - samples/sec: 277.03 - lr: 0.250000
2020-09-11 09:30:26,283 epoch 6 - iter 16/17 - loss 3.87008142 - samples/sec: 290.29 - lr: 0.250000
2020-09-11 09:30:26,349 epoch 6 - iter 17/17 - loss 3.82113767 - samples/sec: 506.56 - lr: 0.250000
2020-09-11 09:30:26,350 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:26,355 EPOCH 6 done: loss 3.8211 - lr 0.2500000
2020-09-11 09:30:26,436 DEV : loss 3.1234371662139893 - score 0.8808
2020-09-11 09:30:26,438 BAD EPOCHS (no improvement): 0
saving best model
2020-09-11 09:30:29,221 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:29,343 epoch 7 - iter 1/17 - loss 3.70950317 - samples/sec: 268.26 - lr: 0.250000
2020-09-11 09:30:29,446 epoch 7 - iter 2/17 - loss 3.15139985 - samples/sec: 313.16 - lr: 0.250000
2020-09-11 09:30:29,557 epoch 7 - iter 3/17 - loss 2.90648588 - samples/sec: 292.79 - lr: 0.250000
2020-09-11 09:30:29,691 epoch 7 - iter 4/17 - loss 2.84409702 - samples/sec: 240.22 - lr: 0.250000
2020-09-11 09:30:29,792 epoch 7 - iter 5/17 - loss 2.73230619 - samples/sec: 322.98 - lr: 0.250000
2020-09-11 09:30:29,917 epoch 7 - iter 6/17 - loss 2.97766495 - samples/sec: 258.82 - lr: 0.250000
2020-09-11 09:30:30,024 epoch 7 - iter 7/17 - loss 3.07457617 - samples/sec: 301.19 - lr: 0.250000
2020-09-11 09:30:30,129 epoch 7 - iter 8/17 - loss 3.16595078 - samples/sec: 311.51 - lr: 0.250000
2020-09-11 09:30:30,226 epoch 7 - iter 9/17 - loss 3.29891888 - samples/sec: 332.91 - lr: 0.250000
2020-09-11 09:30:30,337 epoch 7 - iter 10/17 - loss 3.39236808 - samples/sec: 291.15 - lr: 0.250000
2020-09-11 09:30:30,441 epoch 7 - iter 11/17 - loss 3.41726154 - samples/sec: 312.11 - lr: 0.250000
2020-09-11 09:30:30,549 epoch 7 - iter 12/17 - loss 3.41482002 - samples/sec: 299.15 - lr: 0.250000
2020-09-11 09:30:30,648 epoch 7 - iter 13/17 - loss 3.32942341 - samples/sec: 326.18 - lr: 0.250000
2020-09-11 09:30:30,793 epoch 7 - iter 14/17 - loss 3.42877962 - samples/sec: 223.33 - lr: 0.250000
2020-09-11 09:30:30,905 epoch 7 - iter 15/17 - loss 3.37255146 - samples/sec: 287.33 - lr: 0.250000
2020-09-11 09:30:31,012 epoch 7 - iter 16/17 - loss 3.29338527 - samples/sec: 302.59 - lr: 0.250000
2020-09-11 09:30:31,097 epoch 7 - iter 17/17 - loss 3.36279516 - samples/sec: 382.70 - lr: 0.250000
2020-09-11 09:30:31,098 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:31,104 EPOCH 7 done: loss 3.3628 - lr 0.2500000
2020-09-11 09:30:31,181 DEV : loss 2.352734327316284 - score 0.8164
2020-09-11 09:30:31,183 BAD EPOCHS (no improvement): 1
2020-09-11 09:30:31,187 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:31,298 epoch 8 - iter 1/17 - loss 3.31515622 - samples/sec: 294.10 - lr: 0.250000
2020-09-11 09:30:31,430 epoch 8 - iter 2/17 - loss 3.51384747 - samples/sec: 245.22 - lr: 0.250000
2020-09-11 09:30:31,541 epoch 8 - iter 3/17 - loss 3.30893199 - samples/sec: 290.08 - lr: 0.250000
2020-09-11 09:30:31,656 epoch 8 - iter 4/17 - loss 3.24576128 - samples/sec: 283.74 - lr: 0.250000
2020-09-11 09:30:31,758 epoch 8 - iter 5/17 - loss 3.12689247 - samples/sec: 315.29 - lr: 0.250000
2020-09-11 09:30:31,862 epoch 8 - iter 6/17 - loss 2.94166811 - samples/sec: 313.46 - lr: 0.250000
2020-09-11 09:30:31,992 epoch 8 - iter 7/17 - loss 3.11964280 - samples/sec: 251.93 - lr: 0.250000
2020-09-11 09:30:32,098 epoch 8 - iter 8/17 - loss 3.04969150 - samples/sec: 304.60 - lr: 0.250000
2020-09-11 09:30:32,205 epoch 8 - iter 9/17 - loss 3.06001208 - samples/sec: 302.37 - lr: 0.250000
2020-09-11 09:30:32,313 epoch 8 - iter 10/17 - loss 3.13563135 - samples/sec: 298.31 - lr: 0.250000
2020-09-11 09:30:32,428 epoch 8 - iter 11/17 - loss 3.17867511 - samples/sec: 281.42 - lr: 0.250000
2020-09-11 09:30:32,542 epoch 8 - iter 12/17 - loss 3.17592837 - samples/sec: 287.75 - lr: 0.250000
2020-09-11 09:30:32,643 epoch 8 - iter 13/17 - loss 3.17387684 - samples/sec: 321.38 - lr: 0.250000
2020-09-11 09:30:32,752 epoch 8 - iter 14/17 - loss 3.30220359 - samples/sec: 296.03 - lr: 0.250000
2020-09-11 09:30:32,864 epoch 8 - iter 15/17 - loss 3.28310798 - samples/sec: 288.32 - lr: 0.250000
2020-09-11 09:30:32,984 epoch 8 - iter 16/17 - loss 3.27035704 - samples/sec: 270.40 - lr: 0.250000
2020-09-11 09:30:33,059 epoch 8 - iter 17/17 - loss 3.25974651 - samples/sec: 429.82 - lr: 0.250000
2020-09-11 09:30:33,060 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:33,065 EPOCH 8 done: loss 3.2597 - lr 0.2500000
2020-09-11 09:30:33,142 DEV : loss 2.3950960636138916 - score 0.8911
2020-09-11 09:30:33,145 BAD EPOCHS (no improvement): 0
saving best model
2020-09-11 09:30:35,928 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:36,063 epoch 9 - iter 1/17 - loss 4.13516760 - samples/sec: 241.45 - lr: 0.250000
2020-09-11 09:30:36,177 epoch 9 - iter 2/17 - loss 4.22095203 - samples/sec: 283.96 - lr: 0.250000
2020-09-11 09:30:36,282 epoch 9 - iter 3/17 - loss 3.74937018 - samples/sec: 307.81 - lr: 0.250000
2020-09-11 09:30:36,384 epoch 9 - iter 4/17 - loss 3.56653398 - samples/sec: 316.58 - lr: 0.250000
2020-09-11 09:30:36,505 epoch 9 - iter 5/17 - loss 3.27518516 - samples/sec: 267.32 - lr: 0.250000
2020-09-11 09:30:36,619 epoch 9 - iter 6/17 - loss 3.02496213 - samples/sec: 285.21 - lr: 0.250000
2020-09-11 09:30:36,746 epoch 9 - iter 7/17 - loss 3.03646287 - samples/sec: 253.72 - lr: 0.250000
2020-09-11 09:30:36,862 epoch 9 - iter 8/17 - loss 3.04716738 - samples/sec: 281.19 - lr: 0.250000
2020-09-11 09:30:36,966 epoch 9 - iter 9/17 - loss 3.13016204 - samples/sec: 310.68 - lr: 0.250000
2020-09-11 09:30:37,094 epoch 9 - iter 10/17 - loss 3.07540933 - samples/sec: 250.78 - lr: 0.250000
2020-09-11 09:30:37,203 epoch 9 - iter 11/17 - loss 2.99208668 - samples/sec: 298.74 - lr: 0.250000
2020-09-11 09:30:37,326 epoch 9 - iter 12/17 - loss 3.08011819 - samples/sec: 262.50 - lr: 0.250000
2020-09-11 09:30:37,437 epoch 9 - iter 13/17 - loss 3.15795074 - samples/sec: 290.04 - lr: 0.250000
2020-09-11 09:30:37,554 epoch 9 - iter 14/17 - loss 3.13511590 - samples/sec: 276.32 - lr: 0.250000
2020-09-11 09:30:37,658 epoch 9 - iter 15/17 - loss 3.09624709 - samples/sec: 312.35 - lr: 0.250000
2020-09-11 09:30:37,770 epoch 9 - iter 16/17 - loss 3.20836692 - samples/sec: 288.37 - lr: 0.250000
2020-09-11 09:30:37,857 epoch 9 - iter 17/17 - loss 3.14222338 - samples/sec: 372.18 - lr: 0.250000
2020-09-11 09:30:37,859 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:37,865 EPOCH 9 done: loss 3.1422 - lr 0.2500000
2020-09-11 09:30:37,942 DEV : loss 2.601285934448242 - score 0.8783
2020-09-11 09:30:37,944 BAD EPOCHS (no improvement): 1
2020-09-11 09:30:37,949 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:38,064 epoch 10 - iter 1/17 - loss 2.18587756 - samples/sec: 286.91 - lr: 0.250000
2020-09-11 09:30:38,173 epoch 10 - iter 2/17 - loss 2.85696280 - samples/sec: 297.21 - lr: 0.250000
2020-09-11 09:30:38,279 epoch 10 - iter 3/17 - loss 3.14432240 - samples/sec: 308.52 - lr: 0.250000
2020-09-11 09:30:38,385 epoch 10 - iter 4/17 - loss 3.15336317 - samples/sec: 303.25 - lr: 0.250000
2020-09-11 09:30:38,514 epoch 10 - iter 5/17 - loss 3.14261246 - samples/sec: 250.19 - lr: 0.250000
2020-09-11 09:30:38,621 epoch 10 - iter 6/17 - loss 3.17861811 - samples/sec: 303.24 - lr: 0.250000
2020-09-11 09:30:38,734 epoch 10 - iter 7/17 - loss 3.23335017 - samples/sec: 286.76 - lr: 0.250000
2020-09-11 09:30:38,844 epoch 10 - iter 8/17 - loss 3.17415664 - samples/sec: 293.62 - lr: 0.250000
2020-09-11 09:30:38,955 epoch 10 - iter 9/17 - loss 3.23231522 - samples/sec: 291.92 - lr: 0.250000
2020-09-11 09:30:39,075 epoch 10 - iter 10/17 - loss 3.25380137 - samples/sec: 269.14 - lr: 0.250000
2020-09-11 09:30:39,190 epoch 10 - iter 11/17 - loss 3.16060584 - samples/sec: 280.60 - lr: 0.250000
2020-09-11 09:30:39,294 epoch 10 - iter 12/17 - loss 3.02024135 - samples/sec: 312.62 - lr: 0.250000
2020-09-11 09:30:39,401 epoch 10 - iter 13/17 - loss 3.02866225 - samples/sec: 301.38 - lr: 0.250000
2020-09-11 09:30:39,530 epoch 10 - iter 14/17 - loss 3.05385321 - samples/sec: 250.16 - lr: 0.250000
2020-09-11 09:30:39,644 epoch 10 - iter 15/17 - loss 3.06730847 - samples/sec: 283.84 - lr: 0.250000
2020-09-11 09:30:39,757 epoch 10 - iter 16/17 - loss 3.21189360 - samples/sec: 286.73 - lr: 0.250000
2020-09-11 09:30:39,832 epoch 10 - iter 17/17 - loss 3.28693191 - samples/sec: 432.01 - lr: 0.250000
2020-09-11 09:30:39,833 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:39,838 EPOCH 10 done: loss 3.2869 - lr 0.2500000
2020-09-11 09:30:39,919 DEV : loss 2.621568202972412 - score 0.8878
2020-09-11 09:30:39,921 BAD EPOCHS (no improvement): 2
2020-09-11 09:30:39,923 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:40,028 epoch 11 - iter 1/17 - loss 1.97674811 - samples/sec: 312.16 - lr: 0.250000
2020-09-11 09:30:40,146 epoch 11 - iter 2/17 - loss 2.63742667 - samples/sec: 273.63 - lr: 0.250000
2020-09-11 09:30:40,247 epoch 11 - iter 3/17 - loss 3.29801786 - samples/sec: 321.25 - lr: 0.250000
2020-09-11 09:30:40,365 epoch 11 - iter 4/17 - loss 3.60576668 - samples/sec: 272.73 - lr: 0.250000
2020-09-11 09:30:40,474 epoch 11 - iter 5/17 - loss 3.71707928 - samples/sec: 303.02 - lr: 0.250000
2020-09-11 09:30:40,589 epoch 11 - iter 6/17 - loss 3.40174667 - samples/sec: 281.19 - lr: 0.250000
2020-09-11 09:30:40,712 epoch 11 - iter 7/17 - loss 3.18708919 - samples/sec: 261.80 - lr: 0.250000
2020-09-11 09:30:40,826 epoch 11 - iter 8/17 - loss 3.04836126 - samples/sec: 287.11 - lr: 0.250000
2020-09-11 09:30:40,943 epoch 11 - iter 9/17 - loss 2.98250650 - samples/sec: 276.91 - lr: 0.250000
2020-09-11 09:30:41,058 epoch 11 - iter 10/17 - loss 2.92936121 - samples/sec: 282.13 - lr: 0.250000
2020-09-11 09:30:41,167 epoch 11 - iter 11/17 - loss 2.92226912 - samples/sec: 294.92 - lr: 0.250000
2020-09-11 09:30:41,281 epoch 11 - iter 12/17 - loss 2.89158462 - samples/sec: 285.59 - lr: 0.250000
2020-09-11 09:30:41,389 epoch 11 - iter 13/17 - loss 3.05706126 - samples/sec: 300.46 - lr: 0.250000
2020-09-11 09:30:41,497 epoch 11 - iter 14/17 - loss 3.01038414 - samples/sec: 304.51 - lr: 0.250000
2020-09-11 09:30:41,619 epoch 11 - iter 15/17 - loss 3.13056888 - samples/sec: 266.18 - lr: 0.250000
2020-09-11 09:30:41,749 epoch 11 - iter 16/17 - loss 3.20361467 - samples/sec: 248.63 - lr: 0.250000
2020-09-11 09:30:41,824 epoch 11 - iter 17/17 - loss 3.17225321 - samples/sec: 450.57 - lr: 0.250000
2020-09-11 09:30:41,825 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:41,831 EPOCH 11 done: loss 3.1723 - lr 0.2500000
2020-09-11 09:30:41,909 DEV : loss 2.6496293544769287 - score 0.9175
2020-09-11 09:30:41,911 BAD EPOCHS (no improvement): 0
saving best model
2020-09-11 09:30:44,727 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:44,843 epoch 12 - iter 1/17 - loss 3.06218433 - samples/sec: 278.55 - lr: 0.250000
2020-09-11 09:30:44,962 epoch 12 - iter 2/17 - loss 2.53818643 - samples/sec: 273.01 - lr: 0.250000
2020-09-11 09:30:45,080 epoch 12 - iter 3/17 - loss 2.66141121 - samples/sec: 276.04 - lr: 0.250000
2020-09-11 09:30:45,196 epoch 12 - iter 4/17 - loss 2.73923683 - samples/sec: 278.75 - lr: 0.250000
2020-09-11 09:30:45,304 epoch 12 - iter 5/17 - loss 2.70134916 - samples/sec: 302.96 - lr: 0.250000
2020-09-11 09:30:45,411 epoch 12 - iter 6/17 - loss 2.47173454 - samples/sec: 301.51 - lr: 0.250000
2020-09-11 09:30:45,524 epoch 12 - iter 7/17 - loss 2.56464466 - samples/sec: 288.11 - lr: 0.250000
2020-09-11 09:30:45,638 epoch 12 - iter 8/17 - loss 2.83810382 - samples/sec: 284.02 - lr: 0.250000
2020-09-11 09:30:45,753 epoch 12 - iter 9/17 - loss 2.96720710 - samples/sec: 283.20 - lr: 0.250000
2020-09-11 09:30:45,863 epoch 12 - iter 10/17 - loss 3.00092806 - samples/sec: 293.61 - lr: 0.250000
2020-09-11 09:30:45,980 epoch 12 - iter 11/17 - loss 3.04209977 - samples/sec: 282.71 - lr: 0.250000
2020-09-11 09:30:46,103 epoch 12 - iter 12/17 - loss 3.06752718 - samples/sec: 261.65 - lr: 0.250000
2020-09-11 09:30:46,219 epoch 12 - iter 13/17 - loss 3.10638168 - samples/sec: 278.15 - lr: 0.250000
2020-09-11 09:30:46,325 epoch 12 - iter 14/17 - loss 3.11180851 - samples/sec: 307.11 - lr: 0.250000
2020-09-11 09:30:46,435 epoch 12 - iter 15/17 - loss 3.11393329 - samples/sec: 295.05 - lr: 0.250000
2020-09-11 09:30:46,563 epoch 12 - iter 16/17 - loss 3.17738984 - samples/sec: 251.88 - lr: 0.250000
2020-09-11 09:30:46,640 epoch 12 - iter 17/17 - loss 3.13963230 - samples/sec: 419.02 - lr: 0.250000
2020-09-11 09:30:46,642 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:46,647 EPOCH 12 done: loss 3.1396 - lr 0.2500000
2020-09-11 09:30:46,753 DEV : loss 2.456434726715088 - score 0.8571
2020-09-11 09:30:46,757 BAD EPOCHS (no improvement): 1
2020-09-11 09:30:46,759 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:46,872 epoch 13 - iter 1/17 - loss 3.74742985 - samples/sec: 288.46 - lr: 0.250000
2020-09-11 09:30:46,978 epoch 13 - iter 2/17 - loss 3.21253848 - samples/sec: 306.03 - lr: 0.250000
2020-09-11 09:30:47,084 epoch 13 - iter 3/17 - loss 3.31751029 - samples/sec: 306.26 - lr: 0.250000
2020-09-11 09:30:47,192 epoch 13 - iter 4/17 - loss 2.90003487 - samples/sec: 298.68 - lr: 0.250000
2020-09-11 09:30:47,310 epoch 13 - iter 5/17 - loss 2.77682316 - samples/sec: 274.49 - lr: 0.250000
2020-09-11 09:30:47,423 epoch 13 - iter 6/17 - loss 2.92825923 - samples/sec: 284.24 - lr: 0.250000
2020-09-11 09:30:47,535 epoch 13 - iter 7/17 - loss 2.93475987 - samples/sec: 290.65 - lr: 0.250000
2020-09-11 09:30:47,660 epoch 13 - iter 8/17 - loss 3.03747167 - samples/sec: 258.99 - lr: 0.250000
2020-09-11 09:30:47,782 epoch 13 - iter 9/17 - loss 3.01528635 - samples/sec: 265.17 - lr: 0.250000
2020-09-11 09:30:47,887 epoch 13 - iter 10/17 - loss 3.02738467 - samples/sec: 308.06 - lr: 0.250000
2020-09-11 09:30:47,995 epoch 13 - iter 11/17 - loss 3.00082893 - samples/sec: 297.64 - lr: 0.250000
2020-09-11 09:30:48,106 epoch 13 - iter 12/17 - loss 3.03533484 - samples/sec: 298.56 - lr: 0.250000
2020-09-11 09:30:48,214 epoch 13 - iter 13/17 - loss 2.99576386 - samples/sec: 299.72 - lr: 0.250000
2020-09-11 09:30:48,320 epoch 13 - iter 14/17 - loss 2.99190849 - samples/sec: 304.07 - lr: 0.250000
2020-09-11 09:30:48,430 epoch 13 - iter 15/17 - loss 3.02248323 - samples/sec: 293.57 - lr: 0.250000
2020-09-11 09:30:48,539 epoch 13 - iter 16/17 - loss 3.00460766 - samples/sec: 297.44 - lr: 0.250000
2020-09-11 09:30:48,619 epoch 13 - iter 17/17 - loss 2.95338992 - samples/sec: 409.80 - lr: 0.250000
2020-09-11 09:30:48,620 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:48,626 EPOCH 13 done: loss 2.9534 - lr 0.2500000
2020-09-11 09:30:48,702 DEV : loss 2.8066673278808594 - score 0.8548
2020-09-11 09:30:48,704 BAD EPOCHS (no improvement): 2
2020-09-11 09:30:48,705 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:48,833 epoch 14 - iter 1/17 - loss 2.78732395 - samples/sec: 257.25 - lr: 0.250000
2020-09-11 09:30:48,945 epoch 14 - iter 2/17 - loss 2.74681008 - samples/sec: 288.53 - lr: 0.250000
2020-09-11 09:30:49,061 epoch 14 - iter 3/17 - loss 2.75188263 - samples/sec: 278.90 - lr: 0.250000
2020-09-11 09:30:49,182 epoch 14 - iter 4/17 - loss 2.79956216 - samples/sec: 266.16 - lr: 0.250000
2020-09-11 09:30:49,289 epoch 14 - iter 5/17 - loss 2.81255398 - samples/sec: 303.61 - lr: 0.250000
2020-09-11 09:30:49,399 epoch 14 - iter 6/17 - loss 2.67327150 - samples/sec: 293.32 - lr: 0.250000
2020-09-11 09:30:49,509 epoch 14 - iter 7/17 - loss 2.64780256 - samples/sec: 296.43 - lr: 0.250000
2020-09-11 09:30:49,626 epoch 14 - iter 8/17 - loss 2.89155030 - samples/sec: 274.99 - lr: 0.250000
2020-09-11 09:30:49,732 epoch 14 - iter 9/17 - loss 2.80368842 - samples/sec: 304.67 - lr: 0.250000
2020-09-11 09:30:49,848 epoch 14 - iter 10/17 - loss 3.01142316 - samples/sec: 280.74 - lr: 0.250000
2020-09-11 09:30:49,969 epoch 14 - iter 11/17 - loss 3.08519667 - samples/sec: 266.39 - lr: 0.250000
2020-09-11 09:30:50,095 epoch 14 - iter 12/17 - loss 3.10426335 - samples/sec: 257.15 - lr: 0.250000
2020-09-11 09:30:50,209 epoch 14 - iter 13/17 - loss 3.06903934 - samples/sec: 282.02 - lr: 0.250000
2020-09-11 09:30:50,324 epoch 14 - iter 14/17 - loss 3.03085591 - samples/sec: 295.41 - lr: 0.250000
2020-09-11 09:30:50,424 epoch 14 - iter 15/17 - loss 3.02578127 - samples/sec: 321.50 - lr: 0.250000
2020-09-11 09:30:50,545 epoch 14 - iter 16/17 - loss 2.98861359 - samples/sec: 267.74 - lr: 0.250000
2020-09-11 09:30:50,625 epoch 14 - iter 17/17 - loss 3.04630093 - samples/sec: 407.75 - lr: 0.250000
2020-09-11 09:30:50,626 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:50,630 EPOCH 14 done: loss 3.0463 - lr 0.2500000
2020-09-11 09:30:50,726 DEV : loss 2.356717109680176 - score 0.9039
2020-09-11 09:30:50,730 BAD EPOCHS (no improvement): 3
2020-09-11 09:30:50,732 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:50,868 epoch 15 - iter 1/17 - loss 4.18320131 - samples/sec: 237.43 - lr: 0.250000
2020-09-11 09:30:50,981 epoch 15 - iter 2/17 - loss 3.43749928 - samples/sec: 287.59 - lr: 0.250000
2020-09-11 09:30:51,089 epoch 15 - iter 3/17 - loss 3.32088296 - samples/sec: 302.31 - lr: 0.250000
2020-09-11 09:30:51,195 epoch 15 - iter 4/17 - loss 3.32438457 - samples/sec: 303.65 - lr: 0.250000
2020-09-11 09:30:51,317 epoch 15 - iter 5/17 - loss 3.04261053 - samples/sec: 265.50 - lr: 0.250000
2020-09-11 09:30:51,431 epoch 15 - iter 6/17 - loss 3.01294063 - samples/sec: 284.89 - lr: 0.250000
2020-09-11 09:30:51,547 epoch 15 - iter 7/17 - loss 3.07561300 - samples/sec: 279.72 - lr: 0.250000
2020-09-11 09:30:51,650 epoch 15 - iter 8/17 - loss 3.14126436 - samples/sec: 312.54 - lr: 0.250000
2020-09-11 09:30:51,755 epoch 15 - iter 9/17 - loss 3.12974224 - samples/sec: 311.04 - lr: 0.250000
2020-09-11 09:30:51,872 epoch 15 - iter 10/17 - loss 3.00686265 - samples/sec: 280.14 - lr: 0.250000
2020-09-11 09:30:51,984 epoch 15 - iter 11/17 - loss 3.00323490 - samples/sec: 288.18 - lr: 0.250000
2020-09-11 09:30:52,091 epoch 15 - iter 12/17 - loss 2.97433997 - samples/sec: 302.88 - lr: 0.250000
2020-09-11 09:30:52,203 epoch 15 - iter 13/17 - loss 2.99207349 - samples/sec: 290.19 - lr: 0.250000
2020-09-11 09:30:52,333 epoch 15 - iter 14/17 - loss 2.94220261 - samples/sec: 249.46 - lr: 0.250000
2020-09-11 09:30:52,447 epoch 15 - iter 15/17 - loss 2.89441790 - samples/sec: 283.54 - lr: 0.250000
2020-09-11 09:30:52,554 epoch 15 - iter 16/17 - loss 2.89061851 - samples/sec: 302.51 - lr: 0.250000
2020-09-11 09:30:52,632 epoch 15 - iter 17/17 - loss 2.86109092 - samples/sec: 415.69 - lr: 0.250000
2020-09-11 09:30:52,634 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:52,637 EPOCH 15 done: loss 2.8611 - lr 0.2500000
2020-09-11 09:30:52,715 DEV : loss 2.2419240474700928 - score 0.8964
Epoch    15: reducing learning rate of group 0 to 1.2500e-01.
2020-09-11 09:30:52,719 BAD EPOCHS (no improvement): 4
2020-09-11 09:30:52,720 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:52,835 epoch 16 - iter 1/17 - loss 3.22716141 - samples/sec: 281.04 - lr: 0.125000
2020-09-11 09:30:52,945 epoch 16 - iter 2/17 - loss 2.45503211 - samples/sec: 296.44 - lr: 0.125000
2020-09-11 09:30:53,049 epoch 16 - iter 3/17 - loss 2.48855003 - samples/sec: 323.45 - lr: 0.125000
2020-09-11 09:30:53,154 epoch 16 - iter 4/17 - loss 2.59882224 - samples/sec: 307.89 - lr: 0.125000
2020-09-11 09:30:53,269 epoch 16 - iter 5/17 - loss 2.60306301 - samples/sec: 281.55 - lr: 0.125000
2020-09-11 09:30:53,382 epoch 16 - iter 6/17 - loss 2.49932460 - samples/sec: 286.07 - lr: 0.125000
2020-09-11 09:30:53,488 epoch 16 - iter 7/17 - loss 2.50845940 - samples/sec: 305.77 - lr: 0.125000
2020-09-11 09:30:53,596 epoch 16 - iter 8/17 - loss 2.45025101 - samples/sec: 299.80 - lr: 0.125000
2020-09-11 09:30:53,706 epoch 16 - iter 9/17 - loss 2.47416223 - samples/sec: 296.94 - lr: 0.125000
2020-09-11 09:30:53,842 epoch 16 - iter 10/17 - loss 2.48455787 - samples/sec: 237.17 - lr: 0.125000
2020-09-11 09:30:53,951 epoch 16 - iter 11/17 - loss 2.49519675 - samples/sec: 297.89 - lr: 0.125000
2020-09-11 09:30:54,074 epoch 16 - iter 12/17 - loss 2.41682629 - samples/sec: 262.08 - lr: 0.125000
2020-09-11 09:30:54,179 epoch 16 - iter 13/17 - loss 2.43769492 - samples/sec: 310.28 - lr: 0.125000
2020-09-11 09:30:54,297 epoch 16 - iter 14/17 - loss 2.46912466 - samples/sec: 274.40 - lr: 0.125000
2020-09-11 09:30:54,410 epoch 16 - iter 15/17 - loss 2.47079910 - samples/sec: 285.36 - lr: 0.125000
2020-09-11 09:30:54,521 epoch 16 - iter 16/17 - loss 2.49755961 - samples/sec: 292.36 - lr: 0.125000
2020-09-11 09:30:54,597 epoch 16 - iter 17/17 - loss 2.52624600 - samples/sec: 426.15 - lr: 0.125000
2020-09-11 09:30:54,598 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:54,600 EPOCH 16 done: loss 2.5262 - lr 0.1250000
2020-09-11 09:30:54,681 DEV : loss 2.1843576431274414 - score 0.8964
2020-09-11 09:30:54,684 BAD EPOCHS (no improvement): 1
2020-09-11 09:30:54,686 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:54,806 epoch 17 - iter 1/17 - loss 2.76969957 - samples/sec: 270.53 - lr: 0.125000
2020-09-11 09:30:54,922 epoch 17 - iter 2/17 - loss 2.50936592 - samples/sec: 280.56 - lr: 0.125000
2020-09-11 09:30:55,046 epoch 17 - iter 3/17 - loss 2.33596226 - samples/sec: 258.96 - lr: 0.125000
2020-09-11 09:30:55,162 epoch 17 - iter 4/17 - loss 2.50554565 - samples/sec: 279.75 - lr: 0.125000
2020-09-11 09:30:55,265 epoch 17 - iter 5/17 - loss 2.27989476 - samples/sec: 316.59 - lr: 0.125000
2020-09-11 09:30:55,383 epoch 17 - iter 6/17 - loss 2.29474705 - samples/sec: 274.08 - lr: 0.125000
2020-09-11 09:30:55,494 epoch 17 - iter 7/17 - loss 2.42519081 - samples/sec: 290.64 - lr: 0.125000
2020-09-11 09:30:55,600 epoch 17 - iter 8/17 - loss 2.52284651 - samples/sec: 303.65 - lr: 0.125000
2020-09-11 09:30:55,702 epoch 17 - iter 9/17 - loss 2.41699484 - samples/sec: 318.36 - lr: 0.125000
2020-09-11 09:30:55,808 epoch 17 - iter 10/17 - loss 2.39273806 - samples/sec: 303.67 - lr: 0.125000
2020-09-11 09:30:55,944 epoch 17 - iter 11/17 - loss 2.39208945 - samples/sec: 238.63 - lr: 0.125000
2020-09-11 09:30:56,054 epoch 17 - iter 12/17 - loss 2.32023218 - samples/sec: 293.26 - lr: 0.125000
2020-09-11 09:30:56,160 epoch 17 - iter 13/17 - loss 2.35094486 - samples/sec: 305.68 - lr: 0.125000
2020-09-11 09:30:56,270 epoch 17 - iter 14/17 - loss 2.42827324 - samples/sec: 296.42 - lr: 0.125000
2020-09-11 09:30:56,396 epoch 17 - iter 15/17 - loss 2.45238497 - samples/sec: 257.97 - lr: 0.125000
2020-09-11 09:30:56,507 epoch 17 - iter 16/17 - loss 2.39506280 - samples/sec: 292.19 - lr: 0.125000
2020-09-11 09:30:56,584 epoch 17 - iter 17/17 - loss 2.49167655 - samples/sec: 422.23 - lr: 0.125000
2020-09-11 09:30:56,585 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:56,590 EPOCH 17 done: loss 2.4917 - lr 0.1250000
2020-09-11 09:30:56,669 DEV : loss 2.249250888824463 - score 0.8912
2020-09-11 09:30:56,672 BAD EPOCHS (no improvement): 2
2020-09-11 09:30:56,674 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:56,786 epoch 18 - iter 1/17 - loss 1.70234942 - samples/sec: 297.37 - lr: 0.125000
2020-09-11 09:30:56,888 epoch 18 - iter 2/17 - loss 1.85333061 - samples/sec: 315.17 - lr: 0.125000
2020-09-11 09:30:56,998 epoch 18 - iter 3/17 - loss 1.89275738 - samples/sec: 294.29 - lr: 0.125000
2020-09-11 09:30:57,114 epoch 18 - iter 4/17 - loss 1.86746427 - samples/sec: 278.81 - lr: 0.125000
2020-09-11 09:30:57,222 epoch 18 - iter 5/17 - loss 2.20966289 - samples/sec: 299.47 - lr: 0.125000
2020-09-11 09:30:57,332 epoch 18 - iter 6/17 - loss 2.16520981 - samples/sec: 293.48 - lr: 0.125000
2020-09-11 09:30:57,443 epoch 18 - iter 7/17 - loss 2.11290937 - samples/sec: 292.71 - lr: 0.125000
2020-09-11 09:30:57,543 epoch 18 - iter 8/17 - loss 2.15310632 - samples/sec: 325.15 - lr: 0.125000
2020-09-11 09:30:57,652 epoch 18 - iter 9/17 - loss 2.18450381 - samples/sec: 296.34 - lr: 0.125000
2020-09-11 09:30:57,766 epoch 18 - iter 10/17 - loss 2.19876078 - samples/sec: 282.87 - lr: 0.125000
2020-09-11 09:30:57,908 epoch 18 - iter 11/17 - loss 2.24738829 - samples/sec: 228.46 - lr: 0.125000
2020-09-11 09:30:58,022 epoch 18 - iter 12/17 - loss 2.29583320 - samples/sec: 283.50 - lr: 0.125000
2020-09-11 09:30:58,126 epoch 18 - iter 13/17 - loss 2.42597394 - samples/sec: 310.80 - lr: 0.125000
2020-09-11 09:30:58,225 epoch 18 - iter 14/17 - loss 2.40854189 - samples/sec: 326.30 - lr: 0.125000
2020-09-11 09:30:58,330 epoch 18 - iter 15/17 - loss 2.55437588 - samples/sec: 307.40 - lr: 0.125000
2020-09-11 09:30:58,442 epoch 18 - iter 16/17 - loss 2.60625351 - samples/sec: 289.05 - lr: 0.125000
2020-09-11 09:30:58,514 epoch 18 - iter 17/17 - loss 2.60324173 - samples/sec: 452.42 - lr: 0.125000
2020-09-11 09:30:58,515 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:58,519 EPOCH 18 done: loss 2.6032 - lr 0.1250000
2020-09-11 09:30:58,605 DEV : loss 2.1045773029327393 - score 0.8901
2020-09-11 09:30:58,608 BAD EPOCHS (no improvement): 3
2020-09-11 09:30:58,610 ----------------------------------------------------------------------------------------------------
2020-09-11 09:30:58,727 epoch 19 - iter 1/17 - loss 2.05735612 - samples/sec: 278.66 - lr: 0.125000
2020-09-11 09:30:58,847 epoch 19 - iter 2/17 - loss 2.11045420 - samples/sec: 269.04 - lr: 0.125000
2020-09-11 09:30:58,974 epoch 19 - iter 3/17 - loss 2.07742627 - samples/sec: 254.10 - lr: 0.125000
2020-09-11 09:30:59,084 epoch 19 - iter 4/17 - loss 2.27933270 - samples/sec: 295.28 - lr: 0.125000
2020-09-11 09:30:59,190 epoch 19 - iter 5/17 - loss 2.52328839 - samples/sec: 303.98 - lr: 0.125000
2020-09-11 09:30:59,299 epoch 19 - iter 6/17 - loss 2.53958567 - samples/sec: 303.08 - lr: 0.125000
2020-09-11 09:30:59,415 epoch 19 - iter 7/17 - loss 2.43096699 - samples/sec: 280.08 - lr: 0.125000
2020-09-11 09:30:59,519 epoch 19 - iter 8/17 - loss 2.36722346 - samples/sec: 310.25 - lr: 0.125000
2020-09-11 09:30:59,625 epoch 19 - iter 9/17 - loss 2.32014529 - samples/sec: 305.11 - lr: 0.125000
2020-09-11 09:30:59,733 epoch 19 - iter 10/17 - loss 2.40720191 - samples/sec: 301.33 - lr: 0.125000
2020-09-11 09:30:59,859 epoch 19 - iter 11/17 - loss 2.39145192 - samples/sec: 255.91 - lr: 0.125000
2020-09-11 09:30:59,974 epoch 19 - iter 12/17 - loss 2.35232800 - samples/sec: 281.75 - lr: 0.125000
2020-09-11 09:31:00,092 epoch 19 - iter 13/17 - loss 2.34161122 - samples/sec: 280.33 - lr: 0.125000
2020-09-11 09:31:00,202 epoch 19 - iter 14/17 - loss 2.39985812 - samples/sec: 291.89 - lr: 0.125000
2020-09-11 09:31:00,315 epoch 19 - iter 15/17 - loss 2.34814619 - samples/sec: 289.62 - lr: 0.125000
2020-09-11 09:31:00,447 epoch 19 - iter 16/17 - loss 2.40359858 - samples/sec: 245.59 - lr: 0.125000
2020-09-11 09:31:00,524 epoch 19 - iter 17/17 - loss 2.37741771 - samples/sec: 445.32 - lr: 0.125000
2020-09-11 09:31:00,525 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:00,530 EPOCH 19 done: loss 2.3774 - lr 0.1250000
2020-09-11 09:31:00,607 DEV : loss 1.987985372543335 - score 0.9039
Epoch    19: reducing learning rate of group 0 to 6.2500e-02.
2020-09-11 09:31:00,611 BAD EPOCHS (no improvement): 4
2020-09-11 09:31:00,614 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:00,726 epoch 20 - iter 1/17 - loss 1.71020281 - samples/sec: 296.47 - lr: 0.062500
2020-09-11 09:31:00,832 epoch 20 - iter 2/17 - loss 2.09335452 - samples/sec: 305.37 - lr: 0.062500
2020-09-11 09:31:00,942 epoch 20 - iter 3/17 - loss 2.28337387 - samples/sec: 293.37 - lr: 0.062500
2020-09-11 09:31:01,055 epoch 20 - iter 4/17 - loss 2.47729316 - samples/sec: 284.93 - lr: 0.062500
2020-09-11 09:31:01,159 epoch 20 - iter 5/17 - loss 2.56094611 - samples/sec: 314.81 - lr: 0.062500
2020-09-11 09:31:01,257 epoch 20 - iter 6/17 - loss 2.50572254 - samples/sec: 328.52 - lr: 0.062500
2020-09-11 09:31:01,380 epoch 20 - iter 7/17 - loss 2.47985882 - samples/sec: 262.47 - lr: 0.062500
2020-09-11 09:31:01,495 epoch 20 - iter 8/17 - loss 2.40888305 - samples/sec: 281.91 - lr: 0.062500
2020-09-11 09:31:01,597 epoch 20 - iter 9/17 - loss 2.43964536 - samples/sec: 320.29 - lr: 0.062500
2020-09-11 09:31:01,718 epoch 20 - iter 10/17 - loss 2.36184093 - samples/sec: 266.20 - lr: 0.062500
2020-09-11 09:31:01,834 epoch 20 - iter 11/17 - loss 2.33077885 - samples/sec: 277.68 - lr: 0.062500
2020-09-11 09:31:01,945 epoch 20 - iter 12/17 - loss 2.31888257 - samples/sec: 291.73 - lr: 0.062500
2020-09-11 09:31:02,060 epoch 20 - iter 13/17 - loss 2.30530426 - samples/sec: 281.27 - lr: 0.062500
2020-09-11 09:31:02,163 epoch 20 - iter 14/17 - loss 2.32191645 - samples/sec: 314.84 - lr: 0.062500
2020-09-11 09:31:02,267 epoch 20 - iter 15/17 - loss 2.34071354 - samples/sec: 309.11 - lr: 0.062500
2020-09-11 09:31:02,367 epoch 20 - iter 16/17 - loss 2.40924118 - samples/sec: 325.52 - lr: 0.062500
2020-09-11 09:31:02,444 epoch 20 - iter 17/17 - loss 2.38642045 - samples/sec: 422.96 - lr: 0.062500
2020-09-11 09:31:02,445 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:02,449 EPOCH 20 done: loss 2.3864 - lr 0.0625000
2020-09-11 09:31:02,524 DEV : loss 2.02628755569458 - score 0.9039
2020-09-11 09:31:02,526 BAD EPOCHS (no improvement): 1
2020-09-11 09:31:02,531 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:02,634 epoch 21 - iter 1/17 - loss 2.01805162 - samples/sec: 313.46 - lr: 0.062500
2020-09-11 09:31:02,740 epoch 21 - iter 2/17 - loss 1.95761949 - samples/sec: 307.95 - lr: 0.062500
2020-09-11 09:31:02,865 epoch 21 - iter 3/17 - loss 2.05638238 - samples/sec: 257.24 - lr: 0.062500
2020-09-11 09:31:02,986 epoch 21 - iter 4/17 - loss 2.24450067 - samples/sec: 268.72 - lr: 0.062500
2020-09-11 09:31:03,099 epoch 21 - iter 5/17 - loss 2.27903502 - samples/sec: 285.77 - lr: 0.062500
2020-09-11 09:31:03,203 epoch 21 - iter 6/17 - loss 2.38084318 - samples/sec: 308.65 - lr: 0.062500
2020-09-11 09:31:03,310 epoch 21 - iter 7/17 - loss 2.30562082 - samples/sec: 303.05 - lr: 0.062500
2020-09-11 09:31:03,444 epoch 21 - iter 8/17 - loss 2.33702309 - samples/sec: 240.19 - lr: 0.062500
2020-09-11 09:31:03,550 epoch 21 - iter 9/17 - loss 2.24217778 - samples/sec: 309.72 - lr: 0.062500
2020-09-11 09:31:03,652 epoch 21 - iter 10/17 - loss 2.26832607 - samples/sec: 316.97 - lr: 0.062500
2020-09-11 09:31:03,762 epoch 21 - iter 11/17 - loss 2.26648381 - samples/sec: 294.96 - lr: 0.062500
2020-09-11 09:31:03,867 epoch 21 - iter 12/17 - loss 2.28058559 - samples/sec: 307.86 - lr: 0.062500
2020-09-11 09:31:03,976 epoch 21 - iter 13/17 - loss 2.25714514 - samples/sec: 296.97 - lr: 0.062500
2020-09-11 09:31:04,091 epoch 21 - iter 14/17 - loss 2.23559930 - samples/sec: 281.10 - lr: 0.062500
2020-09-11 09:31:04,206 epoch 21 - iter 15/17 - loss 2.27486047 - samples/sec: 283.20 - lr: 0.062500
2020-09-11 09:31:04,312 epoch 21 - iter 16/17 - loss 2.25765611 - samples/sec: 310.23 - lr: 0.062500
2020-09-11 09:31:04,382 epoch 21 - iter 17/17 - loss 2.24482668 - samples/sec: 463.98 - lr: 0.062500
2020-09-11 09:31:04,383 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:04,389 EPOCH 21 done: loss 2.2448 - lr 0.0625000
2020-09-11 09:31:04,476 DEV : loss 1.9274215698242188 - score 0.9039
2020-09-11 09:31:04,479 BAD EPOCHS (no improvement): 2
2020-09-11 09:31:04,482 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:04,591 epoch 22 - iter 1/17 - loss 2.05779243 - samples/sec: 299.29 - lr: 0.062500
2020-09-11 09:31:04,712 epoch 22 - iter 2/17 - loss 2.54358244 - samples/sec: 267.17 - lr: 0.062500
2020-09-11 09:31:04,843 epoch 22 - iter 3/17 - loss 2.38451076 - samples/sec: 246.03 - lr: 0.062500
2020-09-11 09:31:04,950 epoch 22 - iter 4/17 - loss 2.44637775 - samples/sec: 303.17 - lr: 0.062500
2020-09-11 09:31:05,057 epoch 22 - iter 5/17 - loss 2.30466504 - samples/sec: 302.91 - lr: 0.062500
2020-09-11 09:31:05,178 epoch 22 - iter 6/17 - loss 2.26858521 - samples/sec: 266.10 - lr: 0.062500
2020-09-11 09:31:05,277 epoch 22 - iter 7/17 - loss 2.12332932 - samples/sec: 328.32 - lr: 0.062500
2020-09-11 09:31:05,377 epoch 22 - iter 8/17 - loss 2.16235070 - samples/sec: 321.38 - lr: 0.062500
2020-09-11 09:31:05,507 epoch 22 - iter 9/17 - loss 2.22368626 - samples/sec: 253.23 - lr: 0.062500
2020-09-11 09:31:05,611 epoch 22 - iter 10/17 - loss 2.20117749 - samples/sec: 310.81 - lr: 0.062500
2020-09-11 09:31:05,711 epoch 22 - iter 11/17 - loss 2.23854591 - samples/sec: 323.73 - lr: 0.062500
2020-09-11 09:31:05,832 epoch 22 - iter 12/17 - loss 2.23895742 - samples/sec: 264.75 - lr: 0.062500
2020-09-11 09:31:05,976 epoch 22 - iter 13/17 - loss 2.28941275 - samples/sec: 224.52 - lr: 0.062500
2020-09-11 09:31:06,084 epoch 22 - iter 14/17 - loss 2.28183858 - samples/sec: 302.04 - lr: 0.062500
2020-09-11 09:31:06,196 epoch 22 - iter 15/17 - loss 2.27302086 - samples/sec: 286.23 - lr: 0.062500
2020-09-11 09:31:06,309 epoch 22 - iter 16/17 - loss 2.25989293 - samples/sec: 287.92 - lr: 0.062500
2020-09-11 09:31:06,386 epoch 22 - iter 17/17 - loss 2.19085824 - samples/sec: 419.62 - lr: 0.062500
2020-09-11 09:31:06,388 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:06,393 EPOCH 22 done: loss 2.1909 - lr 0.0625000
2020-09-11 09:31:06,480 DEV : loss 1.9331698417663574 - score 0.9039
2020-09-11 09:31:06,484 BAD EPOCHS (no improvement): 3
2020-09-11 09:31:06,486 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:06,601 epoch 23 - iter 1/17 - loss 1.70134401 - samples/sec: 283.94 - lr: 0.062500
2020-09-11 09:31:06,711 epoch 23 - iter 2/17 - loss 2.13410854 - samples/sec: 299.57 - lr: 0.062500
2020-09-11 09:31:06,818 epoch 23 - iter 3/17 - loss 2.12737036 - samples/sec: 301.17 - lr: 0.062500
2020-09-11 09:31:06,945 epoch 23 - iter 4/17 - loss 2.07283798 - samples/sec: 254.23 - lr: 0.062500
2020-09-11 09:31:07,062 epoch 23 - iter 5/17 - loss 2.13042910 - samples/sec: 277.10 - lr: 0.062500
2020-09-11 09:31:07,180 epoch 23 - iter 6/17 - loss 2.22374584 - samples/sec: 273.38 - lr: 0.062500
2020-09-11 09:31:07,293 epoch 23 - iter 7/17 - loss 2.24066106 - samples/sec: 285.75 - lr: 0.062500
2020-09-11 09:31:07,402 epoch 23 - iter 8/17 - loss 2.25720285 - samples/sec: 298.11 - lr: 0.062500
2020-09-11 09:31:07,520 epoch 23 - iter 9/17 - loss 2.20347146 - samples/sec: 273.03 - lr: 0.062500
2020-09-11 09:31:07,633 epoch 23 - iter 10/17 - loss 2.24449781 - samples/sec: 285.70 - lr: 0.062500
2020-09-11 09:31:07,744 epoch 23 - iter 11/17 - loss 2.31409958 - samples/sec: 292.72 - lr: 0.062500
2020-09-11 09:31:07,860 epoch 23 - iter 12/17 - loss 2.29987424 - samples/sec: 279.58 - lr: 0.062500
2020-09-11 09:31:07,986 epoch 23 - iter 13/17 - loss 2.30229404 - samples/sec: 255.65 - lr: 0.062500
2020-09-11 09:31:08,088 epoch 23 - iter 14/17 - loss 2.32035975 - samples/sec: 317.76 - lr: 0.062500
2020-09-11 09:31:08,205 epoch 23 - iter 15/17 - loss 2.29056011 - samples/sec: 275.83 - lr: 0.062500
2020-09-11 09:31:08,321 epoch 23 - iter 16/17 - loss 2.27713012 - samples/sec: 280.00 - lr: 0.062500
2020-09-11 09:31:08,399 epoch 23 - iter 17/17 - loss 2.26789435 - samples/sec: 413.97 - lr: 0.062500
2020-09-11 09:31:08,401 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:08,406 EPOCH 23 done: loss 2.2679 - lr 0.0625000
2020-09-11 09:31:08,484 DEV : loss 1.9181852340698242 - score 0.9039
Epoch    23: reducing learning rate of group 0 to 3.1250e-02.
2020-09-11 09:31:08,489 BAD EPOCHS (no improvement): 4
2020-09-11 09:31:08,490 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:08,603 epoch 24 - iter 1/17 - loss 2.76224279 - samples/sec: 300.34 - lr: 0.031250
2020-09-11 09:31:08,713 epoch 24 - iter 2/17 - loss 2.52293849 - samples/sec: 293.60 - lr: 0.031250
2020-09-11 09:31:08,826 epoch 24 - iter 3/17 - loss 2.32014473 - samples/sec: 285.65 - lr: 0.031250
2020-09-11 09:31:08,939 epoch 24 - iter 4/17 - loss 2.27968848 - samples/sec: 288.03 - lr: 0.031250
2020-09-11 09:31:09,047 epoch 24 - iter 5/17 - loss 2.19507091 - samples/sec: 300.27 - lr: 0.031250
2020-09-11 09:31:09,143 epoch 24 - iter 6/17 - loss 2.15499967 - samples/sec: 335.25 - lr: 0.031250
2020-09-11 09:31:09,262 epoch 24 - iter 7/17 - loss 2.34728897 - samples/sec: 271.65 - lr: 0.031250
2020-09-11 09:31:09,371 epoch 24 - iter 8/17 - loss 2.23135819 - samples/sec: 297.18 - lr: 0.031250
2020-09-11 09:31:09,487 epoch 24 - iter 9/17 - loss 2.35803510 - samples/sec: 279.54 - lr: 0.031250
2020-09-11 09:31:09,603 epoch 24 - iter 10/17 - loss 2.30058753 - samples/sec: 279.13 - lr: 0.031250
2020-09-11 09:31:09,719 epoch 24 - iter 11/17 - loss 2.25945546 - samples/sec: 280.01 - lr: 0.031250
2020-09-11 09:31:09,835 epoch 24 - iter 12/17 - loss 2.27051020 - samples/sec: 278.96 - lr: 0.031250
2020-09-11 09:31:09,945 epoch 24 - iter 13/17 - loss 2.23163500 - samples/sec: 292.98 - lr: 0.031250
2020-09-11 09:31:10,057 epoch 24 - iter 14/17 - loss 2.25586351 - samples/sec: 290.07 - lr: 0.031250
2020-09-11 09:31:10,167 epoch 24 - iter 15/17 - loss 2.26975231 - samples/sec: 291.75 - lr: 0.031250
2020-09-11 09:31:10,284 epoch 24 - iter 16/17 - loss 2.23412069 - samples/sec: 278.97 - lr: 0.031250
2020-09-11 09:31:10,378 epoch 24 - iter 17/17 - loss 2.21847627 - samples/sec: 346.19 - lr: 0.031250
2020-09-11 09:31:10,379 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:10,385 EPOCH 24 done: loss 2.2185 - lr 0.0312500
2020-09-11 09:31:10,464 DEV : loss 1.9145869016647339 - score 0.9039
2020-09-11 09:31:10,467 BAD EPOCHS (no improvement): 1
2020-09-11 09:31:10,469 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:10,576 epoch 25 - iter 1/17 - loss 2.68180037 - samples/sec: 308.77 - lr: 0.031250
2020-09-11 09:31:10,701 epoch 25 - iter 2/17 - loss 2.58654761 - samples/sec: 259.33 - lr: 0.031250
2020-09-11 09:31:10,806 epoch 25 - iter 3/17 - loss 2.54156987 - samples/sec: 306.55 - lr: 0.031250
2020-09-11 09:31:10,922 epoch 25 - iter 4/17 - loss 2.45042753 - samples/sec: 278.73 - lr: 0.031250
2020-09-11 09:31:11,030 epoch 25 - iter 5/17 - loss 2.37050085 - samples/sec: 300.68 - lr: 0.031250
2020-09-11 09:31:11,131 epoch 25 - iter 6/17 - loss 2.17418148 - samples/sec: 320.10 - lr: 0.031250
2020-09-11 09:31:11,238 epoch 25 - iter 7/17 - loss 2.03742301 - samples/sec: 303.48 - lr: 0.031250
2020-09-11 09:31:11,349 epoch 25 - iter 8/17 - loss 2.02971898 - samples/sec: 293.46 - lr: 0.031250
2020-09-11 09:31:11,475 epoch 25 - iter 9/17 - loss 1.98951248 - samples/sec: 257.54 - lr: 0.031250
2020-09-11 09:31:11,590 epoch 25 - iter 10/17 - loss 2.04102901 - samples/sec: 279.25 - lr: 0.031250
2020-09-11 09:31:11,702 epoch 25 - iter 11/17 - loss 2.12209180 - samples/sec: 289.60 - lr: 0.031250
2020-09-11 09:31:11,808 epoch 25 - iter 12/17 - loss 2.12565103 - samples/sec: 307.27 - lr: 0.031250
2020-09-11 09:31:11,916 epoch 25 - iter 13/17 - loss 2.21383809 - samples/sec: 301.98 - lr: 0.031250
2020-09-11 09:31:12,021 epoch 25 - iter 14/17 - loss 2.22879870 - samples/sec: 308.28 - lr: 0.031250
2020-09-11 09:31:12,143 epoch 25 - iter 15/17 - loss 2.25462717 - samples/sec: 265.38 - lr: 0.031250
2020-09-11 09:31:12,261 epoch 25 - iter 16/17 - loss 2.24462736 - samples/sec: 273.45 - lr: 0.031250
2020-09-11 09:31:12,339 epoch 25 - iter 17/17 - loss 2.26452670 - samples/sec: 422.20 - lr: 0.031250
2020-09-11 09:31:12,340 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:12,342 EPOCH 25 done: loss 2.2645 - lr 0.0312500
2020-09-11 09:31:12,425 DEV : loss 1.8926992416381836 - score 0.9039
2020-09-11 09:31:12,429 BAD EPOCHS (no improvement): 2
2020-09-11 09:31:12,431 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:12,547 epoch 26 - iter 1/17 - loss 1.52716124 - samples/sec: 279.51 - lr: 0.031250
2020-09-11 09:31:12,670 epoch 26 - iter 2/17 - loss 1.83199435 - samples/sec: 264.82 - lr: 0.031250
2020-09-11 09:31:12,783 epoch 26 - iter 3/17 - loss 1.96283241 - samples/sec: 291.04 - lr: 0.031250
2020-09-11 09:31:12,890 epoch 26 - iter 4/17 - loss 1.96469370 - samples/sec: 304.40 - lr: 0.031250
2020-09-11 09:31:13,001 epoch 26 - iter 5/17 - loss 2.03075287 - samples/sec: 290.77 - lr: 0.031250
2020-09-11 09:31:13,114 epoch 26 - iter 6/17 - loss 2.18692909 - samples/sec: 286.41 - lr: 0.031250
2020-09-11 09:31:13,238 epoch 26 - iter 7/17 - loss 2.29399492 - samples/sec: 261.06 - lr: 0.031250
2020-09-11 09:31:13,359 epoch 26 - iter 8/17 - loss 2.21845753 - samples/sec: 266.94 - lr: 0.031250
2020-09-11 09:31:13,465 epoch 26 - iter 9/17 - loss 2.27986459 - samples/sec: 304.67 - lr: 0.031250
2020-09-11 09:31:13,574 epoch 26 - iter 10/17 - loss 2.31232477 - samples/sec: 297.41 - lr: 0.031250
2020-09-11 09:31:13,690 epoch 26 - iter 11/17 - loss 2.29177281 - samples/sec: 282.18 - lr: 0.031250
2020-09-11 09:31:13,811 epoch 26 - iter 12/17 - loss 2.25202786 - samples/sec: 267.51 - lr: 0.031250
2020-09-11 09:31:13,918 epoch 26 - iter 13/17 - loss 2.21773954 - samples/sec: 302.48 - lr: 0.031250
2020-09-11 09:31:14,029 epoch 26 - iter 14/17 - loss 2.19228974 - samples/sec: 290.48 - lr: 0.031250
2020-09-11 09:31:14,140 epoch 26 - iter 15/17 - loss 2.16736569 - samples/sec: 292.30 - lr: 0.031250
2020-09-11 09:31:14,245 epoch 26 - iter 16/17 - loss 2.16703309 - samples/sec: 307.62 - lr: 0.031250
2020-09-11 09:31:14,336 epoch 26 - iter 17/17 - loss 2.20482035 - samples/sec: 355.35 - lr: 0.031250
2020-09-11 09:31:14,337 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:14,339 EPOCH 26 done: loss 2.2048 - lr 0.0312500
2020-09-11 09:31:14,418 DEV : loss 1.829909324645996 - score 0.9039
2020-09-11 09:31:14,420 BAD EPOCHS (no improvement): 3
2020-09-11 09:31:14,423 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:14,535 epoch 27 - iter 1/17 - loss 2.94158649 - samples/sec: 289.52 - lr: 0.031250
2020-09-11 09:31:14,650 epoch 27 - iter 2/17 - loss 2.31759334 - samples/sec: 279.59 - lr: 0.031250
2020-09-11 09:31:14,769 epoch 27 - iter 3/17 - loss 2.34357309 - samples/sec: 274.76 - lr: 0.031250
2020-09-11 09:31:14,901 epoch 27 - iter 4/17 - loss 2.31417656 - samples/sec: 252.17 - lr: 0.031250
2020-09-11 09:31:15,019 epoch 27 - iter 5/17 - loss 2.19485738 - samples/sec: 274.71 - lr: 0.031250
2020-09-11 09:31:15,131 epoch 27 - iter 6/17 - loss 2.24387747 - samples/sec: 289.75 - lr: 0.031250
2020-09-11 09:31:15,248 epoch 27 - iter 7/17 - loss 2.31949151 - samples/sec: 276.19 - lr: 0.031250
2020-09-11 09:31:15,372 epoch 27 - iter 8/17 - loss 2.27232495 - samples/sec: 261.82 - lr: 0.031250
2020-09-11 09:31:15,501 epoch 27 - iter 9/17 - loss 2.23626822 - samples/sec: 251.21 - lr: 0.031250
2020-09-11 09:31:15,634 epoch 27 - iter 10/17 - loss 2.19940158 - samples/sec: 243.44 - lr: 0.031250
2020-09-11 09:31:15,745 epoch 27 - iter 11/17 - loss 2.25831646 - samples/sec: 289.98 - lr: 0.031250
2020-09-11 09:31:15,860 epoch 27 - iter 12/17 - loss 2.20441757 - samples/sec: 286.89 - lr: 0.031250
2020-09-11 09:31:15,971 epoch 27 - iter 13/17 - loss 2.22872842 - samples/sec: 297.65 - lr: 0.031250
2020-09-11 09:31:16,081 epoch 27 - iter 14/17 - loss 2.20987686 - samples/sec: 292.10 - lr: 0.031250
2020-09-11 09:31:16,191 epoch 27 - iter 15/17 - loss 2.19334530 - samples/sec: 295.28 - lr: 0.031250
2020-09-11 09:31:16,299 epoch 27 - iter 16/17 - loss 2.17026734 - samples/sec: 297.75 - lr: 0.031250
2020-09-11 09:31:16,393 epoch 27 - iter 17/17 - loss 2.12320886 - samples/sec: 344.81 - lr: 0.031250
2020-09-11 09:31:16,394 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:16,396 EPOCH 27 done: loss 2.1232 - lr 0.0312500
2020-09-11 09:31:16,477 DEV : loss 1.877849817276001 - score 0.9039
Epoch    27: reducing learning rate of group 0 to 1.5625e-02.
2020-09-11 09:31:16,480 BAD EPOCHS (no improvement): 4
2020-09-11 09:31:16,482 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:16,598 epoch 28 - iter 1/17 - loss 1.15935516 - samples/sec: 281.50 - lr: 0.015625
2020-09-11 09:31:16,730 epoch 28 - iter 2/17 - loss 1.71386480 - samples/sec: 244.95 - lr: 0.015625
2020-09-11 09:31:16,843 epoch 28 - iter 3/17 - loss 1.80357365 - samples/sec: 288.82 - lr: 0.015625
2020-09-11 09:31:16,953 epoch 28 - iter 4/17 - loss 1.88561693 - samples/sec: 293.88 - lr: 0.015625
2020-09-11 09:31:17,069 epoch 28 - iter 5/17 - loss 1.87196920 - samples/sec: 280.24 - lr: 0.015625
2020-09-11 09:31:17,191 epoch 28 - iter 6/17 - loss 1.89888237 - samples/sec: 264.96 - lr: 0.015625
2020-09-11 09:31:17,299 epoch 28 - iter 7/17 - loss 2.00117913 - samples/sec: 298.19 - lr: 0.015625
2020-09-11 09:31:17,419 epoch 28 - iter 8/17 - loss 1.97936609 - samples/sec: 269.09 - lr: 0.015625
2020-09-11 09:31:17,526 epoch 28 - iter 9/17 - loss 1.89083740 - samples/sec: 304.52 - lr: 0.015625
2020-09-11 09:31:17,635 epoch 28 - iter 10/17 - loss 2.04024680 - samples/sec: 298.68 - lr: 0.015625
2020-09-11 09:31:17,750 epoch 28 - iter 11/17 - loss 2.15808472 - samples/sec: 280.07 - lr: 0.015625
2020-09-11 09:31:17,862 epoch 28 - iter 12/17 - loss 2.18874393 - samples/sec: 288.12 - lr: 0.015625
2020-09-11 09:31:17,979 epoch 28 - iter 13/17 - loss 2.18398133 - samples/sec: 277.47 - lr: 0.015625
2020-09-11 09:31:18,107 epoch 28 - iter 14/17 - loss 2.23524254 - samples/sec: 252.52 - lr: 0.015625
2020-09-11 09:31:18,209 epoch 28 - iter 15/17 - loss 2.20884586 - samples/sec: 317.97 - lr: 0.015625
2020-09-11 09:31:18,328 epoch 28 - iter 16/17 - loss 2.19283289 - samples/sec: 271.69 - lr: 0.015625
2020-09-11 09:31:18,411 epoch 28 - iter 17/17 - loss 2.17065479 - samples/sec: 389.14 - lr: 0.015625
2020-09-11 09:31:18,412 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:18,416 EPOCH 28 done: loss 2.1707 - lr 0.0156250
2020-09-11 09:31:18,497 DEV : loss 1.8591759204864502 - score 0.9039
2020-09-11 09:31:18,501 BAD EPOCHS (no improvement): 1
2020-09-11 09:31:18,504 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:18,616 epoch 29 - iter 1/17 - loss 2.38848042 - samples/sec: 295.16 - lr: 0.015625
2020-09-11 09:31:18,730 epoch 29 - iter 2/17 - loss 2.01982307 - samples/sec: 281.73 - lr: 0.015625
2020-09-11 09:31:18,842 epoch 29 - iter 3/17 - loss 2.28015947 - samples/sec: 289.15 - lr: 0.015625
2020-09-11 09:31:18,973 epoch 29 - iter 4/17 - loss 2.35284030 - samples/sec: 248.54 - lr: 0.015625
2020-09-11 09:31:19,100 epoch 29 - iter 5/17 - loss 2.46799192 - samples/sec: 253.52 - lr: 0.015625
2020-09-11 09:31:19,208 epoch 29 - iter 6/17 - loss 2.40597574 - samples/sec: 298.77 - lr: 0.015625
2020-09-11 09:31:19,316 epoch 29 - iter 7/17 - loss 2.27038290 - samples/sec: 301.48 - lr: 0.015625
2020-09-11 09:31:19,432 epoch 29 - iter 8/17 - loss 2.20697598 - samples/sec: 277.52 - lr: 0.015625
2020-09-11 09:31:19,545 epoch 29 - iter 9/17 - loss 2.14561096 - samples/sec: 286.38 - lr: 0.015625
2020-09-11 09:31:19,656 epoch 29 - iter 10/17 - loss 2.20748037 - samples/sec: 293.48 - lr: 0.015625
2020-09-11 09:31:19,763 epoch 29 - iter 11/17 - loss 2.22472450 - samples/sec: 302.61 - lr: 0.015625
2020-09-11 09:31:19,878 epoch 29 - iter 12/17 - loss 2.24347988 - samples/sec: 286.50 - lr: 0.015625
2020-09-11 09:31:19,994 epoch 29 - iter 13/17 - loss 2.21828763 - samples/sec: 277.90 - lr: 0.015625
2020-09-11 09:31:20,105 epoch 29 - iter 14/17 - loss 2.18254331 - samples/sec: 294.47 - lr: 0.015625
2020-09-11 09:31:20,213 epoch 29 - iter 15/17 - loss 2.22664884 - samples/sec: 299.30 - lr: 0.015625
2020-09-11 09:31:20,322 epoch 29 - iter 16/17 - loss 2.23254411 - samples/sec: 297.41 - lr: 0.015625
2020-09-11 09:31:20,399 epoch 29 - iter 17/17 - loss 2.21945810 - samples/sec: 422.06 - lr: 0.015625
2020-09-11 09:31:20,400 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:20,402 EPOCH 29 done: loss 2.2195 - lr 0.0156250
2020-09-11 09:31:20,492 DEV : loss 1.8752442598342896 - score 0.9039
2020-09-11 09:31:20,496 BAD EPOCHS (no improvement): 2
2020-09-11 09:31:20,497 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:20,607 epoch 30 - iter 1/17 - loss 1.82208562 - samples/sec: 297.46 - lr: 0.015625
2020-09-11 09:31:20,721 epoch 30 - iter 2/17 - loss 2.00882280 - samples/sec: 284.76 - lr: 0.015625
2020-09-11 09:31:20,838 epoch 30 - iter 3/17 - loss 2.11731188 - samples/sec: 276.32 - lr: 0.015625
2020-09-11 09:31:20,946 epoch 30 - iter 4/17 - loss 1.95303643 - samples/sec: 300.17 - lr: 0.015625
2020-09-11 09:31:21,047 epoch 30 - iter 5/17 - loss 2.05010142 - samples/sec: 322.80 - lr: 0.015625
2020-09-11 09:31:21,164 epoch 30 - iter 6/17 - loss 2.18919861 - samples/sec: 276.19 - lr: 0.015625
2020-09-11 09:31:21,273 epoch 30 - iter 7/17 - loss 2.20131217 - samples/sec: 298.11 - lr: 0.015625
2020-09-11 09:31:21,389 epoch 30 - iter 8/17 - loss 2.24543753 - samples/sec: 282.40 - lr: 0.015625
2020-09-11 09:31:21,506 epoch 30 - iter 9/17 - loss 2.20305248 - samples/sec: 277.27 - lr: 0.015625
2020-09-11 09:31:21,611 epoch 30 - iter 10/17 - loss 2.13625307 - samples/sec: 309.91 - lr: 0.015625
2020-09-11 09:31:21,733 epoch 30 - iter 11/17 - loss 2.14368816 - samples/sec: 264.68 - lr: 0.015625
2020-09-11 09:31:21,870 epoch 30 - iter 12/17 - loss 2.21769957 - samples/sec: 235.08 - lr: 0.015625
2020-09-11 09:31:21,980 epoch 30 - iter 13/17 - loss 2.18367576 - samples/sec: 297.07 - lr: 0.015625
2020-09-11 09:31:22,087 epoch 30 - iter 14/17 - loss 2.16648819 - samples/sec: 303.74 - lr: 0.015625
2020-09-11 09:31:22,193 epoch 30 - iter 15/17 - loss 2.19202752 - samples/sec: 304.22 - lr: 0.015625
2020-09-11 09:31:22,301 epoch 30 - iter 16/17 - loss 2.19048543 - samples/sec: 304.97 - lr: 0.015625
2020-09-11 09:31:22,394 epoch 30 - iter 17/17 - loss 2.21348506 - samples/sec: 351.18 - lr: 0.015625
2020-09-11 09:31:22,395 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:22,400 EPOCH 30 done: loss 2.2135 - lr 0.0156250
2020-09-11 09:31:22,481 DEV : loss 1.8820831775665283 - score 0.9039
2020-09-11 09:31:22,484 BAD EPOCHS (no improvement): 3
2020-09-11 09:31:22,486 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:22,600 epoch 31 - iter 1/17 - loss 2.38624716 - samples/sec: 288.82 - lr: 0.015625
2020-09-11 09:31:22,707 epoch 31 - iter 2/17 - loss 2.14800692 - samples/sec: 304.05 - lr: 0.015625
2020-09-11 09:31:22,816 epoch 31 - iter 3/17 - loss 1.89553030 - samples/sec: 296.20 - lr: 0.015625
2020-09-11 09:31:22,921 epoch 31 - iter 4/17 - loss 1.80254796 - samples/sec: 308.79 - lr: 0.015625
2020-09-11 09:31:23,025 epoch 31 - iter 5/17 - loss 2.05551784 - samples/sec: 312.82 - lr: 0.015625
2020-09-11 09:31:23,132 epoch 31 - iter 6/17 - loss 2.07799266 - samples/sec: 303.13 - lr: 0.015625
2020-09-11 09:31:23,242 epoch 31 - iter 7/17 - loss 2.12334066 - samples/sec: 292.67 - lr: 0.015625
2020-09-11 09:31:23,354 epoch 31 - iter 8/17 - loss 2.12068520 - samples/sec: 289.28 - lr: 0.015625
2020-09-11 09:31:23,464 epoch 31 - iter 9/17 - loss 2.06356608 - samples/sec: 295.16 - lr: 0.015625
2020-09-11 09:31:23,596 epoch 31 - iter 10/17 - loss 2.07550075 - samples/sec: 244.25 - lr: 0.015625
2020-09-11 09:31:23,718 epoch 31 - iter 11/17 - loss 2.08892419 - samples/sec: 264.35 - lr: 0.015625
2020-09-11 09:31:23,850 epoch 31 - iter 12/17 - loss 2.10753208 - samples/sec: 245.54 - lr: 0.015625
2020-09-11 09:31:23,961 epoch 31 - iter 13/17 - loss 2.11423028 - samples/sec: 292.27 - lr: 0.015625
2020-09-11 09:31:24,075 epoch 31 - iter 14/17 - loss 2.10826038 - samples/sec: 284.92 - lr: 0.015625
2020-09-11 09:31:24,180 epoch 31 - iter 15/17 - loss 2.15856535 - samples/sec: 306.64 - lr: 0.015625
2020-09-11 09:31:24,289 epoch 31 - iter 16/17 - loss 2.20597644 - samples/sec: 296.83 - lr: 0.015625
2020-09-11 09:31:24,363 epoch 31 - iter 17/17 - loss 2.15071367 - samples/sec: 441.66 - lr: 0.015625
2020-09-11 09:31:24,364 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:24,369 EPOCH 31 done: loss 2.1507 - lr 0.0156250
2020-09-11 09:31:24,448 DEV : loss 1.87209951877594 - score 0.9039
Epoch    31: reducing learning rate of group 0 to 7.8125e-03.
2020-09-11 09:31:24,450 BAD EPOCHS (no improvement): 4
2020-09-11 09:31:24,454 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:24,587 epoch 32 - iter 1/17 - loss 3.31541109 - samples/sec: 244.62 - lr: 0.007812
2020-09-11 09:31:24,699 epoch 32 - iter 2/17 - loss 2.87909269 - samples/sec: 292.61 - lr: 0.007812
2020-09-11 09:31:24,817 epoch 32 - iter 3/17 - loss 2.39622060 - samples/sec: 274.76 - lr: 0.007812
2020-09-11 09:31:24,922 epoch 32 - iter 4/17 - loss 2.27022970 - samples/sec: 307.60 - lr: 0.007812
2020-09-11 09:31:25,030 epoch 32 - iter 5/17 - loss 2.35990863 - samples/sec: 299.72 - lr: 0.007812
2020-09-11 09:31:25,138 epoch 32 - iter 6/17 - loss 2.25238045 - samples/sec: 299.64 - lr: 0.007812
2020-09-11 09:31:25,252 epoch 32 - iter 7/17 - loss 2.31877245 - samples/sec: 281.27 - lr: 0.007812
2020-09-11 09:31:25,359 epoch 32 - iter 8/17 - loss 2.32546023 - samples/sec: 302.22 - lr: 0.007812
2020-09-11 09:31:25,465 epoch 32 - iter 9/17 - loss 2.25857042 - samples/sec: 305.31 - lr: 0.007812
2020-09-11 09:31:25,578 epoch 32 - iter 10/17 - loss 2.16616904 - samples/sec: 284.42 - lr: 0.007812
2020-09-11 09:31:25,678 epoch 32 - iter 11/17 - loss 2.17235703 - samples/sec: 325.38 - lr: 0.007812
2020-09-11 09:31:25,788 epoch 32 - iter 12/17 - loss 2.24928207 - samples/sec: 292.01 - lr: 0.007812
2020-09-11 09:31:25,887 epoch 32 - iter 13/17 - loss 2.20171934 - samples/sec: 327.47 - lr: 0.007812
2020-09-11 09:31:25,994 epoch 32 - iter 14/17 - loss 2.19627576 - samples/sec: 304.41 - lr: 0.007812
2020-09-11 09:31:26,097 epoch 32 - iter 15/17 - loss 2.15969448 - samples/sec: 314.44 - lr: 0.007812
2020-09-11 09:31:26,196 epoch 32 - iter 16/17 - loss 2.15566656 - samples/sec: 324.70 - lr: 0.007812
2020-09-11 09:31:26,277 epoch 32 - iter 17/17 - loss 2.12638341 - samples/sec: 401.92 - lr: 0.007812
2020-09-11 09:31:26,278 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:26,283 EPOCH 32 done: loss 2.1264 - lr 0.0078125
2020-09-11 09:31:26,360 DEV : loss 1.8655517101287842 - score 0.9039
2020-09-11 09:31:26,363 BAD EPOCHS (no improvement): 1
2020-09-11 09:31:26,367 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:26,472 epoch 33 - iter 1/17 - loss 2.11451244 - samples/sec: 307.77 - lr: 0.007812
2020-09-11 09:31:26,571 epoch 33 - iter 2/17 - loss 1.94452286 - samples/sec: 329.06 - lr: 0.007812
2020-09-11 09:31:26,692 epoch 33 - iter 3/17 - loss 2.11479004 - samples/sec: 269.04 - lr: 0.007812
2020-09-11 09:31:26,810 epoch 33 - iter 4/17 - loss 2.03008524 - samples/sec: 273.58 - lr: 0.007812
2020-09-11 09:31:26,921 epoch 33 - iter 5/17 - loss 1.94079068 - samples/sec: 293.75 - lr: 0.007812
2020-09-11 09:31:27,030 epoch 33 - iter 6/17 - loss 2.00068849 - samples/sec: 296.73 - lr: 0.007812
2020-09-11 09:31:27,143 epoch 33 - iter 7/17 - loss 2.01924847 - samples/sec: 288.16 - lr: 0.007812
2020-09-11 09:31:27,251 epoch 33 - iter 8/17 - loss 2.11283641 - samples/sec: 297.76 - lr: 0.007812
2020-09-11 09:31:27,358 epoch 33 - iter 9/17 - loss 2.04315246 - samples/sec: 303.98 - lr: 0.007812
2020-09-11 09:31:27,473 epoch 33 - iter 10/17 - loss 2.06819868 - samples/sec: 280.28 - lr: 0.007812
2020-09-11 09:31:27,583 epoch 33 - iter 11/17 - loss 2.12044837 - samples/sec: 297.79 - lr: 0.007812
2020-09-11 09:31:27,693 epoch 33 - iter 12/17 - loss 2.14381409 - samples/sec: 293.06 - lr: 0.007812
2020-09-11 09:31:27,802 epoch 33 - iter 13/17 - loss 2.14429503 - samples/sec: 297.72 - lr: 0.007812
2020-09-11 09:31:27,913 epoch 33 - iter 14/17 - loss 2.10765451 - samples/sec: 291.99 - lr: 0.007812
2020-09-11 09:31:28,053 epoch 33 - iter 15/17 - loss 2.13644788 - samples/sec: 230.54 - lr: 0.007812
2020-09-11 09:31:28,157 epoch 33 - iter 16/17 - loss 2.16665895 - samples/sec: 310.85 - lr: 0.007812
2020-09-11 09:31:28,240 epoch 33 - iter 17/17 - loss 2.18356979 - samples/sec: 395.16 - lr: 0.007812
2020-09-11 09:31:28,241 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:28,246 EPOCH 33 done: loss 2.1836 - lr 0.0078125
2020-09-11 09:31:28,324 DEV : loss 1.860945701599121 - score 0.9039
2020-09-11 09:31:28,326 BAD EPOCHS (no improvement): 2
2020-09-11 09:31:28,329 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:28,435 epoch 34 - iter 1/17 - loss 2.16651177 - samples/sec: 310.24 - lr: 0.007812
2020-09-11 09:31:28,534 epoch 34 - iter 2/17 - loss 2.25732791 - samples/sec: 329.03 - lr: 0.007812
2020-09-11 09:31:28,648 epoch 34 - iter 3/17 - loss 2.21363282 - samples/sec: 284.57 - lr: 0.007812
2020-09-11 09:31:28,771 epoch 34 - iter 4/17 - loss 2.33480859 - samples/sec: 262.22 - lr: 0.007812
2020-09-11 09:31:28,888 epoch 34 - iter 5/17 - loss 2.34977865 - samples/sec: 275.83 - lr: 0.007812
2020-09-11 09:31:28,998 epoch 34 - iter 6/17 - loss 2.29187767 - samples/sec: 295.34 - lr: 0.007812
2020-09-11 09:31:29,107 epoch 34 - iter 7/17 - loss 2.28540604 - samples/sec: 296.13 - lr: 0.007812
2020-09-11 09:31:29,216 epoch 34 - iter 8/17 - loss 2.21293262 - samples/sec: 297.22 - lr: 0.007812
2020-09-11 09:31:29,324 epoch 34 - iter 9/17 - loss 2.13716773 - samples/sec: 300.87 - lr: 0.007812
2020-09-11 09:31:29,454 epoch 34 - iter 10/17 - loss 2.22819139 - samples/sec: 247.87 - lr: 0.007812
2020-09-11 09:31:29,559 epoch 34 - iter 11/17 - loss 2.28991833 - samples/sec: 309.13 - lr: 0.007812
2020-09-11 09:31:29,670 epoch 34 - iter 12/17 - loss 2.28256600 - samples/sec: 291.14 - lr: 0.007812
2020-09-11 09:31:29,783 epoch 34 - iter 13/17 - loss 2.22029331 - samples/sec: 285.83 - lr: 0.007812
2020-09-11 09:31:29,906 epoch 34 - iter 14/17 - loss 2.21900798 - samples/sec: 263.64 - lr: 0.007812
2020-09-11 09:31:30,017 epoch 34 - iter 15/17 - loss 2.19328976 - samples/sec: 292.50 - lr: 0.007812
2020-09-11 09:31:30,129 epoch 34 - iter 16/17 - loss 2.19865713 - samples/sec: 288.33 - lr: 0.007812
2020-09-11 09:31:30,207 epoch 34 - iter 17/17 - loss 2.23145440 - samples/sec: 416.13 - lr: 0.007812
2020-09-11 09:31:30,208 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:30,214 EPOCH 34 done: loss 2.2315 - lr 0.0078125
2020-09-11 09:31:30,292 DEV : loss 1.8520863056182861 - score 0.9039
2020-09-11 09:31:30,296 BAD EPOCHS (no improvement): 3
2020-09-11 09:31:30,299 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:30,403 epoch 35 - iter 1/17 - loss 2.20372343 - samples/sec: 317.64 - lr: 0.007812
2020-09-11 09:31:30,512 epoch 35 - iter 2/17 - loss 2.14256120 - samples/sec: 297.31 - lr: 0.007812
2020-09-11 09:31:30,617 epoch 35 - iter 3/17 - loss 2.07499452 - samples/sec: 310.13 - lr: 0.007812
2020-09-11 09:31:30,733 epoch 35 - iter 4/17 - loss 2.12319884 - samples/sec: 276.98 - lr: 0.007812
2020-09-11 09:31:30,837 epoch 35 - iter 5/17 - loss 2.20568845 - samples/sec: 310.20 - lr: 0.007812
2020-09-11 09:31:30,949 epoch 35 - iter 6/17 - loss 2.16370652 - samples/sec: 291.01 - lr: 0.007812
2020-09-11 09:31:31,060 epoch 35 - iter 7/17 - loss 2.15263004 - samples/sec: 292.45 - lr: 0.007812
2020-09-11 09:31:31,167 epoch 35 - iter 8/17 - loss 2.19112043 - samples/sec: 300.66 - lr: 0.007812
2020-09-11 09:31:31,281 epoch 35 - iter 9/17 - loss 2.16499941 - samples/sec: 284.53 - lr: 0.007812
2020-09-11 09:31:31,403 epoch 35 - iter 10/17 - loss 2.11889089 - samples/sec: 264.39 - lr: 0.007812
2020-09-11 09:31:31,513 epoch 35 - iter 11/17 - loss 2.06410332 - samples/sec: 294.73 - lr: 0.007812
2020-09-11 09:31:31,622 epoch 35 - iter 12/17 - loss 2.05899282 - samples/sec: 295.55 - lr: 0.007812
2020-09-11 09:31:31,730 epoch 35 - iter 13/17 - loss 2.01894082 - samples/sec: 299.70 - lr: 0.007812
2020-09-11 09:31:31,843 epoch 35 - iter 14/17 - loss 2.08863953 - samples/sec: 285.49 - lr: 0.007812
2020-09-11 09:31:31,958 epoch 35 - iter 15/17 - loss 2.17515968 - samples/sec: 281.82 - lr: 0.007812
2020-09-11 09:31:32,063 epoch 35 - iter 16/17 - loss 2.16473049 - samples/sec: 307.60 - lr: 0.007812
2020-09-11 09:31:32,142 epoch 35 - iter 17/17 - loss 2.15948333 - samples/sec: 410.71 - lr: 0.007812
2020-09-11 09:31:32,143 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:32,148 EPOCH 35 done: loss 2.1595 - lr 0.0078125
2020-09-11 09:31:32,225 DEV : loss 1.8610153198242188 - score 0.9039
Epoch    35: reducing learning rate of group 0 to 3.9062e-03.
2020-09-11 09:31:32,228 BAD EPOCHS (no improvement): 4
2020-09-11 09:31:32,230 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:32,346 epoch 36 - iter 1/17 - loss 2.43557644 - samples/sec: 285.81 - lr: 0.003906
2020-09-11 09:31:32,452 epoch 36 - iter 2/17 - loss 2.08234406 - samples/sec: 305.17 - lr: 0.003906
2020-09-11 09:31:32,556 epoch 36 - iter 3/17 - loss 2.13271157 - samples/sec: 308.61 - lr: 0.003906
2020-09-11 09:31:32,663 epoch 36 - iter 4/17 - loss 2.12066472 - samples/sec: 303.64 - lr: 0.003906
2020-09-11 09:31:32,775 epoch 36 - iter 5/17 - loss 2.19467897 - samples/sec: 288.35 - lr: 0.003906
2020-09-11 09:31:32,884 epoch 36 - iter 6/17 - loss 2.10642157 - samples/sec: 295.36 - lr: 0.003906
2020-09-11 09:31:32,996 epoch 36 - iter 7/17 - loss 2.09218320 - samples/sec: 295.59 - lr: 0.003906
2020-09-11 09:31:33,104 epoch 36 - iter 8/17 - loss 2.07874064 - samples/sec: 297.33 - lr: 0.003906
2020-09-11 09:31:33,210 epoch 36 - iter 9/17 - loss 2.07249725 - samples/sec: 304.95 - lr: 0.003906
2020-09-11 09:31:33,316 epoch 36 - iter 10/17 - loss 2.11360244 - samples/sec: 305.79 - lr: 0.003906
2020-09-11 09:31:33,427 epoch 36 - iter 11/17 - loss 2.14954514 - samples/sec: 292.79 - lr: 0.003906
2020-09-11 09:31:33,532 epoch 36 - iter 12/17 - loss 2.15247686 - samples/sec: 306.40 - lr: 0.003906
2020-09-11 09:31:33,628 epoch 36 - iter 13/17 - loss 2.17567102 - samples/sec: 336.53 - lr: 0.003906
2020-09-11 09:31:33,746 epoch 36 - iter 14/17 - loss 2.15970991 - samples/sec: 274.48 - lr: 0.003906
2020-09-11 09:31:33,877 epoch 36 - iter 15/17 - loss 2.17100244 - samples/sec: 246.64 - lr: 0.003906
2020-09-11 09:31:33,989 epoch 36 - iter 16/17 - loss 2.17317575 - samples/sec: 288.69 - lr: 0.003906
2020-09-11 09:31:34,068 epoch 36 - iter 17/17 - loss 2.16962830 - samples/sec: 414.82 - lr: 0.003906
2020-09-11 09:31:34,069 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:34,075 EPOCH 36 done: loss 2.1696 - lr 0.0039062
2020-09-11 09:31:34,154 DEV : loss 1.8612797260284424 - score 0.9039
2020-09-11 09:31:34,155 BAD EPOCHS (no improvement): 1
2020-09-11 09:31:34,159 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:34,267 epoch 37 - iter 1/17 - loss 2.70274210 - samples/sec: 302.17 - lr: 0.003906
2020-09-11 09:31:34,376 epoch 37 - iter 2/17 - loss 2.30244517 - samples/sec: 295.43 - lr: 0.003906
2020-09-11 09:31:34,487 epoch 37 - iter 3/17 - loss 2.29809332 - samples/sec: 293.06 - lr: 0.003906
2020-09-11 09:31:34,595 epoch 37 - iter 4/17 - loss 2.27606213 - samples/sec: 299.59 - lr: 0.003906
2020-09-11 09:31:34,698 epoch 37 - iter 5/17 - loss 2.30987163 - samples/sec: 313.49 - lr: 0.003906
2020-09-11 09:31:34,802 epoch 37 - iter 6/17 - loss 2.23178925 - samples/sec: 309.89 - lr: 0.003906
2020-09-11 09:31:34,908 epoch 37 - iter 7/17 - loss 2.18345986 - samples/sec: 304.52 - lr: 0.003906
2020-09-11 09:31:35,011 epoch 37 - iter 8/17 - loss 2.11910208 - samples/sec: 320.77 - lr: 0.003906
2020-09-11 09:31:35,133 epoch 37 - iter 9/17 - loss 2.08216679 - samples/sec: 265.51 - lr: 0.003906
2020-09-11 09:31:35,235 epoch 37 - iter 10/17 - loss 2.14111589 - samples/sec: 316.56 - lr: 0.003906
2020-09-11 09:31:35,337 epoch 37 - iter 11/17 - loss 2.13171017 - samples/sec: 316.25 - lr: 0.003906
2020-09-11 09:31:35,447 epoch 37 - iter 12/17 - loss 2.11819906 - samples/sec: 294.52 - lr: 0.003906
2020-09-11 09:31:35,548 epoch 37 - iter 13/17 - loss 2.12408993 - samples/sec: 318.93 - lr: 0.003906
2020-09-11 09:31:35,658 epoch 37 - iter 14/17 - loss 2.14650181 - samples/sec: 292.30 - lr: 0.003906
2020-09-11 09:31:35,759 epoch 37 - iter 15/17 - loss 2.10822772 - samples/sec: 326.46 - lr: 0.003906
2020-09-11 09:31:35,873 epoch 37 - iter 16/17 - loss 2.09593584 - samples/sec: 282.42 - lr: 0.003906
2020-09-11 09:31:35,959 epoch 37 - iter 17/17 - loss 2.13863867 - samples/sec: 375.76 - lr: 0.003906
2020-09-11 09:31:35,961 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:35,963 EPOCH 37 done: loss 2.1386 - lr 0.0039062
2020-09-11 09:31:36,041 DEV : loss 1.862546443939209 - score 0.9039
2020-09-11 09:31:36,045 BAD EPOCHS (no improvement): 2
2020-09-11 09:31:36,047 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:36,153 epoch 38 - iter 1/17 - loss 1.55653930 - samples/sec: 309.42 - lr: 0.003906
2020-09-11 09:31:36,262 epoch 38 - iter 2/17 - loss 1.83484852 - samples/sec: 295.54 - lr: 0.003906
2020-09-11 09:31:36,366 epoch 38 - iter 3/17 - loss 1.97699809 - samples/sec: 310.71 - lr: 0.003906
2020-09-11 09:31:36,478 epoch 38 - iter 4/17 - loss 1.97135368 - samples/sec: 290.51 - lr: 0.003906
2020-09-11 09:31:36,580 epoch 38 - iter 5/17 - loss 2.01099064 - samples/sec: 318.33 - lr: 0.003906
2020-09-11 09:31:36,685 epoch 38 - iter 6/17 - loss 1.91558721 - samples/sec: 306.78 - lr: 0.003906
2020-09-11 09:31:36,811 epoch 38 - iter 7/17 - loss 2.06156763 - samples/sec: 256.64 - lr: 0.003906
2020-09-11 09:31:36,913 epoch 38 - iter 8/17 - loss 2.07127489 - samples/sec: 318.30 - lr: 0.003906
2020-09-11 09:31:37,034 epoch 38 - iter 9/17 - loss 2.12594540 - samples/sec: 266.92 - lr: 0.003906
2020-09-11 09:31:37,138 epoch 38 - iter 10/17 - loss 2.16660880 - samples/sec: 313.26 - lr: 0.003906
2020-09-11 09:31:37,246 epoch 38 - iter 11/17 - loss 2.15714467 - samples/sec: 297.33 - lr: 0.003906
2020-09-11 09:31:37,350 epoch 38 - iter 12/17 - loss 2.16440808 - samples/sec: 314.15 - lr: 0.003906
2020-09-11 09:31:37,460 epoch 38 - iter 13/17 - loss 2.14800671 - samples/sec: 294.64 - lr: 0.003906
2020-09-11 09:31:37,583 epoch 38 - iter 14/17 - loss 2.16008878 - samples/sec: 262.87 - lr: 0.003906
2020-09-11 09:31:37,687 epoch 38 - iter 15/17 - loss 2.08712841 - samples/sec: 309.62 - lr: 0.003906
2020-09-11 09:31:37,788 epoch 38 - iter 16/17 - loss 2.09805407 - samples/sec: 320.24 - lr: 0.003906
2020-09-11 09:31:37,868 epoch 38 - iter 17/17 - loss 2.07644403 - samples/sec: 404.17 - lr: 0.003906
2020-09-11 09:31:37,869 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:37,873 EPOCH 38 done: loss 2.0764 - lr 0.0039062
2020-09-11 09:31:37,949 DEV : loss 1.869424819946289 - score 0.9039
2020-09-11 09:31:37,953 BAD EPOCHS (no improvement): 3
2020-09-11 09:31:37,961 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:38,070 epoch 39 - iter 1/17 - loss 2.91720772 - samples/sec: 299.92 - lr: 0.003906
2020-09-11 09:31:38,174 epoch 39 - iter 2/17 - loss 2.45199174 - samples/sec: 313.26 - lr: 0.003906
2020-09-11 09:31:38,280 epoch 39 - iter 3/17 - loss 2.31430829 - samples/sec: 303.97 - lr: 0.003906
2020-09-11 09:31:38,389 epoch 39 - iter 4/17 - loss 2.37968537 - samples/sec: 296.63 - lr: 0.003906
2020-09-11 09:31:38,484 epoch 39 - iter 5/17 - loss 2.30176828 - samples/sec: 338.59 - lr: 0.003906
2020-09-11 09:31:38,590 epoch 39 - iter 6/17 - loss 2.28818593 - samples/sec: 308.01 - lr: 0.003906
2020-09-11 09:31:38,694 epoch 39 - iter 7/17 - loss 2.20957887 - samples/sec: 315.08 - lr: 0.003906
2020-09-11 09:31:38,796 epoch 39 - iter 8/17 - loss 2.15541568 - samples/sec: 316.55 - lr: 0.003906
2020-09-11 09:31:38,906 epoch 39 - iter 9/17 - loss 2.05849785 - samples/sec: 295.51 - lr: 0.003906
2020-09-11 09:31:39,026 epoch 39 - iter 10/17 - loss 2.14265947 - samples/sec: 268.94 - lr: 0.003906
2020-09-11 09:31:39,131 epoch 39 - iter 11/17 - loss 2.14655584 - samples/sec: 307.74 - lr: 0.003906
2020-09-11 09:31:39,229 epoch 39 - iter 12/17 - loss 2.12833981 - samples/sec: 328.42 - lr: 0.003906
2020-09-11 09:31:39,350 epoch 39 - iter 13/17 - loss 2.23054640 - samples/sec: 268.39 - lr: 0.003906
2020-09-11 09:31:39,455 epoch 39 - iter 14/17 - loss 2.18998856 - samples/sec: 308.36 - lr: 0.003906
2020-09-11 09:31:39,549 epoch 39 - iter 15/17 - loss 2.13317854 - samples/sec: 344.80 - lr: 0.003906
2020-09-11 09:31:39,655 epoch 39 - iter 16/17 - loss 2.14621764 - samples/sec: 305.66 - lr: 0.003906
2020-09-11 09:31:39,735 epoch 39 - iter 17/17 - loss 2.10736282 - samples/sec: 400.25 - lr: 0.003906
2020-09-11 09:31:39,736 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:39,742 EPOCH 39 done: loss 2.1074 - lr 0.0039062
2020-09-11 09:31:39,838 DEV : loss 1.8706583976745605 - score 0.9039
Epoch    39: reducing learning rate of group 0 to 1.9531e-03.
2020-09-11 09:31:39,842 BAD EPOCHS (no improvement): 4
2020-09-11 09:31:39,844 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:39,964 epoch 40 - iter 1/17 - loss 2.40858364 - samples/sec: 286.84 - lr: 0.001953
2020-09-11 09:31:40,096 epoch 40 - iter 2/17 - loss 2.66101336 - samples/sec: 245.63 - lr: 0.001953
2020-09-11 09:31:40,202 epoch 40 - iter 3/17 - loss 2.68021313 - samples/sec: 303.80 - lr: 0.001953
2020-09-11 09:31:40,312 epoch 40 - iter 4/17 - loss 2.57772970 - samples/sec: 293.86 - lr: 0.001953
2020-09-11 09:31:40,422 epoch 40 - iter 5/17 - loss 2.45276420 - samples/sec: 294.24 - lr: 0.001953
2020-09-11 09:31:40,532 epoch 40 - iter 6/17 - loss 2.51650308 - samples/sec: 294.31 - lr: 0.001953
2020-09-11 09:31:40,635 epoch 40 - iter 7/17 - loss 2.36470851 - samples/sec: 315.08 - lr: 0.001953
2020-09-11 09:31:40,742 epoch 40 - iter 8/17 - loss 2.28064451 - samples/sec: 303.42 - lr: 0.001953
2020-09-11 09:31:40,846 epoch 40 - iter 9/17 - loss 2.25968324 - samples/sec: 309.69 - lr: 0.001953
2020-09-11 09:31:40,961 epoch 40 - iter 10/17 - loss 2.25215931 - samples/sec: 281.35 - lr: 0.001953
2020-09-11 09:31:41,076 epoch 40 - iter 11/17 - loss 2.29170622 - samples/sec: 282.39 - lr: 0.001953
2020-09-11 09:31:41,183 epoch 40 - iter 12/17 - loss 2.24143372 - samples/sec: 303.11 - lr: 0.001953
2020-09-11 09:31:41,288 epoch 40 - iter 13/17 - loss 2.27747974 - samples/sec: 308.06 - lr: 0.001953
2020-09-11 09:31:41,393 epoch 40 - iter 14/17 - loss 2.22446014 - samples/sec: 307.05 - lr: 0.001953
2020-09-11 09:31:41,507 epoch 40 - iter 15/17 - loss 2.23860873 - samples/sec: 282.55 - lr: 0.001953
2020-09-11 09:31:41,628 epoch 40 - iter 16/17 - loss 2.21095503 - samples/sec: 266.93 - lr: 0.001953
2020-09-11 09:31:41,708 epoch 40 - iter 17/17 - loss 2.20091358 - samples/sec: 409.14 - lr: 0.001953
2020-09-11 09:31:41,712 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:41,713 EPOCH 40 done: loss 2.2009 - lr 0.0019531
2020-09-11 09:31:41,803 DEV : loss 1.8684940338134766 - score 0.9039
2020-09-11 09:31:41,809 BAD EPOCHS (no improvement): 1
2020-09-11 09:31:41,812 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:41,929 epoch 41 - iter 1/17 - loss 1.65641534 - samples/sec: 281.95 - lr: 0.001953
2020-09-11 09:31:42,047 epoch 41 - iter 2/17 - loss 1.98350984 - samples/sec: 274.74 - lr: 0.001953
2020-09-11 09:31:42,156 epoch 41 - iter 3/17 - loss 1.93206290 - samples/sec: 298.68 - lr: 0.001953
2020-09-11 09:31:42,268 epoch 41 - iter 4/17 - loss 1.83420372 - samples/sec: 287.80 - lr: 0.001953
2020-09-11 09:31:42,374 epoch 41 - iter 5/17 - loss 1.74692581 - samples/sec: 304.46 - lr: 0.001953
2020-09-11 09:31:42,488 epoch 41 - iter 6/17 - loss 1.89210922 - samples/sec: 287.42 - lr: 0.001953
2020-09-11 09:31:42,600 epoch 41 - iter 7/17 - loss 1.92536325 - samples/sec: 289.60 - lr: 0.001953
2020-09-11 09:31:42,717 epoch 41 - iter 8/17 - loss 1.87745994 - samples/sec: 276.82 - lr: 0.001953
2020-09-11 09:31:42,834 epoch 41 - iter 9/17 - loss 1.95671293 - samples/sec: 277.22 - lr: 0.001953
2020-09-11 09:31:42,969 epoch 41 - iter 10/17 - loss 2.00737596 - samples/sec: 238.75 - lr: 0.001953
2020-09-11 09:31:43,081 epoch 41 - iter 11/17 - loss 2.06435234 - samples/sec: 287.18 - lr: 0.001953
2020-09-11 09:31:43,191 epoch 41 - iter 12/17 - loss 2.05423961 - samples/sec: 294.45 - lr: 0.001953
2020-09-11 09:31:43,295 epoch 41 - iter 13/17 - loss 2.07148066 - samples/sec: 311.37 - lr: 0.001953
2020-09-11 09:31:43,403 epoch 41 - iter 14/17 - loss 2.10708749 - samples/sec: 300.12 - lr: 0.001953
2020-09-11 09:31:43,509 epoch 41 - iter 15/17 - loss 2.10328631 - samples/sec: 303.79 - lr: 0.001953
2020-09-11 09:31:43,631 epoch 41 - iter 16/17 - loss 2.10379887 - samples/sec: 264.22 - lr: 0.001953
2020-09-11 09:31:43,705 epoch 41 - iter 17/17 - loss 2.13205387 - samples/sec: 444.99 - lr: 0.001953
2020-09-11 09:31:43,706 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:43,711 EPOCH 41 done: loss 2.1321 - lr 0.0019531
2020-09-11 09:31:43,795 DEV : loss 1.8697052001953125 - score 0.9039
2020-09-11 09:31:43,798 BAD EPOCHS (no improvement): 2
2020-09-11 09:31:43,800 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:43,909 epoch 42 - iter 1/17 - loss 1.95205081 - samples/sec: 303.71 - lr: 0.001953
2020-09-11 09:31:44,025 epoch 42 - iter 2/17 - loss 1.77231854 - samples/sec: 278.23 - lr: 0.001953
2020-09-11 09:31:44,141 epoch 42 - iter 3/17 - loss 1.76212402 - samples/sec: 278.12 - lr: 0.001953
2020-09-11 09:31:44,251 epoch 42 - iter 4/17 - loss 1.68454868 - samples/sec: 296.14 - lr: 0.001953
2020-09-11 09:31:44,358 epoch 42 - iter 5/17 - loss 1.72046323 - samples/sec: 300.28 - lr: 0.001953
2020-09-11 09:31:44,466 epoch 42 - iter 6/17 - loss 1.82062662 - samples/sec: 300.04 - lr: 0.001953
2020-09-11 09:31:44,577 epoch 42 - iter 7/17 - loss 1.82287388 - samples/sec: 290.32 - lr: 0.001953
2020-09-11 09:31:44,680 epoch 42 - iter 8/17 - loss 1.80281527 - samples/sec: 312.72 - lr: 0.001953
2020-09-11 09:31:44,786 epoch 42 - iter 9/17 - loss 1.73538368 - samples/sec: 307.32 - lr: 0.001953
2020-09-11 09:31:44,889 epoch 42 - iter 10/17 - loss 1.86518863 - samples/sec: 312.29 - lr: 0.001953
2020-09-11 09:31:45,024 epoch 42 - iter 11/17 - loss 1.89539980 - samples/sec: 238.57 - lr: 0.001953
2020-09-11 09:31:45,142 epoch 42 - iter 12/17 - loss 1.88407112 - samples/sec: 273.58 - lr: 0.001953
2020-09-11 09:31:45,252 epoch 42 - iter 13/17 - loss 1.93909807 - samples/sec: 296.27 - lr: 0.001953
2020-09-11 09:31:45,366 epoch 42 - iter 14/17 - loss 1.96448104 - samples/sec: 283.21 - lr: 0.001953
2020-09-11 09:31:45,478 epoch 42 - iter 15/17 - loss 2.04754047 - samples/sec: 288.62 - lr: 0.001953
2020-09-11 09:31:45,588 epoch 42 - iter 16/17 - loss 2.09948217 - samples/sec: 295.08 - lr: 0.001953
2020-09-11 09:31:45,660 epoch 42 - iter 17/17 - loss 2.06929702 - samples/sec: 447.93 - lr: 0.001953
2020-09-11 09:31:45,661 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:45,666 EPOCH 42 done: loss 2.0693 - lr 0.0019531
2020-09-11 09:31:45,751 DEV : loss 1.8711341619491577 - score 0.9039
2020-09-11 09:31:45,753 BAD EPOCHS (no improvement): 3
2020-09-11 09:31:45,754 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:45,875 epoch 43 - iter 1/17 - loss 1.59613466 - samples/sec: 272.75 - lr: 0.001953
2020-09-11 09:31:45,986 epoch 43 - iter 2/17 - loss 1.89992344 - samples/sec: 292.91 - lr: 0.001953
2020-09-11 09:31:46,111 epoch 43 - iter 3/17 - loss 2.15681545 - samples/sec: 257.22 - lr: 0.001953
2020-09-11 09:31:46,221 epoch 43 - iter 4/17 - loss 1.94478324 - samples/sec: 296.32 - lr: 0.001953
2020-09-11 09:31:46,327 epoch 43 - iter 5/17 - loss 2.02235644 - samples/sec: 306.35 - lr: 0.001953
2020-09-11 09:31:46,436 epoch 43 - iter 6/17 - loss 2.06755092 - samples/sec: 295.39 - lr: 0.001953
2020-09-11 09:31:46,533 epoch 43 - iter 7/17 - loss 2.09775879 - samples/sec: 332.81 - lr: 0.001953
2020-09-11 09:31:46,635 epoch 43 - iter 8/17 - loss 2.04314528 - samples/sec: 316.79 - lr: 0.001953
2020-09-11 09:31:46,767 epoch 43 - iter 9/17 - loss 2.04059197 - samples/sec: 244.50 - lr: 0.001953
2020-09-11 09:31:46,887 epoch 43 - iter 10/17 - loss 2.13431033 - samples/sec: 269.87 - lr: 0.001953
2020-09-11 09:31:46,997 epoch 43 - iter 11/17 - loss 2.11249408 - samples/sec: 295.32 - lr: 0.001953
2020-09-11 09:31:47,101 epoch 43 - iter 12/17 - loss 2.18600748 - samples/sec: 308.72 - lr: 0.001953
2020-09-11 09:31:47,213 epoch 43 - iter 13/17 - loss 2.19971956 - samples/sec: 290.51 - lr: 0.001953
2020-09-11 09:31:47,323 epoch 43 - iter 14/17 - loss 2.11635588 - samples/sec: 295.03 - lr: 0.001953
2020-09-11 09:31:47,449 epoch 43 - iter 15/17 - loss 2.15256975 - samples/sec: 255.52 - lr: 0.001953
2020-09-11 09:31:47,560 epoch 43 - iter 16/17 - loss 2.12364431 - samples/sec: 290.04 - lr: 0.001953
2020-09-11 09:31:47,632 epoch 43 - iter 17/17 - loss 2.13725646 - samples/sec: 467.01 - lr: 0.001953
2020-09-11 09:31:47,633 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:47,638 EPOCH 43 done: loss 2.1373 - lr 0.0019531
2020-09-11 09:31:47,716 DEV : loss 1.871195912361145 - score 0.9039
Epoch    43: reducing learning rate of group 0 to 9.7656e-04.
2020-09-11 09:31:47,720 BAD EPOCHS (no improvement): 4
2020-09-11 09:31:47,721 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:47,831 epoch 44 - iter 1/17 - loss 1.57494926 - samples/sec: 297.58 - lr: 0.000977
2020-09-11 09:31:47,955 epoch 44 - iter 2/17 - loss 1.70237011 - samples/sec: 265.10 - lr: 0.000977
2020-09-11 09:31:48,086 epoch 44 - iter 3/17 - loss 1.62696763 - samples/sec: 247.22 - lr: 0.000977
2020-09-11 09:31:48,203 epoch 44 - iter 4/17 - loss 1.73749629 - samples/sec: 275.45 - lr: 0.000977
2020-09-11 09:31:48,311 epoch 44 - iter 5/17 - loss 1.85222251 - samples/sec: 300.34 - lr: 0.000977
2020-09-11 09:31:48,425 epoch 44 - iter 6/17 - loss 1.92494589 - samples/sec: 282.86 - lr: 0.000977
2020-09-11 09:31:48,539 epoch 44 - iter 7/17 - loss 2.00947160 - samples/sec: 283.22 - lr: 0.000977
2020-09-11 09:31:48,656 epoch 44 - iter 8/17 - loss 2.03440548 - samples/sec: 276.26 - lr: 0.000977
2020-09-11 09:31:48,761 epoch 44 - iter 9/17 - loss 2.03593189 - samples/sec: 309.42 - lr: 0.000977
2020-09-11 09:31:48,867 epoch 44 - iter 10/17 - loss 1.98007635 - samples/sec: 304.99 - lr: 0.000977
2020-09-11 09:31:48,977 epoch 44 - iter 11/17 - loss 1.96373889 - samples/sec: 295.94 - lr: 0.000977
2020-09-11 09:31:49,095 epoch 44 - iter 12/17 - loss 2.03976662 - samples/sec: 276.61 - lr: 0.000977
2020-09-11 09:31:49,212 epoch 44 - iter 13/17 - loss 2.07122222 - samples/sec: 275.88 - lr: 0.000977
2020-09-11 09:31:49,318 epoch 44 - iter 14/17 - loss 2.06604474 - samples/sec: 306.71 - lr: 0.000977
2020-09-11 09:31:49,442 epoch 44 - iter 15/17 - loss 2.10574220 - samples/sec: 259.62 - lr: 0.000977
2020-09-11 09:31:49,560 epoch 44 - iter 16/17 - loss 2.10223112 - samples/sec: 273.95 - lr: 0.000977
2020-09-11 09:31:49,636 epoch 44 - iter 17/17 - loss 2.08419435 - samples/sec: 427.19 - lr: 0.000977
2020-09-11 09:31:49,637 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:49,641 EPOCH 44 done: loss 2.0842 - lr 0.0009766
2020-09-11 09:31:49,724 DEV : loss 1.8707306385040283 - score 0.9039
2020-09-11 09:31:49,726 BAD EPOCHS (no improvement): 1
2020-09-11 09:31:49,730 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:49,838 epoch 45 - iter 1/17 - loss 1.89361787 - samples/sec: 305.45 - lr: 0.000977
2020-09-11 09:31:49,947 epoch 45 - iter 2/17 - loss 2.21607864 - samples/sec: 299.69 - lr: 0.000977
2020-09-11 09:31:50,049 epoch 45 - iter 3/17 - loss 2.01096229 - samples/sec: 315.51 - lr: 0.000977
2020-09-11 09:31:50,170 epoch 45 - iter 4/17 - loss 1.97172287 - samples/sec: 266.99 - lr: 0.000977
2020-09-11 09:31:50,277 epoch 45 - iter 5/17 - loss 1.93318305 - samples/sec: 301.61 - lr: 0.000977
2020-09-11 09:31:50,372 epoch 45 - iter 6/17 - loss 1.82265991 - samples/sec: 340.79 - lr: 0.000977
2020-09-11 09:31:50,475 epoch 45 - iter 7/17 - loss 1.90316897 - samples/sec: 313.52 - lr: 0.000977
2020-09-11 09:31:50,582 epoch 45 - iter 8/17 - loss 1.94942440 - samples/sec: 302.36 - lr: 0.000977
2020-09-11 09:31:50,684 epoch 45 - iter 9/17 - loss 1.91201617 - samples/sec: 318.28 - lr: 0.000977
2020-09-11 09:31:50,788 epoch 45 - iter 10/17 - loss 1.95709399 - samples/sec: 308.72 - lr: 0.000977
2020-09-11 09:31:50,917 epoch 45 - iter 11/17 - loss 2.03674131 - samples/sec: 251.01 - lr: 0.000977
2020-09-11 09:31:51,031 epoch 45 - iter 12/17 - loss 2.09745031 - samples/sec: 283.16 - lr: 0.000977
2020-09-11 09:31:51,144 epoch 45 - iter 13/17 - loss 2.10905980 - samples/sec: 288.12 - lr: 0.000977
2020-09-11 09:31:51,254 epoch 45 - iter 14/17 - loss 2.12343171 - samples/sec: 293.42 - lr: 0.000977
2020-09-11 09:31:51,371 epoch 45 - iter 15/17 - loss 2.10053473 - samples/sec: 276.05 - lr: 0.000977
2020-09-11 09:31:51,487 epoch 45 - iter 16/17 - loss 2.09765709 - samples/sec: 278.21 - lr: 0.000977
2020-09-11 09:31:51,571 epoch 45 - iter 17/17 - loss 2.11037770 - samples/sec: 387.99 - lr: 0.000977
2020-09-11 09:31:51,572 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:51,577 EPOCH 45 done: loss 2.1104 - lr 0.0009766
2020-09-11 09:31:51,654 DEV : loss 1.8710083961486816 - score 0.9039
2020-09-11 09:31:51,656 BAD EPOCHS (no improvement): 2
2020-09-11 09:31:51,659 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:51,769 epoch 46 - iter 1/17 - loss 2.29029131 - samples/sec: 297.72 - lr: 0.000977
2020-09-11 09:31:51,878 epoch 46 - iter 2/17 - loss 2.57501078 - samples/sec: 295.45 - lr: 0.000977
2020-09-11 09:31:51,995 epoch 46 - iter 3/17 - loss 2.33628249 - samples/sec: 277.47 - lr: 0.000977
2020-09-11 09:31:52,100 epoch 46 - iter 4/17 - loss 2.20042735 - samples/sec: 308.27 - lr: 0.000977
2020-09-11 09:31:52,228 epoch 46 - iter 5/17 - loss 2.15306783 - samples/sec: 252.65 - lr: 0.000977
2020-09-11 09:31:52,337 epoch 46 - iter 6/17 - loss 2.23327601 - samples/sec: 298.16 - lr: 0.000977
2020-09-11 09:31:52,455 epoch 46 - iter 7/17 - loss 2.17818601 - samples/sec: 273.14 - lr: 0.000977
2020-09-11 09:31:52,580 epoch 46 - iter 8/17 - loss 2.29868346 - samples/sec: 262.24 - lr: 0.000977
2020-09-11 09:31:52,692 epoch 46 - iter 9/17 - loss 2.24365924 - samples/sec: 286.62 - lr: 0.000977
2020-09-11 09:31:52,793 epoch 46 - iter 10/17 - loss 2.13943095 - samples/sec: 321.16 - lr: 0.000977
2020-09-11 09:31:52,909 epoch 46 - iter 11/17 - loss 2.22218587 - samples/sec: 278.50 - lr: 0.000977
2020-09-11 09:31:53,011 epoch 46 - iter 12/17 - loss 2.17799040 - samples/sec: 320.62 - lr: 0.000977
2020-09-11 09:31:53,122 epoch 46 - iter 13/17 - loss 2.13923915 - samples/sec: 291.37 - lr: 0.000977
2020-09-11 09:31:53,244 epoch 46 - iter 14/17 - loss 2.13772869 - samples/sec: 263.87 - lr: 0.000977
2020-09-11 09:31:53,350 epoch 46 - iter 15/17 - loss 2.10194511 - samples/sec: 308.98 - lr: 0.000977
2020-09-11 09:31:53,474 epoch 46 - iter 16/17 - loss 2.12772428 - samples/sec: 261.12 - lr: 0.000977
2020-09-11 09:31:53,558 epoch 46 - iter 17/17 - loss 2.14000834 - samples/sec: 387.06 - lr: 0.000977
2020-09-11 09:31:53,559 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:53,564 EPOCH 46 done: loss 2.1400 - lr 0.0009766
2020-09-11 09:31:53,642 DEV : loss 1.8702256679534912 - score 0.9039
2020-09-11 09:31:53,647 BAD EPOCHS (no improvement): 3
2020-09-11 09:31:53,648 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:53,759 epoch 47 - iter 1/17 - loss 2.40958548 - samples/sec: 304.72 - lr: 0.000977
2020-09-11 09:31:53,893 epoch 47 - iter 2/17 - loss 2.19522685 - samples/sec: 242.33 - lr: 0.000977
2020-09-11 09:31:54,004 epoch 47 - iter 3/17 - loss 2.18233558 - samples/sec: 292.21 - lr: 0.000977
2020-09-11 09:31:54,117 epoch 47 - iter 4/17 - loss 2.08626416 - samples/sec: 287.13 - lr: 0.000977
2020-09-11 09:31:54,243 epoch 47 - iter 5/17 - loss 2.13577464 - samples/sec: 257.57 - lr: 0.000977
2020-09-11 09:31:54,352 epoch 47 - iter 6/17 - loss 2.09897268 - samples/sec: 294.61 - lr: 0.000977
2020-09-11 09:31:54,457 epoch 47 - iter 7/17 - loss 2.25570938 - samples/sec: 309.49 - lr: 0.000977
2020-09-11 09:31:54,566 epoch 47 - iter 8/17 - loss 2.36531955 - samples/sec: 299.93 - lr: 0.000977
2020-09-11 09:31:54,692 epoch 47 - iter 9/17 - loss 2.39397939 - samples/sec: 256.87 - lr: 0.000977
2020-09-11 09:31:54,801 epoch 47 - iter 10/17 - loss 2.31865383 - samples/sec: 295.82 - lr: 0.000977
2020-09-11 09:31:54,904 epoch 47 - iter 11/17 - loss 2.23503270 - samples/sec: 314.43 - lr: 0.000977
2020-09-11 09:31:55,006 epoch 47 - iter 12/17 - loss 2.19364679 - samples/sec: 318.50 - lr: 0.000977
2020-09-11 09:31:55,107 epoch 47 - iter 13/17 - loss 2.16499858 - samples/sec: 319.93 - lr: 0.000977
2020-09-11 09:31:55,247 epoch 47 - iter 14/17 - loss 2.17180823 - samples/sec: 229.81 - lr: 0.000977
2020-09-11 09:31:55,356 epoch 47 - iter 15/17 - loss 2.19207067 - samples/sec: 298.37 - lr: 0.000977
2020-09-11 09:31:55,467 epoch 47 - iter 16/17 - loss 2.19204720 - samples/sec: 292.88 - lr: 0.000977
2020-09-11 09:31:55,540 epoch 47 - iter 17/17 - loss 2.16333261 - samples/sec: 439.67 - lr: 0.000977
2020-09-11 09:31:55,542 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:55,546 EPOCH 47 done: loss 2.1633 - lr 0.0009766
2020-09-11 09:31:55,621 DEV : loss 1.8696794509887695 - score 0.9039
Epoch    47: reducing learning rate of group 0 to 4.8828e-04.
2020-09-11 09:31:55,625 BAD EPOCHS (no improvement): 4
2020-09-11 09:31:55,627 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:55,732 epoch 48 - iter 1/17 - loss 2.13647890 - samples/sec: 312.68 - lr: 0.000488
2020-09-11 09:31:55,841 epoch 48 - iter 2/17 - loss 2.60982764 - samples/sec: 295.73 - lr: 0.000488
2020-09-11 09:31:55,955 epoch 48 - iter 3/17 - loss 2.60576868 - samples/sec: 284.55 - lr: 0.000488
2020-09-11 09:31:56,063 epoch 48 - iter 4/17 - loss 2.81221414 - samples/sec: 299.76 - lr: 0.000488
2020-09-11 09:31:56,165 epoch 48 - iter 5/17 - loss 2.56672552 - samples/sec: 320.36 - lr: 0.000488
2020-09-11 09:31:56,284 epoch 48 - iter 6/17 - loss 2.45763489 - samples/sec: 271.14 - lr: 0.000488
2020-09-11 09:31:56,398 epoch 48 - iter 7/17 - loss 2.42420312 - samples/sec: 284.66 - lr: 0.000488
2020-09-11 09:31:56,512 epoch 48 - iter 8/17 - loss 2.40458560 - samples/sec: 282.20 - lr: 0.000488
2020-09-11 09:31:56,637 epoch 48 - iter 9/17 - loss 2.34310838 - samples/sec: 258.63 - lr: 0.000488
2020-09-11 09:31:56,745 epoch 48 - iter 10/17 - loss 2.32288555 - samples/sec: 302.83 - lr: 0.000488
2020-09-11 09:31:56,859 epoch 48 - iter 11/17 - loss 2.23890460 - samples/sec: 282.30 - lr: 0.000488
2020-09-11 09:31:56,972 epoch 48 - iter 12/17 - loss 2.23518967 - samples/sec: 287.37 - lr: 0.000488
2020-09-11 09:31:57,080 epoch 48 - iter 13/17 - loss 2.26823274 - samples/sec: 299.58 - lr: 0.000488
2020-09-11 09:31:57,191 epoch 48 - iter 14/17 - loss 2.26889933 - samples/sec: 296.74 - lr: 0.000488
2020-09-11 09:31:57,307 epoch 48 - iter 15/17 - loss 2.23389218 - samples/sec: 277.80 - lr: 0.000488
2020-09-11 09:31:57,419 epoch 48 - iter 16/17 - loss 2.21442220 - samples/sec: 288.86 - lr: 0.000488
2020-09-11 09:31:57,489 epoch 48 - iter 17/17 - loss 2.15259550 - samples/sec: 463.29 - lr: 0.000488
2020-09-11 09:31:57,490 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:57,495 EPOCH 48 done: loss 2.1526 - lr 0.0004883
2020-09-11 09:31:57,572 DEV : loss 1.869992733001709 - score 0.9039
2020-09-11 09:31:57,575 BAD EPOCHS (no improvement): 1
2020-09-11 09:31:57,577 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:57,689 epoch 49 - iter 1/17 - loss 3.32574272 - samples/sec: 290.88 - lr: 0.000488
2020-09-11 09:31:57,798 epoch 49 - iter 2/17 - loss 3.23043871 - samples/sec: 298.50 - lr: 0.000488
2020-09-11 09:31:57,909 epoch 49 - iter 3/17 - loss 2.52508895 - samples/sec: 293.91 - lr: 0.000488
2020-09-11 09:31:58,014 epoch 49 - iter 4/17 - loss 2.27688953 - samples/sec: 307.34 - lr: 0.000488
2020-09-11 09:31:58,124 epoch 49 - iter 5/17 - loss 2.20293577 - samples/sec: 296.12 - lr: 0.000488
2020-09-11 09:31:58,225 epoch 49 - iter 6/17 - loss 2.22645797 - samples/sec: 318.18 - lr: 0.000488
2020-09-11 09:31:58,343 epoch 49 - iter 7/17 - loss 2.18002132 - samples/sec: 274.32 - lr: 0.000488
2020-09-11 09:31:58,454 epoch 49 - iter 8/17 - loss 2.08970803 - samples/sec: 290.59 - lr: 0.000488
2020-09-11 09:31:58,579 epoch 49 - iter 9/17 - loss 2.12008651 - samples/sec: 258.67 - lr: 0.000488
2020-09-11 09:31:58,698 epoch 49 - iter 10/17 - loss 2.12727408 - samples/sec: 272.61 - lr: 0.000488
2020-09-11 09:31:58,800 epoch 49 - iter 11/17 - loss 2.08404921 - samples/sec: 314.90 - lr: 0.000488
2020-09-11 09:31:58,913 epoch 49 - iter 12/17 - loss 2.07866135 - samples/sec: 288.02 - lr: 0.000488
2020-09-11 09:31:59,034 epoch 49 - iter 13/17 - loss 2.09018061 - samples/sec: 266.84 - lr: 0.000488
2020-09-11 09:31:59,152 epoch 49 - iter 14/17 - loss 2.12898230 - samples/sec: 275.69 - lr: 0.000488
2020-09-11 09:31:59,277 epoch 49 - iter 15/17 - loss 2.11229343 - samples/sec: 257.11 - lr: 0.000488
2020-09-11 09:31:59,413 epoch 49 - iter 16/17 - loss 2.14525196 - samples/sec: 237.68 - lr: 0.000488
2020-09-11 09:31:59,502 epoch 49 - iter 17/17 - loss 2.16026076 - samples/sec: 366.15 - lr: 0.000488
2020-09-11 09:31:59,503 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:59,509 EPOCH 49 done: loss 2.1603 - lr 0.0004883
2020-09-11 09:31:59,602 DEV : loss 1.8705830574035645 - score 0.9039
2020-09-11 09:31:59,605 BAD EPOCHS (no improvement): 2
2020-09-11 09:31:59,606 ----------------------------------------------------------------------------------------------------
2020-09-11 09:31:59,729 epoch 50 - iter 1/17 - loss 1.70025277 - samples/sec: 265.16 - lr: 0.000488
2020-09-11 09:31:59,843 epoch 50 - iter 2/17 - loss 1.75726217 - samples/sec: 285.34 - lr: 0.000488
2020-09-11 09:31:59,947 epoch 50 - iter 3/17 - loss 1.81887865 - samples/sec: 311.87 - lr: 0.000488
2020-09-11 09:32:00,055 epoch 50 - iter 4/17 - loss 1.73993617 - samples/sec: 299.32 - lr: 0.000488
2020-09-11 09:32:00,164 epoch 50 - iter 5/17 - loss 1.70279319 - samples/sec: 295.46 - lr: 0.000488
2020-09-11 09:32:00,290 epoch 50 - iter 6/17 - loss 1.82746798 - samples/sec: 257.35 - lr: 0.000488
2020-09-11 09:32:00,417 epoch 50 - iter 7/17 - loss 1.90154033 - samples/sec: 252.97 - lr: 0.000488
2020-09-11 09:32:00,537 epoch 50 - iter 8/17 - loss 1.92441855 - samples/sec: 270.18 - lr: 0.000488
2020-09-11 09:32:00,650 epoch 50 - iter 9/17 - loss 1.97294697 - samples/sec: 291.55 - lr: 0.000488
2020-09-11 09:32:00,759 epoch 50 - iter 10/17 - loss 1.98562843 - samples/sec: 297.68 - lr: 0.000488
2020-09-11 09:32:00,871 epoch 50 - iter 11/17 - loss 2.00348701 - samples/sec: 287.94 - lr: 0.000488
2020-09-11 09:32:00,991 epoch 50 - iter 12/17 - loss 2.05574360 - samples/sec: 270.36 - lr: 0.000488
2020-09-11 09:32:01,112 epoch 50 - iter 13/17 - loss 2.10646278 - samples/sec: 273.29 - lr: 0.000488
2020-09-11 09:32:01,222 epoch 50 - iter 14/17 - loss 2.14258188 - samples/sec: 297.55 - lr: 0.000488
2020-09-11 09:32:01,338 epoch 50 - iter 15/17 - loss 2.10952766 - samples/sec: 280.93 - lr: 0.000488
2020-09-11 09:32:01,454 epoch 50 - iter 16/17 - loss 2.18073478 - samples/sec: 282.13 - lr: 0.000488
2020-09-11 09:32:01,544 epoch 50 - iter 17/17 - loss 2.18814912 - samples/sec: 361.88 - lr: 0.000488
2020-09-11 09:32:01,546 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:01,555 EPOCH 50 done: loss 2.1881 - lr 0.0004883
2020-09-11 09:32:01,639 DEV : loss 1.8708758354187012 - score 0.9039
2020-09-11 09:32:01,643 BAD EPOCHS (no improvement): 3
2020-09-11 09:32:01,645 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:01,754 epoch 51 - iter 1/17 - loss 2.37925291 - samples/sec: 299.85 - lr: 0.000488
2020-09-11 09:32:01,862 epoch 51 - iter 2/17 - loss 2.31285119 - samples/sec: 299.21 - lr: 0.000488
2020-09-11 09:32:01,983 epoch 51 - iter 3/17 - loss 2.07815230 - samples/sec: 267.30 - lr: 0.000488
2020-09-11 09:32:02,098 epoch 51 - iter 4/17 - loss 2.12176999 - samples/sec: 280.35 - lr: 0.000488
2020-09-11 09:32:02,209 epoch 51 - iter 5/17 - loss 2.13544719 - samples/sec: 296.11 - lr: 0.000488
2020-09-11 09:32:02,315 epoch 51 - iter 6/17 - loss 2.15400670 - samples/sec: 302.91 - lr: 0.000488
2020-09-11 09:32:02,435 epoch 51 - iter 7/17 - loss 2.15878560 - samples/sec: 271.01 - lr: 0.000488
2020-09-11 09:32:02,546 epoch 51 - iter 8/17 - loss 2.10743538 - samples/sec: 292.75 - lr: 0.000488
2020-09-11 09:32:02,652 epoch 51 - iter 9/17 - loss 2.14642469 - samples/sec: 303.95 - lr: 0.000488
2020-09-11 09:32:02,768 epoch 51 - iter 10/17 - loss 2.11396281 - samples/sec: 280.38 - lr: 0.000488
2020-09-11 09:32:02,896 epoch 51 - iter 11/17 - loss 2.13433785 - samples/sec: 252.34 - lr: 0.000488
2020-09-11 09:32:03,009 epoch 51 - iter 12/17 - loss 2.14074990 - samples/sec: 287.48 - lr: 0.000488
2020-09-11 09:32:03,133 epoch 51 - iter 13/17 - loss 2.16428389 - samples/sec: 266.61 - lr: 0.000488
2020-09-11 09:32:03,242 epoch 51 - iter 14/17 - loss 2.17041359 - samples/sec: 297.92 - lr: 0.000488
2020-09-11 09:32:03,348 epoch 51 - iter 15/17 - loss 2.11546025 - samples/sec: 305.25 - lr: 0.000488
2020-09-11 09:32:03,465 epoch 51 - iter 16/17 - loss 2.11760668 - samples/sec: 279.29 - lr: 0.000488
2020-09-11 09:32:03,532 epoch 51 - iter 17/17 - loss 2.15209274 - samples/sec: 491.81 - lr: 0.000488
2020-09-11 09:32:03,533 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:03,538 EPOCH 51 done: loss 2.1521 - lr 0.0004883
2020-09-11 09:32:03,616 DEV : loss 1.8709588050842285 - score 0.9039
Epoch    51: reducing learning rate of group 0 to 2.4414e-04.
2020-09-11 09:32:03,621 BAD EPOCHS (no improvement): 4
2020-09-11 09:32:03,623 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:03,734 epoch 52 - iter 1/17 - loss 1.42433143 - samples/sec: 293.13 - lr: 0.000244
2020-09-11 09:32:03,864 epoch 52 - iter 2/17 - loss 1.94309056 - samples/sec: 248.18 - lr: 0.000244
2020-09-11 09:32:03,970 epoch 52 - iter 3/17 - loss 2.05831647 - samples/sec: 306.61 - lr: 0.000244
2020-09-11 09:32:04,083 epoch 52 - iter 4/17 - loss 2.07525927 - samples/sec: 286.32 - lr: 0.000244
2020-09-11 09:32:04,197 epoch 52 - iter 5/17 - loss 2.31849523 - samples/sec: 284.32 - lr: 0.000244
2020-09-11 09:32:04,302 epoch 52 - iter 6/17 - loss 2.25557834 - samples/sec: 307.19 - lr: 0.000244
2020-09-11 09:32:04,416 epoch 52 - iter 7/17 - loss 2.21537377 - samples/sec: 282.38 - lr: 0.000244
2020-09-11 09:32:04,532 epoch 52 - iter 8/17 - loss 2.16501409 - samples/sec: 278.57 - lr: 0.000244
2020-09-11 09:32:04,633 epoch 52 - iter 9/17 - loss 2.17519458 - samples/sec: 322.09 - lr: 0.000244
2020-09-11 09:32:04,758 epoch 52 - iter 10/17 - loss 2.25405197 - samples/sec: 265.34 - lr: 0.000244
2020-09-11 09:32:04,866 epoch 52 - iter 11/17 - loss 2.22692343 - samples/sec: 298.33 - lr: 0.000244
2020-09-11 09:32:04,971 epoch 52 - iter 12/17 - loss 2.20147764 - samples/sec: 309.76 - lr: 0.000244
2020-09-11 09:32:05,077 epoch 52 - iter 13/17 - loss 2.19556830 - samples/sec: 305.14 - lr: 0.000244
2020-09-11 09:32:05,203 epoch 52 - iter 14/17 - loss 2.16996110 - samples/sec: 261.25 - lr: 0.000244
2020-09-11 09:32:05,307 epoch 52 - iter 15/17 - loss 2.15638318 - samples/sec: 308.44 - lr: 0.000244
2020-09-11 09:32:05,425 epoch 52 - iter 16/17 - loss 2.13956507 - samples/sec: 275.18 - lr: 0.000244
2020-09-11 09:32:05,493 epoch 52 - iter 17/17 - loss 2.07687952 - samples/sec: 475.48 - lr: 0.000244
2020-09-11 09:32:05,494 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:05,499 EPOCH 52 done: loss 2.0769 - lr 0.0002441
2020-09-11 09:32:05,575 DEV : loss 1.8710246086120605 - score 0.9039
2020-09-11 09:32:05,578 BAD EPOCHS (no improvement): 1
2020-09-11 09:32:05,580 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:05,696 epoch 53 - iter 1/17 - loss 2.67301607 - samples/sec: 279.99 - lr: 0.000244
2020-09-11 09:32:05,810 epoch 53 - iter 2/17 - loss 2.87615097 - samples/sec: 284.34 - lr: 0.000244
2020-09-11 09:32:05,925 epoch 53 - iter 3/17 - loss 2.46839376 - samples/sec: 279.79 - lr: 0.000244
2020-09-11 09:32:06,049 epoch 53 - iter 4/17 - loss 2.64226267 - samples/sec: 261.68 - lr: 0.000244
2020-09-11 09:32:06,156 epoch 53 - iter 5/17 - loss 2.48819025 - samples/sec: 300.57 - lr: 0.000244
2020-09-11 09:32:06,263 epoch 53 - iter 6/17 - loss 2.42314504 - samples/sec: 302.87 - lr: 0.000244
2020-09-11 09:32:06,366 epoch 53 - iter 7/17 - loss 2.33482059 - samples/sec: 313.20 - lr: 0.000244
2020-09-11 09:32:06,481 epoch 53 - iter 8/17 - loss 2.23332472 - samples/sec: 281.06 - lr: 0.000244
2020-09-11 09:32:06,593 epoch 53 - iter 9/17 - loss 2.26868233 - samples/sec: 294.98 - lr: 0.000244
2020-09-11 09:32:06,700 epoch 53 - iter 10/17 - loss 2.20803412 - samples/sec: 302.27 - lr: 0.000244
2020-09-11 09:32:06,808 epoch 53 - iter 11/17 - loss 2.17226865 - samples/sec: 299.75 - lr: 0.000244
2020-09-11 09:32:06,903 epoch 53 - iter 12/17 - loss 2.13279492 - samples/sec: 342.01 - lr: 0.000244
2020-09-11 09:32:07,007 epoch 53 - iter 13/17 - loss 2.14206107 - samples/sec: 309.29 - lr: 0.000244
2020-09-11 09:32:07,118 epoch 53 - iter 14/17 - loss 2.15092226 - samples/sec: 293.50 - lr: 0.000244
2020-09-11 09:32:07,229 epoch 53 - iter 15/17 - loss 2.18495049 - samples/sec: 289.12 - lr: 0.000244
2020-09-11 09:32:07,337 epoch 53 - iter 16/17 - loss 2.16140499 - samples/sec: 298.82 - lr: 0.000244
2020-09-11 09:32:07,415 epoch 53 - iter 17/17 - loss 2.15657809 - samples/sec: 418.69 - lr: 0.000244
2020-09-11 09:32:07,416 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:07,421 EPOCH 53 done: loss 2.1566 - lr 0.0002441
2020-09-11 09:32:07,507 DEV : loss 1.8710384368896484 - score 0.9039
2020-09-11 09:32:07,510 BAD EPOCHS (no improvement): 2
2020-09-11 09:32:07,514 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:07,626 epoch 54 - iter 1/17 - loss 2.50339174 - samples/sec: 292.09 - lr: 0.000244
2020-09-11 09:32:07,735 epoch 54 - iter 2/17 - loss 2.18140179 - samples/sec: 315.09 - lr: 0.000244
2020-09-11 09:32:07,850 epoch 54 - iter 3/17 - loss 2.23897684 - samples/sec: 282.39 - lr: 0.000244
2020-09-11 09:32:07,966 epoch 54 - iter 4/17 - loss 2.10332695 - samples/sec: 279.99 - lr: 0.000244
2020-09-11 09:32:08,088 epoch 54 - iter 5/17 - loss 2.13238862 - samples/sec: 263.80 - lr: 0.000244
2020-09-11 09:32:08,206 epoch 54 - iter 6/17 - loss 2.24009635 - samples/sec: 273.54 - lr: 0.000244
2020-09-11 09:32:08,329 epoch 54 - iter 7/17 - loss 2.30253548 - samples/sec: 269.00 - lr: 0.000244
2020-09-11 09:32:08,433 epoch 54 - iter 8/17 - loss 2.18023707 - samples/sec: 313.01 - lr: 0.000244
2020-09-11 09:32:08,562 epoch 54 - iter 9/17 - loss 2.13453245 - samples/sec: 250.65 - lr: 0.000244
2020-09-11 09:32:08,672 epoch 54 - iter 10/17 - loss 2.19992437 - samples/sec: 292.82 - lr: 0.000244
2020-09-11 09:32:08,787 epoch 54 - iter 11/17 - loss 2.15717849 - samples/sec: 281.81 - lr: 0.000244
2020-09-11 09:32:08,893 epoch 54 - iter 12/17 - loss 2.14129857 - samples/sec: 307.05 - lr: 0.000244
2020-09-11 09:32:08,999 epoch 54 - iter 13/17 - loss 2.16953674 - samples/sec: 304.10 - lr: 0.000244
2020-09-11 09:32:09,107 epoch 54 - iter 14/17 - loss 2.17339781 - samples/sec: 297.71 - lr: 0.000244
2020-09-11 09:32:09,219 epoch 54 - iter 15/17 - loss 2.16997722 - samples/sec: 289.97 - lr: 0.000244
2020-09-11 09:32:09,325 epoch 54 - iter 16/17 - loss 2.14441101 - samples/sec: 305.37 - lr: 0.000244
2020-09-11 09:32:09,402 epoch 54 - iter 17/17 - loss 2.09969692 - samples/sec: 418.75 - lr: 0.000244
2020-09-11 09:32:09,404 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:09,409 EPOCH 54 done: loss 2.0997 - lr 0.0002441
2020-09-11 09:32:09,497 DEV : loss 1.8709750175476074 - score 0.9039
2020-09-11 09:32:09,499 BAD EPOCHS (no improvement): 3
2020-09-11 09:32:09,500 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:09,620 epoch 55 - iter 1/17 - loss 1.90178788 - samples/sec: 272.99 - lr: 0.000244
2020-09-11 09:32:09,728 epoch 55 - iter 2/17 - loss 1.98399633 - samples/sec: 301.43 - lr: 0.000244
2020-09-11 09:32:09,841 epoch 55 - iter 3/17 - loss 1.99539125 - samples/sec: 285.31 - lr: 0.000244
2020-09-11 09:32:09,953 epoch 55 - iter 4/17 - loss 1.90213764 - samples/sec: 289.10 - lr: 0.000244
2020-09-11 09:32:10,065 epoch 55 - iter 5/17 - loss 1.96329775 - samples/sec: 288.70 - lr: 0.000244
2020-09-11 09:32:10,176 epoch 55 - iter 6/17 - loss 1.96443625 - samples/sec: 292.03 - lr: 0.000244
2020-09-11 09:32:10,288 epoch 55 - iter 7/17 - loss 2.03388395 - samples/sec: 286.98 - lr: 0.000244
2020-09-11 09:32:10,409 epoch 55 - iter 8/17 - loss 2.09622708 - samples/sec: 269.29 - lr: 0.000244
2020-09-11 09:32:10,530 epoch 55 - iter 9/17 - loss 2.17744046 - samples/sec: 266.37 - lr: 0.000244
2020-09-11 09:32:10,645 epoch 55 - iter 10/17 - loss 2.20716212 - samples/sec: 281.23 - lr: 0.000244
2020-09-11 09:32:10,762 epoch 55 - iter 11/17 - loss 2.20755792 - samples/sec: 275.91 - lr: 0.000244
2020-09-11 09:32:10,885 epoch 55 - iter 12/17 - loss 2.21960968 - samples/sec: 261.72 - lr: 0.000244
2020-09-11 09:32:10,988 epoch 55 - iter 13/17 - loss 2.20926589 - samples/sec: 320.85 - lr: 0.000244
2020-09-11 09:32:11,106 epoch 55 - iter 14/17 - loss 2.12377312 - samples/sec: 272.30 - lr: 0.000244
2020-09-11 09:32:11,211 epoch 55 - iter 15/17 - loss 2.13603848 - samples/sec: 308.71 - lr: 0.000244
2020-09-11 09:32:11,316 epoch 55 - iter 16/17 - loss 2.14775415 - samples/sec: 309.65 - lr: 0.000244
2020-09-11 09:32:11,392 epoch 55 - iter 17/17 - loss 2.12510460 - samples/sec: 423.90 - lr: 0.000244
2020-09-11 09:32:11,394 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:11,399 EPOCH 55 done: loss 2.1251 - lr 0.0002441
2020-09-11 09:32:11,476 DEV : loss 1.8711307048797607 - score 0.9039
Epoch    55: reducing learning rate of group 0 to 1.2207e-04.
2020-09-11 09:32:11,478 BAD EPOCHS (no improvement): 4
2020-09-11 09:32:11,483 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:11,597 epoch 56 - iter 1/17 - loss 2.13230896 - samples/sec: 287.93 - lr: 0.000122
2020-09-11 09:32:11,706 epoch 56 - iter 2/17 - loss 2.16884816 - samples/sec: 300.55 - lr: 0.000122
2020-09-11 09:32:11,813 epoch 56 - iter 3/17 - loss 2.14700532 - samples/sec: 299.71 - lr: 0.000122
2020-09-11 09:32:11,925 epoch 56 - iter 4/17 - loss 2.10528451 - samples/sec: 289.35 - lr: 0.000122
2020-09-11 09:32:12,042 epoch 56 - iter 5/17 - loss 2.02419295 - samples/sec: 275.70 - lr: 0.000122
2020-09-11 09:32:12,150 epoch 56 - iter 6/17 - loss 2.09250812 - samples/sec: 302.22 - lr: 0.000122
2020-09-11 09:32:12,257 epoch 56 - iter 7/17 - loss 1.99774071 - samples/sec: 302.23 - lr: 0.000122
2020-09-11 09:32:12,380 epoch 56 - iter 8/17 - loss 1.98823553 - samples/sec: 262.22 - lr: 0.000122
2020-09-11 09:32:12,478 epoch 56 - iter 9/17 - loss 2.01300555 - samples/sec: 329.48 - lr: 0.000122
2020-09-11 09:32:12,603 epoch 56 - iter 10/17 - loss 1.96308876 - samples/sec: 260.03 - lr: 0.000122
2020-09-11 09:32:12,722 epoch 56 - iter 11/17 - loss 2.12541857 - samples/sec: 270.64 - lr: 0.000122
2020-09-11 09:32:12,831 epoch 56 - iter 12/17 - loss 2.09370079 - samples/sec: 299.12 - lr: 0.000122
2020-09-11 09:32:12,934 epoch 56 - iter 13/17 - loss 2.14898827 - samples/sec: 312.36 - lr: 0.000122
2020-09-11 09:32:13,042 epoch 56 - iter 14/17 - loss 2.11128387 - samples/sec: 299.37 - lr: 0.000122
2020-09-11 09:32:13,149 epoch 56 - iter 15/17 - loss 2.12494528 - samples/sec: 303.02 - lr: 0.000122
2020-09-11 09:32:13,262 epoch 56 - iter 16/17 - loss 2.16102227 - samples/sec: 286.20 - lr: 0.000122
2020-09-11 09:32:13,333 epoch 56 - iter 17/17 - loss 2.14927550 - samples/sec: 456.69 - lr: 0.000122
2020-09-11 09:32:13,335 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:13,337 EPOCH 56 done: loss 2.1493 - lr 0.0001221
2020-09-11 09:32:13,416 DEV : loss 1.8712515830993652 - score 0.9039
2020-09-11 09:32:13,420 BAD EPOCHS (no improvement): 1
2020-09-11 09:32:13,423 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:13,542 epoch 57 - iter 1/17 - loss 2.06140113 - samples/sec: 272.59 - lr: 0.000122
2020-09-11 09:32:13,658 epoch 57 - iter 2/17 - loss 2.09485781 - samples/sec: 281.52 - lr: 0.000122
2020-09-11 09:32:13,790 epoch 57 - iter 3/17 - loss 2.17190838 - samples/sec: 246.30 - lr: 0.000122
2020-09-11 09:32:13,914 epoch 57 - iter 4/17 - loss 2.08750546 - samples/sec: 261.82 - lr: 0.000122
2020-09-11 09:32:14,037 epoch 57 - iter 5/17 - loss 2.17361174 - samples/sec: 261.26 - lr: 0.000122
2020-09-11 09:32:14,144 epoch 57 - iter 6/17 - loss 2.15775029 - samples/sec: 303.08 - lr: 0.000122
2020-09-11 09:32:14,252 epoch 57 - iter 7/17 - loss 2.11520788 - samples/sec: 300.57 - lr: 0.000122
2020-09-11 09:32:14,354 epoch 57 - iter 8/17 - loss 2.15911621 - samples/sec: 318.04 - lr: 0.000122
2020-09-11 09:32:14,460 epoch 57 - iter 9/17 - loss 2.15239777 - samples/sec: 303.85 - lr: 0.000122
2020-09-11 09:32:14,576 epoch 57 - iter 10/17 - loss 2.22143736 - samples/sec: 277.67 - lr: 0.000122
2020-09-11 09:32:14,675 epoch 57 - iter 11/17 - loss 2.18487239 - samples/sec: 327.67 - lr: 0.000122
2020-09-11 09:32:14,784 epoch 57 - iter 12/17 - loss 2.16919176 - samples/sec: 316.15 - lr: 0.000122
2020-09-11 09:32:14,890 epoch 57 - iter 13/17 - loss 2.11041773 - samples/sec: 305.92 - lr: 0.000122
2020-09-11 09:32:14,997 epoch 57 - iter 14/17 - loss 2.12899177 - samples/sec: 301.15 - lr: 0.000122
2020-09-11 09:32:15,132 epoch 57 - iter 15/17 - loss 2.10911355 - samples/sec: 239.11 - lr: 0.000122
2020-09-11 09:32:15,244 epoch 57 - iter 16/17 - loss 2.15161987 - samples/sec: 288.10 - lr: 0.000122
2020-09-11 09:32:15,322 epoch 57 - iter 17/17 - loss 2.11003646 - samples/sec: 417.30 - lr: 0.000122
2020-09-11 09:32:15,323 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:15,328 EPOCH 57 done: loss 2.1100 - lr 0.0001221
2020-09-11 09:32:15,407 DEV : loss 1.871190071105957 - score 0.9039
2020-09-11 09:32:15,411 BAD EPOCHS (no improvement): 2
2020-09-11 09:32:15,413 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:15,520 epoch 58 - iter 1/17 - loss 2.92842674 - samples/sec: 303.98 - lr: 0.000122
2020-09-11 09:32:15,634 epoch 58 - iter 2/17 - loss 2.42707694 - samples/sec: 281.85 - lr: 0.000122
2020-09-11 09:32:15,771 epoch 58 - iter 3/17 - loss 2.23341076 - samples/sec: 237.25 - lr: 0.000122
2020-09-11 09:32:15,892 epoch 58 - iter 4/17 - loss 2.20908457 - samples/sec: 265.75 - lr: 0.000122
2020-09-11 09:32:16,007 epoch 58 - iter 5/17 - loss 2.17910295 - samples/sec: 283.48 - lr: 0.000122
2020-09-11 09:32:16,104 epoch 58 - iter 6/17 - loss 2.05788509 - samples/sec: 333.94 - lr: 0.000122
2020-09-11 09:32:16,215 epoch 58 - iter 7/17 - loss 2.08856239 - samples/sec: 289.41 - lr: 0.000122
2020-09-11 09:32:16,330 epoch 58 - iter 8/17 - loss 2.14802042 - samples/sec: 281.15 - lr: 0.000122
2020-09-11 09:32:16,439 epoch 58 - iter 9/17 - loss 2.17300524 - samples/sec: 297.83 - lr: 0.000122
2020-09-11 09:32:16,537 epoch 58 - iter 10/17 - loss 2.16579535 - samples/sec: 332.77 - lr: 0.000122
2020-09-11 09:32:16,665 epoch 58 - iter 11/17 - loss 2.21264616 - samples/sec: 251.48 - lr: 0.000122
2020-09-11 09:32:16,770 epoch 58 - iter 12/17 - loss 2.19528157 - samples/sec: 306.98 - lr: 0.000122
2020-09-11 09:32:16,885 epoch 58 - iter 13/17 - loss 2.11050682 - samples/sec: 282.85 - lr: 0.000122
2020-09-11 09:32:16,993 epoch 58 - iter 14/17 - loss 2.14877816 - samples/sec: 298.19 - lr: 0.000122
2020-09-11 09:32:17,100 epoch 58 - iter 15/17 - loss 2.20244874 - samples/sec: 302.51 - lr: 0.000122
2020-09-11 09:32:17,200 epoch 58 - iter 16/17 - loss 2.16341272 - samples/sec: 323.63 - lr: 0.000122
2020-09-11 09:32:17,270 epoch 58 - iter 17/17 - loss 2.08311685 - samples/sec: 465.62 - lr: 0.000122
2020-09-11 09:32:17,271 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:17,276 EPOCH 58 done: loss 2.0831 - lr 0.0001221
2020-09-11 09:32:17,351 DEV : loss 1.8712575435638428 - score 0.9039
2020-09-11 09:32:17,356 BAD EPOCHS (no improvement): 3
2020-09-11 09:32:17,357 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:17,470 epoch 59 - iter 1/17 - loss 3.57667923 - samples/sec: 288.24 - lr: 0.000122
2020-09-11 09:32:17,570 epoch 59 - iter 2/17 - loss 2.45157045 - samples/sec: 324.19 - lr: 0.000122
2020-09-11 09:32:17,685 epoch 59 - iter 3/17 - loss 2.40864130 - samples/sec: 279.59 - lr: 0.000122
2020-09-11 09:32:17,793 epoch 59 - iter 4/17 - loss 2.30390897 - samples/sec: 301.24 - lr: 0.000122
2020-09-11 09:32:17,896 epoch 59 - iter 5/17 - loss 2.12980967 - samples/sec: 314.40 - lr: 0.000122
2020-09-11 09:32:18,015 epoch 59 - iter 6/17 - loss 2.18769928 - samples/sec: 275.16 - lr: 0.000122
2020-09-11 09:32:18,123 epoch 59 - iter 7/17 - loss 2.13403550 - samples/sec: 301.61 - lr: 0.000122
2020-09-11 09:32:18,230 epoch 59 - iter 8/17 - loss 2.11809765 - samples/sec: 299.58 - lr: 0.000122
2020-09-11 09:32:18,340 epoch 59 - iter 9/17 - loss 2.08499732 - samples/sec: 293.75 - lr: 0.000122
2020-09-11 09:32:18,452 epoch 59 - iter 10/17 - loss 2.08781813 - samples/sec: 292.03 - lr: 0.000122
2020-09-11 09:32:18,565 epoch 59 - iter 11/17 - loss 2.06968793 - samples/sec: 287.39 - lr: 0.000122
2020-09-11 09:32:18,690 epoch 59 - iter 12/17 - loss 2.08348020 - samples/sec: 257.11 - lr: 0.000122
2020-09-11 09:32:18,812 epoch 59 - iter 13/17 - loss 2.08096592 - samples/sec: 265.63 - lr: 0.000122
2020-09-11 09:32:18,914 epoch 59 - iter 14/17 - loss 2.06882810 - samples/sec: 317.14 - lr: 0.000122
2020-09-11 09:32:19,041 epoch 59 - iter 15/17 - loss 2.13064247 - samples/sec: 256.00 - lr: 0.000122
2020-09-11 09:32:19,150 epoch 59 - iter 16/17 - loss 2.16788667 - samples/sec: 297.97 - lr: 0.000122
2020-09-11 09:32:19,222 epoch 59 - iter 17/17 - loss 2.12413386 - samples/sec: 451.70 - lr: 0.000122
2020-09-11 09:32:19,223 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:19,225 EPOCH 59 done: loss 2.1241 - lr 0.0001221
2020-09-11 09:32:19,307 DEV : loss 1.8713274002075195 - score 0.9039
Epoch    59: reducing learning rate of group 0 to 6.1035e-05.
2020-09-11 09:32:19,309 BAD EPOCHS (no improvement): 4
2020-09-11 09:32:19,312 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:19,313 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:19,314 learning rate too small - quitting training!
2020-09-11 09:32:19,316 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:22,073 ----------------------------------------------------------------------------------------------------
2020-09-11 09:32:22,074 Testing using best model ...
2020-09-11 09:32:22,075 loading file /content/best-model.pt
2020-09-11 09:32:23,480 0.9176	0.9455	0.9313
2020-09-11 09:32:23,481 
Results:
- F1-score (micro) 0.9313
- F1-score (macro) 0.7715

By class:
-          tp: 0 - fp: 0 - fn: 1 - precision: 0.0000 - recall: 0.0000 - f1-score: 0.0000
City       tp: 29 - fp: 2 - fn: 2 - precision: 0.9355 - recall: 0.9355 - f1-score: 0.9355
Corporation tp: 13 - fp: 1 - fn: 1 - precision: 0.9286 - recall: 0.9286 - f1-score: 0.9286
Country    tp: 11 - fp: 0 - fn: 0 - precision: 1.0000 - recall: 1.0000 - f1-score: 1.0000
GivenName  tp: 7 - fp: 1 - fn: 0 - precision: 0.8750 - recall: 1.0000 - f1-score: 0.9333
Household  tp: 9 - fp: 0 - fn: 1 - precision: 1.0000 - recall: 0.9000 - f1-score: 0.9474
MiddleName tp: 0 - fp: 2 - fn: 0 - precision: 0.0000 - recall: 0.0000 - f1-score: 0.0000
State      tp: 29 - fp: 1 - fn: 1 - precision: 0.9667 - recall: 0.9667 - f1-score: 0.9667
StreetAddress tp: 28 - fp: 3 - fn: 3 - precision: 0.9032 - recall: 0.9032 - f1-score: 0.9032
SurName    tp: 7 - fp: 1 - fn: 0 - precision: 0.8750 - recall: 1.0000 - f1-score: 0.9333
Zipcode    tp: 23 - fp: 3 - fn: 0 - precision: 0.8846 - recall: 1.0000 - f1-score: 0.9388
2020-09-11 09:32:23,484 ----------------------------------------------------------------------------------------------------
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;dev_loss_history&#39;: [5.717854976654053,
  7.014471054077148,
  6.267121315002441,
  4.367828369140625,
  7.306588172912598,
  3.1234371662139893,
  2.352734327316284,
  2.3950960636138916,
  2.601285934448242,
  2.621568202972412,
  2.6496293544769287,
  2.456434726715088,
  2.8066673278808594,
  2.356717109680176,
  2.2419240474700928,
  2.1843576431274414,
  2.249250888824463,
  2.1045773029327393,
  1.987985372543335,
  2.02628755569458,
  1.9274215698242188,
  1.9331698417663574,
  1.9181852340698242,
  1.9145869016647339,
  1.8926992416381836,
  1.829909324645996,
  1.877849817276001,
  1.8591759204864502,
  1.8752442598342896,
  1.8820831775665283,
  1.87209951877594,
  1.8655517101287842,
  1.860945701599121,
  1.8520863056182861,
  1.8610153198242188,
  1.8612797260284424,
  1.862546443939209,
  1.869424819946289,
  1.8706583976745605,
  1.8684940338134766,
  1.8697052001953125,
  1.8711341619491577,
  1.871195912361145,
  1.8707306385040283,
  1.8710083961486816,
  1.8702256679534912,
  1.8696794509887695,
  1.869992733001709,
  1.8705830574035645,
  1.8708758354187012,
  1.8709588050842285,
  1.8710246086120605,
  1.8710384368896484,
  1.8709750175476074,
  1.8711307048797607,
  1.8712515830993652,
  1.871190071105957,
  1.8712575435638428,
  1.8713274002075195],
 &#39;dev_score_history&#39;: [0.8697916666666667,
  0.7978436657681941,
  0.7704918032786885,
  0.8491048593350384,
  0.8608923884514434,
  0.8808290155440414,
  0.8164383561643836,
  0.8911392405063291,
  0.8783068783068783,
  0.8877551020408163,
  0.9175257731958764,
  0.8571428571428572,
  0.8548387096774193,
  0.903896103896104,
  0.8963730569948186,
  0.8963730569948186,
  0.8911917098445595,
  0.8900523560209423,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104,
  0.903896103896104],
 &#39;test_score&#39;: 0.9313432835820895,
 &#39;train_loss_history&#39;: [9.025349981644574,
  6.609698015100816,
  6.332132143132827,
  5.108250505783978,
  5.506425955716302,
  3.8211376667022705,
  3.362795156591079,
  3.259746509439805,
  3.1422233791912304,
  3.286931914441726,
  3.1722532090018776,
  3.1396323021720436,
  2.9533899181029377,
  3.0463009301353905,
  2.8610909195507275,
  2.526246000738705,
  2.491676554960363,
  2.6032417311387905,
  2.377417711650624,
  2.386420453295988,
  2.244826681473676,
  2.190858244895935,
  2.267894345171311,
  2.218476274434258,
  2.264526696766124,
  2.204820352442124,
  2.123208859387566,
  2.1706547877367806,
  2.2194581031799316,
  2.2134850586161896,
  2.1507136681500603,
  2.1263834097806145,
  2.1835697889328003,
  2.2314544004552506,
  2.1594833345974194,
  2.1696282975813923,
  2.1386386717067047,
  2.0764440298080444,
  2.107362817315494,
  2.200913576518788,
  2.132053866105921,
  2.069297019173117,
  2.1372564610312965,
  2.084194351645077,
  2.1103776973836563,
  2.140008344369776,
  2.1633326095693253,
  2.1525954989825977,
  2.16026076148538,
  2.1881491226308487,
  2.152092737310073,
  2.076879515367396,
  2.1565780850017773,
  2.0996969166923973,
  2.1251045956331143,
  2.149275499231675,
  2.1100364572861614,
  2.0831168504322277,
  2.12413386036368]}</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">from</span> <span class="nn">flair.data</span> <span class="kn">import</span> <span class="n">Sentence</span>
<span class="kn">from</span> <span class="nn">flair.models</span> <span class="kn">import</span> <span class="n">SequenceTagger</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SequenceTagger</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;/content/final-model.pt&#39;</span><span class="p">)</span>

<span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&lt;redacted&gt;&#39;</span>
<span class="n">sentence</span> <span class="o">=</span> <span class="n">Sentence</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">sentence</span><span class="o">.</span><span class="n">get_spans</span><span class="p">(</span><span class="s1">&#39;ner&#39;</span><span class="p">):</span>
  <span class="n">out</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">text</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2020-09-11 09:33:19,511 loading file /content/final-model.pt
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EntityType&#39;</span><span class="p">,</span><span class="s1">&#39;Recipient&#39;</span><span class="p">,</span><span class="s1">&#39;Address&#39;</span><span class="p">,</span>
        <span class="s1">&#39;GivenName&#39;</span><span class="p">,</span><span class="s1">&#39;MiddleName&#39;</span><span class="p">,</span><span class="s1">&#39;SurName&#39;</span><span class="p">,</span><span class="s1">&#39;Household&#39;</span><span class="p">,</span><span class="s1">&#39;Corporation&#39;</span><span class="p">,</span>
        <span class="s1">&#39;StreetAddress&#39;</span><span class="p">,</span><span class="s1">&#39;City&#39;</span><span class="p">,</span><span class="s1">&#39;State&#39;</span><span class="p">,</span><span class="s1">&#39;Zipcode&#39;</span><span class="p">,</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="s1">&#39;Confidence&#39;</span><span class="p">]</span>

<span class="n">PAD_TAIL</span> <span class="o">=</span> <span class="s1">&#39;&lt;redacted&gt;&#39;</span>

<span class="k">def</span> <span class="nf">household_patch</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">EntityType</span><span class="o">==</span><span class="s1">&#39;Household&#39;</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">Household</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;&amp;&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">Household</span> <span class="k">else</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Household</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">parseit</span><span class="p">(</span><span class="n">text</span><span class="o">+</span><span class="n">PAD_TAIL</span><span class="p">)</span>
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;GivenName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;GivenName&#39;</span><span class="p">]</span>
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;SurName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;SurName&#39;</span><span class="p">]</span>
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;MiddleName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;MiddleName&#39;</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">row</span>

<span class="k">def</span> <span class="nf">add_on</span><span class="p">(</span><span class="n">xx</span><span class="p">):</span>
  <span class="c1"># Address is the combination of street, city, state, zip and country</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;StreetAddress&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;City&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;State&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Zipcode&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span>
  <span class="c1"># default is person, if household column is not empty, then household, same for corporation</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;EntityType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Person&#39;</span>
  <span class="n">xx</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">xx</span><span class="o">.</span><span class="n">Household</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;EntityType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Household&#39;</span>
  <span class="n">xx</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">xx</span><span class="o">.</span><span class="n">Corporation</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;EntityType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Corporation&#39;</span>
  <span class="c1"># default is full name of person, if entity is corporation ,then corporation name, same for household</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Recipient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;SurName&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;GivenName&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;MiddleName&#39;</span><span class="p">]</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Recipient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">Corporation</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">EntityType</span><span class="o">==</span><span class="s1">&#39;Corporation&#39;</span> <span class="k">else</span> <span class="n">row</span><span class="o">.</span><span class="n">Recipient</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Recipient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">Household</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">EntityType</span><span class="o">==</span><span class="s1">&#39;Household&#39;</span> <span class="k">else</span> <span class="n">row</span><span class="o">.</span><span class="n">Recipient</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="c1"># adding household to name field patch</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">household_patch</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="c1"># converting to dictionary format</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*$&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="c1"># return the processed data</span>
  <span class="k">return</span> <span class="n">xx</span>

<span class="k">def</span> <span class="nf">parseit</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
  <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">sentence</span> <span class="o">=</span> <span class="n">Sentence</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">sentence</span><span class="o">.</span><span class="n">get_spans</span><span class="p">(</span><span class="s1">&#39;ner&#39;</span><span class="p">):</span>
    <span class="n">output</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">text</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">dfx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
  <span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
  <span class="n">dfx</span><span class="p">[</span><span class="s1">&#39;Confidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">score</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="si">}</span><span class="s1">]&#39;</span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sentence</span><span class="o">.</span><span class="n">get_spans</span><span class="p">(</span><span class="s1">&#39;ner&#39;</span><span class="p">)])</span>
  <span class="k">return</span> <span class="n">dfx</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">parseit</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">add_on</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">X</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">X</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">func</span><span class="p">(</span><span class="s1">&#39;&lt;redacted&gt;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">gradio</span>
<span class="kn">import</span> <span class="nn">gradio</span> <span class="k">as</span> <span class="nn">gr</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">Textbox</span><span class="p">(</span><span class="n">lines</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Input&#39;</span><span class="p">)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">Textbox</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Output&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">gr</span><span class="o">.</span><span class="n">Interface</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="API">API<a class="anchor-link" href="#API"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">probablepeople</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">usaddress</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span>  <span class="nn">probablepeople</span> <span class="k">as</span> <span class="nn">pp</span>
<span class="kn">import</span> <span class="nn">usaddress</span> <span class="k">as</span> <span class="nn">ua</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="n">tqdm</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span>
<span class="o">%</span><span class="n">reload_ext</span> <span class="n">autoreload</span>
<span class="o">%</span><span class="n">autoreload</span> <span class="mi">2</span>
<span class="o">%</span><span class="n">reload_ext</span> <span class="n">google</span><span class="o">.</span><span class="n">colab</span><span class="o">.</span><span class="n">data_table</span>
<span class="o">%</span><span class="n">config</span> <span class="n">InlineBackend</span><span class="o">.</span><span class="n">figure_format</span> <span class="o">=</span> <span class="s1">&#39;retina&#39;</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;fivethirtyeight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-notebook&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;sample.p&#39;</span><span class="p">))</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">oor</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">patch_country</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">combos</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; US &#39;</span><span class="p">,</span><span class="s1">&#39; USA &#39;</span><span class="p">,</span><span class="s1">&#39; U.S. &#39;</span><span class="p">,</span><span class="s1">&#39; U.S.A. &#39;</span><span class="p">]</span>
  <span class="n">cflagz</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
  <span class="n">otext</span> <span class="o">=</span> <span class="n">text</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
  <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">combos</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
      <span class="n">cflagz</span> <span class="o">=</span> <span class="n">i</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">otext</span><span class="p">[:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">cflagz</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
  <span class="n">cflagz</span> <span class="o">=</span> <span class="n">cflagz</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">text</span><span class="p">,</span> <span class="n">cflagz</span>

<span class="k">def</span> <span class="nf">patch_household</span><span class="p">(</span><span class="n">xz</span><span class="p">):</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">xz</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Person&#39;</span>
  <span class="k">if</span> <span class="s1">&#39;And&#39;</span> <span class="ow">in</span> <span class="n">xx</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Household&#39;</span><span class="p">:</span><span class="n">xz</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Household&#39;</span>
  <span class="k">return</span> <span class="n">xx</span>

<span class="n">tags</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">LABELS</span>
<span class="n">tags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ua</span><span class="o">.</span><span class="n">LABELS</span><span class="p">)</span>
<span class="n">tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">))</span>
<span class="n">additionals</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CountryName&#39;</span><span class="p">,</span> <span class="s1">&#39;Household&#39;</span><span class="p">,</span> <span class="s1">&#39;Type&#39;</span><span class="p">,</span> 
               <span class="s1">&#39;NameConfidence&#39;</span><span class="p">,</span> <span class="s1">&#39;AddrConfidence&#39;</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">]</span>
<span class="n">tags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">additionals</span><span class="p">)</span>

<span class="n">dfx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
<span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="o">~</span><span class="n">dfx</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;UNITED STATES OF AMERICA&#39;</span><span class="p">,</span><span class="s1">&#39;US&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;TEXAS&#39;</span><span class="p">,</span><span class="s1">&#39;TX&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">text</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">temp</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">text</span><span class="p">,</span> <span class="n">cflag</span> <span class="o">=</span> <span class="n">patch_country</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="c1"># address parsing</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ua</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">text</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;AddrConfidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ua</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">text</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ua</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">))</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)})</span><span class="o">.</span><span class="n">T</span>
    <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;AddrConfidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Error&#39;</span>
  <span class="c1"># address to name linking</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">xz</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">Recipient</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="n">xz</span> <span class="o">=</span> <span class="n">text</span>
  <span class="c1"># name parsing</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">xz</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;NameConfidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">xz</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">xz</span><span class="p">))</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)})</span><span class="o">.</span><span class="n">T</span>
    <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;NameConfidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Error&#39;</span>
  <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Person&#39;</span>
  <span class="c1"># household name patch</span>
  <span class="k">if</span> <span class="s1">&#39;And&#39;</span> <span class="ow">in</span> <span class="n">df2</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Household&#39;</span><span class="p">:</span><span class="n">xz</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Household&#39;</span>
  <span class="c1"># concatenation</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span>  
  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;CountryName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cflag</span> <span class="k">if</span> <span class="n">cflag</span><span class="o">!=</span><span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
  <span class="n">dfx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
  <span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="o">~</span><span class="n">dfx</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
  <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;CorporationName&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Corporation&#39;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;MiddleInitial&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;MiddleName&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">gname</span><span class="p">,</span> <span class="n">mname</span><span class="p">,</span> <span class="n">sname</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">MiddleName</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">Surname</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">GivenName</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;MiddleName&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Surname&#39;</span><span class="p">],</span> <span class="n">dfx</span><span class="p">[</span><span class="s1">&#39;GivenName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mname</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sname</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="c1"># elif (df[&#39;MiddleInitial&#39;][0]==&#39;&#39;) &amp; (df[&#39;MiddleName&#39;][0]==&#39;&#39;):</span>
  <span class="c1">#   gname, sname = df.Surname, df.GivenName</span>
  <span class="c1">#   df[&#39;Surname&#39;], df[&#39;GivenName&#39;] = sname[0], gname[0]</span>
  <span class="k">return</span> <span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">tagmap</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;tag_map.xlsx&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">tagmap</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">tagmap</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">tagmap</span>
<span class="n">tagmap</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">tagmap</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;FIRSTNAME&#39;</span><span class="p">,</span><span class="s1">&#39;MIDDLENAME&#39;</span><span class="p">,</span><span class="s1">&#39;LASTNAME&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;OTHERNAME&#39;</span><span class="p">,</span><span class="s1">&#39;HOUSEHOLD&#39;</span><span class="p">,</span><span class="s1">&#39;CORPORATION&#39;</span><span class="p">,</span>
                                                        <span class="s1">&#39;STREET_ADDRESS&#39;</span><span class="p">,</span> <span class="s1">&#39;CITY&#39;</span><span class="p">,</span> <span class="s1">&#39;STATE&#39;</span><span class="p">,</span> <span class="s1">&#39;PINCODE&#39;</span><span class="p">,</span> 
                                                        <span class="s1">&#39;COUNTRY&#39;</span><span class="p">,</span> <span class="s1">&#39;META&#39;</span><span class="p">,</span> <span class="s1">&#39;OTHER&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dropna</span><span class="p">()[[</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">custom_patch</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; DALLA S &#39;</span><span class="p">,</span> <span class="s1">&#39; DALLAS &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; PRAIRI E &#39;</span><span class="p">,</span> <span class="s1">&#39; PRAIRIE &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; EL PAS O &#39;</span><span class="p">,</span> <span class="s1">&#39; EL PASO &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; SAN ANT ONIO &#39;</span><span class="p">,</span> <span class="s1">&#39; SAN ANTONIO &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; THE WOODL ANDS &#39;</span><span class="p">,</span> <span class="s1">&#39; THE WOODLANDS &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; FORT WORT H &#39;</span><span class="p">,</span> <span class="s1">&#39; FORT WORTH &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; ARLINGTO N &#39;</span><span class="p">,</span> <span class="s1">&#39; ARLINGTON &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; SOCORR O &#39;</span><span class="p">,</span> <span class="s1">&#39; SOCORRO &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; HURS T &#39;</span><span class="p">,</span> <span class="s1">&#39; HURST &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; HOLLYWOO D &#39;</span><span class="p">,</span> <span class="s1">&#39; HOLLYWOOD &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">text</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">oor_api</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">texto</span> <span class="o">=</span> <span class="n">text</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">temp</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">xx</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">tagmap</span><span class="p">)</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;META&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*$&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;PINCODE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;PINCODE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">T</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
  <span class="n">xx</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
  <span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">custom_patch</span><span class="p">)</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
  <span class="n">label2tag</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">):</span> <span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
  <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">label2tag</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;entity&#39;</span><span class="p">:</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="s1">&#39;tag&#39;</span><span class="p">:</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()})</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;entity&#39;</span><span class="p">:</span> <span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;tag&#39;</span><span class="p">:</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]})</span>
  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;entity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;tag&#39;</span><span class="p">])[</span><span class="s1">&#39;entity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">process_text</span><span class="p">)</span>
  <span class="n">x</span><span class="p">[</span><span class="s1">&#39;entity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;entity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">process_text</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="s1">&#39;tag&#39;</span><span class="p">:</span><span class="s1">&#39;TEXT&#39;</span><span class="p">,</span><span class="s1">&#39;entity&#39;</span><span class="p">:</span><span class="n">texto</span><span class="p">}),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;tag&#39;</span><span class="p">)</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s1">&#39;entity&#39;</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">x</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1"># oor_api(zz)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">oor_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TEXT&#39;</span><span class="p">,</span><span class="s1">&#39;FIRSTNAME&#39;</span><span class="p">,</span><span class="s1">&#39;MIDDLENAME&#39;</span><span class="p">,</span><span class="s1">&#39;LASTNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;OTHERNAME&#39;</span><span class="p">,</span> <span class="s1">&#39;HOUSEHOLD&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;CORPORATION&#39;</span><span class="p">,</span> <span class="s1">&#39;STREET_ADDRESS&#39;</span><span class="p">,</span> <span class="s1">&#39;CITY&#39;</span><span class="p">,</span> <span class="s1">&#39;STATE&#39;</span><span class="p">,</span> <span class="s1">&#39;PINCODE&#39;</span><span class="p">,</span> <span class="s1">&#39;COUNTRY&#39;</span><span class="p">]</span>
<span class="n">dfx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">oor_cols</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
  <span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">oor_api</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>
<span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="p">[</span><span class="n">oor_cols</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>1000it [01:03, 15.75it/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*$&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dfx</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 1000 entries, 0 to 999
Data columns (total 12 columns):
 #   Column          Non-Null Count  Dtype 
---  ------          --------------  ----- 
 0   TEXT            997 non-null    object
 1   FIRSTNAME       403 non-null    object
 2   MIDDLENAME      155 non-null    object
 3   LASTNAME        324 non-null    object
 4   OTHERNAME       9 non-null      object
 5   HOUSEHOLD       199 non-null    object
 6   CORPORATION     364 non-null    object
 7   STREET_ADDRESS  976 non-null    object
 8   CITY            870 non-null    object
 9   STATE           954 non-null    object
 10  PINCODE         838 non-null    object
 11  COUNTRY         288 non-null    object
dtypes: object(12)
memory usage: 101.6+ KB
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dfx</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;x.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;&lt;redacted&gt;&#39;</span>
<span class="n">temp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">oor_api</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Deliverables">Deliverables<a class="anchor-link" href="#Deliverables"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="c1"># !cookiecutter https://github.com/drivendata/cookiecutter-data-science</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">imports</span> <span class="n">_requirements</span><span class="o">.</span><span class="n">txt_</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">flair</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EntityType&#39;</span><span class="p">,</span><span class="s1">&#39;Recipient&#39;</span><span class="p">,</span><span class="s1">&#39;Address&#39;</span><span class="p">,</span>
        <span class="s1">&#39;GivenName&#39;</span><span class="p">,</span><span class="s1">&#39;MiddleName&#39;</span><span class="p">,</span><span class="s1">&#39;SurName&#39;</span><span class="p">,</span><span class="s1">&#39;Household&#39;</span><span class="p">,</span><span class="s1">&#39;Corporation&#39;</span><span class="p">,</span>
        <span class="s1">&#39;StreetAddress&#39;</span><span class="p">,</span><span class="s1">&#39;City&#39;</span><span class="p">,</span><span class="s1">&#39;State&#39;</span><span class="p">,</span><span class="s1">&#39;Zipcode&#39;</span><span class="p">,</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="s1">&#39;Confidence&#39;</span><span class="p">]</span>
<span class="n">name_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EntityType&#39;</span><span class="p">,</span><span class="s1">&#39;Recipient&#39;</span><span class="p">,</span> <span class="s1">&#39;GivenName&#39;</span><span class="p">,</span><span class="s1">&#39;MiddleName&#39;</span><span class="p">,</span><span class="s1">&#39;SurName&#39;</span><span class="p">,</span><span class="s1">&#39;Household&#39;</span><span class="p">,</span><span class="s1">&#39;Corporation&#39;</span><span class="p">]</span>
<span class="n">addr_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Address&#39;</span><span class="p">,</span><span class="s1">&#39;StreetAddress&#39;</span><span class="p">,</span><span class="s1">&#39;City&#39;</span><span class="p">,</span><span class="s1">&#39;State&#39;</span><span class="p">,</span><span class="s1">&#39;Zipcode&#39;</span><span class="p">,</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span>

<span class="n">PAD_TAIL</span> <span class="o">=</span> <span class="s1">&#39;&lt;redacted&gt;&#39;</span>
<span class="n">PAD_HEAD</span> <span class="o">=</span> <span class="s1">&#39;&lt;redacted&gt;&#39;</span>

<span class="k">def</span> <span class="nf">household_patch</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">EntityType</span><span class="o">==</span><span class="s1">&#39;Household&#39;</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">Household</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;&amp;&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">Household</span> <span class="k">else</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Household</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">parseit</span><span class="p">(</span><span class="n">text</span><span class="o">+</span><span class="n">PAD_TAIL</span><span class="p">)</span>
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;GivenName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;GivenName&#39;</span><span class="p">]</span>
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;SurName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;SurName&#39;</span><span class="p">]</span>
    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;MiddleName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;MiddleName&#39;</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">row</span>

<span class="k">def</span> <span class="nf">add_on</span><span class="p">(</span><span class="n">xx</span><span class="p">):</span>
  <span class="c1"># Address is the combination of street, city, state, zip and country</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Address&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;StreetAddress&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;City&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;State&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Zipcode&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Country&#39;</span><span class="p">]</span>
  <span class="c1"># default is person, if household column is not empty, then household, same for corporation</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;EntityType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Person&#39;</span>
  <span class="n">xx</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">xx</span><span class="o">.</span><span class="n">Household</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;EntityType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Household&#39;</span>
  <span class="n">xx</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">xx</span><span class="o">.</span><span class="n">Corporation</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;EntityType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Corporation&#39;</span>
  <span class="c1"># default is full name of person, if entity is corporation ,then corporation name, same for household</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Recipient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;SurName&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;GivenName&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;MiddleName&#39;</span><span class="p">]</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Recipient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">Corporation</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">EntityType</span><span class="o">==</span><span class="s1">&#39;Corporation&#39;</span> <span class="k">else</span> <span class="n">row</span><span class="o">.</span><span class="n">Recipient</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Recipient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">Household</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">EntityType</span><span class="o">==</span><span class="s1">&#39;Household&#39;</span> <span class="k">else</span> <span class="n">row</span><span class="o">.</span><span class="n">Recipient</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="c1"># adding household to name field patch</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">household_patch</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="c1"># converting to dictionary format</span>
  <span class="n">xx</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\s*$&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
  <span class="c1"># return the processed data</span>
  <span class="k">return</span> <span class="n">xx</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">flair.data</span> <span class="kn">import</span> <span class="n">Sentence</span>
<span class="kn">from</span> <span class="nn">flair.models</span> <span class="kn">import</span> <span class="n">SequenceTagger</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">SequenceTagger</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;models/final-model.pt&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
  <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">sentence</span> <span class="o">=</span> <span class="n">Sentence</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">sentence</span><span class="o">.</span><span class="n">get_spans</span><span class="p">(</span><span class="s1">&#39;ner&#39;</span><span class="p">):</span>
    <span class="n">output</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">text</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">dfx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
  <span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
  <span class="n">dfx</span><span class="p">[</span><span class="s1">&#39;Confidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">score</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="si">}</span><span class="s1">]&#39;</span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sentence</span><span class="o">.</span><span class="n">get_spans</span><span class="p">(</span><span class="s1">&#39;ner&#39;</span><span class="p">)])</span>
  <span class="k">return</span> <span class="n">dfx</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2020-09-11 13:02:40,896 loading file models/final-model.pt
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">_predict</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">_parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">add_on</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">X</span>

<span class="k">def</span> <span class="nf">_predict_name</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">text</span> <span class="o">+</span> <span class="n">PAD_TAIL</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">_parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">add_on</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">rqd_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">name_tags</span><span class="p">))</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">rqd_cols</span><span class="p">]</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">X</span>

<span class="k">def</span> <span class="nf">_predict_address</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">PAD_HEAD</span> <span class="o">+</span> <span class="n">text</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">_parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">add_on</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">rqd_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">addr_tags</span><span class="p">))</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">rqd_cols</span><span class="p">]</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">X</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">_predict</span><span class="p">(</span><span class="s1">&#39;&lt;redacted&gt;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">src</span><span class="o">/</span><span class="n">app</span><span class="o">.</span><span class="n">py</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">flair.data</span> <span class="kn">import</span> <span class="n">Sentence</span>
<span class="kn">from</span> <span class="nn">flair.models</span> <span class="kn">import</span> <span class="n">SequenceTagger</span>

<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">model</span> <span class="kn">import</span> <span class="n">loadmodel</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
<span class="n">_PPATH</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;/&#39;</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">loadmodel</span><span class="o">.</span><span class="n">finalmodel</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---Encoder--- </span><span class="si">%s</span><span class="s2"> seconds ---&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
  <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">sentence</span> <span class="o">=</span> <span class="n">Sentence</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">sentence</span><span class="o">.</span><span class="n">get_spans</span><span class="p">(</span><span class="s1">&#39;ner&#39;</span><span class="p">):</span>
    <span class="n">output</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">text</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">dfx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
  <span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
  <span class="n">dfx</span><span class="p">[</span><span class="s1">&#39;Confidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">tag</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">score</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="si">}</span><span class="s1">]&#39;</span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sentence</span><span class="o">.</span><span class="n">get_spans</span><span class="p">(</span><span class="s1">&#39;ner&#39;</span><span class="p">)])</span>
  <span class="k">return</span> <span class="n">dfx</span>

<span class="k">def</span> <span class="nf">_predict</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">_parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">add_on</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">X</span>

<span class="k">def</span> <span class="nf">_predict_name</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">text</span> <span class="o">+</span> <span class="n">PAD_TAIL</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">_parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">add_on</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">rqd_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">name_tags</span><span class="p">))</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">rqd_cols</span><span class="p">]</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">X</span>

<span class="k">def</span> <span class="nf">_predict_address</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">PAD_HEAD</span> <span class="o">+</span> <span class="n">text</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">_parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">add_on</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
  <span class="n">rqd_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">addr_tags</span><span class="p">))</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">rqd_cols</span><span class="p">]</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">X</span>

<span class="c1">########## FLASK API ##########</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">send_file</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/oor&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">parse_oor</span><span class="p">():</span>
  <span class="n">req_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">req_data</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span>
  <span class="n">preds</span> <span class="o">=</span> <span class="n">_predict</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/name&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">parse_name</span><span class="p">():</span>
  <span class="n">req_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">req_data</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span>
  <span class="n">preds</span> <span class="o">=</span> <span class="n">_predict_name</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/address&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">parse_address</span><span class="p">():</span>
  <span class="n">req_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">req_data</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">]</span>
  <span class="n">preds</span> <span class="o">=</span> <span class="n">_predict_address</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting src/app.py
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">pyngrok</span>
<span class="kn">from</span> <span class="nn">pyngrok</span> <span class="kn">import</span> <span class="n">ngrok</span>
<span class="err">!</span><span class="n">ngrok</span> <span class="n">authtoken</span> <span class="o">&lt;</span><span class="n">redacted</span><span class="o">&gt;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>  Building wheel for pyngrok (setup.py) ... done
Authtoken saved to configuration file: /root/.ngrok2/ngrok.yml
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">ngrok</span><span class="o">.</span><span class="n">kill</span><span class="p">()</span>
<span class="n">public_url</span> <span class="o">=</span> <span class="n">ngrok</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="s1">&#39;5000&#39;</span><span class="p">);</span> <span class="n">public_url</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;http://c1b4cabd8e5b.ngrok.io&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">python</span> <span class="n">src</span><span class="o">/</span><span class="n">app</span><span class="o">.</span><span class="n">py</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2020-09-16 16:05:27.961051: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudart.so.10.1
2020-09-16 16:05:30,365 loading file /content/p28118/models/final-model.pt
---Encoder--- 1.430511474609375e-06 seconds ---
 * Serving Flask app &#34;app&#34; (lazy loading)
 * Environment: production
<span class="ansi-red-fg">   WARNING: This is a development server. Do not use it in a production deployment.</span>
   Use a production WSGI server instead.
 * Debug mode: on
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
 * Restarting with stat
2020-09-16 16:05:35.186608: I tensorflow/stream_executor/platform/default/dso_loader.cc:48] Successfully opened dynamic library libcudart.so.10.1
2020-09-16 16:05:37,169 loading file /content/p28118/models/final-model.pt
---Encoder--- 1.1920928955078125e-06 seconds ---
 * Debugger is active!
 * Debugger PIN: 210-465-697
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Pipeline">Pipeline<a class="anchor-link" href="#Pipeline"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">probablepeople</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">usaddress</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="n">tqdm</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span>

<span class="kn">import</span>  <span class="nn">probablepeople</span> <span class="k">as</span> <span class="nn">pp</span>
<span class="kn">import</span> <span class="nn">usaddress</span> <span class="k">as</span> <span class="nn">ua</span>

<span class="kn">import</span> <span class="nn">shutil</span>
<span class="c1"># shutil.make_archive(os.path.join(path,&#39;customNER&#39;),&#39;zip&#39;,&#39;/content/customNER&#39;)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">unpack_archive</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;customNER.zip&#39;</span><span class="p">),</span> <span class="s1">&#39;/content/customNER&#39;</span><span class="p">,</span> <span class="s1">&#39;zip&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;sample.p&#39;</span><span class="p">))</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">oor</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">110</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 1000 entries, 3605089 to 2516200
Data columns (total 2 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   _id     1000 non-null   object
 1   oor     1000 non-null   object
dtypes: object(2)
memory usage: 23.4+ KB
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">spacy</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;/content/customNER&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">text1</span> <span class="o">=</span> <span class="s1">&#39;&lt;redacted&gt;&#39;</span>

<span class="k">def</span> <span class="nf">name_parsing</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">textdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">textdf</span><span class="p">[</span><span class="s1">&#39;NameType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">textdf</span><span class="p">[</span><span class="s1">&#39;NameConfidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Tag&#39;</span>
    <span class="n">textdf</span> <span class="o">=</span> <span class="n">textdf</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="n">textdf</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">textdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">textdf</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)})</span><span class="o">.</span><span class="n">T</span>
    <span class="n">textdf</span><span class="p">[</span><span class="s1">&#39;NameType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Ambiguous&#39;</span>
    <span class="n">textdf</span><span class="p">[</span><span class="s1">&#39;NameConfidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Parse&#39;</span>
    <span class="n">textdf</span> <span class="o">=</span> <span class="n">textdf</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">textdf</span>

<span class="n">name_parsing</span><span class="p">(</span><span class="n">text3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
  <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;UNITED STATES OF AMERICA&#39;</span><span class="p">,</span><span class="s1">&#39;US&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">text</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">text1</span> <span class="o">=</span> <span class="s1">&#39;&lt;redacted&gt;&#39;</span>

<span class="k">def</span> <span class="nf">address_parsing</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">preprocess</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">ua</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">textdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">textdf</span><span class="p">[</span><span class="s1">&#39;AddressType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">textdf</span><span class="p">[</span><span class="s1">&#39;AddrConfidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Tag&#39;</span>
    <span class="n">textdf</span> <span class="o">=</span> <span class="n">textdf</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="n">textdf</span> <span class="o">=</span> <span class="n">ua</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">textdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">textdf</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)})</span><span class="o">.</span><span class="n">T</span>
    <span class="n">textdf</span><span class="p">[</span><span class="s1">&#39;AddressType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Ambiguous&#39;</span>
    <span class="n">textdf</span><span class="p">[</span><span class="s1">&#39;AddrConfidence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Parse&#39;</span>
    <span class="n">textdf</span> <span class="o">=</span> <span class="n">textdf</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">textdf</span>

<span class="n">xx</span> <span class="o">=</span> <span class="n">address_parsing</span><span class="p">(</span><span class="n">text2</span><span class="p">);</span> <span class="n">xx</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;USPSBoxType&#39;,
 &#39;USPSBoxID&#39;,
 &#39;PlaceName&#39;,
 &#39;StateName&#39;,
 &#39;ZipCode&#39;,
 &#39;ZipPlus4&#39;,
 &#39;CountryName&#39;,
 &#39;AddressType&#39;,
 &#39;AddrConfidence&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">text1</span> <span class="o">=</span> <span class="s1">&#39;&lt;redacted&gt;&#39;</span>

<span class="k">def</span> <span class="nf">full_parsing</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">doc</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">ners</span> <span class="o">=</span> <span class="p">{</span><span class="n">ent</span><span class="o">.</span><span class="n">label_</span><span class="p">:</span><span class="n">ent</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">ents</span><span class="p">}</span>
  <span class="n">name</span> <span class="o">=</span> <span class="n">address</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">address_parsing</span><span class="p">(</span><span class="n">ners</span><span class="p">[</span><span class="s1">&#39;Address&#39;</span><span class="p">])</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name_parsing</span><span class="p">(</span><span class="n">ners</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">])</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
  <span class="n">address</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">address</span><span class="p">[</span><span class="s1">&#39;Recipient&#39;</span><span class="p">]</span>
  <span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
  <span class="k">if</span> <span class="s1">&#39;And&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">address</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="n">xx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Household&#39;</span><span class="p">:</span><span class="n">xz</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">xx</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Household&#39;</span>
  <span class="k">return</span> <span class="n">address</span>

<span class="n">xx</span> <span class="o">=</span> <span class="n">full_parsing</span><span class="p">(</span><span class="n">text2</span><span class="p">);</span> <span class="n">xx</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">tags</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">LABELS</span>
<span class="n">tags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ua</span><span class="o">.</span><span class="n">LABELS</span><span class="p">)</span>
<span class="n">tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">))</span>
<span class="n">additionals</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Text&#39;</span><span class="p">,</span> <span class="s1">&#39;AddressType&#39;</span><span class="p">,</span><span class="s1">&#39;AddrConfidence&#39;</span><span class="p">,</span><span class="s1">&#39;NameType&#39;</span><span class="p">,</span><span class="s1">&#39;NameConfidence&#39;</span><span class="p">]</span>
<span class="n">tags</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">additionals</span><span class="p">)</span>
<span class="n">dfx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
<span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="o">~</span><span class="n">dfx</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
  <span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_parsing</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
  <span class="n">dfx</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;Text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">sorted_collist</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">index</span>
<span class="n">dfx</span> <span class="o">=</span> <span class="n">dfx</span><span class="p">[</span><span class="n">sorted_collist</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dfx</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1000 entries, 0 to 999
Data columns (total 61 columns):
 #   Column                             Non-Null Count  Dtype 
---  ------                             --------------  ----- 
 0   Text                               1000 non-null   object
 1   NameConfidence                     994 non-null    object
 2   NameType                           994 non-null    object
 3   AddrConfidence                     989 non-null    object
 4   AddressType                        989 non-null    object
 5   PlaceName                          967 non-null    object
 6   StateName                          967 non-null    object
 7   AddressNumber                      933 non-null    object
 8   StreetName                         926 non-null    object
 9   StreetNamePostType                 864 non-null    object
 10  ZipCode                            857 non-null    object
 11  GivenName                          627 non-null    object
 12  Surname                            589 non-null    object
 13  CorporationName                    388 non-null    object
 14  MiddleInitial                      286 non-null    object
 15  And                                208 non-null    object
 16  SecondGivenName                    181 non-null    object
 17  CountryName                        157 non-null    object
 18  CorporationLegalType               109 non-null    object
 19  StreetNamePreDirectional           87 non-null     object
 20  OccupancyIdentifier                83 non-null     object
 21  ZipPlus4                           80 non-null     object
 22  OccupancyType                      71 non-null     object
 23  SecondMiddleInitial                63 non-null     object
 24  MiddleName                         59 non-null     object
 25  USPSBoxType                        57 non-null     object
 26  USPSBoxID                          57 non-null     object
 27  CorporationNameOrganization        56 non-null     object
 28  SecondSurname                      25 non-null     object
 29  StreetNamePreType                  24 non-null     object
 30  SuffixGenerational                 22 non-null     object
 31  StreetNamePostDirectional          15 non-null     object
 32  PrefixOther                        13 non-null     object
 33  Recipient                          9 non-null      object
 34  CorporationNameBranchIdentifier    8 non-null      object
 35  CorporationNameAndCompany          5 non-null      object
 36  SuffixOther                        4 non-null      object
 37  BuildingName                       4 non-null      object
 38  SubaddressIdentifier               4 non-null      object
 39  SecondMiddleName                   3 non-null      object
 40  SubaddressType                     3 non-null      object
 41  Nickname                           2 non-null      object
 42  CorporationNameBranchType          2 non-null      object
 43  FirstInitial                       1 non-null      object
 44  ShortForm                          1 non-null      object
 45  SecondCorporationNameOrganization  1 non-null      object
 46  AddressNumberSuffix                1 non-null      object
 47  SecondCorporationName              1 non-null      object
 48  CorporationCommitteeType           1 non-null      object
 49  USPSBoxGroupType                   0 non-null      object
 50  IntersectionSeparator              0 non-null      object
 51  LastInitial                        0 non-null      object
 52  AKA                                0 non-null      object
 53  LandmarkName                       0 non-null      object
 54  StreetNamePreModifier              0 non-null      object
 55  AddressNumberPrefix                0 non-null      object
 56  CornerOf                           0 non-null      object
 57  USPSBoxGroupID                     0 non-null      object
 58  ProxyFor                           0 non-null      object
 59  PrefixMarital                      0 non-null      object
 60  NotAddress                         0 non-null      object
dtypes: object(61)
memory usage: 476.7+ KB
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dfx0</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="nb">print</span><span class="p">(</span><span class="n">dfx0</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
<span class="n">dfx1</span> <span class="o">=</span> <span class="n">dfx</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">dfx1</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1000 entries, 0 to 999
Data columns (total 61 columns):
 #   Column                             Non-Null Count  Dtype 
---  ------                             --------------  ----- 
 0   Text                               1000 non-null   object
 1   NameConfidence                     994 non-null    object
 2   NameType                           994 non-null    object
 3   AddrConfidence                     989 non-null    object
 4   AddressType                        989 non-null    object
 5   PlaceName                          967 non-null    object
 6   StateName                          967 non-null    object
 7   AddressNumber                      933 non-null    object
 8   StreetName                         926 non-null    object
 9   StreetNamePostType                 864 non-null    object
 10  ZipCode                            857 non-null    object
 11  GivenName                          627 non-null    object
 12  Surname                            589 non-null    object
 13  CorporationName                    388 non-null    object
 14  MiddleInitial                      286 non-null    object
 15  And                                208 non-null    object
 16  SecondGivenName                    181 non-null    object
 17  CountryName                        157 non-null    object
 18  CorporationLegalType               109 non-null    object
 19  StreetNamePreDirectional           87 non-null     object
 20  OccupancyIdentifier                83 non-null     object
 21  ZipPlus4                           80 non-null     object
 22  OccupancyType                      71 non-null     object
 23  SecondMiddleInitial                63 non-null     object
 24  MiddleName                         59 non-null     object
 25  USPSBoxType                        57 non-null     object
 26  USPSBoxID                          57 non-null     object
 27  CorporationNameOrganization        56 non-null     object
 28  SecondSurname                      25 non-null     object
 29  StreetNamePreType                  24 non-null     object
 30  SuffixGenerational                 22 non-null     object
 31  StreetNamePostDirectional          15 non-null     object
 32  PrefixOther                        13 non-null     object
 33  Recipient                          9 non-null      object
 34  CorporationNameBranchIdentifier    8 non-null      object
 35  CorporationNameAndCompany          5 non-null      object
 36  SuffixOther                        4 non-null      object
 37  BuildingName                       4 non-null      object
 38  SubaddressIdentifier               4 non-null      object
 39  SecondMiddleName                   3 non-null      object
 40  SubaddressType                     3 non-null      object
 41  Nickname                           2 non-null      object
 42  CorporationNameBranchType          2 non-null      object
 43  FirstInitial                       1 non-null      object
 44  ShortForm                          1 non-null      object
 45  SecondCorporationNameOrganization  1 non-null      object
 46  AddressNumberSuffix                1 non-null      object
 47  SecondCorporationName              1 non-null      object
 48  CorporationCommitteeType           1 non-null      object
 49  USPSBoxGroupType                   0 non-null      object
 50  IntersectionSeparator              0 non-null      object
 51  LastInitial                        0 non-null      object
 52  AKA                                0 non-null      object
 53  LandmarkName                       0 non-null      object
 54  StreetNamePreModifier              0 non-null      object
 55  AddressNumberPrefix                0 non-null      object
 56  CornerOf                           0 non-null      object
 57  USPSBoxGroupID                     0 non-null      object
 58  ProxyFor                           0 non-null      object
 59  PrefixMarital                      0 non-null      object
 60  NotAddress                         0 non-null      object
dtypes: object(61)
memory usage: 476.7+ KB
None
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1000 entries, 0 to 999
Data columns (total 49 columns):
 #   Column                             Non-Null Count  Dtype 
---  ------                             --------------  ----- 
 0   Text                               1000 non-null   object
 1   NameConfidence                     994 non-null    object
 2   NameType                           994 non-null    object
 3   AddrConfidence                     989 non-null    object
 4   AddressType                        989 non-null    object
 5   PlaceName                          967 non-null    object
 6   StateName                          967 non-null    object
 7   AddressNumber                      933 non-null    object
 8   StreetName                         926 non-null    object
 9   StreetNamePostType                 864 non-null    object
 10  ZipCode                            857 non-null    object
 11  GivenName                          627 non-null    object
 12  Surname                            589 non-null    object
 13  CorporationName                    388 non-null    object
 14  MiddleInitial                      286 non-null    object
 15  And                                208 non-null    object
 16  SecondGivenName                    181 non-null    object
 17  CountryName                        157 non-null    object
 18  CorporationLegalType               109 non-null    object
 19  StreetNamePreDirectional           87 non-null     object
 20  OccupancyIdentifier                83 non-null     object
 21  ZipPlus4                           80 non-null     object
 22  OccupancyType                      71 non-null     object
 23  SecondMiddleInitial                63 non-null     object
 24  MiddleName                         59 non-null     object
 25  USPSBoxType                        57 non-null     object
 26  USPSBoxID                          57 non-null     object
 27  CorporationNameOrganization        56 non-null     object
 28  SecondSurname                      25 non-null     object
 29  StreetNamePreType                  24 non-null     object
 30  SuffixGenerational                 22 non-null     object
 31  StreetNamePostDirectional          15 non-null     object
 32  PrefixOther                        13 non-null     object
 33  Recipient                          9 non-null      object
 34  CorporationNameBranchIdentifier    8 non-null      object
 35  CorporationNameAndCompany          5 non-null      object
 36  SuffixOther                        4 non-null      object
 37  BuildingName                       4 non-null      object
 38  SubaddressIdentifier               4 non-null      object
 39  SecondMiddleName                   3 non-null      object
 40  SubaddressType                     3 non-null      object
 41  Nickname                           2 non-null      object
 42  CorporationNameBranchType          2 non-null      object
 43  FirstInitial                       1 non-null      object
 44  ShortForm                          1 non-null      object
 45  SecondCorporationNameOrganization  1 non-null      object
 46  AddressNumberSuffix                1 non-null      object
 47  SecondCorporationName              1 non-null      object
 48  CorporationCommitteeType           1 non-null      object
dtypes: object(49)
memory usage: 382.9+ KB
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dfx1</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;dfx1.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="n">output</span> <span class="o">=</span> <span class="n">full_parsing</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
  <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

<span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;&lt;redacted&gt;&#39;</span>
<span class="n">func</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">gradio</span>
<span class="kn">import</span> <span class="nn">gradio</span> <span class="k">as</span> <span class="nn">gr</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">gr</span><span class="o">.</span><span class="n">Interface</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">launch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

</div>



  </div><a class="u-url" href="/2022/01/01/name-address-parsing.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Jupyter notebook database.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/recohut" target="_blank" title="recohut"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
