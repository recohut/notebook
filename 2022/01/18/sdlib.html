<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Shilling simulated attacks and detection methods | reconb</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Shilling simulated attacks and detection methods" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Jupyter notebook database." />
<meta property="og:description" content="Jupyter notebook database." />
<link rel="canonical" href="https://nb.recohut.com/2022/01/18/sdlib.html" />
<meta property="og:url" content="https://nb.recohut.com/2022/01/18/sdlib.html" />
<meta property="og:site_name" content="reconb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-18T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Shilling simulated attacks and detection methods" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-18T00:00:00-06:00","datePublished":"2022-01-18T00:00:00-06:00","description":"Jupyter notebook database.","headline":"Shilling simulated attacks and detection methods","mainEntityOfPage":{"@type":"WebPage","@id":"https://nb.recohut.com/2022/01/18/sdlib.html"},"url":"https://nb.recohut.com/2022/01/18/sdlib.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nb.recohut.com/feed.xml" title="reconb" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">reconb</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Shilling simulated attacks and detection methods</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-01-18T00:00:00-06:00" itemprop="datePublished">
        Jan 18, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      53 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/recohut/notebook/tree/master/_notebooks/2022-01-18-sdlib.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/recohut/notebook/master?filepath=_notebooks%2F2022-01-18-sdlib.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/recohut/notebook/blob/master/_notebooks/2022-01-18-sdlib.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Frecohut%2Fnotebook%2Fblob%2Fmaster%2F_notebooks%2F2022-01-18-sdlib.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-01-18-sdlib.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup">Setup<a class="anchor-link" href="#Setup"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="n">results</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Imports">Imports<a class="anchor-link" href="#Imports"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">abspath</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">makedirs</span><span class="p">,</span><span class="n">remove</span>
<span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="nb">compile</span><span class="p">,</span><span class="n">findall</span><span class="p">,</span><span class="n">split</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">pairwise_distances</span><span class="p">,</span><span class="n">cosine_similarity</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy.stats.stats</span> <span class="kn">import</span> <span class="n">pearsonr</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span><span class="n">exp</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">split</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span><span class="n">Manager</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">strftime</span><span class="p">,</span><span class="n">localtime</span><span class="p">,</span><span class="n">time</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">abspath</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">strftime</span><span class="p">,</span><span class="n">localtime</span><span class="p">,</span><span class="n">time</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">import</span> <span class="nn">time</span> <span class="k">as</span> <span class="nn">tm</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span><span class="p">,</span><span class="n">exp</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span><span class="p">,</span><span class="n">exp</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">csr_matrix</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data">Data<a class="anchor-link" href="#Data"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="n">dataset</span><span class="o">/</span><span class="n">amazon</span>
<span class="err">!</span><span class="n">cd</span> <span class="n">dataset</span><span class="o">/</span><span class="n">amazon</span> <span class="o">&amp;&amp;</span> <span class="n">wget</span> <span class="o">-</span><span class="n">q</span> <span class="o">--</span><span class="n">show</span><span class="o">-</span><span class="n">progress</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Coder</span><span class="o">-</span><span class="n">Yu</span><span class="o">/</span><span class="n">SDLib</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">dataset</span><span class="o">/</span><span class="n">amazon</span><span class="o">/</span><span class="n">profiles</span><span class="o">.</span><span class="n">txt</span>
<span class="err">!</span><span class="n">cd</span> <span class="n">dataset</span><span class="o">/</span><span class="n">amazon</span> <span class="o">&amp;&amp;</span> <span class="n">wget</span> <span class="o">-</span><span class="n">q</span> <span class="o">--</span><span class="n">show</span><span class="o">-</span><span class="n">progress</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Coder</span><span class="o">-</span><span class="n">Yu</span><span class="o">/</span><span class="n">SDLib</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">dataset</span><span class="o">/</span><span class="n">amazon</span><span class="o">/</span><span class="n">labels</span><span class="o">.</span><span class="n">txt</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>profiles.txt.2      100%[===================&gt;]   1.46M  --.-KB/s    in 0.01s   
labels.txt.2        100%[===================&gt;]  82.62K  --.-KB/s    in 0.002s  
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="n">dataset</span><span class="o">/</span><span class="n">averageattack</span>
<span class="err">!</span><span class="n">cd</span> <span class="n">dataset</span><span class="o">/</span><span class="n">averageattack</span> <span class="o">&amp;&amp;</span> <span class="n">wget</span> <span class="o">-</span><span class="n">q</span> <span class="o">--</span><span class="n">show</span><span class="o">-</span><span class="n">progress</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Coder</span><span class="o">-</span><span class="n">Yu</span><span class="o">/</span><span class="n">SDLib</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">dataset</span><span class="o">/</span><span class="n">averageattack</span><span class="o">/</span><span class="n">ratings</span><span class="o">.</span><span class="n">txt</span>
<span class="err">!</span><span class="n">cd</span> <span class="n">dataset</span><span class="o">/</span><span class="n">averageattack</span> <span class="o">&amp;&amp;</span> <span class="n">wget</span> <span class="o">-</span><span class="n">q</span> <span class="o">--</span><span class="n">show</span><span class="o">-</span><span class="n">progress</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Coder</span><span class="o">-</span><span class="n">Yu</span><span class="o">/</span><span class="n">SDLib</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">dataset</span><span class="o">/</span><span class="n">averageattack</span><span class="o">/</span><span class="n">labels</span><span class="o">.</span><span class="n">txt</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>ratings.txt         100%[===================&gt;] 531.60K  --.-KB/s    in 0.007s  
labels.txt          100%[===================&gt;]  10.25K  --.-KB/s    in 0s      
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="n">dataset</span><span class="o">/</span><span class="n">filmtrust</span>
<span class="err">!</span><span class="n">cd</span> <span class="n">dataset</span><span class="o">/</span><span class="n">filmtrust</span> <span class="o">&amp;&amp;</span> <span class="n">wget</span> <span class="o">-</span><span class="n">q</span> <span class="o">--</span><span class="n">show</span><span class="o">-</span><span class="n">progress</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Coder</span><span class="o">-</span><span class="n">Yu</span><span class="o">/</span><span class="n">SDLib</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">dataset</span><span class="o">/</span><span class="n">filmtrust</span><span class="o">/</span><span class="n">ratings</span><span class="o">.</span><span class="n">txt</span>
<span class="err">!</span><span class="n">cd</span> <span class="n">dataset</span><span class="o">/</span><span class="n">filmtrust</span> <span class="o">&amp;&amp;</span> <span class="n">wget</span> <span class="o">-</span><span class="n">q</span> <span class="o">--</span><span class="n">show</span><span class="o">-</span><span class="n">progress</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Coder</span><span class="o">-</span><span class="n">Yu</span><span class="o">/</span><span class="n">SDLib</span><span class="o">/</span><span class="n">raw</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">dataset</span><span class="o">/</span><span class="n">filmtrust</span><span class="o">/</span><span class="n">trust</span><span class="o">.</span><span class="n">txt</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>ratings.txt         100%[===================&gt;] 367.62K  --.-KB/s    in 0.006s  
trust.txt           100%[===================&gt;]  19.15K  --.-KB/s    in 0s      
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Config">Config<a class="anchor-link" href="#Config"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Configure-the-Detection-Method">Configure the Detection Method<a class="anchor-link" href="#Configure-the-Detection-Method"> </a></h3><div>
 <table class="table table-hover table-bordered">
  <tr>
    <th width="12%" scope="col"> Entry</th>
    <th width="16%" class="conf" scope="col">Example</th>
    <th width="72%" class="conf" scope="col">Description</th>
  </tr>
  <tr>
    <td>ratings</td>
    <td>dataset/averageattack/ratings.txt</td>
    <td>Set the path to the dirty recommendation dataset. Format: each row separated by empty, tab or comma symbol. </td>
  </tr>
 <tr>
    <td>label</td>
    <td>dataset/averageattack/labels.txt</td>
    <td>Set the path to labels (for users). Format: each row separated by empty, tab or comma symbol. </td>
  </tr>
  <tr>
    <td scope="row">ratings.setup</td>
    <td>-columns 0 1 2</td>
    <td>-columns: (user, item, rating) columns of rating data are used;
      -header: to skip the first head line when reading data<br />
    </td>
  </tr>

  <tr>
    <td scope="row">MethodName</td>
    <td>DegreeSAD/PCASelect/etc.</td>
    <td>The name of the detection method<br />
    </td>
  </tr>
  <tr>
    <td scope="row">evaluation.setup</td>
    <td>-testSet dataset/testset.txt</td>
    <td>Main option: -testSet, -ap, -cv <br />
      -testSet path/to/test/file   (need to specify the test set manually)<br />
      -ap ratio   (ap means that the user set (including items and ratings) are automatically partitioned into training set and test set, the number is the ratio of test set. e.g. -ap 0.2)<br />
      -cv k   (-cv means cross validation, k is the number of the fold. e.g. -cv 5)<br />
     </td>
  </tr>

  <tr>
    <td scope="row">output.setup</td>
    <td>on -dir Results/</td>
    <td>Main option: whether to output recommendation results<br />
      -dir path: the directory path of output results.
       </td>
  </tr>
  </table>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Configure-the-Shilling-Model">Configure the Shilling Model<a class="anchor-link" href="#Configure-the-Shilling-Model"> </a></h3><div>
 <table class="table table-hover table-bordered">

  <tr>
    <th width="12%" scope="col"> Entry</th>
    <th width="16%" class="conf" scope="col">Example</th>
    <th width="72%" class="conf" scope="col">Description</th>
  </tr>
   <tr>
    <td>ratings</td>
    <td>dataset/averageattack/ratings.txt</td>
    <td>Set the path to the recommendation dataset. Format: each row separated by empty, tab or comma symbol. </td>
  </tr>
  <tr>
    <td scope="row">ratings.setup</td>
    <td>-columns 0 1 2</td>
    <td>-columns: (user, item, rating) columns of rating data are used;
      -header: to skip the first head line when reading data<br />
    </td>
  </tr>
  <tr>
    <td>attackSize</td>
    <td>0.01</td>
    <td>The ratio of the injected spammers to genuine users</td>
  </tr>
 <tr>
    <td>fillerSize</td>
    <td>0.01</td>
    <td>The ratio of the filler items to all items </td>
  </tr>
 <tr>
    <td>selectedSize</td>
    <td>0.001</td>
    <td>The ratio of the selected items to all items </td>
 </tr>
  <tr>
    <td>linkSize</td>
    <td>0.01</td>
    <td>The ratio of the users maliciously linked by a spammer to all user </td>
 </tr>
   <tr>
    <td>targetCount</td>
    <td>20</td>
    <td>The count of the targeted items </td>
  </tr>

   <tr>
    <td>targetScore</td>
    <td>5.0</td>
    <td>The score given to the target items</td>
  </tr>
  <tr>
    <td>threshold</td>
    <td>3.0</td>
    <td>Item has an average score lower than threshold may be chosen as one of the target items</td>
  </tr>

  <tr>
    <td>minCount</td>
    <td>3</td>
    <td>Item has a ratings count larger than minCount may be chosen as one of the target items</td>
  </tr>

  <tr>
    <td>maxCount</td>
    <td>50</td>
    <td>Item has a rating count smaller that maxCount may be chosen as one of the target items</td>
  </tr>

  <tr>
    <td scope="row">outputDir</td>
    <td>data/</td>
    <td> User profiles and labels will be output here     </td>
  </tr>
  </table>
</div>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">BayesDetector</span><span class="o">.</span><span class="n">conf</span>
<span class="n">ratings</span><span class="o">=</span><span class="n">dataset</span><span class="o">/</span><span class="n">amazon</span><span class="o">/</span><span class="n">profiles</span><span class="o">.</span><span class="n">txt</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">setup</span><span class="o">=-</span><span class="n">columns</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="n">label</span><span class="o">=</span><span class="n">dataset</span><span class="o">/</span><span class="n">amazon</span><span class="o">/</span><span class="n">labels</span><span class="o">.</span><span class="n">txt</span>
<span class="n">methodName</span><span class="o">=</span><span class="n">BayesDetector</span>
<span class="n">evaluation</span><span class="o">.</span><span class="n">setup</span><span class="o">=-</span><span class="n">cv</span> <span class="mi">5</span>
<span class="n">item</span><span class="o">.</span><span class="n">ranking</span><span class="o">=</span><span class="n">off</span> <span class="o">-</span><span class="n">topN</span> <span class="mi">50</span>
<span class="n">num</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">iter</span><span class="o">=</span><span class="mi">100</span>
<span class="n">learnRate</span><span class="o">=-</span><span class="n">init</span> <span class="mf">0.03</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.1</span>
<span class="n">reg</span><span class="o">.</span><span class="k">lambda</span><span class="o">=-</span><span class="n">u</span> <span class="mf">0.3</span> <span class="o">-</span><span class="n">i</span> <span class="mf">0.3</span>
<span class="n">BayesDetector</span><span class="o">=-</span><span class="n">k</span> <span class="mi">10</span> <span class="o">-</span><span class="n">negCount</span> <span class="mi">256</span> <span class="o">-</span><span class="n">gamma</span> <span class="mi">1</span> <span class="o">-</span><span class="nb">filter</span> <span class="mi">4</span> <span class="o">-</span><span class="n">delta</span> <span class="mf">0.01</span>
<span class="n">output</span><span class="o">.</span><span class="n">setup</span><span class="o">=</span><span class="n">on</span> <span class="o">-</span><span class="nb">dir</span> <span class="n">results</span><span class="o">/</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing BayesDetector.conf
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">CoDetector</span><span class="o">.</span><span class="n">conf</span>
<span class="n">ratings</span><span class="o">=</span><span class="n">dataset</span><span class="o">/</span><span class="n">amazon</span><span class="o">/</span><span class="n">profiles</span><span class="o">.</span><span class="n">txt</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">setup</span><span class="o">=-</span><span class="n">columns</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="n">label</span><span class="o">=</span><span class="n">dataset</span><span class="o">/</span><span class="n">amazon</span><span class="o">/</span><span class="n">labels</span><span class="o">.</span><span class="n">txt</span>
<span class="n">methodName</span><span class="o">=</span><span class="n">CoDetector</span>
<span class="n">evaluation</span><span class="o">.</span><span class="n">setup</span><span class="o">=-</span><span class="n">ap</span> <span class="mf">0.3</span>
<span class="n">item</span><span class="o">.</span><span class="n">ranking</span><span class="o">=</span><span class="n">on</span> <span class="o">-</span><span class="n">topN</span> <span class="mi">50</span>
<span class="n">num</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">iter</span><span class="o">=</span><span class="mi">200</span>
<span class="n">learnRate</span><span class="o">=-</span><span class="n">init</span> <span class="mf">0.01</span> <span class="o">-</span><span class="nb">max</span> <span class="mf">0.01</span>
<span class="n">reg</span><span class="o">.</span><span class="k">lambda</span><span class="o">=-</span><span class="n">u</span> <span class="mf">0.8</span> <span class="o">-</span><span class="n">i</span> <span class="mf">0.4</span>
<span class="n">CoDetector</span><span class="o">=-</span><span class="n">k</span> <span class="mi">10</span> <span class="o">-</span><span class="n">negCount</span> <span class="mi">256</span> <span class="o">-</span><span class="n">gamma</span> <span class="mi">1</span> <span class="o">-</span><span class="nb">filter</span> <span class="mi">4</span>
<span class="n">output</span><span class="o">.</span><span class="n">setup</span><span class="o">=</span><span class="n">on</span> <span class="o">-</span><span class="nb">dir</span> <span class="n">results</span><span class="o">/</span><span class="n">amazon</span><span class="o">/</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing CoDetector.conf
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">DegreeSAD</span><span class="o">.</span><span class="n">conf</span>
<span class="n">ratings</span><span class="o">=</span><span class="n">dataset</span><span class="o">/</span><span class="n">amazon</span><span class="o">/</span><span class="n">profiles</span><span class="o">.</span><span class="n">txt</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">setup</span><span class="o">=-</span><span class="n">columns</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="n">label</span><span class="o">=</span><span class="n">dataset</span><span class="o">/</span><span class="n">amazon</span><span class="o">/</span><span class="n">labels</span><span class="o">.</span><span class="n">txt</span>
<span class="n">methodName</span><span class="o">=</span><span class="n">DegreeSAD</span>
<span class="n">evaluation</span><span class="o">.</span><span class="n">setup</span><span class="o">=-</span><span class="n">cv</span> <span class="mi">5</span>
<span class="n">output</span><span class="o">.</span><span class="n">setup</span><span class="o">=</span><span class="n">on</span> <span class="o">-</span><span class="nb">dir</span> <span class="n">results</span><span class="o">/</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting DegreeSAD.conf
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">FAP</span><span class="o">.</span><span class="n">conf</span>
<span class="n">ratings</span><span class="o">=</span><span class="n">dataset</span><span class="o">/</span><span class="n">averageattack</span><span class="o">/</span><span class="n">ratings</span><span class="o">.</span><span class="n">txt</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">setup</span><span class="o">=-</span><span class="n">columns</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="n">label</span><span class="o">=</span><span class="n">dataset</span><span class="o">/</span><span class="n">averageattack</span><span class="o">/</span><span class="n">labels</span><span class="o">.</span><span class="n">txt</span>
<span class="n">methodName</span><span class="o">=</span><span class="n">FAP</span>
<span class="n">evaluation</span><span class="o">.</span><span class="n">setup</span><span class="o">=-</span><span class="n">ap</span> <span class="mf">0.000001</span>
<span class="n">seedUser</span><span class="o">=</span><span class="mi">350</span>
<span class="n">topKSpam</span><span class="o">=</span><span class="mi">1557</span>
<span class="n">output</span><span class="o">.</span><span class="n">setup</span><span class="o">=</span><span class="n">on</span> <span class="o">-</span><span class="nb">dir</span> <span class="n">results</span><span class="o">/</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing FAP.conf
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">PCASelectUsers</span><span class="o">.</span><span class="n">conf</span>
<span class="n">ratings</span><span class="o">=</span><span class="n">dataset</span><span class="o">/</span><span class="n">averageattack</span><span class="o">/</span><span class="n">ratings</span><span class="o">.</span><span class="n">txt</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">setup</span><span class="o">=-</span><span class="n">columns</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="n">label</span><span class="o">=</span><span class="n">dataset</span><span class="o">/</span><span class="n">averageattack</span><span class="o">/</span><span class="n">labels</span><span class="o">.</span><span class="n">txt</span>
<span class="n">methodName</span><span class="o">=</span><span class="n">PCASelectUsers</span>
<span class="n">evaluation</span><span class="o">.</span><span class="n">setup</span><span class="o">=-</span><span class="n">ap</span> <span class="mf">0.00001</span>
<span class="n">kVals</span><span class="o">=</span><span class="mi">3</span>
<span class="n">attackSize</span><span class="o">=</span><span class="mf">0.1</span>
<span class="n">output</span><span class="o">.</span><span class="n">setup</span><span class="o">=</span><span class="n">on</span> <span class="o">-</span><span class="nb">dir</span> <span class="n">results</span><span class="o">/</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing PCASelectUsers.conf
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">SemiSAD</span><span class="o">.</span><span class="n">conf</span>
<span class="n">ratings</span><span class="o">=</span><span class="n">dataset</span><span class="o">/</span><span class="n">averageattack</span><span class="o">/</span><span class="n">ratings</span><span class="o">.</span><span class="n">txt</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">setup</span><span class="o">=-</span><span class="n">columns</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="n">label</span><span class="o">=</span><span class="n">dataset</span><span class="o">/</span><span class="n">averageattack</span><span class="o">/</span><span class="n">labels</span><span class="o">.</span><span class="n">txt</span>
<span class="n">methodName</span><span class="o">=</span><span class="n">SemiSAD</span>
<span class="n">evaluation</span><span class="o">.</span><span class="n">setup</span><span class="o">=-</span><span class="n">ap</span> <span class="mf">0.2</span>
<span class="n">Lambda</span><span class="o">=</span><span class="mf">0.5</span>
<span class="n">topK</span><span class="o">=</span><span class="mi">28</span>
<span class="n">output</span><span class="o">.</span><span class="n">setup</span><span class="o">=</span><span class="n">on</span> <span class="o">-</span><span class="nb">dir</span> <span class="n">results</span><span class="o">/</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Writing SemiSAD.conf
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Baseclass">Baseclass<a class="anchor-link" href="#Baseclass"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">SDetection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conf</span><span class="p">,</span><span class="n">trainingSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">testSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fold</span><span class="o">=</span><span class="s1">&#39;[1]&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">conf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isSave</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isLoad</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foldInfo</span> <span class="o">=</span> <span class="n">fold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dao</span> <span class="o">=</span> <span class="n">RatingDAO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">trainingSet</span><span class="p">,</span> <span class="n">testSet</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trainingLabels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testLabels</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">readConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;methodName&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">LineConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;output.setup&#39;</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">printAlgorConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;show algorithm&#39;s configuration&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Algorithm:&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;methodName&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ratings dataSet:&#39;</span><span class="p">,</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ratings&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">LineConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;evaluation.setup&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;-testSet&#39;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test set:&#39;</span><span class="p">,</span><span class="n">abspath</span><span class="p">(</span><span class="n">LineConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;evaluation.setup&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">getOption</span><span class="p">(</span><span class="s1">&#39;-testSet&#39;</span><span class="p">)))</span>
        <span class="c1">#print &#39;Count of the users in training set: &#39;,len()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training set size: (user count: </span><span class="si">%d</span><span class="s1">, item count </span><span class="si">%d</span><span class="s1">, record count: </span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSize</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test set size: (user count: </span><span class="si">%d</span><span class="s1">, item count </span><span class="si">%d</span><span class="s1">, record count: </span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSize</span><span class="p">()))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">buildModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">saveModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">loadModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readConfiguration</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">foldInfo</span> <span class="o">==</span> <span class="s1">&#39;[1]&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printAlgorConfig</span><span class="p">()</span>
        <span class="c1"># load model from disk or build model</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLoad</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading model </span><span class="si">%s</span><span class="s1">...&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foldInfo</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadModel</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initializing model </span><span class="si">%s</span><span class="s1">...&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foldInfo</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initModel</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Building Model </span><span class="si">%s</span><span class="s1">...&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foldInfo</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buildModel</span><span class="p">()</span>

        <span class="c1"># preict the ratings or item ranking</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Predicting </span><span class="si">%s</span><span class="s1">...&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foldInfo</span><span class="p">))</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">classification_report</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testLabels</span><span class="p">,</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">currentTime</span> <span class="o">=</span> <span class="n">currentTime</span> <span class="o">=</span> <span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H-%M-%S&quot;</span><span class="p">,</span> <span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="p">()))</span>
        <span class="n">FileIO</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="s1">&#39;-dir&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">algorName</span><span class="o">+</span><span class="s1">&#39;@&#39;</span><span class="o">+</span><span class="n">currentTime</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">foldInfo</span><span class="p">,</span><span class="n">report</span><span class="p">)</span>
        <span class="c1"># save model</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSave</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving model </span><span class="si">%s</span><span class="s1">...&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foldInfo</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveModel</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">report</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">SSDetection</span><span class="p">(</span><span class="n">SDetection</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conf</span><span class="p">,</span><span class="n">trainingSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">testSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">relation</span><span class="o">=</span><span class="nb">list</span><span class="p">(),</span><span class="n">fold</span><span class="o">=</span><span class="s1">&#39;[1]&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SSDetection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="n">trainingSet</span><span class="p">,</span><span class="n">testSet</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">fold</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sao</span> <span class="o">=</span> <span class="n">SocialDAO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">relation</span><span class="p">)</span>  <span class="c1"># social relations access control</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Utils">Utils<a class="anchor-link" href="#Utils"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fileName</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">readConfiguration</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;parameter &#39;</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s1">&#39; is invalid!&#39;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">getOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;parameter &#39;</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s1">&#39; is invalid!&#39;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>

    <span class="k">def</span> <span class="nf">readConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fileName</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">abspath</span><span class="p">(</span><span class="n">fileName</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;config file is not found!&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">IOError</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;config file is not in the correct format! Error Line:</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">LineConfig</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">content</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainOption</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;on&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainOption</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;off&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mainOption</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">))</span> <span class="ow">and</span>  <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">sub</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="n">ind</span><span class="p">:]):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sub</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">))</span> <span class="ow">and</span>  <span class="ow">not</span> <span class="n">sub</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                        <span class="n">ind</span> <span class="o">=</span> <span class="n">j</span>
                        <span class="k">break</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="n">ind</span><span class="p">:])</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ind</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span>
                        <span class="k">break</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>


    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;parameter &#39;</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s1">&#39; is invalid!&#39;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">getOption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;parameter &#39;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39; is invalid!&#39;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">isMainOn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainOption</span>

    <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">FileIO</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">writeFile</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span><span class="n">file</span><span class="p">,</span><span class="n">content</span><span class="p">,</span><span class="n">op</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;str&#39;</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">dir</span> <span class="o">+</span> <span class="n">file</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">dir</span><span class="o">+</span><span class="n">file</span><span class="p">,</span><span class="n">op</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">deleteFile</span><span class="p">(</span><span class="n">filePath</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filePath</span><span class="p">):</span>
            <span class="n">remove</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">loadDataSet</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">bTest</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">trainingData</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="n">testData</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="n">ratingConfig</span> <span class="o">=</span> <span class="n">LineConfig</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;ratings.setup&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bTest</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;loading training data...&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;loading test data...&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">ratings</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="c1"># ignore the headline</span>
        <span class="k">if</span> <span class="n">ratingConfig</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;-header&#39;</span><span class="p">):</span>
            <span class="n">ratings</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1"># order of the columns</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">ratingConfig</span><span class="p">[</span><span class="s1">&#39;-columns&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">lineNo</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ratings</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="s1">&#39; |,|</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bTest</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The rating file is not in a correct format. Error: Line num </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">lineNo</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">userId</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">order</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
                <span class="n">itemId</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">order</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                <span class="k">if</span> <span class="n">bTest</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
                    <span class="n">rating</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#default value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rating</span>  <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">order</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>

            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error! Have you added the option -header to the rating.setup?&#39;</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bTest</span><span class="p">:</span>
                <span class="n">trainingData</span><span class="p">[</span><span class="n">userId</span><span class="p">][</span><span class="n">itemId</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">rating</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">testData</span><span class="p">[</span><span class="n">userId</span><span class="p">][</span><span class="n">itemId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rating</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bTest</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">trainingData</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">testData</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">loadRelationship</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">filePath</span><span class="p">):</span>
        <span class="n">socialConfig</span> <span class="o">=</span> <span class="n">LineConfig</span><span class="p">(</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;social.setup&#39;</span><span class="p">])</span>
        <span class="n">relation</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;loading social data...&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">relations</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="c1"># ignore the headline</span>
        <span class="k">if</span> <span class="n">socialConfig</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;-header&#39;</span><span class="p">):</span>
            <span class="n">relations</span> <span class="o">=</span> <span class="n">relations</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1"># order of the columns</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">socialConfig</span><span class="p">[</span><span class="s1">&#39;-columns&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The social file is not in a correct format.&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lineNo</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">relations</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="s1">&#39; |,|</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The social file is not in a correct format. Error: Line num </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">lineNo</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">userId1</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">order</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="n">userId2</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">order</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">order</span><span class="p">[</span><span class="mi">2</span><span class="p">])])</span>
            <span class="n">relation</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">userId1</span><span class="p">,</span> <span class="n">userId2</span><span class="p">,</span> <span class="n">weight</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">relation</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">loadLabels</span><span class="p">(</span><span class="n">filePath</span><span class="p">):</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">items</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="s1">&#39; |,|</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">labels</span><span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">labels</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">DataSplit</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">dataSplit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">test_ratio</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">test_ratio</span><span class="o">&gt;=</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">test_ratio</span> <span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">test_ratio</span> <span class="o">=</span> <span class="mf">0.3</span>
        <span class="n">testSet</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">trainingSet</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">test_ratio</span><span class="p">:</span>
                <span class="n">testSet</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">trainingSet</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">FileIO</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;testSet[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">order</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="n">testSet</span><span class="p">)</span>
            <span class="n">FileIO</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;trainingSet[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="n">trainingSet</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">trainingSet</span><span class="p">,</span><span class="n">testSet</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">crossValidation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">&lt;=</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">k</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">:</span>
            <span class="n">k</span><span class="o">=</span><span class="mi">3</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
            <span class="n">trainingSet</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">testSet</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">ind</span><span class="p">,</span><span class="n">user</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ind</span><span class="o">%</span><span class="n">k</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">testSet</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">trainingSet</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">yield</span> <span class="n">trainingSet</span><span class="p">,</span><span class="n">testSet</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">drawLine</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">xLabel</span><span class="p">,</span><span class="n">yLabel</span><span class="p">,</span><span class="n">title</span><span class="p">):</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1">#f.tight_layout()</span>
    <span class="c1">#sns.set(style=&quot;darkgrid&quot;)</span>

    <span class="n">palette</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span><span class="s1">&#39;pink&#39;</span><span class="p">]</span>
    <span class="c1"># for i in range(len(ax)):</span>
    <span class="c1">#     x1 = range(0, len(x))</span>
        <span class="c1">#ax.set_xlim(min(x1)-0.2,max(x1)+0.2)</span>
        <span class="c1"># mini = 10000;max = -10000</span>
        <span class="c1"># for label in labels:</span>
        <span class="c1">#     if mini&gt;min(y[i][label]):</span>
        <span class="c1">#         mini = min(y[i][label])</span>
        <span class="c1">#     if max&lt;max(y[i][label]):</span>
        <span class="c1">#         max = max(y[i][label])</span>
        <span class="c1"># ax[i].set_ylim(mini-0.25*(max-mini),max+0.25*(max-mini))</span>
        <span class="c1"># for j,label in enumerate(labels):</span>
        <span class="c1">#     if j%2==1:</span>
        <span class="c1">#         ax[i].plot(x1, y[i][label], color=palette[j/2], marker=&#39;.&#39;, label=label, markersize=12)</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         ax[i].plot(x1, y[i][label], color=palette[j/2], marker=&#39;.&#39;, label=label,markersize=12,linestyle=&#39;--&#39;)</span>
        <span class="c1"># ax[0].set_ylabel(yLabel,fontsize=20)</span>

    <span class="k">for</span> <span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">palette</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span><span class="n">ydata</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
    <span class="c1">#ax.set_xticklabels(x)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xLabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">yLabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="c1">#ax.tick_params(axs=&#39;y&#39;, labelsize=20)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>

    <span class="c1">#ax[i].legend(handles, labels1, loc=2, fontsize=20)</span>
    <span class="c1"># ax.legend(loc=2,</span>
    <span class="c1">#        ncol=6,  borderaxespad=0.,fontsize=20)</span>
    <span class="c1">#ax[2].legend(bbox_to_anchor=(1.05, 1), loc=2, borderaxespad=0.,fontsize=20)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SVD.txt&#39;</span><span class="p">,</span><span class="s1">&#39;PMF.txt&#39;</span><span class="p">,</span><span class="s1">&#39;EE.txt&#39;</span><span class="p">,</span><span class="s1">&#39;RDML.txt&#39;</span><span class="p">]</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EE[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;] iteration.txt&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">9</span><span class="p">)]</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">normalize</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">xdata</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">items</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">rmse</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">xdata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rmse</span><span class="p">))</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span>
    <span class="n">average</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="n">average</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">total</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;EE.txt&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">average</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">readData</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="n">xdata</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ydata</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">items</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">xdata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">rmse</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">ydata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rmse</span><span class="p">))</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xdata</span><span class="p">)</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ydata</span><span class="p">)</span>




<span class="c1"># x = [[1,2,3],[1,2,3]]</span>
<span class="c1"># y = [[1,2,3],[4,5,6]]</span>
<span class="c1">#normalize()</span>
<span class="n">readData</span><span class="p">()</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SVD&#39;</span><span class="p">,</span><span class="s1">&#39;PMF&#39;</span><span class="p">,</span><span class="s1">&#39;EE&#39;</span><span class="p">,</span><span class="s1">&#39;RDML&#39;</span><span class="p">,]</span>
<span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;Iteration&#39;</span>
<span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;RMSE&#39;</span>

<span class="n">drawLine</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">xlabel</span><span class="p">,</span><span class="n">ylabel</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">l1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">ord</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">l2</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">common</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">):</span>
    <span class="c1"># find common ratings</span>
    <span class="n">common</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">x2</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">new_x1</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="n">common</span><span class="p">]</span>
    <span class="n">new_x2</span> <span class="o">=</span> <span class="n">x2</span><span class="p">[</span><span class="n">common</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">new_x1</span><span class="p">,</span><span class="n">new_x2</span>

<span class="k">def</span> <span class="nf">cosine_sp</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">):</span>
    <span class="s1">&#39;x1,x2 are dicts,this version is for sparse representation&#39;</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">denom1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">denom2</span> <span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">x1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">x2</span><span class="p">:</span>
            <span class="n">total</span><span class="o">+=</span><span class="n">x1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">x2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">denom1</span><span class="o">+=</span><span class="n">x1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">denom2</span><span class="o">+=</span><span class="n">x2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">total</span> <span class="o">+</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">denom1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">denom2</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">cosine</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">):</span>
    <span class="c1">#find common ratings</span>
    <span class="n">new_x1</span><span class="p">,</span> <span class="n">new_x2</span> <span class="o">=</span> <span class="n">common</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">)</span>
    <span class="c1">#compute the cosine similarity between two vectors</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="n">new_x1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">new_x2</span><span class="p">)</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">new_x1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">new_x1</span><span class="p">)</span><span class="o">*</span><span class="n">new_x2</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">new_x2</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span><span class="o">/</span><span class="n">denom</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1">#return cosine_similarity(x1,x2)[0][0]</span>

<span class="k">def</span> <span class="nf">pearson_sp</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">):</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">denom1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">denom2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">overlapped</span><span class="o">=</span><span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">mean1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x1</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">mean2</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x2</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">x1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">x2</span><span class="p">:</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="n">mean1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="n">mean2</span><span class="p">)</span>
                <span class="n">denom1</span> <span class="o">+=</span> <span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="n">mean1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="n">denom2</span> <span class="o">+=</span> <span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="n">mean2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                <span class="n">overlapped</span><span class="o">=</span><span class="kc">True</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">total</span> <span class="o">+</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">denom1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">denom2</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">overlapped</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">euclidean</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">):</span>
    <span class="c1">#find common ratings</span>
    <span class="n">new_x1</span><span class="p">,</span> <span class="n">new_x2</span> <span class="o">=</span> <span class="n">common</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
    <span class="c1">#compute the euclidean between two vectors</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">new_x1</span><span class="o">-</span><span class="n">new_x2</span>
    <span class="n">denom</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">diff</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">diff</span><span class="p">)))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">denom</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">pearson</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">):</span>
    <span class="c1">#find common ratings</span>
    <span class="n">new_x1</span><span class="p">,</span> <span class="n">new_x2</span> <span class="o">=</span> <span class="n">common</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
    <span class="c1">#compute the pearson similarity between two vectors</span>
    <span class="n">ind1</span> <span class="o">=</span> <span class="n">new_x1</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">ind2</span> <span class="o">=</span> <span class="n">new_x2</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">mean_x1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_x1</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">/</span><span class="n">ind1</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">mean_x2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">new_x2</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">/</span><span class="n">ind2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">new_x1</span> <span class="o">=</span> <span class="n">new_x1</span> <span class="o">-</span> <span class="n">mean_x1</span>
        <span class="n">new_x2</span> <span class="o">=</span> <span class="n">new_x2</span> <span class="o">-</span> <span class="n">mean_x2</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="n">new_x1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">new_x2</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">new_x1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">new_x1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">new_x2</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">new_x2</span><span class="p">)))</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">similarity</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">sim</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sim</span> <span class="o">==</span> <span class="s1">&#39;pcc&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pearson_sp</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sim</span> <span class="o">==</span> <span class="s1">&#39;euclidean&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">euclidean</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cosine_sp</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span><span class="n">maxVal</span><span class="p">,</span><span class="n">minVal</span><span class="p">):</span>
    <span class="s1">&#39;get the normalized value using min-max normalization&#39;</span>
    <span class="k">if</span> <span class="n">maxVal</span> <span class="o">&gt;</span> <span class="n">minVal</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">vec</span><span class="o">-</span><span class="n">minVal</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">maxVal</span><span class="o">-</span><span class="n">minVal</span><span class="p">)</span><span class="o">+</span><span class="mf">0.01</span>
    <span class="k">elif</span> <span class="n">maxVal</span><span class="o">==</span><span class="n">minVal</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">vec</span><span class="o">/</span><span class="n">maxVal</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error... maximum value is less than minimum value.&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ArithmeticError</span>

<span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">val</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">denormalize</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span><span class="n">maxVal</span><span class="p">,</span><span class="n">minVal</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">minVal</span><span class="o">+</span><span class="p">(</span><span class="n">vec</span><span class="o">-</span><span class="mf">0.01</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">maxVal</span><span class="o">-</span><span class="n">minVal</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Shilling-models">Shilling models<a class="anchor-link" href="#Shilling-models"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Attack-base-class">Attack base class<a class="anchor-link" href="#Attack-base-class"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">Attack</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conf</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span> <span class="o">=</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">loadDataSet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ratings&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attackSize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;attackSize&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fillerSize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;fillerSize&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedSize</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;selectedSize&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targetCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;targetCount&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targetScore</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;targetScore&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;minCount&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;maxCount&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minScore</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;minScore&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxScore</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;maxScore&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputDir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;outputDir&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputDir</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spamItem</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span> <span class="c1">#items rated by spammers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targetItems</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemAverage</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getAverageRating</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectTarget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">getAverageRating</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">itemID</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="p">:</span>
            <span class="n">li</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="p">[</span><span class="n">itemID</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemAverage</span><span class="p">[</span><span class="n">itemID</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">li</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">li</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">selectTarget</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Selecting target items...&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Target item       Average rating of the item&#39;</span><span class="p">)</span>
        <span class="n">itemList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">itemList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetItems</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetCount</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">itemList</span><span class="p">))</span> <span class="c1">#generate a target order at random</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">itemList</span><span class="p">[</span><span class="n">target</span><span class="p">])])</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxCount</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">itemList</span><span class="p">[</span><span class="n">target</span><span class="p">])])</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">minCount</span> \
                    <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">itemList</span><span class="p">[</span><span class="n">target</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetItems</span> \
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">itemAverage</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">itemList</span><span class="p">[</span><span class="n">target</span><span class="p">])]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">targetItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">itemList</span><span class="p">[</span><span class="n">target</span><span class="p">]))</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">itemList</span><span class="p">[</span><span class="n">target</span><span class="p">]),</span><span class="s1">&#39;                  &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">itemAverage</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">itemList</span><span class="p">[</span><span class="n">target</span><span class="p">])])</span>

    <span class="k">def</span> <span class="nf">getFillerItems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fillerSize</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="p">))</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span><span class="o">*</span><span class="n">mu</span><span class="p">)</span>
        <span class="n">markedItemsCount</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))))</span>
        <span class="n">markedItems</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">markedItemsCount</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">markedItems</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">insertSpam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">startID</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">loadTarget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">targetItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">generateLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputDir</span> <span class="o">+</span> <span class="n">filename</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span><span class="o">+</span><span class="s1">&#39; 1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span><span class="o">+</span><span class="s1">&#39; 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;User profiles have been output to &#39;</span><span class="o">+</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;outputDir&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generateProfiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">ratings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputDir</span><span class="o">+</span><span class="n">filename</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                    <span class="n">ratings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                    <span class="n">ratings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">item</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;User labels have been output to &#39;</span><span class="o">+</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;outputDir&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Relation-attack">Relation attack<a class="anchor-link" href="#Relation-attack"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">RelationAttack</span><span class="p">(</span><span class="n">Attack</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conf</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RelationAttack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spamLink</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relation</span> <span class="o">=</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">loadRelationship</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;social&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trustLink</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trusteeLink</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trustLink</span><span class="p">[</span><span class="n">u1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trusteeLink</span><span class="p">[</span><span class="n">u2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activeUser</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 关注了虚假用户的正常用户</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linkedUser</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># 被虚假用户种植过链接的用户</span>

    <span class="c1"># def reload(self):</span>
    <span class="c1">#     super(RelationAttack, self).reload()</span>
    <span class="c1">#     self.spamLink = defaultdict(list)</span>
    <span class="c1">#     self.trustLink, self.trusteeLink = loadTrusts(self.config[&#39;social&#39;])</span>
    <span class="c1">#     self.activeUser = {}  # 关注了虚假用户的正常用户</span>
    <span class="c1">#     self.linkedUser = {}  # 被虚假用户种植过链接的用户</span>

    <span class="k">def</span> <span class="nf">farmLink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">getReciprocal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">target</span><span class="p">):</span>
        <span class="c1">#当前目标用户关注spammer的概率，依赖于粉丝数和关注数的交集</span>
        <span class="n">reciprocal</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trustLink</span><span class="p">[</span><span class="n">target</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trusteeLink</span><span class="p">[</span><span class="n">target</span><span class="p">]))</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span> \
                     <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trustLink</span><span class="p">[</span><span class="n">target</span><span class="p">])</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trusteeLink</span><span class="p">[</span><span class="n">target</span><span class="p">]))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">reciprocal</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trustLink</span><span class="p">[</span><span class="n">target</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trustLink</span><span class="p">[</span><span class="n">target</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trusteeLink</span><span class="p">[</span><span class="n">target</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">reciprocal</span> <span class="o">/=</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="n">reciprocal</span>

    <span class="k">def</span> <span class="nf">generateSocialConnections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">relations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputDir</span> <span class="o">+</span> <span class="n">filename</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">u1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trustLink</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">u2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trustLink</span><span class="p">[</span><span class="n">u1</span><span class="p">]:</span>
                    <span class="n">relations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u1</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">u2</span> <span class="o">+</span> <span class="s1">&#39; 1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">u1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spamLink</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">u2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spamLink</span><span class="p">[</span><span class="n">u1</span><span class="p">]:</span>
                    <span class="n">relations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u1</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">u2</span> <span class="o">+</span> <span class="s1">&#39; 1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">relations</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Social relations have been output to &#39;</span> <span class="o">+</span> <span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;outputDir&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Random-relation-attack">Random relation attack<a class="anchor-link" href="#Random-relation-attack"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">RandomRelationAttack</span><span class="p">(</span><span class="n">RelationAttack</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conf</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RandomRelationAttack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;linkSize&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">farmLink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># 随机注入虚假关系</span>

        <span class="k">for</span> <span class="n">spam</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">:</span>

            <span class="c1">#对购买了目标项目的用户种植链接</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spamItem</span><span class="p">[</span><span class="n">spam</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spamLink</span><span class="p">[</span><span class="n">spam</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
                        <span class="n">response</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                        <span class="n">reciprocal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReciprocal</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">response</span> <span class="o">&lt;=</span> <span class="n">reciprocal</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">trustLink</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spam</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">activeUser</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">linkedUser</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1">#对其它用户以scale的比例种植链接</span>
            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">spamLink</span><span class="p">[</span><span class="n">spam</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                    <span class="n">reciprocal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReciprocal</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">response</span> <span class="o">&lt;</span> <span class="n">reciprocal</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">trustLink</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spam</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">activeUser</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">linkedUser</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Random-attack">Random attack<a class="anchor-link" href="#Random-attack"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">RandomAttack</span><span class="p">(</span><span class="n">Attack</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conf</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RandomAttack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">insertSpam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">startID</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Modeling random attack...&#39;</span><span class="p">)</span>
        <span class="n">itemList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">startID</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span> <span class="o">=</span> <span class="n">startID</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">attackSize</span><span class="p">)):</span>
            <span class="c1">#fill 装填项目</span>
            <span class="n">fillerItems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFillerItems</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fillerItems</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span><span class="p">)][</span><span class="nb">str</span><span class="p">(</span><span class="n">itemList</span><span class="p">[</span><span class="n">item</span><span class="p">])]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minScore</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">maxScore</span><span class="p">)</span>

            <span class="c1">#target 目标项目</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetCount</span><span class="p">):</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetItems</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span><span class="p">)][</span><span class="bp">self</span><span class="o">.</span><span class="n">targetItems</span><span class="p">[</span><span class="n">target</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetScore</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spamItem</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetItems</span><span class="p">[</span><span class="n">target</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">RR_Attack</span><span class="p">(</span><span class="n">RandomRelationAttack</span><span class="p">,</span><span class="n">RandomAttack</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conf</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RR_Attack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Average-attack">Average attack<a class="anchor-link" href="#Average-attack"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">AverageAttack</span><span class="p">(</span><span class="n">Attack</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conf</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AverageAttack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">insertSpam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">startID</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Modeling average attack...&#39;</span><span class="p">)</span>
        <span class="n">itemList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">startID</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span> <span class="o">=</span> <span class="n">startID</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">attackSize</span><span class="p">)):</span>
            <span class="c1">#fill</span>
            <span class="n">fillerItems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFillerItems</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fillerItems</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span><span class="p">)][</span><span class="nb">str</span><span class="p">(</span><span class="n">itemList</span><span class="p">[</span><span class="n">item</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemAverage</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">itemList</span><span class="p">[</span><span class="n">item</span><span class="p">])])</span>
            <span class="c1">#target</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetCount</span><span class="p">):</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetItems</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span><span class="p">)][</span><span class="bp">self</span><span class="o">.</span><span class="n">targetItems</span><span class="p">[</span><span class="n">target</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetScore</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spamItem</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetItems</span><span class="p">[</span><span class="n">target</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Random-average-relation">Random average relation<a class="anchor-link" href="#Random-average-relation"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">RA_Attack</span><span class="p">(</span><span class="n">RandomRelationAttack</span><span class="p">,</span><span class="n">AverageAttack</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conf</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RA_Attack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Bandwagon-attack">Bandwagon attack<a class="anchor-link" href="#Bandwagon-attack"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">BandWagonAttack</span><span class="p">(</span><span class="n">Attack</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conf</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BandWagonAttack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hotItems</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span>
                   <span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedSize</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="p">))]</span>


    <span class="k">def</span> <span class="nf">insertSpam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">startID</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Modeling bandwagon attack...&#39;</span><span class="p">)</span>
        <span class="n">itemList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">startID</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span> <span class="o">=</span> <span class="n">startID</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">attackSize</span><span class="p">)):</span>
            <span class="c1">#fill 装填项目</span>
            <span class="n">fillerItems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFillerItems</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">fillerItems</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span><span class="p">)][</span><span class="nb">str</span><span class="p">(</span><span class="n">itemList</span><span class="p">[</span><span class="n">item</span><span class="p">])]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minScore</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">maxScore</span><span class="p">)</span>
            <span class="c1">#selected 选择项目</span>
            <span class="n">selectedItems</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSelectedItems</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">selectedItems</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span><span class="p">)][</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetScore</span>
            <span class="c1">#target 目标项目</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetCount</span><span class="p">):</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetItems</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span><span class="p">)][</span><span class="bp">self</span><span class="o">.</span><span class="n">targetItems</span><span class="p">[</span><span class="n">target</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetScore</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spamItem</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">targetItems</span><span class="p">[</span><span class="n">target</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startUserID</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">getFillerItems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fillerSize</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="p">))</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span><span class="o">*</span><span class="n">mu</span><span class="p">)</span>
        <span class="n">markedItemsCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">markedItemsCount</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">markedItemsCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">markedItems</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">markedItemsCount</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">markedItems</span>

    <span class="k">def</span> <span class="nf">getSelectedItems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selectedSize</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemProfile</span><span class="p">))</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">mu</span><span class="p">)</span>
        <span class="n">markedItemsCount</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))))</span>
        <span class="n">markedIndexes</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hotItems</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">markedItemsCount</span><span class="p">)</span>
        <span class="n">markedItems</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hotItems</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">markedIndexes</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">markedItems</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Random-bandwagon-relation">Random bandwagon relation<a class="anchor-link" href="#Random-bandwagon-relation"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">RB_Attack</span><span class="p">(</span><span class="n">RandomRelationAttack</span><span class="p">,</span><span class="n">BandWagonAttack</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conf</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RB_Attack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Hybrid-attack">Hybrid attack<a class="anchor-link" href="#Hybrid-attack"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">HybridAttack</span><span class="p">(</span><span class="n">Attack</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conf</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HybridAttack</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aveAttack</span> <span class="o">=</span> <span class="n">AverageAttack</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bandAttack</span> <span class="o">=</span> <span class="n">BandWagonAttack</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">randAttack</span> <span class="o">=</span> <span class="n">RandomAttack</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">insertSpam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">startID</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aveAttack</span><span class="o">.</span><span class="n">insertSpam</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bandAttack</span><span class="o">.</span><span class="n">insertSpam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aveAttack</span><span class="o">.</span><span class="n">startUserID</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">randAttack</span><span class="o">.</span><span class="n">insertSpam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandAttack</span><span class="o">.</span><span class="n">startUserID</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aveAttack</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bandAttack</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">randAttack</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generateProfiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>

        <span class="n">ratings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputDir</span> <span class="o">+</span> <span class="n">filename</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                    <span class="n">ratings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">item</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                    <span class="n">ratings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">item</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;User labels have been output to &#39;</span> <span class="o">+</span> <span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;outputDir&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generateLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputDir</span> <span class="o">+</span> <span class="n">filename</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spamProfile</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span><span class="o">+</span><span class="s1">&#39; 1</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">userProfile</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span><span class="o">+</span><span class="s1">&#39; 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;User profiles have been output to &#39;</span><span class="o">+</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;outputDir&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Generate-data">Generate data<a class="anchor-link" href="#Generate-data"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="o">%%</span><span class="n">writefile</span> <span class="n">config</span><span class="o">.</span><span class="n">conf</span>
<span class="n">ratings</span><span class="o">=</span><span class="n">dataset</span><span class="o">/</span><span class="n">filmtrust</span><span class="o">/</span><span class="n">ratings</span><span class="o">.</span><span class="n">txt</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">setup</span><span class="o">=-</span><span class="n">columns</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="n">social</span><span class="o">=</span><span class="n">dataset</span><span class="o">/</span><span class="n">filmtrust</span><span class="o">/</span><span class="n">trust</span><span class="o">.</span><span class="n">txt</span>
<span class="n">social</span><span class="o">.</span><span class="n">setup</span><span class="o">=-</span><span class="n">columns</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="n">attackSize</span><span class="o">=</span><span class="mf">0.1</span>
<span class="n">fillerSize</span><span class="o">=</span><span class="mf">0.05</span>
<span class="n">selectedSize</span><span class="o">=</span><span class="mf">0.005</span>
<span class="n">targetCount</span><span class="o">=</span><span class="mi">20</span>
<span class="n">targetScore</span><span class="o">=</span><span class="mf">4.0</span>
<span class="n">threshold</span><span class="o">=</span><span class="mf">3.0</span>
<span class="n">maxScore</span><span class="o">=</span><span class="mf">4.0</span>
<span class="n">minScore</span><span class="o">=</span><span class="mf">1.0</span>
<span class="n">minCount</span><span class="o">=</span><span class="mi">5</span>
<span class="n">maxCount</span><span class="o">=</span><span class="mi">50</span>
<span class="n">linkSize</span><span class="o">=</span><span class="mf">0.001</span>
<span class="n">outputDir</span><span class="o">=</span><span class="n">output</span><span class="o">/</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Overwriting config.conf
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">attack</span> <span class="o">=</span> <span class="n">RR_Attack</span><span class="p">(</span><span class="s1">&#39;config.conf&#39;</span><span class="p">)</span>
<span class="n">attack</span><span class="o">.</span><span class="n">insertSpam</span><span class="p">()</span>
<span class="n">attack</span><span class="o">.</span><span class="n">farmLink</span><span class="p">()</span>
<span class="n">attack</span><span class="o">.</span><span class="n">generateLabels</span><span class="p">(</span><span class="s1">&#39;labels.txt&#39;</span><span class="p">)</span>
<span class="n">attack</span><span class="o">.</span><span class="n">generateProfiles</span><span class="p">(</span><span class="s1">&#39;profiles.txt&#39;</span><span class="p">)</span>
<span class="n">attack</span><span class="o">.</span><span class="n">generateSocialConnections</span><span class="p">(</span><span class="s1">&#39;relations.txt&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading training data...
Selecting target items...
--------------------------------------------------------------------------------
Target item       Average rating of the item
877                    2.875
472                    2.5833333333333335
715                    2.8
528                    2.7142857142857144
169                    2.25
442                    2.8055555555555554
270                    2.962962962962963
681                    2.75
843                    3.0
832                    1.8571428571428572
668                    2.7777777777777777
938                    2.9166666666666665
282                    2.642857142857143
489                    2.1666666666666665
927                    2.5833333333333335
577                    2.5
693                    2.6875
593                    2.7083333333333335
529                    2.5
872                    2.3333333333333335
loading social data...
Modeling random attack...
User profiles have been output to /content/output.
User labels have been output to /content/output.
Social relations have been output to /content/output.
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-access-objects">Data access objects<a class="anchor-link" href="#Data-access-objects"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">RatingDAO</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="s1">&#39;data access control&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">config</span><span class="p">,</span> <span class="n">trainingData</span><span class="p">,</span> <span class="n">testData</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ratingConfig</span> <span class="o">=</span> <span class="n">LineConfig</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ratings.setup&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">#used to store the order of users in the training set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">#used to store the order of items in the training set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id2user</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id2item</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_Item</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_User</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">userMeans</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">#used to store the mean values of users&#39;s ratings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemMeans</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">#used to store the mean values of items&#39;s ratings</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">globalMean</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># self.trainingMatrix = None</span>
        <span class="c1"># self.validationMatrix = None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testSet_u</span> <span class="o">=</span> <span class="n">testData</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># used to store the test set by hierarchy user:[item,rating]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testSet_i</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span> <span class="c1"># used to store the test set by hierarchy item:[user,rating]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_u</span> <span class="o">=</span> <span class="n">trainingData</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_i</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="c1">#self.rScale = []</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">trainingData</span> <span class="o">=</span> <span class="n">trainingData</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testData</span> <span class="o">=</span> <span class="n">testData</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__generateSet</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__computeItemMean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__computeUserMean</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__globalAverage</span><span class="p">()</span>



    <span class="k">def</span> <span class="nf">__generateSet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1"># find the maximum rating and minimum value</span>
        <span class="c1"># for i, entry in enumerate(self.trainingData):</span>
        <span class="c1">#     userName, itemName, rating = entry</span>
        <span class="c1">#     scale.add(float(rating))</span>
        <span class="c1"># self.rScale = list(scale)</span>
        <span class="c1"># self.rScale.sort()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">user</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainingData</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainingData</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>

                <span class="c1"># makes the rating within the range [0, 1].</span>
                <span class="c1">#rating = normalize(float(rating), self.rScale[-1], self.rScale[0])</span>
                <span class="c1">#self.trainingSet_u[userName][itemName] = float(rating)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainingData</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
                <span class="c1"># order the user</span>
                <span class="k">if</span> <span class="n">user</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">id2user</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">[</span><span class="n">user</span><span class="p">]]</span> <span class="o">=</span> <span class="n">user</span>
                <span class="c1"># order the item</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">id2item</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">[</span><span class="n">item</span><span class="p">]]</span> <span class="o">=</span> <span class="n">item</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainingData</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
                <span class="c1"># userList.append</span>
        <span class="c1">#     triple.append([self.user[userName], self.item[itemName], rating])</span>
        <span class="c1"># self.trainingMatrix = new_sparseMatrix.SparseMatrix(triple)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">all_User</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_Item</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">user</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testData</span><span class="p">):</span>
            <span class="c1"># order the user</span>
            <span class="k">if</span> <span class="n">user</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">all_User</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_User</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">testData</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                <span class="c1"># order the item</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">all_Item</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_Item</span><span class="p">)</span>
                <span class="c1">#self.testSet_u[userName][itemName] = float(rating)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testSet_i</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">testData</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">__globalAverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userMeans</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">total</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">globalMean</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">globalMean</span> <span class="o">=</span> <span class="n">total</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userMeans</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__computeUserMean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># for u in self.user:</span>
        <span class="c1">#     n = self.row(u) &gt; 0</span>
        <span class="c1">#     mean = 0</span>
        <span class="c1">#</span>
        <span class="c1">#     if not self.containsUser(u):  # no data about current user in training set</span>
        <span class="c1">#         pass</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         sum = float(self.row(u)[0].sum())</span>
        <span class="c1">#         try:</span>
        <span class="c1">#             mean =  sum/ n[0].sum()</span>
        <span class="c1">#         except ZeroDivisionError:</span>
        <span class="c1">#             mean = 0</span>
        <span class="c1">#     self.userMeans[u] = mean</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">userMeans</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">+</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">userMeans</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">+</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__computeItemMean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># for c in self.item:</span>
        <span class="c1">#     n = self.col(c) &gt; 0</span>
        <span class="c1">#     mean = 0</span>
        <span class="c1">#     if not self.containsItem(c):  # no data about current user in training set</span>
        <span class="c1">#         pass</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         sum = float(self.col(c)[0].sum())</span>
        <span class="c1">#         try:</span>
        <span class="c1">#             mean = sum / n[0].sum()</span>
        <span class="c1">#         except ZeroDivisionError:</span>
        <span class="c1">#             mean = 0</span>
        <span class="c1">#     self.itemMeans[c] = mean</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemMeans</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">+</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">testSet_i</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemMeans</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testSet_i</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testSet_i</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span> <span class="o">+</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getUserId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">u</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">getItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">trainingSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">recordCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainingData</span><span class="p">:</span>
            <span class="n">recordCount</span><span class="o">+=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainingData</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">),</span><span class="n">recordCount</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">testSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">recordCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">testData</span><span class="p">:</span>
            <span class="n">recordCount</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testData</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testSet_i</span><span class="p">),</span><span class="n">recordCount</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
        <span class="s1">&#39;whether user u rated item i&#39;</span>
        <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_u</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">u</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">containsUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">u</span><span class="p">):</span>
        <span class="s1">&#39;whether user is in training set&#39;</span>
        <span class="k">return</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_u</span>

    <span class="k">def</span> <span class="nf">containsItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
        <span class="s1">&#39;whether item is in training set&#39;</span>
        <span class="k">return</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_i</span>

    <span class="k">def</span> <span class="nf">allUserRated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="c1"># def userRated(self,u):</span>
    <span class="c1">#     if self.trainingMatrix.matrix_User.has_key(self.getUserId(u)):</span>
    <span class="c1">#         itemIndex =  self.trainingMatrix.matrix_User[self.user[u]].keys()</span>
    <span class="c1">#         rating = self.trainingMatrix.matrix_User[self.user[u]].values()</span>
    <span class="c1">#         return (itemIndex,rating)</span>
    <span class="c1">#     return ([],[])</span>
    <span class="c1">#</span>
    <span class="c1"># def itemRated(self,i):</span>
    <span class="c1">#     if self.trainingMatrix.matrix_Item.has_key(self.getItemId(i)):</span>
    <span class="c1">#         userIndex = self.trainingMatrix.matrix_Item[self.item[i]].keys()</span>
    <span class="c1">#         rating = self.trainingMatrix.matrix_Item[self.item[i]].values()</span>
    <span class="c1">#         return (userIndex,rating)</span>
    <span class="c1">#     return ([],[])</span>

    <span class="c1"># def row(self,u):</span>
    <span class="c1">#     return self.trainingMatrix.row(self.getUserId(u))</span>
    <span class="c1">#</span>
    <span class="c1"># def col(self,c):</span>
    <span class="c1">#     return self.trainingMatrix.col(self.getItemId(c))</span>
    <span class="c1">#</span>
    <span class="c1"># def sRow(self,u):</span>
    <span class="c1">#     return self.trainingMatrix.sRow(self.getUserId(u))</span>
    <span class="c1">#</span>
    <span class="c1"># def sCol(self,c):</span>
    <span class="c1">#     return self.trainingMatrix.sCol(self.getItemId(c))</span>
    <span class="c1">#</span>
    <span class="c1"># def rating(self,u,c):</span>
    <span class="c1">#     return self.trainingMatrix.elem(self.getUserId(u),self.getItemId(c))</span>
    <span class="c1">#</span>
    <span class="c1"># def ratingScale(self):</span>
    <span class="c1">#     return (self.rScale[0],self.rScale[1])</span>

    <span class="c1"># def elemCount(self):</span>
    <span class="c1">#     return self.trainingMatrix.elemCount()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">SocialDAO</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conf</span><span class="p">,</span><span class="n">relation</span><span class="o">=</span><span class="nb">list</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">conf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">#used to store the order of users</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relation</span> <span class="o">=</span> <span class="n">relation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">followees</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">followers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trustMatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__generateSet</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__generateSet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#triple = []</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relation</span><span class="p">:</span>
            <span class="n">userId1</span><span class="p">,</span><span class="n">userId2</span><span class="p">,</span><span class="n">weight</span> <span class="o">=</span> <span class="n">line</span>
            <span class="c1">#add relations to dict</span>
            <span class="k">if</span> <span class="n">userId1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">followees</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">followees</span><span class="p">[</span><span class="n">userId1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">followees</span><span class="p">[</span><span class="n">userId1</span><span class="p">][</span><span class="n">userId2</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span>
            <span class="k">if</span> <span class="n">userId2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">followers</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">followers</span><span class="p">[</span><span class="n">userId2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">followers</span><span class="p">[</span><span class="n">userId2</span><span class="p">][</span><span class="n">userId1</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span>
            <span class="c1"># order the user</span>
            <span class="k">if</span> <span class="n">userId1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">[</span><span class="n">userId1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">userId2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">[</span><span class="n">userId2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
            <span class="c1">#triple.append([self.user[userId1], self.user[userId2], weight])</span>
        <span class="c1">#return new_sparseMatrix.SparseMatrix(triple)</span>

    <span class="c1"># def row(self,u):</span>
    <span class="c1">#     #return user u&#39;s followees</span>
    <span class="c1">#     return self.trustMatrix.row(self.user[u])</span>
    <span class="c1">#</span>
    <span class="c1"># def col(self,u):</span>
    <span class="c1">#     #return user u&#39;s followers</span>
    <span class="c1">#     return self.trustMatrix.col(self.user[u])</span>
    <span class="c1">#</span>
    <span class="c1"># def elem(self,u1,u2):</span>
    <span class="c1">#     return self.trustMatrix.elem(u1,u2)</span>

    <span class="k">def</span> <span class="nf">weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">u1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">followees</span> <span class="ow">and</span> <span class="n">u2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">followees</span><span class="p">[</span><span class="n">u1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">followees</span><span class="p">[</span><span class="n">u1</span><span class="p">][</span><span class="n">u2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># def trustSize(self):</span>
    <span class="c1">#     return self.trustMatrix.size</span>

    <span class="k">def</span> <span class="nf">getFollowers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">u</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">followers</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">followers</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">getFollowees</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">u</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">followees</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">followees</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">hasFollowee</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">u1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">followees</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">u2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">followees</span><span class="p">[</span><span class="n">u1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">hasFollower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">u1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">followers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">u2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">followers</span><span class="p">[</span><span class="n">u1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Methods">Methods<a class="anchor-link" href="#Methods"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="BayesDetector">BayesDetector<a class="anchor-link" href="#BayesDetector"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">BayesDetector</span><span class="p">(</span><span class="n">SDetection</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">trainingSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">testSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fold</span><span class="o">=</span><span class="s1">&#39;[1]&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BayesDetector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">trainingSet</span><span class="p">,</span> <span class="n">testSet</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fold</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">readConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BayesDetector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">readConfiguration</span><span class="p">()</span>
        <span class="n">extraSettings</span> <span class="o">=</span> <span class="n">LineConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;BayesDetector&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">extraSettings</span><span class="p">[</span><span class="s1">&#39;-k&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">extraSettings</span><span class="p">[</span><span class="s1">&#39;-negCount&#39;</span><span class="p">])</span>  <span class="c1"># the number of negative samples</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">negCount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">negCount</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">regR</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">extraSettings</span><span class="p">[</span><span class="s1">&#39;-gamma&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">extraSettings</span><span class="p">[</span><span class="s1">&#39;-filter&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">extraSettings</span><span class="p">[</span><span class="s1">&#39;-delta&#39;</span><span class="p">])</span>
        <span class="n">learningRate</span> <span class="o">=</span> <span class="n">LineConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;learnRate&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">learningRate</span><span class="p">[</span><span class="s1">&#39;-init&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxLRate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">learningRate</span><span class="p">[</span><span class="s1">&#39;-max&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxIter</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;num.max.iter&#39;</span><span class="p">])</span>
        <span class="n">regular</span> <span class="o">=</span> <span class="n">LineConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;reg.lambda&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">regI</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">regular</span><span class="p">[</span><span class="s1">&#39;-u&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">regular</span><span class="p">[</span><span class="s1">&#39;-i&#39;</span><span class="p">])</span>
        <span class="c1"># self.delta = float(self.config[&#39;delta&#39;])</span>
    <span class="k">def</span> <span class="nf">printAlgorConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BayesDetector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">printAlgorConfig</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;k: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">negCount</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;regR: </span><span class="si">%.5f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">regR</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;filter: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BayesDetector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">initModel</span><span class="p">()</span>
        <span class="c1"># self.c = np.random.rand(len(self.dao.all_User) + 1) / 20  # bias value of context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>  <span class="c1"># context embedding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>  <span class="c1"># latent user matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_Item</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>  <span class="c1"># latent item matrix</span>

        <span class="c1"># constructing SPPMI matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Constructing SPPMI matrix...&#39;</span><span class="p">)</span>
        <span class="c1"># for larger data set has many items, the process will be time consuming</span>
        <span class="n">occurrence</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">user1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">:</span>
            <span class="n">iList1</span><span class="p">,</span> <span class="n">rList1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">allUserRated</span><span class="p">(</span><span class="n">user1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iList1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">user2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">user1</span> <span class="o">==</span> <span class="n">user2</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">user2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">occurrence</span><span class="p">[</span><span class="n">user1</span><span class="p">]:</span>
                    <span class="n">iList2</span><span class="p">,</span> <span class="n">rList2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">allUserRated</span><span class="p">(</span><span class="n">user2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iList2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">iList1</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">iList2</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">:</span>
                        <span class="n">occurrence</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
                        <span class="n">occurrence</span><span class="p">[</span><span class="n">user2</span><span class="p">][</span><span class="n">user1</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>

        <span class="n">maxVal</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">frequency</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">user1</span> <span class="ow">in</span> <span class="n">occurrence</span><span class="p">:</span>
            <span class="n">frequency</span><span class="p">[</span><span class="n">user1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">occurrence</span><span class="p">[</span><span class="n">user1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">*</span> <span class="mf">1.0</span>
        <span class="n">D</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">frequency</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">*</span> <span class="mf">1.0</span>
        <span class="c1"># maxx = -1</span>
        <span class="k">for</span> <span class="n">user1</span> <span class="ow">in</span> <span class="n">occurrence</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">user2</span> <span class="ow">in</span> <span class="n">occurrence</span><span class="p">[</span><span class="n">user1</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">log</span><span class="p">(</span><span class="n">occurrence</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">]</span> <span class="o">*</span> <span class="n">D</span> <span class="o">/</span> <span class="p">(</span><span class="n">frequency</span><span class="p">[</span><span class="n">user1</span><span class="p">]</span> <span class="o">*</span> <span class="n">frequency</span><span class="p">[</span><span class="n">user2</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">negCount</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">]</span> <span class="o">*</span> <span class="n">D</span> <span class="o">/</span> <span class="p">(</span><span class="n">frequency</span><span class="p">[</span><span class="n">user1</span><span class="p">]</span> <span class="o">*</span> <span class="n">frequency</span><span class="p">[</span><span class="n">user2</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">maxVal</span> <span class="o">&lt;</span> <span class="n">val</span><span class="p">:</span>
                        <span class="n">maxVal</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user2</span><span class="p">][</span><span class="n">user1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">]</span>

        <span class="c1"># normalize</span>
        <span class="k">for</span> <span class="n">user1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">user2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user1</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">]</span> <span class="o">/</span> <span class="n">maxVal</span>

    <span class="k">def</span> <span class="nf">buildModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">ratings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">)</span>
        <span class="c1">#suspicous set</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Preparing sets...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sSet</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="c1">#normal set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nSet</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="c1"># self.NegativeSet = defaultdict(list)</span>

        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">ratings</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                <span class="c1"># if self.dao.ratings[user][item] &gt;= 5 and self.labels[user]==&#39;1&#39;:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;1&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sSet</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="c1"># if self.dao.ratings[user][item] &gt;= 5 and self.labels[user] == &#39;0&#39;:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nSet</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Jointly decompose R(ratings) and SPPMI with shared user latent factors P</span>
        <span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">iteration</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxIter</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sSet</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_Item</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nSet</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">normalUserList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nSet</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sSet</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                    <span class="n">su</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">[</span><span class="n">user</span><span class="p">]</span>
                    <span class="c1"># if len(self.NegativeSet[user]) &gt; 0:</span>
                    <span class="c1">#     item_j = choice(self.NegativeSet[user])</span>
                    <span class="c1"># else:</span>
                    <span class="n">normalUser</span> <span class="o">=</span> <span class="n">choice</span><span class="p">(</span><span class="n">normalUserList</span><span class="p">)</span>
                    <span class="n">nu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">[</span><span class="n">normalUser</span><span class="p">]</span>

                    <span class="n">s</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">su</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">nu</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">su</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">nu</span><span class="p">]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">su</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">nu</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">regI</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">su</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">regU</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">su</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">nu</span><span class="p">]</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">regU</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">nu</span><span class="p">]</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">+=</span> <span class="p">(</span><span class="o">-</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
            <span class="c1">#</span>
            <span class="c1"># for item in self.sSet:</span>
            <span class="c1">#     if not self.nSet.has_key(item):</span>
            <span class="c1">#         continue</span>
            <span class="c1">#     for user1 in self.sSet[item]:</span>
            <span class="c1">#         for user2 in self.sSet[item]:</span>
            <span class="c1">#             su1 = self.dao.all_User[user1]</span>
            <span class="c1">#             su2 = self.dao.all_User[user2]</span>
            <span class="c1">#             self.P[su1] += (self.lRate*(self.P[su1]-self.P[su2]))*self.delta</span>
            <span class="c1">#             self.P[su2] -= (self.lRate*(self.P[su1]-self.P[su2]))*self.delta</span>
            <span class="c1">#</span>
            <span class="c1">#             self.loss += ((self.P[su1]-self.P[su2]).dot(self.P[su1]-self.P[su2]))*self.delta</span>


            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">ratings</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">ratings</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                    <span class="n">rating</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">ratings</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">rating</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">rating</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictRating</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>
                    <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">[</span><span class="n">user</span><span class="p">]</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_Item</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="c1"># self.loss += (error ** 2)*self.b</span>
                    <span class="c1"># update latent vectors</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="p">(</span><span class="n">error</span> <span class="o">*</span> <span class="n">q</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">regU</span> <span class="o">*</span> <span class="n">p</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="p">(</span><span class="n">error</span> <span class="o">*</span> <span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">regI</span> <span class="o">*</span> <span class="n">q</span><span class="p">))</span>


            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">:</span>
                <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">[</span><span class="n">user</span><span class="p">]</span>
                <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">context</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">[</span><span class="n">context</span><span class="p">]</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">context</span><span class="p">]</span>
                    <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                    <span class="n">diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">+=</span> <span class="p">(</span><span class="n">diff</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="c1"># update latent vectors</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="n">diff</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="n">diff</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regU</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">regI</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">regR</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iteration:&#39;</span><span class="p">,</span><span class="n">iteration</span><span class="p">)</span>

        <span class="c1"># preparing examples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trainingLabels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testLabels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">[</span><span class="n">user</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trainingLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">[</span><span class="n">user</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># tsne = TSNE(n_components=2)</span>
        <span class="c1"># self.Y = tsne.fit_transform(self.P)</span>
        <span class="c1">#</span>
        <span class="c1"># self.normalUsers = []</span>
        <span class="c1"># self.spammers = []</span>
        <span class="c1"># for user in self.labels:</span>
        <span class="c1">#     if self.labels[user] == &#39;0&#39;:</span>
        <span class="c1">#         self.normalUsers.append(user)</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         self.spammers.append(user)</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1"># print len(self.spammers)</span>
        <span class="c1"># self.normalfeature = np.zeros((len(self.normalUsers), 2))</span>
        <span class="c1"># self.spamfeature = np.zeros((len(self.spammers), 2))</span>
        <span class="c1"># normal_index = 0</span>
        <span class="c1"># for normaluser in self.normalUsers:</span>
        <span class="c1">#     if normaluser in self.dao.all_User:</span>
        <span class="c1">#         self.normalfeature[normal_index] = self.Y[self.dao.all_User[normaluser]]</span>
        <span class="c1">#         normal_index += 1</span>
        <span class="c1">#</span>
        <span class="c1"># spam_index = 0</span>
        <span class="c1"># for spamuser in self.spammers:</span>
        <span class="c1">#     if spamuser in self.dao.all_User:</span>
        <span class="c1">#         self.spamfeature[spam_index] = self.Y[self.dao.all_User[spamuser]]</span>
        <span class="c1">#         spam_index += 1</span>
        <span class="c1"># self.randomNormal = np.zeros((500,2))</span>
        <span class="c1"># self.randomSpam = np.zeros((500,2))</span>
        <span class="c1"># # for i in range(500):</span>
        <span class="c1"># #     self.randomNormal[i] = self.normalfeature[random.randint(0,len(self.normalfeature)-1)]</span>
        <span class="c1"># #     self.randomSpam[i] = self.spamfeature[random.randint(0,len(self.spamfeature)-1)]</span>
        <span class="c1"># plt.scatter(self.normalfeature[:, 0], self.normalfeature[:, 1], c=&#39;red&#39;,s=8,marker=&#39;o&#39;,label=&#39;NormalUser&#39;)</span>
        <span class="c1"># plt.scatter(self.spamfeature[:, 0], self.spamfeature[:, 1], c=&#39;blue&#39;,s=8,marker=&#39;o&#39;,label=&#39;Spammer&#39;)</span>
        <span class="c1"># plt.legend(loc=&#39;lower left&#39;)</span>
        <span class="c1"># plt.xticks([])</span>
        <span class="c1"># plt.yticks([])</span>
        <span class="c1"># plt.savefig(&#39;9.png&#39;,dpi=500)</span>


    <span class="k">def</span> <span class="nf">predictRating</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">[</span><span class="n">user</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_Item</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">classifier</span> <span class="o">=</span>  <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="c1"># classifier = DecisionTreeClassifier(criterion=&#39;entropy&#39;)</span>
        <span class="n">classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainingLabels</span><span class="p">)</span>
        <span class="n">pred_labels</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decision Tree:&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pred_labels</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="CoDetector">CoDetector<a class="anchor-link" href="#CoDetector"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">CoDetector</span><span class="p">(</span><span class="n">SDetection</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">trainingSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">testSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fold</span><span class="o">=</span><span class="s1">&#39;[1]&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CoDetector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">trainingSet</span><span class="p">,</span> <span class="n">testSet</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fold</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">readConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CoDetector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">readConfiguration</span><span class="p">()</span>
        <span class="n">extraSettings</span> <span class="o">=</span> <span class="n">LineConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CoDetector&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">extraSettings</span><span class="p">[</span><span class="s1">&#39;-k&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">extraSettings</span><span class="p">[</span><span class="s1">&#39;-negCount&#39;</span><span class="p">])</span>  <span class="c1"># the number of negative samples</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">negCount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">negCount</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">regR</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">extraSettings</span><span class="p">[</span><span class="s1">&#39;-gamma&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">extraSettings</span><span class="p">[</span><span class="s1">&#39;-filter&#39;</span><span class="p">])</span>

        <span class="n">learningRate</span> <span class="o">=</span> <span class="n">LineConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;learnRate&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">learningRate</span><span class="p">[</span><span class="s1">&#39;-init&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxLRate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">learningRate</span><span class="p">[</span><span class="s1">&#39;-max&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxIter</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;num.max.iter&#39;</span><span class="p">])</span>
        <span class="n">regular</span> <span class="o">=</span> <span class="n">LineConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;reg.lambda&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">regI</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">regular</span><span class="p">[</span><span class="s1">&#39;-u&#39;</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">regular</span><span class="p">[</span><span class="s1">&#39;-i&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">printAlgorConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CoDetector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">printAlgorConfig</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;k: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">negCount</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;regR: </span><span class="si">%.5f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">regR</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;filter: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CoDetector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">initModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span>  <span class="c1"># bias value of user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span> <span class="mi">20</span>  <span class="c1"># bias value of context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span>  <span class="c1"># context embedding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span>  <span class="c1"># latent user matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_Item</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span>  <span class="c1"># latent item matrix</span>


        <span class="c1"># constructing SPPMI matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Constructing SPPMI matrix...&#39;</span><span class="p">)</span>
        <span class="c1"># for larger data set has many items, the process will be time consuming</span>
        <span class="n">occurrence</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">user1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">:</span>
            <span class="n">iList1</span><span class="p">,</span> <span class="n">rList1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">allUserRated</span><span class="p">(</span><span class="n">user1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iList1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">user2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">user1</span> <span class="o">==</span> <span class="n">user2</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">user2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">occurrence</span><span class="p">[</span><span class="n">user1</span><span class="p">]:</span>
                    <span class="n">iList2</span><span class="p">,</span> <span class="n">rList2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">allUserRated</span><span class="p">(</span><span class="n">user2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iList2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">iList1</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">iList2</span><span class="p">)))</span>
                    <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">:</span>
                        <span class="n">occurrence</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
                        <span class="n">occurrence</span><span class="p">[</span><span class="n">user2</span><span class="p">][</span><span class="n">user1</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>

        <span class="n">maxVal</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">frequency</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">user1</span> <span class="ow">in</span> <span class="n">occurrence</span><span class="p">:</span>
            <span class="n">frequency</span><span class="p">[</span><span class="n">user1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">occurrence</span><span class="p">[</span><span class="n">user1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">*</span> <span class="mf">1.0</span>
        <span class="n">D</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">frequency</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">*</span> <span class="mf">1.0</span>
        <span class="c1"># maxx = -1</span>
        <span class="k">for</span> <span class="n">user1</span> <span class="ow">in</span> <span class="n">occurrence</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">user2</span> <span class="ow">in</span> <span class="n">occurrence</span><span class="p">[</span><span class="n">user1</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">log</span><span class="p">(</span><span class="n">occurrence</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">]</span> <span class="o">*</span> <span class="n">D</span> <span class="o">/</span> <span class="p">(</span><span class="n">frequency</span><span class="p">[</span><span class="n">user1</span><span class="p">]</span> <span class="o">*</span> <span class="n">frequency</span><span class="p">[</span><span class="n">user2</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">negCount</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">]</span> <span class="o">*</span> <span class="n">D</span> <span class="o">/</span> <span class="p">(</span><span class="n">frequency</span><span class="p">[</span><span class="n">user1</span><span class="p">]</span> <span class="o">*</span> <span class="n">frequency</span><span class="p">[</span><span class="n">user2</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">maxVal</span> <span class="o">&lt;</span> <span class="n">val</span><span class="p">:</span>
                        <span class="n">maxVal</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user2</span><span class="p">][</span><span class="n">user1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">]</span>

        <span class="c1"># normalize</span>
        <span class="k">for</span> <span class="n">user1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">user2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user1</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">user2</span><span class="p">]</span> <span class="o">/</span> <span class="n">maxVal</span>

    <span class="k">def</span> <span class="nf">buildModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Jointly decompose R(ratings) and SPPMI with shared user latent factors P</span>
        <span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">iteration</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxIter</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">ratings</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">ratings</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">ratings</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                    <span class="n">rating</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">ratings</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">rating</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictRating</span><span class="p">(</span><span class="n">user</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>
                    <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">[</span><span class="n">user</span><span class="p">]</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_Item</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">+=</span> <span class="n">error</span> <span class="o">**</span> <span class="mi">2</span>
                    <span class="c1"># update latent vectors</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="p">(</span><span class="n">error</span> <span class="o">*</span> <span class="n">q</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">regU</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="p">(</span><span class="n">error</span> <span class="o">*</span> <span class="n">p</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">regI</span> <span class="o">*</span> <span class="n">q</span><span class="p">)</span>


            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">:</span>
                <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">[</span><span class="n">user</span><span class="p">]</span>
                <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">context</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">[</span><span class="n">context</span><span class="p">]</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPPMI</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">context</span><span class="p">]</span>
                    <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                    <span class="n">diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">+=</span> <span class="n">diff</span> <span class="o">**</span> <span class="mi">2</span>
                    <span class="c1"># update latent vectors</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="n">diff</span> <span class="o">*</span> <span class="n">g</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="n">diff</span> <span class="o">*</span> <span class="n">p</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="n">diff</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lRate</span> <span class="o">*</span> <span class="n">diff</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loss</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regU</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">regI</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">regR</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iteration:&#39;</span><span class="p">,</span><span class="n">iteration</span><span class="p">)</span>

        <span class="c1"># preparing examples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trainingLabels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testLabels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">[</span><span class="n">user</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trainingLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">[</span><span class="n">user</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">predictRating</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_User</span><span class="p">[</span><span class="n">user</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">all_Item</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">classifier</span> <span class="o">=</span>  <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">)</span>
        <span class="n">classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainingLabels</span><span class="p">)</span>
        <span class="n">pred_labels</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decision Tree:&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pred_labels</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="DegreeSAD">DegreeSAD<a class="anchor-link" href="#DegreeSAD"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">DegreeSAD</span><span class="p">(</span><span class="n">SDetection</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">trainingSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">testSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fold</span><span class="o">=</span><span class="s1">&#39;[1]&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DegreeSAD</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">trainingSet</span><span class="p">,</span> <span class="n">testSet</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fold</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">buildModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MUD</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RUD</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">QUD</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># computing MUD,RUD,QUD for training set</span>
        <span class="n">sList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">maxLength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sList</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MUD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">MUD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="c1">#/ float(maxLength)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MUD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">]))</span>
            <span class="n">lengthList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">]]</span>
            <span class="n">lengthList</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RUD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="n">lengthList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">lengthList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">lengthList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">]]</span>
            <span class="n">lengthList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">QUD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="n">lengthList</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">lengthList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)]</span>

        <span class="c1"># computing MUD,RUD,QUD for test set</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MUD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">MUD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="c1">#/ float(maxLength)</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">:</span>
            <span class="n">lengthList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">]]</span>
            <span class="n">lengthList</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RUD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="n">lengthList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">lengthList</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">:</span>
            <span class="n">lengthList</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">]]</span>
            <span class="n">lengthList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">QUD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="n">lengthList</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">lengthList</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)]</span>

        <span class="c1"># preparing examples</span>

        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">MUD</span><span class="p">[</span><span class="n">user</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">RUD</span><span class="p">[</span><span class="n">user</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">QUD</span><span class="p">[</span><span class="n">user</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trainingLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">MUD</span><span class="p">[</span><span class="n">user</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">RUD</span><span class="p">[</span><span class="n">user</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">QUD</span><span class="p">[</span><span class="n">user</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># classifier = LogisticRegression()</span>
        <span class="c1"># classifier.fit(self.training, self.trainingLabels)</span>
        <span class="c1"># pred_labels = classifier.predict(self.test)</span>
        <span class="c1"># print &#39;Logistic:&#39;</span>
        <span class="c1"># print classification_report(self.testLabels, pred_labels)</span>
        <span class="c1">#</span>
        <span class="c1"># classifier = SVC()</span>
        <span class="c1"># classifier.fit(self.training, self.trainingLabels)</span>
        <span class="c1"># pred_labels = classifier.predict(self.test)</span>
        <span class="c1"># print &#39;SVM:&#39;</span>
        <span class="c1"># print classification_report(self.testLabels, pred_labels)</span>

        <span class="n">classifier</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span><span class="p">)</span>
        <span class="n">classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainingLabels</span><span class="p">)</span>
        <span class="n">pred_labels</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Decision Tree:&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pred_labels</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="FAP">FAP<a class="anchor-link" href="#FAP"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">FAP</span><span class="p">(</span><span class="n">SDetection</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">trainingSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">testSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fold</span><span class="o">=</span><span class="s1">&#39;[1]&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FAP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">trainingSet</span><span class="p">,</span> <span class="n">testSet</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fold</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">readConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FAP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">readConfiguration</span><span class="p">()</span>
        <span class="c1"># # s means the number of seedUser who be regarded as spammer in training</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span><span class="nb">int</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;seedUser&#39;</span><span class="p">])</span>
        <span class="c1"># preserve the real spammer ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spammer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">spammer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">user</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">sThreshold</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spammer</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">&gt;</span> <span class="n">sThreshold</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">sThreshold</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** seedUser is more than a half of spammer, so it is set to&#39;</span><span class="p">,</span> <span class="n">sThreshold</span><span class="p">,</span> <span class="s1">&#39;***&#39;</span><span class="p">)</span>

        <span class="c1"># # predict top-k user as spammer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;topKSpam&#39;</span><span class="p">])</span>
        <span class="c1"># 0.5 is the ratio of spammer to dataset, it can be changed according to different datasets</span>
        <span class="n">kThreshold</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">user</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">&gt;</span> <span class="n">kThreshold</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">kThreshold</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** the number of top-K users is more than threshold value, so it is set to&#39;</span><span class="p">,</span> <span class="n">kThreshold</span><span class="p">,</span> <span class="s1">&#39;***&#39;</span><span class="p">)</span>
    <span class="c1"># product transition probability matrix self.TPUI and self.TPIU</span>

    <span class="k">def</span> <span class="nf">__computeTProbability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># m--user count; n--item count</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TPUI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TPIU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">userUserIdDic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemItemIdDic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tmpUser</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">tmpUserId</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">tmpItem</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">tmpItemId</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">users</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">userUserIdDic</span><span class="p">[</span><span class="n">tmpUser</span><span class="p">[</span><span class="n">users</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tmpUserId</span><span class="p">[</span><span class="n">users</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemItemIdDic</span><span class="p">[</span><span class="n">tmpItem</span><span class="p">[</span><span class="n">items</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tmpItemId</span><span class="p">[</span><span class="n">items</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">userUserIdDic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">itemItemIdDic</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="c1"># if has edge in graph,set a value ;otherwise set 0</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">user</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bipartiteGraphUI</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bipartiteGraphUI</span><span class="p">[</span><span class="n">user</span><span class="p">]):</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">w</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bipartiteGraphUI</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">])</span>
                    <span class="c1"># to avoid positive feedback and reliability problem,we should Polish the w</span>
                    <span class="n">otherItemW</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">otherUserW</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">otherItem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bipartiteGraphUI</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                        <span class="n">otherItemW</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bipartiteGraphUI</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">otherItem</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">otherUser</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                        <span class="n">otherUserW</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bipartiteGraphUI</span><span class="p">[</span><span class="n">otherUser</span><span class="p">][</span><span class="n">item</span><span class="p">])</span>
                    <span class="c1"># wPrime = w*1.0/(otherUserW * otherItemW)</span>
                    <span class="n">wPrime</span> <span class="o">=</span> <span class="n">w</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">TPUI</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">wPrime</span> <span class="o">/</span> <span class="n">otherItemW</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">TPIU</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">wPrime</span> <span class="o">/</span> <span class="n">otherUserW</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;progress: </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">m</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">initModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># construction of the bipartite graph</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;constructing bipartite graph...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bipartiteGraphUI</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">:</span>
            <span class="n">tmpUserItemDic</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># user-item-point</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                <span class="c1"># tmpItemUserDic = {}#item-user-point</span>
                <span class="n">recordValue</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">])</span>
                <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">((</span><span class="n">recordValue</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">userMeans</span><span class="p">[</span><span class="n">user</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">userMeans</span><span class="p">[</span><span class="n">user</span><span class="p">])</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">recordValue</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">itemMeans</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">itemMeans</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">recordValue</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">globalMean</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">globalMean</span><span class="p">)</span>
                <span class="c1"># tmpItemUserDic[user] = w</span>
                <span class="n">tmpUserItemDic</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span>
            <span class="c1"># self.bipartiteGraphIU[item] = tmpItemUserDic</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bipartiteGraphUI</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmpUserItemDic</span>
        <span class="c1"># we do the polish in computing the transition probability</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;computing transition probability...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__computeTProbability</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">isConvergence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PUser</span><span class="p">,</span> <span class="n">PUserOld</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">PUserOld</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">PUser</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">PUser</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">PUserOld</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">buildModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># -------init--------</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSize</span><span class="p">()</span>
        <span class="n">PUser</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">PItem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testLabels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predLabels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>

        <span class="c1"># preserve seedUser Index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seedUser</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">randDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">):</span>
            <span class="n">randNum</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spammer</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">randNum</span> <span class="ow">in</span> <span class="n">randDict</span><span class="p">:</span>
                <span class="n">randNum</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spammer</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">randDict</span><span class="p">[</span><span class="n">randNum</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seedUser</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spammer</span><span class="p">[</span><span class="n">randNum</span><span class="p">]))</span>
            <span class="c1"># print len(randDict), randDict</span>

        <span class="c1">#initial user and item spam probability</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seedUser</span><span class="p">:</span>
                <span class="c1">#print type(j),j</span>
                <span class="n">PUser</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">PUser</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">PItem</span><span class="p">[</span><span class="n">tmp</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>

        <span class="c1"># -------iterator-------</span>
        <span class="n">PUserOld</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">isConvergence</span><span class="p">(</span><span class="n">PUser</span><span class="p">,</span> <span class="n">PUserOld</span><span class="p">):</span>
        <span class="c1">#while iterator &lt; 100:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seedUser</span><span class="p">:</span>
                <span class="n">PUser</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">PUserOld</span> <span class="o">=</span> <span class="n">PUser</span>
            <span class="n">PItem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TPIU</span><span class="p">,</span> <span class="n">PUser</span><span class="p">)</span>
            <span class="n">PUser</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TPUI</span><span class="p">,</span> <span class="n">PItem</span><span class="p">)</span>
            <span class="n">iterator</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foldInfo</span><span class="p">,</span><span class="s1">&#39;iteration&#39;</span><span class="p">,</span> <span class="n">iterator</span><span class="p">)</span>

        <span class="n">PUserDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">userId</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">PUser</span><span class="p">:</span>
            <span class="n">PUserDict</span><span class="p">[</span><span class="n">userId</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">userId</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seedUser</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">PUserDict</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PSort</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">PUserDict</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># predLabels</span>
        <span class="c1"># top-k user as spammer</span>
        <span class="n">spamList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">sIndex</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">:</span>
            <span class="n">spam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PSort</span><span class="p">[</span><span class="n">sIndex</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">spamList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spam</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predLabels</span><span class="p">[</span><span class="n">spam</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">sIndex</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># trueLabels</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">:</span>
            <span class="n">userInd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">user</span><span class="p">[</span><span class="n">user</span><span class="p">]</span>
            <span class="c1"># print type(user), user, userInd</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testLabels</span><span class="p">[</span><span class="n">userInd</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>

        <span class="c1"># delete seedUser labels</span>
        <span class="n">differ</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seedUser</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">user</span> <span class="o">-</span> <span class="n">differ</span><span class="p">)</span>
            <span class="c1"># print type(user)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">predLabels</span><span class="p">[</span><span class="n">user</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">testLabels</span><span class="p">[</span><span class="n">user</span><span class="p">]</span>
            <span class="n">differ</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predLabels</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="PCASelectUsers">PCASelectUsers<a class="anchor-link" href="#PCASelectUsers"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">PCASelectUsers</span><span class="p">(</span><span class="n">SDetection</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">trainingSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">testSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fold</span><span class="o">=</span><span class="s1">&#39;[1]&#39;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PCASelectUsers</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">trainingSet</span><span class="p">,</span> <span class="n">testSet</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fold</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">readConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PCASelectUsers</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">readConfiguration</span><span class="p">()</span>
        <span class="c1"># K = top-K vals of cov</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;kVals&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">userNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">&gt;=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userNum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">itemNum</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** k-vals is more than the number of user or item, so it is set to&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>

        <span class="c1"># n = attack size or the ratio of spammers to normal users</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;attackSize&#39;</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">buildModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#array initialization</span>
        <span class="n">dataArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">userNum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">itemNum</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testLabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userNum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predLabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userNum</span><span class="p">)</span>

        <span class="c1">#add data</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;construct matrix&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
                <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">user</span><span class="p">[</span><span class="n">user</span><span class="p">]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">item</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                <span class="n">dataArray</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">sMatrix</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">(</span><span class="n">dataArray</span><span class="p">)</span>
        <span class="c1"># z-scores</span>
        <span class="n">sMatrix</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">sMatrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">with_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">sMT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">sMatrix</span><span class="p">)</span>
        <span class="c1"># cov</span>
        <span class="n">covSM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sMT</span><span class="p">,</span> <span class="n">sMatrix</span><span class="p">)</span>
        <span class="c1"># eigen-value-decomposition</span>
        <span class="n">vals</span><span class="p">,</span> <span class="n">vecs</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigs</span><span class="p">(</span><span class="n">covSM</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;LM&#39;</span><span class="p">)</span>

        <span class="n">newArray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dataArray</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">vecs</span><span class="p">))</span>

        <span class="n">distanceDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">userId</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">newArray</span><span class="p">:</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">user</span><span class="p">:</span>
                <span class="n">distance</span> <span class="o">+=</span> <span class="n">tmp</span>
            <span class="n">distanceDict</span><span class="p">[</span><span class="n">userId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
            <span class="n">userId</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sort distance &#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disSort</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">distanceDict</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;predict spammer&#39;</span><span class="p">)</span>
        <span class="n">spamList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disSort</span><span class="p">):</span>
            <span class="n">spam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disSort</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">spamList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spam</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">predLabels</span><span class="p">[</span><span class="n">spam</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># trueLabels</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">:</span>
            <span class="n">userInd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">user</span><span class="p">[</span><span class="n">user</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testLabels</span><span class="p">[</span><span class="n">userInd</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predLabels</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SemiSAD">SemiSAD<a class="anchor-link" href="#SemiSAD"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">SemiSAD</span><span class="p">(</span><span class="n">SDetection</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">trainingSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">testSet</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fold</span><span class="o">=</span><span class="s1">&#39;[1]&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SemiSAD</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="n">trainingSet</span><span class="p">,</span> <span class="n">testSet</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">fold</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">readConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SemiSAD</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">readConfiguration</span><span class="p">()</span>
        <span class="c1"># K = top-K vals of cov</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;topK&#39;</span><span class="p">])</span>
        <span class="c1"># Lambda = λ参数</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Lambda</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;Lambda&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">buildModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DegSim</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LengVar</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RDMA</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FMTD</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Begin feature engineering...&#39;</span><span class="p">)</span>
        <span class="c1"># computing H,DegSim,LengVar,RDMA,FMTD for LabledData set</span>
        <span class="n">trainingIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">testIndex</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">trainingUserCount</span><span class="p">,</span> <span class="n">trainingItemCount</span><span class="p">,</span> <span class="n">trainingrecordCount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSize</span><span class="p">()</span>
        <span class="n">testUserCount</span><span class="p">,</span> <span class="n">testItemCount</span><span class="p">,</span> <span class="n">testrecordCount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSize</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">:</span>
            <span class="n">trainingIndex</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                    <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">==</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mf">10.0</span><span class="p">)):</span>
                        <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="p">(</span><span class="n">trainingUserCount</span><span class="o">*</span><span class="mf">1.0</span><span class="p">))</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="p">(</span><span class="n">trainingUserCount</span><span class="o">*</span><span class="mf">1.0</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>

            <span class="n">SimList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DegSim</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">user1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">:</span>
                <span class="n">userA</span><span class="p">,</span> <span class="n">userB</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user1</span><span class="p">]))):</span>
                    <span class="n">userA</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
                    <span class="n">userB</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
                    <span class="n">Count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">Count</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">AverageA</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">AverageB</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">AverageA</span> <span class="o">=</span> <span class="n">userA</span><span class="o">/</span><span class="n">Count</span>
                    <span class="n">AverageB</span> <span class="o">=</span> <span class="n">userB</span><span class="o">/</span><span class="n">Count</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user1</span><span class="p">]))):</span>
                    <span class="n">C</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">-</span><span class="n">AverageA</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">-</span><span class="n">AverageB</span><span class="p">)</span>
                    <span class="n">D</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">-</span><span class="n">AverageA</span><span class="p">)</span>
                    <span class="n">E</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">-</span><span class="n">AverageB</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">C</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">SimList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">SimList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C</span><span class="o">/</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">E</span><span class="p">)))</span>
            <span class="n">SimList</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DegSim</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">+=</span> <span class="n">SimList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>

            <span class="n">GlobalAverage</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">F</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">user2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">:</span>
                <span class="n">GlobalAverage</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">user3</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">:</span>
                <span class="n">F</span> <span class="o">+=</span> <span class="nb">pow</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user3</span><span class="p">])</span><span class="o">-</span><span class="n">GlobalAverage</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LengVar</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">])</span><span class="o">-</span><span class="n">GlobalAverage</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">F</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span>

            <span class="n">Divisor</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">item1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                <span class="n">Divisor</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">itemMeans</span><span class="p">[</span><span class="n">item1</span><span class="p">])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RDMA</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="n">Divisor</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>

            <span class="n">Minuend</span><span class="p">,</span> <span class="n">index1</span><span class="p">,</span> <span class="n">Subtrahend</span><span class="p">,</span> <span class="n">index2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">item3</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item3</span><span class="p">]</span><span class="o">==</span><span class="mf">5.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item3</span><span class="p">]</span><span class="o">==</span><span class="mf">1.0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">Minuend</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item3</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                    <span class="n">index1</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item3</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Subtrahend</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item3</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                    <span class="n">index2</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_i</span><span class="p">[</span><span class="n">item3</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">index1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">index2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FMTD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">index1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FMTD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Subtrahend</span> <span class="o">/</span> <span class="n">index2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">index2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FMTD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Minuend</span> <span class="o">/</span> <span class="n">index1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FMTD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Minuend</span> <span class="o">/</span> <span class="n">index1</span> <span class="o">-</span> <span class="n">Subtrahend</span> <span class="o">/</span> <span class="n">index2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">trainingIndex</span><span class="o">==</span><span class="p">(</span><span class="n">trainingUserCount</span><span class="o">/</span><span class="mi">5</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;trainingData Done 20%...&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">trainingIndex</span><span class="o">==</span><span class="p">(</span><span class="n">trainingUserCount</span><span class="o">/</span><span class="mi">5</span><span class="o">*</span><span class="mi">2</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;trainingData Done 40%...&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">trainingIndex</span><span class="o">==</span><span class="p">(</span><span class="n">trainingUserCount</span><span class="o">/</span><span class="mi">5</span><span class="o">*</span><span class="mi">3</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;trainingData Done 60%...&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">trainingIndex</span><span class="o">==</span><span class="p">(</span><span class="n">trainingUserCount</span><span class="o">/</span><span class="mi">5</span><span class="o">*</span><span class="mi">4</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;trainingData Done 80%...&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">trainingIndex</span><span class="o">==</span><span class="p">(</span><span class="n">trainingUserCount</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;trainingData Done 100%...&#39;</span><span class="p">)</span>

        <span class="c1"># computing H,DegSim,LengVar,RDMA,FMTD for UnLabledData set</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">:</span>
            <span class="n">testIndex</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                    <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">==</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mf">10.0</span><span class="p">)):</span>
                        <span class="n">n</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="p">(</span><span class="n">testUserCount</span><span class="o">*</span><span class="mf">1.0</span><span class="p">))</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="p">(</span><span class="n">testUserCount</span><span class="o">*</span><span class="mf">1.0</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>

            <span class="n">SimList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DegSim</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">user1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">:</span>
                <span class="n">userA</span><span class="p">,</span> <span class="n">userB</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user1</span><span class="p">]))):</span>
                    <span class="n">userA</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
                    <span class="n">userB</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
                    <span class="n">Count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">Count</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">AverageA</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">AverageB</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">AverageA</span> <span class="o">=</span> <span class="n">userA</span><span class="o">/</span><span class="n">Count</span>
                    <span class="n">AverageB</span> <span class="o">=</span> <span class="n">userB</span><span class="o">/</span><span class="n">Count</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user1</span><span class="p">]))):</span>
                    <span class="n">C</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">-</span><span class="n">AverageA</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">-</span><span class="n">AverageB</span><span class="p">)</span>
                    <span class="n">D</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">-</span><span class="n">AverageA</span><span class="p">)</span>
                    <span class="n">E</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user1</span><span class="p">][</span><span class="n">item</span><span class="p">]</span><span class="o">-</span><span class="n">AverageB</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">C</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">SimList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">SimList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C</span><span class="o">/</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">E</span><span class="p">)))</span>
            <span class="n">SimList</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DegSim</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">+=</span> <span class="n">SimList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>

            <span class="n">GlobalAverage</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">F</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">user2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">:</span>
                <span class="n">GlobalAverage</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">user3</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">:</span>
                <span class="n">F</span> <span class="o">+=</span> <span class="nb">pow</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user3</span><span class="p">])</span><span class="o">-</span><span class="n">GlobalAverage</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LengVar</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">])</span><span class="o">-</span><span class="n">GlobalAverage</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">F</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span>

            <span class="n">Divisor</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">item1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                <span class="n">Divisor</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">itemMeans</span><span class="p">[</span><span class="n">item1</span><span class="p">])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_i</span><span class="p">[</span><span class="n">item1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RDMA</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="n">Divisor</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>

            <span class="n">Minuend</span><span class="p">,</span> <span class="n">index1</span><span class="p">,</span> <span class="n">Subtrahend</span><span class="p">,</span> <span class="n">index2</span><span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">item3</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">]:</span>
                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item3</span><span class="p">]</span><span class="o">==</span><span class="mf">5.0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">item3</span><span class="p">]</span><span class="o">==</span><span class="mf">1.0</span><span class="p">):</span>
                    <span class="n">Minuend</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_i</span><span class="p">[</span><span class="n">item3</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                    <span class="n">index1</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_i</span><span class="p">[</span><span class="n">item3</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Subtrahend</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_i</span><span class="p">[</span><span class="n">item3</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                    <span class="n">index2</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_i</span><span class="p">[</span><span class="n">item3</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">index1</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">index2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FMTD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">index1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FMTD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Subtrahend</span> <span class="o">/</span> <span class="n">index2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">index2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FMTD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Minuend</span> <span class="o">/</span> <span class="n">index1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FMTD</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Minuend</span> <span class="o">/</span> <span class="n">index1</span> <span class="o">-</span> <span class="n">Subtrahend</span> <span class="o">/</span> <span class="n">index2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">testIndex</span> <span class="o">==</span> <span class="n">testUserCount</span> <span class="o">/</span> <span class="mi">5</span><span class="p">:</span>
                 <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;testData Done 20%...&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">testIndex</span> <span class="o">==</span> <span class="n">testUserCount</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;testData Done 40%...&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">testIndex</span> <span class="o">==</span> <span class="n">testUserCount</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">3</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;testData Done 60%...&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">testIndex</span> <span class="o">==</span> <span class="n">testUserCount</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">4</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;testData Done 80%...&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">testIndex</span> <span class="o">==</span> <span class="n">testUserCount</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;testData Done 100%...&#39;</span><span class="p">)</span>

        <span class="c1"># preparing examples training for LabledData ,test for UnLableData</span>

        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">trainingSet_u</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">user</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">DegSim</span><span class="p">[</span><span class="n">user</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">LengVar</span><span class="p">[</span><span class="n">user</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">RDMA</span><span class="p">[</span><span class="n">user</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">FMTD</span><span class="p">[</span><span class="n">user</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trainingLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dao</span><span class="o">.</span><span class="n">testSet_u</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="p">[</span><span class="n">user</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">DegSim</span><span class="p">[</span><span class="n">user</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">LengVar</span><span class="p">[</span><span class="n">user</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">RDMA</span><span class="p">[</span><span class="n">user</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">FMTD</span><span class="p">[</span><span class="n">user</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">ClassifierN</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">classifier</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>
            <span class="n">X_train</span><span class="p">,</span><span class="n">X_test</span><span class="p">,</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">trainingLabels</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">33</span><span class="p">)</span>
            <span class="n">classifier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
            <span class="c1"># predict UnLabledData</span>
            <span class="c1">#pred_labelsForTrainingUn = classifier.predict(X_test)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Enhanced classifier...&#39;</span><span class="p">)</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">5</span><span class="p">:</span> <span class="c1"># min</span>
                    <span class="k">break</span>         <span class="c1">#min</span>
                <span class="n">proba_labelsForTrainingUn</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
                <span class="n">X_test_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">X_test</span><span class="p">,</span> <span class="n">proba_labelsForTrainingUn</span><span class="p">))</span>
                <span class="n">X_test_labels0_sort</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">X_test_labels</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">X_test_labels0_sort</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">&gt;</span><span class="n">X_test_labels0_sort</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">6</span><span class="p">]:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X_test_labels0_sort</span><span class="p">]</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
                    <span class="n">classifier</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">],</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span><span class="n">sample_weight</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lambda</span><span class="p">)</span>
                    <span class="n">X_test_labels</span> <span class="o">=</span> <span class="n">X_test_labels0_sort</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
                    <span class="n">X_test</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">:</span> <span class="c1"># min</span>
                    <span class="k">break</span>         <span class="c1">#min</span>

                <span class="n">X_test_labels0_sort</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">X_test_labels</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">X_test_labels0_sort</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">X_test_labels0_sort</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">6</span><span class="p">]:</span> <span class="c1">#min</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X_test_labels0_sort</span><span class="p">]</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
                    <span class="n">classifier</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span><span class="n">sample_weight</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">X_test_labels</span> <span class="o">=</span> <span class="n">X_test_labels0_sort</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>  <span class="c1"># min</span>
                    <span class="n">X_test</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">6</span><span class="p">:</span>
                    <span class="k">break</span>
            <span class="c1"># while 1 :</span>
            <span class="c1">#     p1 = pred_labelsForTrainingUn</span>
            <span class="c1">#     # 将带λ参数的无标签数据拟合入分类器</span>
            <span class="c1">#     classifier.partial_fit(X_test, pred_labelsForTrainingUn,classes=[&#39;0&#39;,&#39;1&#39;], sample_weight=np.ones(len(X_test),dtype=np.float)*self.Lambda)</span>
            <span class="c1">#     pred_labelsForTrainingUn = classifier.predict(X_test)</span>
            <span class="c1">#     p2 = pred_labelsForTrainingUn</span>
            <span class="c1">#     # 判断分类器是否稳定</span>
            <span class="c1">#     if list(p1)==list(p2) :</span>
            <span class="c1">#         ClassifierN += 1</span>
            <span class="c1">#     elif ClassifierN &gt; 0:</span>
            <span class="c1">#         ClassifierN = 0</span>
            <span class="c1">#     if ClassifierN == 20:</span>
            <span class="c1">#         break</span>
            <span class="n">pred_labels</span> <span class="o">=</span> <span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;naive_bayes with EM algorithm:&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pred_labels</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Main">Main<a class="anchor-link" href="#Main"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">SDLib</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">config</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trainingData</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># training data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testData</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># testData</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relation</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span><span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ratingConfig</span> <span class="o">=</span> <span class="n">LineConfig</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ratings.setup&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">loadLabels</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;evaluation.setup&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluation</span> <span class="o">=</span> <span class="n">LineConfig</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;evaluation.setup&#39;</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;-testSet&#39;</span><span class="p">):</span>
                <span class="c1">#specify testSet</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trainingData</span> <span class="o">=</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">loadDataSet</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ratings&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">testData</span> <span class="o">=</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">loadDataSet</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;-testSet&#39;</span><span class="p">],</span> <span class="n">bTest</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;-ap&#39;</span><span class="p">):</span>
                <span class="c1">#auto partition</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trainingData</span> <span class="o">=</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">loadDataSet</span><span class="p">(</span><span class="n">config</span><span class="p">,</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ratings&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trainingData</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">testData</span> <span class="o">=</span> <span class="n">DataSplit</span><span class="o">.</span>\
                    <span class="n">dataSplit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainingData</span><span class="p">,</span><span class="n">test_ratio</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;-ap&#39;</span><span class="p">]))</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;-cv&#39;</span><span class="p">):</span>
                <span class="c1">#cross validation</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trainingData</span> <span class="o">=</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">loadDataSet</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ratings&#39;</span><span class="p">])</span>
                <span class="c1">#self.trainingData,self.testData = DataSplit.crossValidation(self.trainingData,int(self.evaluation[&#39;-cv&#39;]))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Evaluation is not well configured!&#39;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;social&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socialConfig</span> <span class="o">=</span> <span class="n">LineConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;social.setup&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relation</span> <span class="o">=</span> <span class="n">FileIO</span><span class="o">.</span><span class="n">loadRelationship</span><span class="p">(</span><span class="n">config</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;social&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;preprocessing...&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;-cv&#39;</span><span class="p">):</span>
            <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;-cv&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="c1">#create the manager used to communication in multiprocess</span>
            <span class="n">manager</span> <span class="o">=</span> <span class="n">Manager</span><span class="p">()</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">train</span><span class="p">,</span><span class="n">test</span> <span class="ow">in</span> <span class="n">DataSplit</span><span class="o">.</span><span class="n">crossValidation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainingData</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
                <span class="n">fold</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;social&#39;</span><span class="p">):</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;methodName&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;(self.config,train,test,self.labels,self.relation,fold)&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;methodName&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;(self.config,train,test,self.labels,fold)&quot;</span>
               <span class="c1">#create the process</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run</span><span class="p">,</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="nb">eval</span><span class="p">(</span><span class="n">method</span><span class="p">),</span><span class="n">i</span><span class="p">))</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
            <span class="c1">#start the processes</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="c1">#wait until all processes are completed</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="c1">#compute the mean error of k-fold cross validation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measure</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">m</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(\d+\.\d+)&#39;</span><span class="p">)</span>
            <span class="n">countPattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;\d+</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">)</span>
            <span class="n">labelPattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;\s\d</span><span class="si">{1}</span><span class="s1">[^\.|</span><span class="se">\n</span><span class="s1">|\d]&#39;</span><span class="p">)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">labelPattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">9</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">report</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">measure</span><span class="p">:</span>
                <span class="n">patterns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span><span class="n">report</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">values</span> <span class="o">+=</span> <span class="n">patterns</span><span class="p">[:</span><span class="mi">9</span><span class="p">]</span>
                <span class="n">patterncounts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">countPattern</span><span class="p">,</span><span class="n">report</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="n">patterncounts</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">values</span><span class="o">/=</span><span class="n">k</span>
            <span class="n">values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;             precision  recall  f1-score  support</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;         &#39;</span><span class="o">+</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;  &#39;</span><span class="o">+</span><span class="s1">&#39;    &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;   &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;         &#39;</span><span class="o">+</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;  &#39;</span><span class="o">+</span><span class="s1">&#39;    &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;   &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;  avg/total   &#39;</span> <span class="o">+</span> <span class="s1">&#39;    &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;   &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
                <span class="c1"># for line in lines[1:]:</span>
                <span class="c1">#</span>
                <span class="c1"># measure = self.measure[0][i].split(&#39;:&#39;)[0]</span>
                <span class="c1"># total = 0</span>
                <span class="c1"># for j in range(k):</span>
                <span class="c1">#     total += float(self.measure[j][i].split(&#39;:&#39;)[1])</span>
                <span class="c1"># res.append(measure+&#39;:&#39;+str(total/k)+&#39;\n&#39;)</span>
            <span class="c1">#output result</span>
            <span class="n">currentTime</span> <span class="o">=</span> <span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H-%M-%S&quot;</span><span class="p">,</span> <span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="p">()))</span>
            <span class="n">outDir</span> <span class="o">=</span> <span class="n">LineConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;output.setup&#39;</span><span class="p">])[</span><span class="s1">&#39;-dir&#39;</span><span class="p">]</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;methodName&#39;</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39;@&#39;</span><span class="o">+</span><span class="n">currentTime</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-fold-cv&#39;</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span>
            <span class="n">FileIO</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="n">outDir</span><span class="p">,</span><span class="n">fileName</span><span class="p">,</span><span class="n">res</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The results have been output to &#39;</span><span class="o">+</span><span class="n">abspath</span><span class="p">(</span><span class="n">LineConfig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;output.setup&#39;</span><span class="p">])[</span><span class="s1">&#39;-dir&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;social&#39;</span><span class="p">):</span>
                <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;methodName&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;(self.config,self.trainingData,self.testData,self.labels,self.relation)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;methodName&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;(self.config,self.trainingData,self.testData,self.labels)&#39;</span>
            <span class="nb">eval</span><span class="p">(</span><span class="n">method</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">measure</span><span class="p">,</span><span class="n">algor</span><span class="p">,</span><span class="n">order</span><span class="p">):</span>
    <span class="n">measure</span><span class="p">[</span><span class="n">order</span><span class="p">]</span> <span class="o">=</span> <span class="n">algor</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;DegreeSAD.conf&#39;</span><span class="p">)</span>
<span class="n">sd</span> <span class="o">=</span> <span class="n">SDLib</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
<span class="n">sd</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading training data...
preprocessing...
Algorithm: DegreeSAD
Ratings dataSet: /content/dataset/amazon/profiles.txt
Training set size: (user count: 3921, item count 14711, record count: 40730)
Test set size: (user count: 981, item count 6079, record count: 10368)
================================================================================
Initializing model [1]...
Building Model [1]...
Initializing model [2]...
Building Model [2]...
Initializing model [3]...
Building Model [3]...
Initializing model [4]...
Building Model [4]...
Initializing model [5]...
Building Model [5]...
Predicting [1]...
Decision Tree:
Predicting [2]...
              precision    recall  f1-score   support

           0     0.7709    0.8498    0.8084       586
           1     0.7373    0.6253    0.6767       395

    accuracy                         0.7594       981
   macro avg     0.7541    0.7376    0.7426       981
weighted avg     0.7574    0.7594    0.7554       981

Decision Tree:
              precision    recall  f1-score   support

           0     0.7852    0.8425    0.8128       603
           1     0.7156    0.6323    0.6713       378

    accuracy                         0.7615       981
   macro avg     0.7504    0.7374    0.7421       981
weighted avg     0.7583    0.7615    0.7583       981

Predicting [3]...
Decision Tree:
              precision    recall  f1-score   support

           0     0.7658    0.8381    0.8003       593
           1     0.7100    0.6072    0.6546       387

    accuracy                         0.7469       980
   macro avg     0.7379    0.7227    0.7275       980
weighted avg     0.7437    0.7469    0.7428       980

Predicting [5]...
Predicting [4]...
Decision Tree:
              precision    recall  f1-score   support

           0     0.7876    0.8148    0.8010       610
           1     0.6762    0.6378    0.6565       370

    accuracy                         0.7480       980
   macro avg     0.7319    0.7263    0.7287       980
weighted avg     0.7456    0.7480    0.7464       980

Decision Tree:
              precision    recall  f1-score   support

           0     0.7929    0.8507    0.8208       603
           1     0.7297    0.6446    0.6845       377

    accuracy                         0.7714       980
   macro avg     0.7613    0.7477    0.7527       980
weighted avg     0.7686    0.7714    0.7684       980

Total:
             precision  recall  f1-score  support

          0   0.7805    0.8392    0.8087   2995
          1   0.7138    0.6294    0.6687   1907

  avg/total   0.7574    0.7471    0.7343   4902

The results have been output to /content/results

</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Supervised Methods:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1. DegreeSAD   2.CoDetector   3.BayesDetector</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Semi-Supervised Methods:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;4. SemiSAD</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unsupervised Methods:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;5. PCASelectUsers    6. FAP   7.timeIndex</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
<span class="n">order</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;please enter the num of the method to run it:&#39;</span><span class="p">))</span>

<span class="n">algor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">conf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>

<span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;DegreeSAD.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;CoDetector.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;BayesDetector.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;SemiSAD.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;PCASelectUsers.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;FAP.conf&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;timeIndex.conf&#39;</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error num!&#39;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># conf = Config(&#39;DegreeSAD.conf&#39;)</span>

<span class="n">sd</span> <span class="o">=</span> <span class="n">SDLib</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
<span class="n">sd</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Run time: </span><span class="si">%f</span><span class="s2"> s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">s</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>================================================================================
Supervised Methods:
1. DegreeSAD   2.CoDetector   3.BayesDetector

Semi-Supervised Methods:
4. SemiSAD

Unsupervised Methods:
5. PCASelectUsers    6. FAP   7.timeIndex

--------------------------------------------------------------------------------
please enter the num of the method to run it:2
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:14: DeprecationWarning: time.clock has been deprecated in Python 3.3 and will be removed from Python 3.8: use time.perf_counter or time.process_time instead
  
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading training data...
preprocessing...
Algorithm: CoDetector
Ratings dataSet: /content/dataset/amazon/profiles.txt
Training set size: (user count: 3501, item count 13751, record count: 36766)
Test set size: (user count: 1401, item count 7439, record count: 14332)
================================================================================
k: 256
regR: 1.00000
filter: 4
================================================================================
Initializing model [1]...
Constructing SPPMI matrix...
Building Model [1]...
iteration: 1
iteration: 2
iteration: 3
iteration: 4
iteration: 5
iteration: 6
iteration: 7
iteration: 8
iteration: 9
iteration: 10
iteration: 11
iteration: 12
iteration: 13
iteration: 14
iteration: 15
iteration: 16
iteration: 17
iteration: 18
iteration: 19
iteration: 20
iteration: 21
iteration: 22
iteration: 23
iteration: 24
iteration: 25
iteration: 26
iteration: 27
iteration: 28
iteration: 29
iteration: 30
iteration: 31
iteration: 32
iteration: 33
iteration: 34
iteration: 35
iteration: 36
iteration: 37
iteration: 38
iteration: 39
iteration: 40
iteration: 41
iteration: 42
iteration: 43
iteration: 44
iteration: 45
iteration: 46
iteration: 47
iteration: 48
iteration: 49
iteration: 50
iteration: 51
iteration: 52
iteration: 53
iteration: 54
iteration: 55
iteration: 56
iteration: 57
iteration: 58
iteration: 59
iteration: 60
iteration: 61
iteration: 62
iteration: 63
iteration: 64
iteration: 65
iteration: 66
iteration: 67
iteration: 68
iteration: 69
iteration: 70
iteration: 71
iteration: 72
iteration: 73
iteration: 74
iteration: 75
iteration: 76
iteration: 77
iteration: 78
iteration: 79
iteration: 80
iteration: 81
iteration: 82
iteration: 83
iteration: 84
iteration: 85
iteration: 86
iteration: 87
iteration: 88
iteration: 89
iteration: 90
iteration: 91
iteration: 92
iteration: 93
iteration: 94
iteration: 95
iteration: 96
iteration: 97
iteration: 98
iteration: 99
iteration: 100
iteration: 101
iteration: 102
iteration: 103
iteration: 104
iteration: 105
iteration: 106
iteration: 107
iteration: 108
iteration: 109
iteration: 110
iteration: 111
iteration: 112
iteration: 113
iteration: 114
iteration: 115
iteration: 116
iteration: 117
iteration: 118
iteration: 119
iteration: 120
iteration: 121
iteration: 122
iteration: 123
iteration: 124
iteration: 125
iteration: 126
iteration: 127
iteration: 128
iteration: 129
iteration: 130
iteration: 131
iteration: 132
iteration: 133
iteration: 134
iteration: 135
iteration: 136
iteration: 137
iteration: 138
iteration: 139
iteration: 140
iteration: 141
iteration: 142
iteration: 143
iteration: 144
iteration: 145
iteration: 146
iteration: 147
iteration: 148
iteration: 149
iteration: 150
iteration: 151
iteration: 152
iteration: 153
iteration: 154
iteration: 155
iteration: 156
iteration: 157
iteration: 158
iteration: 159
iteration: 160
iteration: 161
iteration: 162
iteration: 163
iteration: 164
iteration: 165
iteration: 166
iteration: 167
iteration: 168
iteration: 169
iteration: 170
iteration: 171
iteration: 172
iteration: 173
iteration: 174
iteration: 175
iteration: 176
iteration: 177
iteration: 178
iteration: 179
iteration: 180
iteration: 181
iteration: 182
iteration: 183
iteration: 184
iteration: 185
iteration: 186
iteration: 187
iteration: 188
iteration: 189
iteration: 190
iteration: 191
iteration: 192
iteration: 193
iteration: 194
iteration: 195
iteration: 196
iteration: 197
iteration: 198
iteration: 199
iteration: 200
Predicting [1]...
Decision Tree:
              precision    recall  f1-score   support

           0     0.9139    0.8867    0.9001       874
           1     0.8210    0.8615    0.8407       527

    accuracy                         0.8772      1401
   macro avg     0.8674    0.8741    0.8704      1401
weighted avg     0.8790    0.8772    0.8778      1401

Run time: 312.447489 s
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:44: DeprecationWarning: time.clock has been deprecated in Python 3.3 and will be removed from Python 3.8: use time.perf_counter or time.process_time instead
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Supervised Methods:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1. DegreeSAD   2.CoDetector   3.BayesDetector</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Semi-Supervised Methods:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;4. SemiSAD</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unsupervised Methods:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;5. PCASelectUsers    6. FAP   7.timeIndex</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
<span class="n">order</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;please enter the num of the method to run it:&#39;</span><span class="p">))</span>

<span class="n">algor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">conf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>

<span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;DegreeSAD.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;CoDetector.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;BayesDetector.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;SemiSAD.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;PCASelectUsers.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;FAP.conf&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;timeIndex.conf&#39;</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error num!&#39;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># conf = Config(&#39;DegreeSAD.conf&#39;)</span>

<span class="n">sd</span> <span class="o">=</span> <span class="n">SDLib</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
<span class="n">sd</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Run time: </span><span class="si">%f</span><span class="s2"> s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">s</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>================================================================================
Supervised Methods:
1. DegreeSAD   2.CoDetector   3.BayesDetector

Semi-Supervised Methods:
4. SemiSAD

Unsupervised Methods:
5. PCASelectUsers    6. FAP   7.timeIndex

--------------------------------------------------------------------------------
please enter the num of the method to run it:1
loading training data...
preprocessing...
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:14: DeprecationWarning: time.clock has been deprecated in Python 3.3 and will be removed from Python 3.8: use time.perf_counter or time.process_time instead
  
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Algorithm: DegreeSAD
Ratings dataSet: /content/dataset/amazon/profiles.txt
Training set size: (user count: 3921, item count 14711, record count: 40730)
Test set size: (user count: 981, item count 6079, record count: 10368)
================================================================================
Initializing model [1]...
Building Model [1]...
Initializing model [2]...
Building Model [2]...
Initializing model [3]...
Building Model [3]...
Predicting [1]...
Initializing model [4]...
Building Model [4]...
Decision Tree:
              precision    recall  f1-score   support

           0     0.7689    0.8515    0.8081       586
           1     0.7380    0.6203    0.6740       395

    accuracy                         0.7584       981
   macro avg     0.7534    0.7359    0.7410       981
weighted avg     0.7564    0.7584    0.7541       981

Initializing model [5]...
Building Model [5]...
Predicting [2]...
Decision Tree:
Predicting [3]...
              precision    recall  f1-score   support

           0     0.7883    0.8458    0.8160       603
           1     0.7216    0.6376    0.6770       378

    accuracy                         0.7655       981
   macro avg     0.7549    0.7417    0.7465       981
weighted avg     0.7626    0.7655    0.7624       981

Predicting [4]...
Decision Tree:
              precision    recall  f1-score   support

           0     0.7673    0.8398    0.8019       593
           1     0.7130    0.6098    0.6574       387

    accuracy                         0.7490       980
   macro avg     0.7402    0.7248    0.7297       980
weighted avg     0.7459    0.7490    0.7448       980

Predicting [5]...
Decision Tree:
Decision Tree:
              precision    recall  f1-score   support

           0     0.7950    0.8491    0.8212       603
           1     0.7292    0.6499    0.6872       377

    accuracy                         0.7724       980
   macro avg     0.7621    0.7495    0.7542       980
weighted avg     0.7697    0.7724    0.7696       980

              precision    recall  f1-score   support

           0     0.7872    0.8246    0.8054       610
           1     0.6862    0.6324    0.6582       370

    accuracy                         0.7520       980
   macro avg     0.7367    0.7285    0.7318       980
weighted avg     0.7491    0.7520    0.7499       980

Total:
             precision  recall  f1-score  support

          0   0.7813    0.8422    0.8105   2995
          1   0.7176    0.63    0.6708   1907

  avg/total   0.7595    0.7495    0.7361   4902

The results have been output to /content/results

Run time: 1.097195 s
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:44: DeprecationWarning: time.clock has been deprecated in Python 3.3 and will be removed from Python 3.8: use time.perf_counter or time.process_time instead
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Supervised Methods:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1. DegreeSAD   2.CoDetector   3.BayesDetector</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Semi-Supervised Methods:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;4. SemiSAD</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unsupervised Methods:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;5. PCASelectUsers    6. FAP   7.timeIndex</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
<span class="n">order</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;please enter the num of the method to run it:&#39;</span><span class="p">))</span>

<span class="n">algor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">conf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>

<span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;DegreeSAD.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;CoDetector.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;BayesDetector.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;SemiSAD.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;PCASelectUsers.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;FAP.conf&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;timeIndex.conf&#39;</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error num!&#39;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># conf = Config(&#39;DegreeSAD.conf&#39;)</span>

<span class="n">sd</span> <span class="o">=</span> <span class="n">SDLib</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
<span class="n">sd</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Run time: </span><span class="si">%f</span><span class="s2"> s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">s</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>================================================================================
Supervised Methods:
1. DegreeSAD   2.CoDetector   3.BayesDetector

Semi-Supervised Methods:
4. SemiSAD

Unsupervised Methods:
5. PCASelectUsers    6. FAP   7.timeIndex

--------------------------------------------------------------------------------
please enter the num of the method to run it:6
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:14: DeprecationWarning: time.clock has been deprecated in Python 3.3 and will be removed from Python 3.8: use time.perf_counter or time.process_time instead
  
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading training data...
preprocessing...
*** seedUser is more than a half of spammer, so it is set to 75 ***
*** the number of top-K users is more than threshold value, so it is set to 791 ***
Algorithm: FAP
Ratings dataSet: /content/dataset/averageattack/ratings.txt
Training set size: (user count: 1658, item count 2071, record count: 44825)
Test set size: (user count: 0, item count 0, record count: 0)
================================================================================
Initializing model [1]...
constructing bipartite graph...
computing transition probability...
progress: 0/1658
progress: 100/1658
progress: 200/1658
progress: 300/1658
progress: 400/1658
progress: 500/1658
progress: 600/1658
progress: 700/1658
progress: 800/1658
progress: 900/1658
progress: 1000/1658
progress: 1100/1658
progress: 1200/1658
progress: 1300/1658
progress: 1400/1658
progress: 1500/1658
progress: 1600/1658
Building Model [1]...
[1] iteration 1
[1] iteration 2
[1] iteration 3
[1] iteration 4
[1] iteration 5
[1] iteration 6
[1] iteration 7
[1] iteration 8
[1] iteration 9
[1] iteration 10
[1] iteration 11
[1] iteration 12
[1] iteration 13
[1] iteration 14
[1] iteration 15
[1] iteration 16
[1] iteration 17
[1] iteration 18
[1] iteration 19
[1] iteration 20
[1] iteration 21
Predicting [1]...
              precision    recall  f1-score   support

           0     0.9448    0.5274    0.6770      1494
           1     0.0574    0.4831    0.1026        89

    accuracy                         0.5250      1583
   macro avg     0.5011    0.5053    0.3898      1583
weighted avg     0.8950    0.5250    0.6447      1583

Run time: 10.561271 s
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:44: DeprecationWarning: time.clock has been deprecated in Python 3.3 and will be removed from Python 3.8: use time.perf_counter or time.process_time instead
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Supervised Methods:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1. DegreeSAD   2.CoDetector   3.BayesDetector</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Semi-Supervised Methods:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;4. SemiSAD</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unsupervised Methods:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;5. PCASelectUsers    6. FAP   7.timeIndex</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span><span class="p">)</span>
<span class="n">order</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;please enter the num of the method to run it:&#39;</span><span class="p">))</span>

<span class="n">algor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">conf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>

<span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;DegreeSAD.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;CoDetector.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;BayesDetector.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;SemiSAD.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;PCASelectUsers.conf&#39;</span><span class="p">)</span>

<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;FAP.conf&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
    <span class="n">conf</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="s1">&#39;timeIndex.conf&#39;</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error num!&#39;</span><span class="p">)</span>
    <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># conf = Config(&#39;DegreeSAD.conf&#39;)</span>

<span class="n">sd</span> <span class="o">=</span> <span class="n">SDLib</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span>
<span class="n">sd</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Run time: </span><span class="si">%f</span><span class="s2"> s&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">s</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>================================================================================
Supervised Methods:
1. DegreeSAD   2.CoDetector   3.BayesDetector

Semi-Supervised Methods:
4. SemiSAD

Unsupervised Methods:
5. PCASelectUsers    6. FAP   7.timeIndex

--------------------------------------------------------------------------------
please enter the num of the method to run it:4
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:14: DeprecationWarning: time.clock has been deprecated in Python 3.3 and will be removed from Python 3.8: use time.perf_counter or time.process_time instead
  
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading training data...
preprocessing...
Algorithm: SemiSAD
Ratings dataSet: /content/dataset/averageattack/ratings.txt
Training set size: (user count: 1322, item count 2068, record count: 35286)
Test set size: (user count: 336, item count 1604, record count: 9539)
================================================================================
Initializing model [1]...
Building Model [1]...
Begin feature engineering...
trainingData Done 100%...
testData Done 100%...
Predicting [1]...
Enhanced classifier...
naive_bayes with EM algorithm:
              precision    recall  f1-score   support

           0     0.9107    1.0000    0.9533       306
           1     0.0000    0.0000    0.0000        30

    accuracy                         0.9107       336
   macro avg     0.4554    0.5000    0.4766       336
weighted avg     0.8294    0.9107    0.8682       336

Run time: 65.108994 s
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/usr/local/lib/python3.7/dist-packages/sklearn/metrics/_classification.py:1272: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:44: DeprecationWarning: time.clock has been deprecated in Python 3.3 and will be removed from Python 3.8: use time.perf_counter or time.process_time instead
</pre>
</div>
</div>

</div>
</div>

</div>
    

</div>



  </div><a class="u-url" href="/2022/01/18/sdlib.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Jupyter notebook database.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/recohut" target="_blank" title="recohut"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
