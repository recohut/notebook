<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Implicit Recommendation | reconb</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Implicit Recommendation" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Jupyter notebook database." />
<meta property="og:description" content="Jupyter notebook database." />
<link rel="canonical" href="https://nb.recohut.com/2022/01/02/implicit-recommendation.html" />
<meta property="og:url" content="https://nb.recohut.com/2022/01/02/implicit-recommendation.html" />
<meta property="og:site_name" content="reconb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-02T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Implicit Recommendation" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-02T00:00:00-06:00","datePublished":"2022-01-02T00:00:00-06:00","description":"Jupyter notebook database.","headline":"Implicit Recommendation","mainEntityOfPage":{"@type":"WebPage","@id":"https://nb.recohut.com/2022/01/02/implicit-recommendation.html"},"url":"https://nb.recohut.com/2022/01/02/implicit-recommendation.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nb.recohut.com/feed.xml" title="reconb" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">reconb</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Implicit Recommendation</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-01-02T00:00:00-06:00" itemprop="datePublished">
        Jan 2, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      19 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/recohut/notebook/tree/master/_notebooks/2022-01-02-implicit-recommendation.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/recohut/notebook/master?filepath=_notebooks%2F2022-01-02-implicit-recommendation.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/recohut/notebook/blob/master/_notebooks/2022-01-02-implicit-recommendation.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Frecohut%2Fnotebook%2Fblob%2Fmaster%2F_notebooks%2F2022-01-02-implicit-recommendation.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-01-02-implicit-recommendation.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Framework">Framework<a class="anchor-link" href="#Framework"> </a></h3><ol>
<li>Data type : 'Unary &amp; Implicit data'<ul>
<li>Be careful not to confuse binary and unary data: unary data means that you have information that a user consumed something (which is coded as 1, much like binary data), but you have no information about whether a user didn't like or consume something (which is coded as NULL instead of binary data's 0).</li>
<li>Implicit data is data we gather from the users behaviour, with no ratings or specific actions needed. It could be what items a user purchased, how many times they played a song or watched a movie, how long they’ve spent reading a specific article etc. </li>
</ul>
</li>
<li>Algorithms<ol>
<li>Traditional algorithm - Item-item nearest neighbor models - a. Cosine distance metric, b. TF IDF, c.    BM25, Popularity based recommendation (baseline).</li>
<li>ALS (Alternating Least Squares) Matrix Factorization<ul>
<li>Original paper: <a href="http://yifanhu.net/PUB/cf.pdf">http://yifanhu.net/PUB/cf.pdf</a> </li>
<li>We can use matrix factorization to mathematically reduce the dimensionality of our original “all users by all items” matrix into something much smaller that represents “all items by some taste dimensions” and “all users by some taste dimensions”. These dimensions are called latent or hidden features and we learn them from our data.</li>
<li>There are different ways to factor a matrix, like Singular Value Decomposition (SVD) or Probabilistic Latent Semantic Analysis (PLSA) if we’re dealing with explicit data.With implicit data the difference lies in how we deal with all the missing data in our very sparse matrix. For explicit data we treat them as just unknown fields that we should assign some predicted rating to. But for implicit we can’t just assume the same since there is information in these unknown values as well. As stated before we don’t know if a missing value means the user disliked something, or if it means they love it but just don’t know about it. Basically we need some way to learn from the missing data. So we’ll need a different approach to get us there.</li>
<li><img src="https://jessesw.com/images/Rec_images/ALS_Image_Test.png" width="600" /></li>
</ul>
</li>
<li>Bayesian Personalized Ranking (BPR)<ul>
<li>Original paper: <a href="https://arxiv.org/ftp/arxiv/papers/1205/1205.2618.pdf">https://arxiv.org/ftp/arxiv/papers/1205/1205.2618.pdf</a></li>
</ul>
</li>
<li>Logistic Matrix Factorization<ul>
<li>Original paper: <a href="http://stanford.edu/~rezab/nips2014workshop/submits/logmat.pdf">http://stanford.edu/~rezab/nips2014workshop/submits/logmat.pdf</a></li>
</ul>
</li>
<li>Collaborative Less-Is-More Filtering<ul>
<li>Original paper: <a href="https://www.ijcai.org/Proceedings/13/Papers/460.pdf">https://www.ijcai.org/Proceedings/13/Papers/460.pdf</a> </li>
</ul>
</li>
</ol>
</li>
</ol>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install implicit

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="k">as</span> <span class="nn">sparse</span>
<span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">spsolve</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">implicit.als</span> <span class="kn">import</span> <span class="n">AlternatingLeastSquares</span>
<span class="kn">from</span> <span class="nn">implicit.bpr</span> <span class="kn">import</span> <span class="n">BayesianPersonalizedRanking</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/sparsh9012/Recommendation-Engine/master/data/data.csv&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>customer_id</th>
      <th>item_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5000034025459</td>
      <td>55649</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8000040000000</td>
      <td>52535</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1000000000000</td>
      <td>76125</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8000039034732</td>
      <td>50489</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8000027039444</td>
      <td>56215</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">customer_id</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">item_id</span><span class="p">)</span>
<span class="n">sparsed</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;matrix shape: &#39;</span><span class="p">,</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sparse shape: &#39;</span><span class="p">,</span><span class="n">sparsed</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">matrix</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>matrix shape:  (1252, 4978)
sparse shape:  (1252, 4978)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>item_id</th>
      <th>50009</th>
      <th>50093</th>
      <th>50096</th>
      <th>50098</th>
      <th>50104</th>
      <th>50108</th>
      <th>50112</th>
      <th>50116</th>
      <th>50119</th>
      <th>50124</th>
      <th>...</th>
      <th>91679</th>
      <th>91740</th>
      <th>91742</th>
      <th>91766</th>
      <th>91768</th>
      <th>91770</th>
      <th>91785</th>
      <th>91790</th>
      <th>91795</th>
      <th>91798</th>
    </tr>
    <tr>
      <th>customer_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1000000000000</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1000000201799</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1000000216930</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1000000220674</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1000000237993</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 4978 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">matrix1</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">matrix</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">&lt;</span><span class="mi">5000</span><span class="p">,:]</span>

<span class="c1">#dropping customers with very-low-frequency purchase</span>
<span class="n">matrix1</span> <span class="o">=</span> <span class="n">matrix1</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">matrix1</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">,:]</span>

<span class="c1">#dropping products with very-low-frequency purchase</span>
<span class="n">matrix1</span> <span class="o">=</span> <span class="n">matrix1</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">matrix1</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">]</span>

<span class="n">sparsed1</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">(</span><span class="n">matrix1</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">matrix1</span><span class="o">.</span><span class="n">shape</span>
<span class="n">sparsed1</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(419, 2359)</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sparsity</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The sparsity level of dataset is &#39;</span> <span class="o">+</span>  <span class="nb">str</span><span class="p">(</span><span class="n">sparsity</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span>

<span class="n">sparsity</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">matrix1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">matrix1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The sparsity level of filtered dataset is &#39;</span> <span class="o">+</span>  <span class="nb">str</span><span class="p">(</span><span class="n">sparsity</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The sparsity level of dataset is 99.7%
The sparsity level of filtered dataset is 98.1%
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">item_dictionary</span> <span class="o">=</span> <span class="p">{</span> <span class="n">i</span> <span class="p">:</span> <span class="n">matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="p">)</span> <span class="p">}</span>
<span class="n">customer_dictionary</span> <span class="o">=</span> <span class="p">{</span> <span class="n">i</span> <span class="p">:</span> <span class="n">matrix</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="p">)</span> <span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">calculate_recommendations</span><span class="p">(</span><span class="n">df_new</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;als&#39;</span><span class="p">,</span> <span class="n">factors</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">regularization</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    
    <span class="c1"># initialize models</span>
    <span class="k">if</span> <span class="n">model_name</span><span class="o">==</span><span class="s1">&#39;als&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">AlternatingLeastSquares</span><span class="p">(</span><span class="n">factors</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">regularization</span> <span class="o">=</span> <span class="mf">0.02</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">=</span> <span class="mi">50</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span><span class="o">==</span><span class="s1">&#39;bpr&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">BayesianPersonalizedRanking</span><span class="p">(</span><span class="n">factors</span><span class="o">=</span><span class="n">factors</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">regularization</span><span class="o">=</span><span class="n">regularization</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="n">iterations</span><span class="p">)</span>
    
    <span class="sd">&#39;&#39;&#39;item_users (csr_matrix) – Matrix of confidences for the liked items. </span>
<span class="sd">    This matrix should be a csr_matrix where the rows of the matrix are the item, </span>
<span class="sd">    the columns are the users that liked that item, and the value is the confidence </span>
<span class="sd">    that the user liked the item.&#39;&#39;&#39;</span>
    
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sparsed</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    
    <span class="sd">&#39;&#39;&#39;user_items (csr_matrix) – A sparse matrix of shape (number_users, number_items). </span>
<span class="sd">    This lets us look up the liked items and their weights for the user. </span>
<span class="sd">    This is used to filter out items that have already been liked from the output, </span>
<span class="sd">    and to also potentially calculate the best items for this user.&#39;&#39;&#39;</span>
    
    <span class="n">user_items</span> <span class="o">=</span> <span class="n">sparsed</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;customer_id&#39;</span><span class="p">,</span> <span class="s1">&#39;recommendation&#39;</span><span class="p">])</span>

    <span class="c1"># Calculates the N best recommendations for a user, and returns a list of itemids, score</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">recommend</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">user_items</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
          <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;customer_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;recommendation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rc</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">recommendation</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">customer_id</span><span class="p">)</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;recommendation&#39;</span><span class="p">)</span>
    <span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;customer_id &#39;</span><span class="o">+</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;customer_id&#39;</span><span class="p">]</span>
    <span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;recommendation &#39;</span><span class="o">+</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;recommendation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;score &#39;</span><span class="o">+</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;recommendation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">df_new</span> <span class="o">=</span> <span class="n">df_new</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s1">&#39;recommendation &#39;</span><span class="o">+</span><span class="n">model_name</span><span class="p">:</span> <span class="n">item_dictionary</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">df_new</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">calculate_recommendations</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;als&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 104.95it/s]
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>customer_id als</th>
      <th>recommendation als</th>
      <th>score als</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1000000000000</td>
      <td>55659</td>
      <td>0.010661</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1000000000000</td>
      <td>54310</td>
      <td>0.008409</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1000000000000</td>
      <td>63087</td>
      <td>0.007403</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1000000000000</td>
      <td>56780</td>
      <td>0.006668</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1000000000000</td>
      <td>51966</td>
      <td>0.006610</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_n</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">df_n</span> <span class="o">=</span> <span class="n">calculate_recommendations</span><span class="p">(</span><span class="n">df_n</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;als&#39;</span><span class="p">)</span>
<span class="n">df_n</span> <span class="o">=</span> <span class="n">calculate_recommendations</span><span class="p">(</span><span class="n">df_n</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;bpr&#39;</span><span class="p">)</span>
<span class="n">df_n</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 109.66it/s]
100%|██████████| 100/100 [00:00&lt;00:00, 142.15it/s, correct=68.43%, skipped=33.39%]
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>customer_id als</th>
      <th>recommendation als</th>
      <th>score als</th>
      <th>customer_id bpr</th>
      <th>recommendation bpr</th>
      <th>score bpr</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1000000000000</td>
      <td>55659</td>
      <td>0.007136</td>
      <td>1000000000000</td>
      <td>89962</td>
      <td>0.708574</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1000000000000</td>
      <td>73975</td>
      <td>0.007122</td>
      <td>1000000000000</td>
      <td>50559</td>
      <td>0.700179</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1000000000000</td>
      <td>66134</td>
      <td>0.006804</td>
      <td>1000000000000</td>
      <td>64293</td>
      <td>0.697164</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1000000000000</td>
      <td>65875</td>
      <td>0.006423</td>
      <td>1000000000000</td>
      <td>64181</td>
      <td>0.676541</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1000000000000</td>
      <td>56780</td>
      <td>0.006374</td>
      <td>1000000000000</td>
      <td>51507</td>
      <td>0.666476</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Model-Evaluation">Model Evaluation<a class="anchor-link" href="#Model-Evaluation"> </a></h3><ul>
<li>It is important to realize that we do not have a reliable feedback regarding which items are disliked. The absence of a favorite item indicator can be related to multiple reasons. We also can't track user reactions to our recommendations. Thus, precision based metrics, such as RMSE and MSE, are not very appropriate, as they require knowing which items users dislike for it to make sense. 
In addition, we are currently unable to track user reactions to our recommendations. Thus, precision based metrics are not very appropriate, as they require knowing which programs are undesired to a user. However, watching a program is an indication of liking it, making recall-oriented measures applicable.</li>
</ul>
<ol>
<li>Random masking and measuring predicted vs. actual values of masked values – ROC AUC score
<img src="https://jessesw.com/images/Rec_images/MaskTrain.png" width="600" /></li>
<li>Recall based evaluation ranking – <strong>Mean Percentage Ranking (MPR)</strong> a.k.a. expected percentile ranking.  Lower values of MPR are more desirable. The expected value of MPR for random predictions is 50%, and thus MPR &gt; 50% indicates an algorithm no better than random.</li>
</ol>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">make_train</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">pct_test</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function will take in the original user-item matrix and &quot;mask&quot; a percentage of the original ratings where a</span>
<span class="sd">    user-item interaction has taken place for use as a test set. The test set will contain all of the original ratings, </span>
<span class="sd">    while the training set replaces the specified percentage of them with a zero in the original ratings matrix. </span>
<span class="sd">    </span>
<span class="sd">    parameters: </span>
<span class="sd">    </span>
<span class="sd">    ratings - the original ratings matrix from which you want to generate a train/test set. Test is just a complete</span>
<span class="sd">    copy of the original set. This is in the form of a sparse csr_matrix. </span>
<span class="sd">    </span>
<span class="sd">    pct_test - The percentage of user-item interactions where an interaction took place that you want to mask in the </span>
<span class="sd">    training set for later comparison to the test set, which contains all of the original ratings. </span>
<span class="sd">    </span>
<span class="sd">    returns:</span>
<span class="sd">    </span>
<span class="sd">    training_set - The altered version of the original data with a certain percentage of the user-item pairs </span>
<span class="sd">    that originally had interaction set back to zero.</span>
<span class="sd">    </span>
<span class="sd">    test_set - A copy of the original ratings matrix, unaltered, so it can be used to see how the rank order </span>
<span class="sd">    compares with the actual interactions.</span>
<span class="sd">    </span>
<span class="sd">    user_inds - From the randomly selected user-item indices, which user rows were altered in the training data.</span>
<span class="sd">    This will be necessary later when evaluating the performance via AUC.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">test_set</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># Make a copy of the original set to be the test set. </span>
    <span class="n">test_set</span><span class="p">[</span><span class="n">test_set</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Store the test set as a binary preference matrix</span>
    <span class="n">training_set</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># Make a copy of the original data we can alter as our training set. </span>
    <span class="n">nonzero_inds</span> <span class="o">=</span> <span class="n">training_set</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span> <span class="c1"># Find the indices in the ratings data where an interaction exists</span>
    <span class="n">nonzero_pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nonzero_inds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nonzero_inds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="c1"># Zip these pairs together of user,item index into list</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Set the random seed to zero for reproducibility</span>
    <span class="n">num_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">pct_test</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">nonzero_pairs</span><span class="p">)))</span> <span class="c1"># Round the number of samples needed to the nearest integer</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nonzero_pairs</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span> <span class="c1"># Sample a random number of user-item pairs without replacement</span>
    <span class="n">user_inds</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">]</span> <span class="c1"># Get the user row indices</span>
    <span class="n">item_inds</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">]</span> <span class="c1"># Get the item column indices</span>
    <span class="n">training_set</span><span class="p">[</span><span class="n">user_inds</span><span class="p">,</span> <span class="n">item_inds</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Assign all of the randomly chosen user-item pairs to zero</span>
    <span class="n">training_set</span><span class="o">.</span><span class="n">eliminate_zeros</span><span class="p">()</span> <span class="c1"># Get rid of zeros in sparse array storage after update to save space</span>
    <span class="k">return</span> <span class="n">training_set</span><span class="p">,</span> <span class="n">test_set</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">user_inds</span><span class="p">))</span> <span class="c1"># Output the unique list of user rows that were altered </span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">auc_score</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This simple function will output the area under the curve using sklearn&#39;s metrics. </span>
<span class="sd">    </span>
<span class="sd">    parameters:</span>
<span class="sd">    </span>
<span class="sd">    - predictions: your prediction output</span>
<span class="sd">    </span>
<span class="sd">    - test: the actual target result you are comparing to</span>
<span class="sd">    </span>
<span class="sd">    returns:</span>
<span class="sd">    </span>
<span class="sd">    - AUC (area under the Receiver Operating Characterisic curve)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
  

  
<span class="k">def</span> <span class="nf">calc_mean_auc</span><span class="p">(</span><span class="n">training_set</span><span class="p">,</span> <span class="n">altered_users</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">test_set</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function will calculate the mean AUC by user for any user that had their user-item matrix altered. </span>
<span class="sd">    </span>
<span class="sd">    parameters:</span>
<span class="sd">    </span>
<span class="sd">    training_set - The training set resulting from make_train, where a certain percentage of the original</span>
<span class="sd">    user/item interactions are reset to zero to hide them from the model </span>
<span class="sd">    </span>
<span class="sd">    predictions - The matrix of your predicted ratings for each user/item pair as output from the implicit MF.</span>
<span class="sd">    These should be stored in a list, with user vectors as item zero and item vectors as item one. </span>
<span class="sd">    </span>
<span class="sd">    altered_users - The indices of the users where at least one user/item pair was altered from make_train function</span>
<span class="sd">    </span>
<span class="sd">    test_set - The test set constucted earlier from make_train function</span>
<span class="sd">    </span>
<span class="sd">    </span>

<span class="sd">    returns:</span>
<span class="sd">    </span>
<span class="sd">    The mean AUC (area under the Receiver Operator Characteristic curve) of the test set only on user-item interactions</span>
<span class="sd">    there were originally zero to test ranking ability in addition to the most popular items as a benchmark.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    
    <span class="n">store_auc</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># An empty list to store the AUC for each user that had an item removed from the training set</span>
    <span class="n">popularity_auc</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># To store popular AUC scores</span>
    <span class="n">pop_items</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Get sum of item iteractions to find most popular</span>
    <span class="n">item_vecs</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">altered_users</span><span class="p">:</span> <span class="c1"># Iterate through each user that had an item altered</span>
        <span class="n">training_row</span> <span class="o">=</span> <span class="n">training_set</span><span class="p">[</span><span class="n">user</span><span class="p">,:]</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Get the training set row</span>
        <span class="n">zero_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">training_row</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># Find where the interaction had not yet occurred</span>
        <span class="c1"># Get the predicted values based on our user/item vectors</span>
        <span class="n">user_vec</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">user</span><span class="p">,:]</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">user_vec</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">item_vecs</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()[</span><span class="mi">0</span><span class="p">,</span><span class="n">zero_inds</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Get only the items that were originally zero</span>
        <span class="c1"># Select all ratings from the MF prediction for this user that originally had no iteraction</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="n">test_set</span><span class="p">[</span><span class="n">user</span><span class="p">,:]</span><span class="o">.</span><span class="n">toarray</span><span class="p">()[</span><span class="mi">0</span><span class="p">,</span><span class="n">zero_inds</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> 
        <span class="c1"># Select the binarized yes/no interaction pairs from the original full data</span>
        <span class="c1"># that align with the same pairs in training </span>
        <span class="n">pop</span> <span class="o">=</span> <span class="n">pop_items</span><span class="p">[</span><span class="n">zero_inds</span><span class="p">]</span> <span class="c1"># Get the item popularity for our chosen items</span>
        <span class="n">store_auc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auc_score</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">actual</span><span class="p">))</span> <span class="c1"># Calculate AUC for the given user and store</span>
        <span class="n">popularity_auc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auc_score</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">actual</span><span class="p">))</span> <span class="c1"># Calculate AUC using most popular and score</span>
    <span class="c1"># End users iteration</span>
    
    <span class="c1"># Return the mean AUC rounded to three decimal places for both test and popularity benchmark</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">np</span>.mean(store_auc)), float(&#39;%.3f&#39;%np.mean(popularity_auc))  
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># hyperparameters</span>

<span class="n">PCT</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">]</span>
<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">128</span><span class="p">]</span>
<span class="n">regularization</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">]</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">50</span><span class="p">]</span>

<span class="c1"># PCT = [0.2]</span>
<span class="c1"># factors = [32]</span>
<span class="c1"># regularization = [0.01]</span>
<span class="c1"># iterations = [10]</span>

<span class="n">scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PCT&#39;</span><span class="p">,</span><span class="s1">&#39;factors&#39;</span><span class="p">,</span><span class="s1">&#39;regularization&#39;</span><span class="p">,</span><span class="s1">&#39;iterations&#39;</span><span class="p">,</span><span class="s1">&#39;score&#39;</span><span class="p">])</span>

<span class="c1"># Grid-search hyperparameter optimization</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">PCT</span><span class="p">:</span>
  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">factors</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">regularization</span><span class="p">:</span> 
      <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        <span class="c1"># creating train, test and altered sets</span>
        <span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">altered</span> <span class="o">=</span> <span class="n">make_train</span><span class="p">(</span><span class="n">sparsed</span><span class="p">,</span> <span class="n">pct_test</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>

        <span class="c1"># calculate the confidence by multiplying it by our alpha value</span>
        <span class="n">alpha_val</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">train</span> <span class="o">=</span> <span class="p">(</span><span class="n">train</span> <span class="o">*</span> <span class="n">alpha_val</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>

        <span class="c1"># defining the model</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">implicit</span><span class="o">.</span><span class="n">als</span><span class="o">.</span><span class="n">AlternatingLeastSquares</span><span class="p">(</span><span class="n">factors</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">regularization</span> <span class="o">=</span> <span class="n">k</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">=</span> <span class="n">l</span><span class="p">)</span>

        <span class="c1"># training the model</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

        <span class="c1"># AUC for our recommender system</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">calc_mean_auc</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">altered</span><span class="p">,</span> <span class="p">[</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">user_factors</span><span class="p">),</span> <span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">item_factors</span><span class="o">.</span><span class="n">T</span><span class="p">)],</span> <span class="n">test</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">user_factors</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="c1"># saving in a dataframe</span>
        <span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;PCT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;factors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
        <span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;regularization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;iterations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
        
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 10.0/10 [00:00&lt;00:00, 161.82it/s]
100%|██████████| 20.0/20 [00:00&lt;00:00, 160.10it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 33%|███▎      | 16.5/50 [00:00&lt;00:00, 157.61it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 200.78it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 341.74it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
100%|██████████| 20.0/20 [00:00&lt;00:00, 156.27it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 33%|███▎      | 16.5/50 [00:00&lt;00:00, 158.16it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 183.69it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 357.50it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
100%|██████████| 20.0/20 [00:00&lt;00:00, 158.56it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 46%|████▌     | 23.0/50 [00:00&lt;00:00, 229.45it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 238.59it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 352.58it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
100%|██████████| 20.0/20 [00:00&lt;00:00, 157.69it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 35%|███▌      | 17.5/50 [00:00&lt;00:00, 167.29it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 201.91it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 252.34it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 52%|█████▎    | 10.5/20 [00:00&lt;00:00, 100.11it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 20.0/20 [00:00&lt;00:00, 102.39it/s]
 31%|███       | 15.5/50 [00:00&lt;00:00, 150.56it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 186.48it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 261.99it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 52%|█████▎    | 10.5/20 [00:00&lt;00:00, 100.64it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 20.0/20 [00:00&lt;00:00, 106.17it/s]
 27%|██▋       | 13.5/50 [00:00&lt;00:00, 130.75it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 181.33it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 266.50it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
100%|██████████| 20.0/20 [00:00&lt;00:00, 112.81it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 37%|███▋      | 18.5/50 [00:00&lt;00:00, 180.06it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 188.52it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 263.85it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 48%|████▊     | 9.5/20 [00:00&lt;00:00, 92.64it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 20.0/20 [00:00&lt;00:00, 98.17it/s]
 33%|███▎      | 16.5/50 [00:00&lt;00:00, 158.98it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 198.53it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 204.59it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 40%|████      | 8.0/20 [00:00&lt;00:00, 79.73it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 20.0/20 [00:00&lt;00:00, 88.00it/s]
 17%|█▋        | 8.5/50 [00:00&lt;00:00, 78.56it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 107.57it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 79.56it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 42%|████▎     | 8.5/20 [00:00&lt;00:00, 77.96it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 20.0/20 [00:00&lt;00:00, 88.35it/s]
 17%|█▋        | 8.5/50 [00:00&lt;00:00, 77.88it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 127.51it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 79.72it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 40%|████      | 8.0/20 [00:00&lt;00:00, 79.45it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 20.0/20 [00:00&lt;00:00, 80.47it/s]
 16%|█▌        | 8.0/50 [00:00&lt;00:00, 79.62it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 117.81it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 80.76it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 40%|████      | 8.0/20 [00:00&lt;00:00, 79.93it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 20.0/20 [00:00&lt;00:00, 78.98it/s]
 16%|█▌        | 8.0/50 [00:00&lt;00:00, 79.73it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 126.63it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 175.56it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
100%|██████████| 20.0/20 [00:00&lt;00:00, 181.78it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 47%|████▋     | 23.5/50 [00:00&lt;00:00, 226.33it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 219.90it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 352.74it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
100%|██████████| 20.0/20 [00:00&lt;00:00, 183.30it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 41%|████      | 20.5/50 [00:00&lt;00:00, 202.38it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 197.39it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 408.38it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
100%|██████████| 20.0/20 [00:00&lt;00:00, 180.72it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 37%|███▋      | 18.5/50 [00:00&lt;00:00, 179.83it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 213.73it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 218.67it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
100%|██████████| 20.0/20 [00:00&lt;00:00, 182.43it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 37%|███▋      | 18.5/50 [00:00&lt;00:00, 181.22it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 212.07it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 117.19it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 32)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
100%|██████████| 20.0/20 [00:00&lt;00:00, 116.46it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 23%|██▎       | 11.5/50 [00:00&lt;00:00, 114.04it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 148.05it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 116.14it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
100%|██████████| 20.0/20 [00:00&lt;00:00, 125.66it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 23%|██▎       | 11.5/50 [00:00&lt;00:00, 114.20it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 145.78it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 117.38it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
100%|██████████| 20.0/20 [00:00&lt;00:00, 117.67it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 23%|██▎       | 11.5/50 [00:00&lt;00:00, 113.21it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 150.54it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 117.70it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
100%|██████████| 20.0/20 [00:00&lt;00:00, 116.13it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 23%|██▎       | 11.5/50 [00:00&lt;00:00, 113.81it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 160.51it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 87.99it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 64)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 45%|████▌     | 9.0/20 [00:00&lt;00:00, 89.20it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 20.0/20 [00:00&lt;00:00, 102.85it/s]
 18%|█▊        | 9.0/50 [00:00&lt;00:00, 89.34it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 130.60it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 88.20it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 45%|████▌     | 9.0/20 [00:00&lt;00:00, 89.27it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 20.0/20 [00:00&lt;00:00, 90.27it/s]
 18%|█▊        | 9.0/50 [00:00&lt;00:00, 89.13it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 127.86it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 88.85it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 45%|████▌     | 9.0/20 [00:00&lt;00:00, 89.07it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 20.0/20 [00:00&lt;00:00, 94.19it/s]
 18%|█▊        | 9.0/50 [00:00&lt;00:00, 89.38it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 129.15it/s]
100%|██████████| 10.0/10 [00:00&lt;00:00, 88.40it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
 45%|████▌     | 9.0/20 [00:00&lt;00:00, 88.95it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 20.0/20 [00:00&lt;00:00, 101.38it/s]
 18%|█▊        | 9.0/50 [00:00&lt;00:00, 89.04it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 131.35it/s]
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(1252, 128)
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">scores</span><span class="p">[[</span><span class="s1">&#39;PCT&#39;</span><span class="p">,</span><span class="s1">&#39;factors&#39;</span><span class="p">,</span><span class="s1">&#39;regularization&#39;</span><span class="p">,</span><span class="s1">&#39;iterations&#39;</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ALS&#39;</span><span class="p">,</span><span class="s1">&#39;Popularity&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;ALS&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ALS</th>
      <th>Popularity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(0.3, 128, 0.2, 10)</th>
      <td>0.520</td>
      <td>0.602</td>
    </tr>
    <tr>
      <th>(0.3, 128, 0.2, 20)</th>
      <td>0.520</td>
      <td>0.602</td>
    </tr>
    <tr>
      <th>(0.3, 128, 0.2, 50)</th>
      <td>0.519</td>
      <td>0.602</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># hyperparameters</span>

<span class="n">PCT</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]</span>
<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="mi">31</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="mi">127</span><span class="p">]</span>
<span class="n">regularization</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>
<span class="c1"># learning_rate = [0.01, 0.05, 0.1]</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">50</span><span class="p">]</span>

<span class="n">scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PCT&#39;</span><span class="p">,</span><span class="s1">&#39;factors&#39;</span><span class="p">,</span><span class="s1">&#39;regularization&#39;</span><span class="p">,</span><span class="s1">&#39;iterations&#39;</span><span class="p">,</span><span class="s1">&#39;score&#39;</span><span class="p">])</span>

<span class="c1"># Grid-search hyperparameter optimization</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">PCT</span><span class="p">:</span>
  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">factors</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">regularization</span><span class="p">:</span> 
      <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        <span class="c1"># creating train, test and altered sets</span>
        <span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">altered</span> <span class="o">=</span> <span class="n">make_train</span><span class="p">(</span><span class="n">sparsed</span><span class="p">,</span> <span class="n">pct_test</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>

        <span class="c1"># calculate the confidence by multiplying it by our alpha value</span>
        <span class="n">alpha_val</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">train</span> <span class="o">=</span> <span class="p">(</span><span class="n">train</span> <span class="o">*</span> <span class="n">alpha_val</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>

        <span class="c1"># defining the model</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">BayesianPersonalizedRanking</span><span class="p">(</span><span class="n">factors</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">regularization</span> <span class="o">=</span> <span class="n">k</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">=</span> <span class="n">l</span><span class="p">)</span>

        <span class="c1"># training the model</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

        <span class="c1"># AUC for our recommender system</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">calc_mean_auc</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">altered</span><span class="p">,</span> <span class="p">[</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">user_factors</span><span class="p">),</span> <span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">item_factors</span><span class="o">.</span><span class="n">T</span><span class="p">)],</span> <span class="n">test</span><span class="p">)</span>
        
        <span class="c1"># saving in a dataframe</span>
        <span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;PCT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;factors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
        <span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;regularization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;iterations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="n">scores</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 10/10 [00:00&lt;00:00, 148.72it/s, correct=53.86%, skipped=27.36%]
100%|██████████| 20/20 [00:00&lt;00:00, 124.86it/s, correct=54.75%, skipped=27.40%]
100%|██████████| 50/50 [00:00&lt;00:00, 141.36it/s, correct=55.18%, skipped=27.36%]
100%|██████████| 10/10 [00:00&lt;00:00, 179.50it/s, correct=53.87%, skipped=27.27%]
100%|██████████| 20/20 [00:00&lt;00:00, 145.93it/s, correct=53.54%, skipped=27.76%]
100%|██████████| 50/50 [00:00&lt;00:00, 157.31it/s, correct=55.41%, skipped=28.05%]
100%|██████████| 10/10 [00:00&lt;00:00, 193.12it/s, correct=53.65%, skipped=27.72%]
100%|██████████| 20/20 [00:00&lt;00:00, 139.21it/s, correct=54.41%, skipped=27.09%]
100%|██████████| 50/50 [00:00&lt;00:00, 164.14it/s, correct=55.21%, skipped=27.41%]
100%|██████████| 10/10 [00:00&lt;00:00, 159.37it/s, correct=53.42%, skipped=27.46%]
100%|██████████| 20/20 [00:00&lt;00:00, 136.66it/s, correct=53.07%, skipped=27.23%]
100%|██████████| 50/50 [00:00&lt;00:00, 168.69it/s, correct=54.50%, skipped=28.13%]
100%|██████████| 10/10 [00:00&lt;00:00, 184.08it/s, correct=53.10%, skipped=27.02%]
100%|██████████| 20/20 [00:00&lt;00:00, 138.54it/s, correct=53.48%, skipped=27.23%]
100%|██████████| 50/50 [00:00&lt;00:00, 170.83it/s, correct=57.67%, skipped=27.29%]
100%|██████████| 10/10 [00:00&lt;00:00, 191.59it/s, correct=54.01%, skipped=26.96%]
100%|██████████| 20/20 [00:00&lt;00:00, 135.95it/s, correct=53.91%, skipped=27.01%]
100%|██████████| 50/50 [00:00&lt;00:00, 146.26it/s, correct=54.73%, skipped=27.47%]
100%|██████████| 10/10 [00:00&lt;00:00, 189.99it/s, correct=53.11%, skipped=27.29%]
100%|██████████| 20/20 [00:00&lt;00:00, 137.36it/s, correct=54.58%, skipped=27.65%]
100%|██████████| 50/50 [00:00&lt;00:00, 136.56it/s, correct=54.84%, skipped=27.93%]
100%|██████████| 10/10 [00:00&lt;00:00, 190.24it/s, correct=53.14%, skipped=26.81%]
100%|██████████| 20/20 [00:00&lt;00:00, 143.07it/s, correct=53.89%, skipped=27.64%]
100%|██████████| 50/50 [00:00&lt;00:00, 154.41it/s, correct=54.22%, skipped=27.64%]
100%|██████████| 10/10 [00:00&lt;00:00, 195.09it/s, correct=53.10%, skipped=27.44%]
100%|██████████| 20/20 [00:00&lt;00:00, 140.14it/s, correct=53.29%, skipped=27.63%]
100%|██████████| 50/50 [00:00&lt;00:00, 165.42it/s, correct=52.92%, skipped=27.88%]
100%|██████████| 10/10 [00:00&lt;00:00, 189.79it/s, correct=52.85%, skipped=26.94%]
100%|██████████| 20/20 [00:00&lt;00:00, 138.76it/s, correct=52.56%, skipped=27.43%]
100%|██████████| 50/50 [00:00&lt;00:00, 144.33it/s, correct=59.11%, skipped=27.21%]
100%|██████████| 10/10 [00:00&lt;00:00, 156.83it/s, correct=54.26%, skipped=27.26%]
100%|██████████| 20/20 [00:00&lt;00:00, 139.86it/s, correct=53.83%, skipped=27.88%]
100%|██████████| 50/50 [00:00&lt;00:00, 149.96it/s, correct=54.25%, skipped=27.33%]
100%|██████████| 10/10 [00:00&lt;00:00, 100.74it/s, correct=54.85%, skipped=27.27%]
100%|██████████| 20/20 [00:00&lt;00:00, 132.91it/s, correct=54.19%, skipped=27.86%]
100%|██████████| 50/50 [00:00&lt;00:00, 139.92it/s, correct=55.09%, skipped=27.58%]
100%|██████████| 10/10 [00:00&lt;00:00, 136.90it/s, correct=53.71%, skipped=27.29%]
100%|██████████| 20/20 [00:00&lt;00:00, 134.78it/s, correct=53.65%, skipped=27.68%]
100%|██████████| 50/50 [00:00&lt;00:00, 149.01it/s, correct=54.60%, skipped=27.37%]
100%|██████████| 10/10 [00:00&lt;00:00, 135.31it/s, correct=54.13%, skipped=27.24%]
100%|██████████| 20/20 [00:00&lt;00:00, 140.68it/s, correct=53.22%, skipped=27.69%]
100%|██████████| 50/50 [00:00&lt;00:00, 153.71it/s, correct=53.05%, skipped=27.41%]
100%|██████████| 10/10 [00:00&lt;00:00, 143.67it/s, correct=54.02%, skipped=27.56%]
100%|██████████| 20/20 [00:00&lt;00:00, 133.77it/s, correct=51.42%, skipped=27.68%]
100%|██████████| 50/50 [00:00&lt;00:00, 152.86it/s, correct=66.37%, skipped=27.71%]
100%|██████████| 10/10 [00:00&lt;00:00, 133.45it/s, correct=52.82%, skipped=24.82%]
100%|██████████| 20/20 [00:00&lt;00:00, 133.77it/s, correct=53.81%, skipped=24.99%]
100%|██████████| 50/50 [00:00&lt;00:00, 153.62it/s, correct=54.59%, skipped=25.06%]
100%|██████████| 10/10 [00:00&lt;00:00, 136.61it/s, correct=52.94%, skipped=25.00%]
100%|██████████| 20/20 [00:00&lt;00:00, 130.78it/s, correct=54.17%, skipped=25.09%]
100%|██████████| 50/50 [00:00&lt;00:00, 136.68it/s, correct=53.89%, skipped=24.66%]
100%|██████████| 10/10 [00:00&lt;00:00, 130.18it/s, correct=52.23%, skipped=24.73%]
100%|██████████| 20/20 [00:00&lt;00:00, 140.54it/s, correct=53.36%, skipped=24.34%]
100%|██████████| 50/50 [00:00&lt;00:00, 143.46it/s, correct=53.59%, skipped=24.48%]
100%|██████████| 10/10 [00:00&lt;00:00, 122.88it/s, correct=52.77%, skipped=25.22%]
100%|██████████| 20/20 [00:00&lt;00:00, 138.65it/s, correct=52.77%, skipped=24.19%]
100%|██████████| 50/50 [00:00&lt;00:00, 160.36it/s, correct=53.74%, skipped=25.04%]
100%|██████████| 10/10 [00:00&lt;00:00, 153.01it/s, correct=53.36%, skipped=24.98%]
100%|██████████| 20/20 [00:00&lt;00:00, 129.92it/s, correct=52.85%, skipped=24.58%]
100%|██████████| 50/50 [00:00&lt;00:00, 142.81it/s, correct=58.85%, skipped=24.30%]
100%|██████████| 10/10 [00:00&lt;00:00, 138.06it/s, correct=53.20%, skipped=24.94%]
100%|██████████| 20/20 [00:00&lt;00:00, 139.66it/s, correct=53.68%, skipped=24.78%]
100%|██████████| 50/50 [00:00&lt;00:00, 135.04it/s, correct=53.72%, skipped=24.39%]
100%|██████████| 10/10 [00:00&lt;00:00, 137.35it/s, correct=52.24%, skipped=24.86%]
100%|██████████| 20/20 [00:00&lt;00:00, 132.61it/s, correct=53.63%, skipped=24.15%]
100%|██████████| 50/50 [00:00&lt;00:00, 141.46it/s, correct=54.30%, skipped=24.68%]
100%|██████████| 10/10 [00:00&lt;00:00, 121.06it/s, correct=54.05%, skipped=24.93%]
100%|██████████| 20/20 [00:00&lt;00:00, 120.97it/s, correct=53.53%, skipped=25.40%]
100%|██████████| 50/50 [00:00&lt;00:00, 155.15it/s, correct=54.21%, skipped=24.62%]
100%|██████████| 10/10 [00:00&lt;00:00, 132.96it/s, correct=53.20%, skipped=24.15%]
100%|██████████| 20/20 [00:00&lt;00:00, 131.29it/s, correct=52.10%, skipped=24.60%]
100%|██████████| 50/50 [00:00&lt;00:00, 139.29it/s, correct=52.76%, skipped=24.88%]
100%|██████████| 10/10 [00:00&lt;00:00, 129.75it/s, correct=53.15%, skipped=24.28%]
100%|██████████| 20/20 [00:00&lt;00:00, 122.74it/s, correct=52.80%, skipped=24.00%]
100%|██████████| 50/50 [00:00&lt;00:00, 145.70it/s, correct=51.14%, skipped=24.57%]
100%|██████████| 10/10 [00:00&lt;00:00, 131.42it/s, correct=53.50%, skipped=24.54%]
100%|██████████| 20/20 [00:00&lt;00:00, 132.51it/s, correct=53.41%, skipped=24.72%]
100%|██████████| 50/50 [00:00&lt;00:00, 154.48it/s, correct=55.21%, skipped=23.91%]
100%|██████████| 10/10 [00:00&lt;00:00, 105.99it/s, correct=52.53%, skipped=24.48%]
100%|██████████| 20/20 [00:00&lt;00:00, 136.50it/s, correct=53.21%, skipped=24.93%]
100%|██████████| 50/50 [00:00&lt;00:00, 133.18it/s, correct=54.43%, skipped=24.28%]
100%|██████████| 10/10 [00:00&lt;00:00, 119.62it/s, correct=53.11%, skipped=24.99%]
100%|██████████| 20/20 [00:00&lt;00:00, 135.82it/s, correct=53.29%, skipped=25.13%]
100%|██████████| 50/50 [00:00&lt;00:00, 147.54it/s, correct=54.29%, skipped=25.27%]
100%|██████████| 10/10 [00:00&lt;00:00, 114.81it/s, correct=52.42%, skipped=24.37%]
100%|██████████| 20/20 [00:00&lt;00:00, 133.19it/s, correct=52.97%, skipped=24.87%]
100%|██████████| 50/50 [00:00&lt;00:00, 152.95it/s, correct=52.74%, skipped=24.88%]
100%|██████████| 10/10 [00:00&lt;00:00, 133.68it/s, correct=53.01%, skipped=24.72%]
100%|██████████| 20/20 [00:00&lt;00:00, 143.85it/s, correct=51.87%, skipped=24.65%]
100%|██████████| 50/50 [00:00&lt;00:00, 143.25it/s, correct=64.64%, skipped=24.66%]
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">scores</span><span class="p">[[</span><span class="s1">&#39;PCT&#39;</span><span class="p">,</span><span class="s1">&#39;factors&#39;</span><span class="p">,</span><span class="s1">&#39;regularization&#39;</span><span class="p">,</span><span class="s1">&#39;iterations&#39;</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ALS&#39;</span><span class="p">,</span><span class="s1">&#39;Popularity&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;ALS&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ALS</th>
      <th>Popularity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(0.3, 127, 0.2, 10)</th>
      <td>0.394</td>
      <td>0.602</td>
    </tr>
    <tr>
      <th>(0.3, 127, 0.2, 20)</th>
      <td>0.300</td>
      <td>0.602</td>
    </tr>
    <tr>
      <th>(0.3, 127, 0.2, 50)</th>
      <td>0.232</td>
      <td>0.602</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># BPR best parameters - (0.2, 127, 0.05, 20)	</span>

<span class="n">df_n</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">df_n</span> <span class="o">=</span> <span class="n">calculate_recommendations</span><span class="p">(</span><span class="n">df_n</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;als&#39;</span><span class="p">,</span> <span class="n">factors</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">regularization</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">df_n</span> <span class="o">=</span> <span class="n">calculate_recommendations</span><span class="p">(</span><span class="n">df_n</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;bpr&#39;</span><span class="p">,</span> <span class="n">factors</span><span class="o">=</span><span class="mi">127</span><span class="p">,</span> <span class="n">regularization</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">df_n</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;recommendations.csv&#39;</span><span class="p">)</span>
<span class="n">df_n</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>100%|██████████| 50.0/50 [00:00&lt;00:00, 153.78it/s]
100%|██████████| 20/20 [00:00&lt;00:00, 121.75it/s, correct=55.94%, skipped=34.42%]
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>customer_id als</th>
      <th>recommendation als</th>
      <th>score als</th>
      <th>customer_id bpr</th>
      <th>recommendation bpr</th>
      <th>score bpr</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1000000000000</td>
      <td>90596</td>
      <td>0.008612</td>
      <td>1000000000000</td>
      <td>64293</td>
      <td>0.098874</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1000000000000</td>
      <td>64274</td>
      <td>0.008383</td>
      <td>1000000000000</td>
      <td>57616</td>
      <td>0.091008</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1000000000000</td>
      <td>90387</td>
      <td>0.008383</td>
      <td>1000000000000</td>
      <td>89962</td>
      <td>0.089681</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1000000000000</td>
      <td>51754</td>
      <td>0.008383</td>
      <td>1000000000000</td>
      <td>55467</td>
      <td>0.085606</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1000000000000</td>
      <td>51694</td>
      <td>0.008383</td>
      <td>1000000000000</td>
      <td>51053</td>
      <td>0.076858</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="References">References<a class="anchor-link" href="#References"> </a></h3><ol>
<li><a href="https://www.benfrederickson.com/distance-metrics/">https://www.benfrederickson.com/distance-metrics/</a></li>
<li><a href="https://github.com/benfred/bens-blog-code/blob/master/distance-metrics/calculate_similar.py">https://github.com/benfred/bens-blog-code/blob/master/distance-metrics/calculate_similar.py</a></li>
<li><a href="https://www.benfrederickson.com/approximate-nearest-neighbours-for-recommender-systems/">https://www.benfrederickson.com/approximate-nearest-neighbours-for-recommender-systems/</a></li>
<li><a href="https://www.benfrederickson.com/fast-implicit-matrix-factorization/">https://www.benfrederickson.com/fast-implicit-matrix-factorization/</a></li>
<li><a href="https://www.ethanrosenthal.com/2016/10/19/implicit-mf-part-1/">https://www.ethanrosenthal.com/2016/10/19/implicit-mf-part-1/</a></li>
<li><a href="https://jessesw.com/Rec-System/">https://jessesw.com/Rec-System/</a></li>
<li><a href="https://github.com/benfred/implicit/blob/master/examples/lastfm.py">https://github.com/benfred/implicit/blob/master/examples/lastfm.py</a></li>
<li><a href="https://github.com/benfred/implicit">https://github.com/benfred/implicit</a></li>
<li><a href="https://towardsdatascience.com/large-scale-jobs-recommendation-engine-using-implicit-data-in-pyspark-ccf8df5d910e">https://towardsdatascience.com/large-scale-jobs-recommendation-engine-using-implicit-data-in-pyspark-ccf8df5d910e</a></li>
<li><a href="http://activisiongamescience.github.io/2016/01/11/Implicit-Recommender-Systems-Biased-Matrix-Factorization/">http://activisiongamescience.github.io/2016/01/11/Implicit-Recommender-Systems-Biased-Matrix-Factorization/</a></li>
<li><a href="https://arxiv.org/pdf/1705.00105.pdf">https://arxiv.org/pdf/1705.00105.pdf</a></li>
<li><a href="https://www.ijcai.org/Proceedings/15/Papers/255.pdf">https://www.ijcai.org/Proceedings/15/Papers/255.pdf</a></li>
<li><a href="https://www.kaggle.com/c/msdchallenge/">https://www.kaggle.com/c/msdchallenge/</a></li>
<li><a href="https://stanford.edu/~rezab/nips2014workshop/submits/logmat.pdf">https://stanford.edu/~rezab/nips2014workshop/submits/logmat.pdf</a></li>
<li><a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.167.5120&amp;rep=rep1&amp;type=pdf">http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.167.5120&amp;rep=rep1&amp;type=pdf</a> </li>
<li><a href="http://adrem.uantwerpen.be/bibrem/pubs/verstrepen15PhDthesis.pdf">http://adrem.uantwerpen.be/bibrem/pubs/verstrepen15PhDthesis.pdf</a> </li>
<li><a href="https://pdfs.semanticscholar.org/eb95/7789f53814a290bc0f8bb01dd01cbd0746cc.pdf">https://pdfs.semanticscholar.org/eb95/7789f53814a290bc0f8bb01dd01cbd0746cc.pdf</a> </li>
<li><a href="https://implicit.readthedocs.io/en/latest/">https://implicit.readthedocs.io/en/latest/</a> </li>
<li><a href="https://github.com/akhilesh-reddy/Implicit-data-based-recommendation-system/blob/master/Implicit%20data%20based%20recommendation%20system%20using%20ALS.ipynb">https://github.com/akhilesh-reddy/Implicit-data-based-recommendation-system/blob/master/Implicit%20data%20based%20recommendation%20system%20using%20ALS.ipynb</a> </li>
</ol>

</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/2022/01/02/implicit-recommendation.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Jupyter notebook database.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/recohut" target="_blank" title="recohut"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
