<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>OLX Job Recommendations using LightFM, SLIM, ALS and baseline models | reconb</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="OLX Job Recommendations using LightFM, SLIM, ALS and baseline models" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Jupyter notebook database." />
<meta property="og:description" content="Jupyter notebook database." />
<link rel="canonical" href="https://nb.recohut.com/2022/01/12/olx-baselines.html" />
<meta property="og:url" content="https://nb.recohut.com/2022/01/12/olx-baselines.html" />
<meta property="og:site_name" content="reconb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-12T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="OLX Job Recommendations using LightFM, SLIM, ALS and baseline models" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-12T00:00:00-06:00","datePublished":"2022-01-12T00:00:00-06:00","description":"Jupyter notebook database.","headline":"OLX Job Recommendations using LightFM, SLIM, ALS and baseline models","mainEntityOfPage":{"@type":"WebPage","@id":"https://nb.recohut.com/2022/01/12/olx-baselines.html"},"url":"https://nb.recohut.com/2022/01/12/olx-baselines.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nb.recohut.com/feed.xml" title="reconb" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">reconb</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">OLX Job Recommendations using LightFM, SLIM, ALS and baseline models</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-01-12T00:00:00-06:00" itemprop="datePublished">
        Jan 12, 2022
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      30 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/recohut/notebook/tree/master/_notebooks/2022-01-12-olx-baselines.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/recohut/notebook/master?filepath=_notebooks%2F2022-01-12-olx-baselines.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/recohut/notebook/blob/master/_notebooks/2022-01-12-olx-baselines.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Frecohut%2Fnotebook%2Fblob%2Fmaster%2F_notebooks%2F2022-01-12-olx-baselines.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-01-12-olx-baselines.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Process-flow">Process flow<a class="anchor-link" href="#Process-flow"> </a></h2><p><img src="https://github.com/RecoHut-Stanzas/S883757/raw/main/images/process_flow.svg" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup">Setup<a class="anchor-link" href="#Setup"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">implicit</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">lightfm</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="o">-</span><span class="n">U</span> <span class="n">kaggle</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">upgrade</span> <span class="o">--</span><span class="n">force</span><span class="o">-</span><span class="n">reinstall</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">deps</span> <span class="n">kaggle</span>
<span class="err">!</span><span class="n">mkdir</span> <span class="o">~/.</span><span class="n">kaggle</span>
<span class="err">!</span><span class="n">cp</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">drive</span><span class="o">/</span><span class="n">MyDrive</span><span class="o">/</span><span class="n">kaggle</span><span class="o">.</span><span class="n">json</span> <span class="o">~/.</span><span class="n">kaggle</span><span class="o">/</span>
<span class="err">!</span><span class="n">chmod</span> <span class="mi">600</span> <span class="o">~/.</span><span class="n">kaggle</span><span class="o">/</span><span class="n">kaggle</span><span class="o">.</span><span class="n">json</span>
<span class="err">!</span><span class="n">kaggle</span> <span class="n">datasets</span> <span class="n">download</span> <span class="o">-</span><span class="n">d</span> <span class="n">olxdatascience</span><span class="o">/</span><span class="n">olx</span><span class="o">-</span><span class="n">jobs</span><span class="o">-</span><span class="n">interactions</span>
<span class="err">!</span><span class="n">unzip</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">olx</span><span class="o">-</span><span class="n">jobs</span><span class="o">-</span><span class="n">interactions</span><span class="o">.</span><span class="n">zip</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="k">as</span> <span class="nn">sparse</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">normalize</span>
<span class="kn">from</span> <span class="nn">sklearn.exceptions</span> <span class="kn">import</span> <span class="n">ConvergenceWarning</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">ElasticNet</span>
<span class="kn">from</span> <span class="nn">sklearn.utils._testing</span> <span class="kn">import</span> <span class="n">ignore_warnings</span>

<span class="kn">import</span> <span class="nn">implicit</span>
<span class="kn">from</span> <span class="nn">lightfm</span> <span class="kn">import</span> <span class="n">LightFM</span>

<span class="kn">import</span> <span class="nn">tracemalloc</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">from</span> <span class="nn">multiprocessing.pool</span> <span class="kn">import</span> <span class="n">ThreadPool</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-Loading-and-Sampling">Data Loading and Sampling<a class="anchor-link" href="#Data-Loading-and-Sampling"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;interactions.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>item</th>
      <th>event</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>27901</td>
      <td>56865</td>
      <td>click</td>
      <td>1581465600</td>
    </tr>
    <tr>
      <th>1</th>
      <td>124480</td>
      <td>115662</td>
      <td>click</td>
      <td>1581465600</td>
    </tr>
    <tr>
      <th>2</th>
      <td>159509</td>
      <td>5150</td>
      <td>click</td>
      <td>1581465600</td>
    </tr>
    <tr>
      <th>3</th>
      <td>188861</td>
      <td>109981</td>
      <td>click</td>
      <td>1581465600</td>
    </tr>
    <tr>
      <th>4</th>
      <td>207348</td>
      <td>88746</td>
      <td>click</td>
      <td>1581465600</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 65502201 entries, 0 to 65502200
Data columns (total 4 columns):
 #   Column     Dtype 
---  ------     ----- 
 0   user       int64 
 1   item       int64 
 2   event      object
 3   timestamp  int64 
dtypes: int64(3), object(1)
memory usage: 2.0+ GB
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>3295942</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">get_interactions_subset</span><span class="p">(</span>
    <span class="n">interactions</span><span class="p">,</span> <span class="n">fraction_users</span><span class="p">,</span> <span class="n">fraction_items</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">10</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Select subset from interactions based on fraction of users and items</span>
<span class="sd">    :param interactions: Original interactions</span>
<span class="sd">    :param fraction_users: Fraction of users</span>
<span class="sd">    :param fraction_items: Fraction of items</span>
<span class="sd">    :param random_seed: Random seed</span>
<span class="sd">    :return: Dataframe with subset of interactions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_get_subset_by_column</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">fraction</span><span class="p">):</span>
        <span class="n">column_df</span> <span class="o">=</span> <span class="n">interactions</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">column_df</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">column_df</span><span class="p">)</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">interactions</span><span class="p">[</span><span class="n">interactions</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">subset</span><span class="p">)]</span>

    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fraction_users</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">interactions</span> <span class="o">=</span> <span class="n">_get_subset_by_column</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">fraction_users</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fraction_items</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">interactions</span> <span class="o">=</span> <span class="n">_get_subset_by_column</span><span class="p">(</span><span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="n">fraction_items</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">interactions</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df_subset_users</span> <span class="o">=</span> <span class="n">get_interactions_subset</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">fraction_users</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">fraction_items</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df_subset_users</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 6210394 entries, 2 to 65502187
Data columns (total 4 columns):
 #   Column     Dtype 
---  ------     ----- 
 0   user       int64 
 1   item       int64 
 2   event      object
 3   timestamp  int64 
dtypes: int64(3), object(1)
memory usage: 236.9+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df_subset_users</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s1">&#39;df_subset_users.parquet.snappy&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;snappy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df_subset_items</span> <span class="o">=</span> <span class="n">get_interactions_subset</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">fraction_users</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fraction_items</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df_subset_items</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 6159193 entries, 10 to 65502199
Data columns (total 4 columns):
 #   Column     Dtype 
---  ------     ----- 
 0   user       int64 
 1   item       int64 
 2   event      object
 3   timestamp  int64 
dtypes: int64(3), object(1)
memory usage: 235.0+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df_subset_items</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="s1">&#39;df_subset_items.parquet.snappy&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;snappy&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Utils">Utils<a class="anchor-link" href="#Utils"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Data-split">Data split<a class="anchor-link" href="#Data-split"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">splitting_functions_factory</span><span class="p">(</span><span class="n">function_name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns splitting function based on name&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">function_name</span> <span class="o">==</span> <span class="s2">&quot;by_time&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">split_by_time</span>


<span class="k">def</span> <span class="nf">split_by_time</span><span class="p">(</span><span class="n">interactions</span><span class="p">,</span> <span class="n">fraction_test</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits interactions by time. Returns tuple of dataframes: train and test.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>

    <span class="n">test_min_timestamp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span>
        <span class="n">interactions</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">],</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fraction_test</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">train</span> <span class="o">=</span> <span class="n">interactions</span><span class="p">[</span><span class="n">interactions</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">test_min_timestamp</span><span class="p">]</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">interactions</span><span class="p">[</span><span class="n">interactions</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">test_min_timestamp</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span>


<span class="k">def</span> <span class="nf">filtering_restrict_to_train_users</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns test DataFrame restricted to users from train set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">train_users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">test</span><span class="p">[</span><span class="n">test</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">train_users</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">filtering_already_interacted_items</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filters out (user, item) pairs from the test set if the given user interacted with a given item in train set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">already_interacted_items</span> <span class="o">=</span> <span class="n">train</span><span class="p">[[</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="n">merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">test</span><span class="p">,</span> <span class="n">already_interacted_items</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[</span><span class="n">merged</span><span class="p">[</span><span class="s2">&quot;_merge&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;left_only&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">test</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">filtering_restrict_to_unique_user_item_pair</span><span class="p">(</span><span class="n">dataframe</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns pd.DataFrame where each (user, item) pair appears only once.</span>
<span class="sd">    A list of corresponding events is stores instead of a single event.</span>
<span class="sd">    Returned timestamp is the timestamp of the first (user, item) interaction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">dataframe</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="s2">&quot;min&quot;</span><span class="p">})</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">split</span><span class="p">(</span>
    <span class="n">interactions</span><span class="p">,</span>
    <span class="n">splitting_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">restrict_to_train_users</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">filter_out_already_interacted_items</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">restrict_train_to_unique_user_item_pairs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">restrict_test_to_unique_user_item_pairs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">replace_events_by_ones</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main function used for splitting the dataset into the train and test sets.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    interactions: pd.DataFrame</span>
<span class="sd">        Interactions dataframe</span>
<span class="sd">    splitting_config : dict, optional</span>
<span class="sd">        Dict with name and parameters passed to splitting function.</span>
<span class="sd">        Currently only name=&quot;by_time&quot; supported.</span>
<span class="sd">    restrict_to_train_users : boolean, optional</span>
<span class="sd">        Whether to restrict users in the test set only to users from the train set.</span>
<span class="sd">    filter_out_already_interacted_items : boolean, optional</span>
<span class="sd">        Whether to filter out (user, item) pairs from the test set if the given user interacted with a given item</span>
<span class="sd">        in the train set.</span>
<span class="sd">    restrict_test_to_unique_user_item_pairs</span>
<span class="sd">        Whether to return only one row per (user, item) pair in test set.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">splitting_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">splitting_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;by_time&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fraction_test&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="n">splitting_name</span> <span class="o">=</span> <span class="n">splitting_config</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
    <span class="n">splitting_config</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">splitting_config</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;name&quot;</span><span class="p">}</span>

    <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">splitting_functions_factory</span><span class="p">(</span><span class="n">splitting_name</span><span class="p">)(</span>
        <span class="n">interactions</span><span class="o">=</span><span class="n">interactions</span><span class="p">,</span> <span class="o">**</span><span class="n">splitting_config</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">restrict_to_train_users</span><span class="p">:</span>
        <span class="n">test</span> <span class="o">=</span> <span class="n">filtering_restrict_to_train_users</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filter_out_already_interacted_items</span><span class="p">:</span>
        <span class="n">test</span> <span class="o">=</span> <span class="n">filtering_already_interacted_items</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">restrict_train_to_unique_user_item_pairs</span><span class="p">:</span>
        <span class="n">train</span> <span class="o">=</span> <span class="n">filtering_restrict_to_unique_user_item_pair</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">restrict_test_to_unique_user_item_pairs</span><span class="p">:</span>
        <span class="n">test</span> <span class="o">=</span> <span class="n">filtering_restrict_to_unique_user_item_pair</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">replace_events_by_ones</span><span class="p">:</span>
        <span class="n">train</span><span class="p">[</span><span class="s2">&quot;event&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">test</span><span class="p">[</span><span class="s2">&quot;event&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Metrics">Metrics<a class="anchor-link" href="#Metrics"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">ranking_metrics</span><span class="p">(</span><span class="n">test_matrix</span><span class="p">,</span> <span class="n">recommendations</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates ranking metrics (precision, recall, F1, F0.5, NDCG, mAP, MRR, LAUC, HR)</span>
<span class="sd">    based on test interactions matrix and recommendations</span>
<span class="sd">    :param test_matrix: Test interactions matrix</span>
<span class="sd">    :param recommendations: Recommendations</span>
<span class="sd">    :param k: Number of top recommendations to calculate metrics on</span>
<span class="sd">    :return: Dataframe with metrics</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">items_number</span> <span class="o">=</span> <span class="n">test_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;F_1&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;F_05&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;ndcg&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;mAP&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;MRR&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;LAUC&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;HR&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">denominators</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;relevant_users&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">user_count</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">recommendations</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])):</span>
        <span class="n">u_interacted_items</span> <span class="o">=</span> <span class="n">get_interacted_items</span><span class="p">(</span><span class="n">test_matrix</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
        <span class="n">interacted_items_amount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">u_interacted_items</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">interacted_items_amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># skip users with no items in test set</span>
            <span class="n">denominators</span><span class="p">[</span><span class="s2">&quot;relevant_users&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># evaluation</span>
            <span class="n">success_statistics</span> <span class="o">=</span> <span class="n">calculate_successes</span><span class="p">(</span>
                <span class="n">k</span><span class="p">,</span> <span class="n">recommendations</span><span class="p">,</span> <span class="n">u_interacted_items</span><span class="p">,</span> <span class="n">user_count</span>
            <span class="p">)</span>

            <span class="n">user_metrics</span> <span class="o">=</span> <span class="n">calculate_ranking_metrics</span><span class="p">(</span>
                <span class="n">success_statistics</span><span class="p">,</span>
                <span class="n">interacted_items_amount</span><span class="p">,</span>
                <span class="n">items_number</span><span class="p">,</span>
                <span class="n">k</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
                <span class="n">metrics</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">+=</span> <span class="n">user_metrics</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span>

    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">metric</span> <span class="o">/</span> <span class="n">denominators</span><span class="p">[</span><span class="s2">&quot;relevant_users&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


<span class="k">def</span> <span class="nf">calculate_ranking_metrics</span><span class="p">(</span>
    <span class="n">success_statistics</span><span class="p">,</span>
    <span class="n">interacted_items_amount</span><span class="p">,</span>
    <span class="n">items_number</span><span class="p">,</span>
    <span class="n">k</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates ranking metrics based on success statistics</span>
<span class="sd">    :param success_statistics: Success statistics dictionary</span>
<span class="sd">    :param interacted_items_amount:</span>
<span class="sd">    :param items_number:</span>
<span class="sd">    :param k: Number of top recommendations to calculate metrics on</span>
<span class="sd">    :return: Dictionary with metrics</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">precision</span> <span class="o">=</span> <span class="n">success_statistics</span><span class="p">[</span><span class="s2">&quot;total_amount&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">k</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="n">success_statistics</span><span class="p">[</span><span class="s2">&quot;total_amount&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">interacted_items_amount</span>
    <span class="n">user_metrics</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
        <span class="n">recall</span><span class="o">=</span><span class="n">recall</span><span class="p">,</span>
        <span class="n">F_1</span><span class="o">=</span><span class="n">calculate_f</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">F_05</span><span class="o">=</span><span class="n">calculate_f</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
        <span class="n">ndcg</span><span class="o">=</span><span class="n">calculate_ndcg</span><span class="p">(</span><span class="n">interacted_items_amount</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">success_statistics</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]),</span>
        <span class="n">mAP</span><span class="o">=</span><span class="n">calculate_map</span><span class="p">(</span><span class="n">success_statistics</span><span class="p">,</span> <span class="n">interacted_items_amount</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span>
        <span class="n">MRR</span><span class="o">=</span><span class="n">calculate_mrr</span><span class="p">(</span><span class="n">success_statistics</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">]),</span>
        <span class="n">LAUC</span><span class="o">=</span><span class="n">calculate_lauc</span><span class="p">(</span>
            <span class="n">success_statistics</span><span class="p">,</span> <span class="n">interacted_items_amount</span><span class="p">,</span> <span class="n">items_number</span><span class="p">,</span> <span class="n">k</span>
        <span class="p">),</span>
        <span class="n">HR</span><span class="o">=</span><span class="n">success_statistics</span><span class="p">[</span><span class="s2">&quot;total_amount&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">user_metrics</span>


<span class="k">def</span> <span class="nf">calculate_mrr</span><span class="p">(</span><span class="n">user_successes</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">user_successes</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_successes</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">else</span> <span class="mi">0</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">calculate_f</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">f</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">precision</span> <span class="o">*</span> <span class="n">recall</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">f</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">else</span> <span class="mi">0</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">calculate_lauc</span><span class="p">(</span><span class="n">successes</span><span class="p">,</span> <span class="n">interacted_items_amount</span><span class="p">,</span> <span class="n">items_number</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">successes</span><span class="p">[</span><span class="s2">&quot;cumsum&quot;</span><span class="p">],</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">successes</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">])</span>
        <span class="o">+</span> <span class="p">(</span><span class="n">successes</span><span class="p">[</span><span class="s2">&quot;total_amount&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">interacted_items_amount</span><span class="p">)</span>
        <span class="o">/</span> <span class="mi">2</span>
        <span class="o">*</span> <span class="p">((</span><span class="n">items_number</span> <span class="o">-</span> <span class="n">interacted_items_amount</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="n">successes</span><span class="p">[</span><span class="s2">&quot;total_amount&quot;</span><span class="p">]))</span>
    <span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">items_number</span> <span class="o">-</span> <span class="n">interacted_items_amount</span><span class="p">)</span> <span class="o">*</span> <span class="n">interacted_items_amount</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">calculate_map</span><span class="p">(</span><span class="n">successes</span><span class="p">,</span> <span class="n">interacted_items_amount</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">successes</span><span class="p">[</span><span class="s2">&quot;cumsum&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">successes</span><span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">min</span><span class="p">(</span>
        <span class="n">k</span><span class="p">,</span> <span class="n">interacted_items_amount</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">calculate_ndcg</span><span class="p">(</span><span class="n">interacted_items_amount</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">user_successes</span><span class="p">):</span>
    <span class="n">cumulative_gain</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">cg_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">cumulative_gain</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">user_successes</span><span class="p">,</span> <span class="n">cumulative_gain</span><span class="p">)</span>
        <span class="o">/</span> <span class="n">cg_sum</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">interacted_items_amount</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">calculate_successes</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">recommendations</span><span class="p">,</span> <span class="n">u_interacted_items</span><span class="p">,</span> <span class="n">user_count</span><span class="p">):</span>

    <span class="n">items</span> <span class="o">=</span> <span class="n">recommendations</span><span class="p">[</span><span class="n">user_count</span><span class="p">,</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">user_successes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">u_interacted_items</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">total</span><span class="o">=</span><span class="n">user_successes</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
        <span class="n">total_amount</span><span class="o">=</span><span class="n">user_successes</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
        <span class="n">cumsum</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">user_successes</span><span class="p">),</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">get_reactions</span><span class="p">(</span><span class="n">test_matrix</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">test_matrix</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">test_matrix</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="p">:</span> <span class="n">test_matrix</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">user</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>


<span class="k">def</span> <span class="nf">get_interacted_items</span><span class="p">(</span><span class="n">test_matrix</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">test_matrix</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="n">test_matrix</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="p">:</span> <span class="n">test_matrix</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">user</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>


<span class="k">def</span> <span class="nf">diversity_metrics</span><span class="p">(</span>
    <span class="n">test_matrix</span><span class="p">,</span> <span class="n">formatted_recommendations</span><span class="p">,</span> <span class="n">original_recommendations</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates diversity metrics</span>
<span class="sd">    (% if recommendations in test, test coverage, Shannon, Gini, users without recommendations)</span>
<span class="sd">    based on test interactions matrix and recommendations</span>
<span class="sd">    :param test_matrix: user/item interactions&#39; matrix</span>
<span class="sd">    :param formatted_recommendations: recommendations where user and item ids were replaced by respective codes based on test_matrix</span>
<span class="sd">    :param original_recommendations: original format recommendations</span>
<span class="sd">    :param k: Number of top recommendations to calculate metrics on</span>
<span class="sd">    :return: Dataframe with metrics</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">formatted_recommendations</span> <span class="o">=</span> <span class="n">formatted_recommendations</span><span class="p">[:,</span> <span class="p">:</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">frequency_statistics</span> <span class="o">=</span> <span class="n">calculate_frequencies</span><span class="p">(</span><span class="n">formatted_recommendations</span><span class="p">,</span> <span class="n">test_matrix</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span>
        <span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span>
    <span class="p">):</span>  <span class="c1"># let&#39;s put zeros we items with 0 frequency and ignore division warning</span>
        <span class="n">log_frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">frequency_statistics</span><span class="p">[</span><span class="s2">&quot;frequencies&quot;</span><span class="p">]),</span> <span class="n">posinf</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">neginf</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>

    <span class="n">metrics</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">reco_in_test</span><span class="o">=</span><span class="n">frequency_statistics</span><span class="p">[</span><span class="s2">&quot;recommendations_in_test_n&quot;</span><span class="p">]</span>
        <span class="o">/</span> <span class="n">frequency_statistics</span><span class="p">[</span><span class="s2">&quot;total_recommendations_n&quot;</span><span class="p">],</span>
        <span class="n">test_coverage</span><span class="o">=</span><span class="n">frequency_statistics</span><span class="p">[</span><span class="s2">&quot;recommended_items_n&quot;</span><span class="p">]</span>
        <span class="o">/</span> <span class="n">test_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">Shannon</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">frequency_statistics</span><span class="p">[</span><span class="s2">&quot;frequencies&quot;</span><span class="p">],</span> <span class="n">log_frequencies</span><span class="p">),</span>
        <span class="n">Gini</span><span class="o">=</span><span class="n">calculate_gini</span><span class="p">(</span>
            <span class="n">frequency_statistics</span><span class="p">[</span><span class="s2">&quot;frequencies&quot;</span><span class="p">],</span> <span class="n">frequency_statistics</span><span class="p">[</span><span class="s2">&quot;items_in_test_n&quot;</span><span class="p">]</span>
        <span class="p">),</span>
        <span class="n">users_without_reco</span><span class="o">=</span><span class="n">original_recommendations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">original_recommendations</span><span class="p">),</span>
        <span class="n">users_without_k_reco</span><span class="o">=</span><span class="n">original_recommendations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">original_recommendations</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


<span class="k">def</span> <span class="nf">calculate_gini</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">items_in_test_n</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
            <span class="n">frequencies</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                <span class="mi">1</span> <span class="o">-</span> <span class="n">items_in_test_n</span><span class="p">,</span>
                <span class="n">items_in_test_n</span><span class="p">,</span>
                <span class="mi">2</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="o">/</span> <span class="p">(</span><span class="n">items_in_test_n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">calculate_frequencies</span><span class="p">(</span><span class="n">formatted_recommendations</span><span class="p">,</span> <span class="n">test_matrix</span><span class="p">):</span>
    <span class="n">frequencies</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
        <span class="nb">int</span><span class="p">,</span> <span class="p">[(</span><span class="n">item</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">test_matrix</span><span class="o">.</span><span class="n">indices</span><span class="p">))]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">formatted_recommendations</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
        <span class="n">frequencies</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">recommendations_out_test_n</span> <span class="o">=</span> <span class="n">frequencies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">frequencies</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">frequencies</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">items_in_test_n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
    <span class="n">recommended_items_n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">[</span><span class="n">frequencies</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">recommendations_in_test_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
    <span class="n">frequencies</span> <span class="o">=</span> <span class="n">frequencies</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
    <span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">frequencies</span><span class="o">=</span><span class="n">frequencies</span><span class="p">,</span>
        <span class="n">items_in_test_n</span><span class="o">=</span><span class="n">items_in_test_n</span><span class="p">,</span>
        <span class="n">recommended_items_n</span><span class="o">=</span><span class="n">recommended_items_n</span><span class="p">,</span>
        <span class="n">recommendations_in_test_n</span><span class="o">=</span><span class="n">recommendations_in_test_n</span><span class="p">,</span>
        <span class="n">total_recommendations_n</span><span class="o">=</span><span class="n">recommendations_out_test_n</span> <span class="o">+</span> <span class="n">recommendations_in_test_n</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Evaluator">Evaluator<a class="anchor-link" href="#Evaluator"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">preprocess_test</span><span class="p">(</span><span class="n">test</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Preprocesses test set to speed up evaluation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_map_column</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="n">test</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">_code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2">_code&quot;</span><span class="p">]))</span>

    <span class="n">test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">test</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>
    <span class="n">user_map</span> <span class="o">=</span> <span class="n">_map_column</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">)</span>
    <span class="n">item_map</span> <span class="o">=</span> <span class="n">_map_column</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">)</span>

    <span class="n">test_matrix</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">(</span>
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)),</span> <span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s2">&quot;user_code&quot;</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="s2">&quot;item_code&quot;</span><span class="p">]))</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">user_map</span><span class="p">,</span> <span class="n">item_map</span><span class="p">,</span> <span class="n">test_matrix</span>


<span class="k">class</span> <span class="nc">Evaluator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class used for models evaluation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># pylint: disable=too-many-instance-attributes</span>
    <span class="c1"># pylint: disable=too-many-arguments</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">recommendations_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">test_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">k</span><span class="p">,</span>
        <span class="n">models_to_evaluate</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recommendations_path</span> <span class="o">=</span> <span class="n">recommendations_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_path</span> <span class="o">=</span> <span class="n">test_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">models_to_evaluate</span> <span class="o">=</span> <span class="n">models_to_evaluate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">located_models</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_map</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_map</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_matrix</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepares test set and models to evaluate</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_get_models</span><span class="p">(</span><span class="n">models_to_evaluate</span><span class="p">,</span> <span class="n">recommendations_path</span><span class="p">):</span>
            <span class="n">models</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">file_name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">recommendations_path</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">models_to_evaluate</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">model</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span> <span class="k">if</span> <span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">models_to_evaluate</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">models</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_path</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_matrix</span> <span class="o">=</span> <span class="n">preprocess_test</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">located_models</span> <span class="o">=</span> <span class="n">_get_models</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">models_to_evaluate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recommendations_path</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">evaluate_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluating multiple models</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_read_recommendations</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recommendations_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">),</span>
                <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">located_models</span><span class="p">:</span>
            <span class="n">recommendations</span> <span class="o">=</span> <span class="n">_read_recommendations</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="n">evaluation_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
                <span class="n">original_recommendations</span><span class="o">=</span><span class="n">recommendations</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">evaluation_result</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;model_name&quot;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">evaluation_result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluation_results</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span>
            <span class="s2">&quot;model_name&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;precision&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_results</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
                <span class="n">by</span><span class="o">=</span><span class="s2">&quot;precision&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">original_recommendations</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate single model</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_format_recommendations</span><span class="p">(</span><span class="n">recommendations</span><span class="p">,</span> <span class="n">user_id_code</span><span class="p">,</span> <span class="n">item_id_code</span><span class="p">):</span>
            <span class="n">users</span> <span class="o">=</span> <span class="n">recommendations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">user_id_code</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">recommendations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">item_id_code</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">users</span><span class="p">,</span> <span class="n">items</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">original_recommendations</span> <span class="o">=</span> <span class="n">original_recommendations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">formatted_recommendations</span> <span class="o">=</span> <span class="n">_format_recommendations</span><span class="p">(</span>
            <span class="n">original_recommendations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_map</span>
        <span class="p">)</span>

        <span class="n">evaluation_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">ranking_metrics</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">test_matrix</span><span class="p">,</span>
                    <span class="n">formatted_recommendations</span><span class="p">,</span>
                    <span class="n">k</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">diversity_metrics</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">test_matrix</span><span class="p">,</span>
                    <span class="n">formatted_recommendations</span><span class="p">,</span>
                    <span class="n">original_recommendations</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">evaluation_results</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Helpers">Helpers<a class="anchor-link" href="#Helpers"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">overlap</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the Overlap Coefficient with respect to (user, item) pairs.</span>
<span class="sd">    We assume uniqueness of (user, item) pairs in DataFrames</span>
<span class="sd">    (not recommending the same item to the same users multiple times)).</span>
<span class="sd">    :param df1: DataFrame which index is user_id and column [&quot;items&quot;] is a list of recommended items</span>
<span class="sd">    :param df2: DataFrame which index is user_id and column [&quot;items&quot;] is a list of recommended items</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nb_items</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">df2</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

    <span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">nb_common_items</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;items_x&quot;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;items_y&quot;</span><span class="p">])),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">return</span> <span class="mf">1.00</span> <span class="o">*</span> <span class="n">nb_common_items</span> <span class="o">/</span> <span class="n">nb_items</span>


<span class="k">def</span> <span class="nf">get_recommendations</span><span class="p">(</span><span class="n">models_to_evaluate</span><span class="p">,</span> <span class="n">recommendations_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns dictionary with model_names as keys and recommendations as values.</span>
<span class="sd">    :param models_to_evaluate: List of model names</span>
<span class="sd">    :param recommendations_path: Stored recommendations directory</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">models</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">recommendations_path</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">recommendations_path</span><span class="p">,</span> <span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span>
        <span class="k">if</span> <span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">models_to_evaluate</span>
    <span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">dict_to_df</span><span class="p">(</span><span class="n">dictionary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates pandas dataframe from dictionary</span>
<span class="sd">    :param dictionary: Original dictionary</span>
<span class="sd">    :return: Dataframe from original dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>


<span class="k">def</span> <span class="nf">efficiency</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">base_params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parametrized decorator for executing function with efficiency logging and</span>
<span class="sd">    storing the results under the given path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_params</span> <span class="o">=</span> <span class="n">base_params</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">efficiency_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">tracemalloc</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">peak</span> <span class="o">=</span> <span class="n">tracemalloc</span><span class="o">.</span><span class="n">get_traced_memory</span><span class="p">()</span>
            <span class="n">dict_to_df</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="o">**</span><span class="n">base_params</span><span class="p">,</span>
                    <span class="o">**</span><span class="p">{</span>
                        <span class="s2">&quot;function_name&quot;</span><span class="p">:</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                        <span class="s2">&quot;execution_time&quot;</span><span class="p">:</span> <span class="n">execution_time</span><span class="p">,</span>
                        <span class="s2">&quot;memory_peak&quot;</span><span class="p">:</span> <span class="n">peak</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">}</span>
            <span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">tracemalloc</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">efficiency_decorator</span>


<span class="k">def</span> <span class="nf">get_unix_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the input path with unique csv filename</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y_%m_</span><span class="si">%d</span><span class="s1">_%H_%M_%S_</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.csv&quot;</span>


<span class="k">def</span> <span class="nf">df_from_dir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns pd.DataFrame with concatenated files from the given path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">files_read</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">dir_path</span> <span class="o">/</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">files_read</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_interactions_subset</span><span class="p">(</span>
    <span class="n">interactions</span><span class="p">,</span> <span class="n">fraction_users</span><span class="p">,</span> <span class="n">fraction_items</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">10</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Select subset from interactions based on fraction of users and items</span>
<span class="sd">    :param interactions: Original interactions</span>
<span class="sd">    :param fraction_users: Fraction of users</span>
<span class="sd">    :param fraction_items: Fraction of items</span>
<span class="sd">    :param random_seed: Random seed</span>
<span class="sd">    :return: Dataframe with subset of interactions</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_get_subset_by_column</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">fraction</span><span class="p">):</span>
        <span class="n">column_df</span> <span class="o">=</span> <span class="n">interactions</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">column_df</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">column_df</span><span class="p">)</span> <span class="o">*</span> <span class="n">fraction</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">interactions</span><span class="p">[</span><span class="n">interactions</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">subset</span><span class="p">)]</span>

    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fraction_users</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">interactions</span> <span class="o">=</span> <span class="n">_get_subset_by_column</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">fraction_users</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fraction_items</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">interactions</span> <span class="o">=</span> <span class="n">_get_subset_by_column</span><span class="p">(</span><span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="n">fraction_items</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">interactions</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-loading">Data loading<a class="anchor-link" href="#Data-loading"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">load_interactions</span><span class="p">(</span><span class="n">data_path</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span>
            <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">],</span>
            <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">load_target_users</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">save_recommendations</span><span class="p">(</span><span class="n">recommendations</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    <span class="n">recommendations</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">data_path</span> <span class="o">=</span> <span class="s1">&#39;df_subset_items.parquet.snappy&#39;</span>

<span class="n">interactions</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
<span class="n">interactions</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>
<span class="n">interactions</span> <span class="o">=</span> <span class="n">interactions</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">})</span>
<span class="n">interactions</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>item</th>
      <th>event</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10</th>
      <td>748807</td>
      <td>167669</td>
      <td>click</td>
      <td>1581465600</td>
    </tr>
    <tr>
      <th>19</th>
      <td>1398480</td>
      <td>8064</td>
      <td>click</td>
      <td>1581465600</td>
    </tr>
    <tr>
      <th>21</th>
      <td>1541984</td>
      <td>7050</td>
      <td>click</td>
      <td>1581465600</td>
    </tr>
    <tr>
      <th>24</th>
      <td>1686074</td>
      <td>50001</td>
      <td>click</td>
      <td>1581465600</td>
    </tr>
    <tr>
      <th>50</th>
      <td>96276</td>
      <td>78456</td>
      <td>click</td>
      <td>1581465601</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">interactions</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 6159193 entries, 10 to 65502199
Data columns (total 4 columns):
 #   Column     Dtype 
---  ------     ----- 
 0   user       object
 1   item       object
 2   event      object
 3   timestamp  int64 
dtypes: int64(1), object(3)
memory usage: 235.0+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="EDA">EDA<a class="anchor-link" href="#EDA"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">n_users</span> <span class="o">=</span> <span class="n">interactions</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="n">n_items</span> <span class="o">=</span> <span class="n">interactions</span><span class="p">[</span><span class="s2">&quot;item&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="n">n_interactions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">interactions</span><span class="p">)</span>

<span class="n">interactions_per_user</span> <span class="o">=</span> <span class="n">interactions</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
<span class="n">interactions_per_item</span> <span class="o">=</span> <span class="n">interactions</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;item&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;We have </span><span class="si">{</span><span class="n">n_users</span><span class="si">}</span><span class="s2"> users, </span><span class="si">{</span><span class="n">n_items</span><span class="si">}</span><span class="s2"> items and </span><span class="si">{</span><span class="n">n_interactions</span><span class="si">}</span><span class="s2"> interactions.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Data sparsity (% of missing entries) is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="n">n_interactions</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_users</span> <span class="o">*</span> <span class="n">n_items</span><span class="p">)),</span> <span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">%.</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Average number of interactions per user is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">interactions_per_user</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\</span>
<span class="s2">    (standard deviation </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">interactions_per_user</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">).</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Average number of interactions per item is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">interactions_per_item</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="se">\</span>
<span class="s2">    (standard deviation </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">interactions_per_item</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">).</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>We have 1535397 users, 17668 items and 6159193 interactions.

Data sparsity (% of missing entries) is 99.9773%.

Average number of interactions per user is 4.011    (standard deviation 6.539).

Average number of interactions per item is 348.607    (standard deviation 608.238).

</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">compute_quantiles</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">]):</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">[[</span><span class="n">quantile</span><span class="p">,</span> <span class="n">series</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">quantile</span><span class="p">)]</span> <span class="k">for</span> <span class="n">quantile</span> <span class="ow">in</span> <span class="n">quantiles</span><span class="p">],</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;quantile&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">],</span>
    <span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Interactions distribution per user:&quot;</span><span class="p">)</span>
<span class="n">compute_quantiles</span><span class="p">(</span><span class="n">interactions_per_user</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Interactions distribution per user:
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>quantile</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.01</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.10</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.25</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.50</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.75</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.90</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.99</td>
      <td>32.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">plot_interactions_distribution</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Users&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;font.size&quot;</span><span class="p">:</span> <span class="mi">22</span><span class="p">})</span>
    <span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of interactions per </span><span class="si">{</span><span class="n">aggregation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Interactions&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


<span class="n">plot_interactions_distribution</span><span class="p">(</span><span class="n">interactions_per_user</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;Users&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
" />
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Interactions distribution per item:&quot;</span><span class="p">)</span>
<span class="n">compute_quantiles</span><span class="p">(</span><span class="n">interactions_per_item</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Interactions distribution per item:
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>quantile</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.01</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.10</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.25</td>
      <td>3.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.50</td>
      <td>134.00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.75</td>
      <td>423.25</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.90</td>
      <td>958.00</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.99</td>
      <td>2858.99</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">plot_interactions_distribution</span><span class="p">(</span><span class="n">interactions_per_item</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="s2">&quot;Items&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
" />
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">event_frequency</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">interactions</span><span class="p">[</span><span class="s2">&quot;event&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">interactions</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;frequency&quot;</span><span class="p">})</span>

<span class="n">event_frequency</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event_frequency</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span>
<span class="p">)</span>
<span class="n">event_frequency</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>frequency</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>click</th>
      <td>89.895%</td>
    </tr>
    <tr>
      <th>contact_phone_click_1</th>
      <td>2.582%</td>
    </tr>
    <tr>
      <th>bookmark</th>
      <td>2.487%</td>
    </tr>
    <tr>
      <th>chat_click</th>
      <td>2.138%</td>
    </tr>
    <tr>
      <th>contact_chat</th>
      <td>1.451%</td>
    </tr>
    <tr>
      <th>contact_partner_click</th>
      <td>0.682%</td>
    </tr>
    <tr>
      <th>contact_phone_click_2</th>
      <td>0.666%</td>
    </tr>
    <tr>
      <th>contact_phone_click_3</th>
      <td>0.1%</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">unix_to_day</span><span class="p">(</span><span class="n">timestamps</span><span class="p">):</span>
    <span class="n">min_timestamp</span> <span class="o">=</span> <span class="n">timestamps</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">seconds_in_day</span> <span class="o">=</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">timestamps</span> <span class="o">-</span> <span class="n">min_timestamp</span><span class="p">)</span><span class="o">//</span><span class="n">seconds_in_day</span> <span class="o">+</span> <span class="mi">1</span>


<span class="n">interactions</span><span class="p">[</span><span class="s2">&quot;day&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unix_to_day</span><span class="p">(</span><span class="n">interactions</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">plot_interactions_over_time</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
    <span class="n">labels</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">freq</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">freq</span><span class="o">.</span><span class="n">values</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span>
    
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;font.size&quot;</span><span class="p">:</span> <span class="mi">22</span><span class="p">})</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data split&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Day&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Interactions [mln]&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
    
<span class="n">plot_interactions_over_time</span><span class="p">(</span><span class="n">interactions</span><span class="p">[</span><span class="s2">&quot;day&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
" />
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Preprocessing">Preprocessing<a class="anchor-link" href="#Preprocessing"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Splitting">Splitting<a class="anchor-link" href="#Splitting"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">random_seed</span><span class="o">=</span><span class="mi">10</span>
<span class="n">validation_target_users_size</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">validation_fraction_users</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">validation_fraction_items</span> <span class="o">=</span> <span class="mf">0.2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">train_and_validation</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">interactions</span><span class="p">)</span>
<span class="n">train_and_validation</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;train_valid.gzip&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;test.gzip&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># split into train and validation</span>
<span class="n">interactions_subset</span> <span class="o">=</span> <span class="n">get_interactions_subset</span><span class="p">(</span>
    <span class="n">interactions</span><span class="o">=</span><span class="n">train_and_validation</span><span class="p">,</span>
    <span class="n">fraction_users</span><span class="o">=</span><span class="n">validation_fraction_users</span><span class="p">,</span>
    <span class="n">fraction_items</span><span class="o">=</span><span class="n">validation_fraction_items</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">train</span><span class="p">,</span> <span class="n">validation</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">interactions_subset</span><span class="p">)</span>
<span class="n">train</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;train.gzip&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">validation</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;validation.gzip&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># prepare target_users</span>
<span class="n">test</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;target_users_all.gzip&#39;</span><span class="p">,</span>
                                      <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                      <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                      <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span>
<span class="p">)</span>

<span class="c1"># prepare target_users for validation</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span>
<span class="n">validation_users</span> <span class="o">=</span> <span class="n">validation</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">validation_users</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">n</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">validation_target_users_size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">validation_users</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;target_users_subset_validation.gzip&#39;</span><span class="p">,</span>
         <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">compression</span><span class="o">=</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span>
         <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Encoding">Encoding<a class="anchor-link" href="#Encoding"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">dataprep</span><span class="p">(</span><span class="n">interactions</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prepare interactions dataset for training model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">interactions</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">user_code_id</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
    <span class="n">user_id_code</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">user_code_id</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;user_code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">user_id_code</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>

    <span class="n">item_code_id</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;item&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()))</span>
    <span class="n">item_id_code</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">item_code_id</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;item_code&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;item&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">item_id_code</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>

    <span class="n">train_ui</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">(</span>
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;user_code&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;item_code&quot;</span><span class="p">]))</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">train_ui</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;user_code_id&#39;</span><span class="p">:</span><span class="n">user_code_id</span><span class="p">,</span>
                      <span class="s1">&#39;user_id_code&#39;</span><span class="p">:</span><span class="n">user_id_code</span><span class="p">,</span>
                      <span class="s1">&#39;item_code_id&#39;</span><span class="p">:</span><span class="n">item_code_id</span><span class="p">,</span>
                      <span class="s1">&#39;item_id_code&#39;</span><span class="p">:</span><span class="n">item_id_code</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Models">Models<a class="anchor-link" href="#Models"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Base-Class">Base Class<a class="anchor-link" href="#Base-Class"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">BaseRecommender</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Base recommender interface&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implement any needed input data preprocessing&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implement model fitter&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">recommend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implement recommend method</span>
<span class="sd">        Should return a DataFrame containing</span>
<span class="sd">        * user_id: id of the user for whom we provide recommendations</span>
<span class="sd">        * n columns containing item recommendations (or None if missing)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="TopPop">TopPop<a class="anchor-link" href="#TopPop"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">TopPop</span><span class="p">(</span><span class="n">BaseRecommender</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TopPop recommender, which recommends the most popular items</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ui</span><span class="p">,</span> <span class="n">encode_maps</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">popular_items</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span> <span class="o">=</span> <span class="n">train_ui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_id_code</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;user_id_code&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_code_id</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;user_code_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_code_id</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;item_code_id&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span> <span class="o">=</span> <span class="n">show_progress</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popular_items</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">recommend</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target_users</span><span class="p">,</span>
        <span class="n">n_recommendations</span><span class="p">,</span>
        <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Recommends n_recommendations items for target_users</span>
<span class="sd">        :return:</span>
<span class="sd">            pd.DataFrame (user, item_1, item_2, ..., item_n)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">ThreadPool</span><span class="p">()</span> <span class="k">as</span> <span class="n">thread_pool</span><span class="p">:</span>
            <span class="n">recommendations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">thread_pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span>
                        <span class="n">partial</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">recommend_per_user</span><span class="p">,</span>
                            <span class="n">n_recommendations</span><span class="o">=</span><span class="n">n_recommendations</span><span class="p">,</span>
                            <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="n">filter_out_interacted_items</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">target_users</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendations</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">recommend_per_user</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">n_recommendations</span><span class="p">,</span> <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recommends n items per user</span>
<span class="sd">        :param user: User id</span>
<span class="sd">        :param n_recommendations: Number of recommendations</span>
<span class="sd">        :param filter_out_interacted_items: boolean value to filter interacted items</span>
<span class="sd">        :return: list of format [user_id, item1, item2 ...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id_code</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">u_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exclude_items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">filter_out_interacted_items</span><span class="p">:</span>
                <span class="n">exclude_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">u_code</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">u_code</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="p">]</span>

            <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">popular_items</span><span class="p">[</span>
                <span class="p">:</span> <span class="n">n_recommendations</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">exclude_items</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">item_code_id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">u_recommended_items</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_items</span>
            <span class="p">]</span>

            <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="n">u_recommended_items</span><span class="p">[:</span><span class="n">n_recommendations</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">[</span><span class="n">user</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">u_recommended_items</span>
            <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_recommendations</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">u_recommended_items</span><span class="p">))</span>
        <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Random">Random<a class="anchor-link" href="#Random"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">Random</span><span class="p">(</span><span class="n">BaseRecommender</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TopPop recommender, which recommends the most popular items</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ui</span><span class="p">,</span> <span class="n">encode_maps</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span> <span class="o">=</span> <span class="n">train_ui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_id_code</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;user_id_code&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_code_id</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;user_code_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_code_id</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;item_code_id&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span> <span class="o">=</span> <span class="n">show_progress</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">recommend</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target_users</span><span class="p">,</span>
        <span class="n">n_recommendations</span><span class="p">,</span>
        <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Recommends n_recommendations items for target_users</span>
<span class="sd">        :return:</span>
<span class="sd">            pd.DataFrame (user, item_1, item_2, ..., item_n)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">ThreadPool</span><span class="p">()</span> <span class="k">as</span> <span class="n">thread_pool</span><span class="p">:</span>
            <span class="n">recommendations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">thread_pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span>
                        <span class="n">partial</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">recommend_per_user</span><span class="p">,</span>
                            <span class="n">n_recommendations</span><span class="o">=</span><span class="n">n_recommendations</span><span class="p">,</span>
                            <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="n">filter_out_interacted_items</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">target_users</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendations</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">recommend_per_user</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">n_recommendations</span><span class="p">,</span> <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recommends n items per user</span>
<span class="sd">        :param user: User id</span>
<span class="sd">        :param n_recommendations: Number of recommendations</span>
<span class="sd">        :param filter_out_interacted_items: boolean value to filter interacted items</span>
<span class="sd">        :return: list of format [user_id, item1, item2 ...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id_code</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">u_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exclude_items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">filter_out_interacted_items</span><span class="p">:</span>
                <span class="n">exclude_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">u_code</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">u_code</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="p">]</span>

            <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">n_recommendations</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">exclude_items</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">item_code_id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">u_recommended_items</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_items</span>
            <span class="p">]</span>

            <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="n">u_recommended_items</span><span class="p">[:</span><span class="n">n_recommendations</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">[</span><span class="n">user</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">u_recommended_items</span>
            <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_recommendations</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">u_recommended_items</span><span class="p">))</span>
        <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="ALS">ALS<a class="anchor-link" href="#ALS"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">ALS</span><span class="p">(</span><span class="n">BaseRecommender</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Module implementing a wrapper for the ALS model</span>
<span class="sd">    Wrapper over ALS model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ui</span><span class="p">,</span>
                 <span class="n">encode_maps</span><span class="p">,</span>
                 <span class="n">factors</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                 <span class="n">regularization</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                 <span class="n">use_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">iterations</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                 <span class="n">event_weights_multiplier</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                 <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Source of descriptions:</span>
<span class="sd">        https://github.com/benfred/implicit/blob/master/implicit/als.py</span>
<span class="sd">        Alternating Least Squares</span>
<span class="sd">        A Recommendation Model based on the algorithms described in the paper</span>
<span class="sd">        &#39;Collaborative Filtering for Implicit Feedback Datasets&#39;</span>
<span class="sd">        with performance optimizations described in &#39;Applications of the</span>
<span class="sd">        Conjugate Gradient Method for Implicit Feedback Collaborative Filtering.&#39;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        factors : int, optional</span>
<span class="sd">            The number of latent factors to compute</span>
<span class="sd">        regularization : float, optional</span>
<span class="sd">            The regularization factor to use</span>
<span class="sd">        use_gpu : bool, optional</span>
<span class="sd">            Fit on the GPU if available, default is to run on CPU</span>
<span class="sd">        iterations : int, optional</span>
<span class="sd">            The number of ALS iterations to use when fitting data</span>
<span class="sd">        event_weights_multiplier: int, optional</span>
<span class="sd">            The multiplier of weights.</span>
<span class="sd">            Used to find a tradeoff between the importance of interacted and not interacted items.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span> <span class="o">=</span> <span class="n">train_ui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_id_code</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;user_id_code&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_code_id</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;user_code_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_code_id</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;item_code_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping_user_test_items</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">similarity_matrix</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span> <span class="o">=</span> <span class="n">show_progress</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">implicit</span><span class="o">.</span><span class="n">als</span><span class="o">.</span><span class="n">AlternatingLeastSquares</span><span class="p">(</span>
            <span class="n">factors</span><span class="o">=</span><span class="n">factors</span><span class="p">,</span>
            <span class="n">regularization</span><span class="o">=</span><span class="n">regularization</span><span class="p">,</span>
            <span class="n">use_gpu</span><span class="o">=</span><span class="n">use_gpu</span><span class="p">,</span>
            <span class="n">iterations</span><span class="o">=</span><span class="n">iterations</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">event_weights_multiplier</span> <span class="o">=</span> <span class="n">event_weights_multiplier</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">recommend</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target_users</span><span class="p">,</span>
        <span class="n">n_recommendations</span><span class="p">,</span>
        <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Recommends n_recommendations items for target_users</span>
<span class="sd">        :return:</span>
<span class="sd">            pd.DataFrame (user, item_1, item_2, ..., item_n)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">ThreadPool</span><span class="p">()</span> <span class="k">as</span> <span class="n">thread_pool</span><span class="p">:</span>
            <span class="n">recommendations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">thread_pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span>
                        <span class="n">partial</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">recommend_per_user</span><span class="p">,</span>
                            <span class="n">n_recommendations</span><span class="o">=</span><span class="n">n_recommendations</span><span class="p">,</span>
                            <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="n">filter_out_interacted_items</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">target_users</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendations</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">recommend_per_user</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">n_recommendations</span><span class="p">,</span> <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recommends n items per user</span>
<span class="sd">        :param user: User id</span>
<span class="sd">        :param n_recommendations: Number of recommendations</span>
<span class="sd">        :param filter_out_interacted_items: boolean value to filter interacted items</span>
<span class="sd">        :return: list of format [user_id, item1, item2 ...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id_code</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">u_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span>
                    <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">recommend</span><span class="p">(</span>
                        <span class="n">u_code</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="p">,</span>
                        <span class="n">N</span><span class="o">=</span><span class="n">n_recommendations</span><span class="p">,</span>
                        <span class="n">filter_already_liked_items</span><span class="o">=</span><span class="n">filter_out_interacted_items</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">item_code_id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">u_recommended_items</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">[</span><span class="n">user</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">u_recommended_items</span>
            <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_recommendations</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">u_recommended_items</span><span class="p">))</span>
        <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="LightFM">LightFM<a class="anchor-link" href="#LightFM"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">LFM</span><span class="p">(</span><span class="n">BaseRecommender</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Module implementing a wrapper for the ALS model</span>
<span class="sd">    Wrapper over LightFM model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ui</span><span class="p">,</span>
                 <span class="n">encode_maps</span><span class="p">,</span>
                <span class="n">no_components</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">learning_schedule</span><span class="o">=</span><span class="s2">&quot;adagrad&quot;</span><span class="p">,</span>
                <span class="n">loss</span><span class="o">=</span><span class="s2">&quot;logistic&quot;</span><span class="p">,</span>
                <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                <span class="n">rho</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
                <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-06</span><span class="p">,</span>
                <span class="n">item_alpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                <span class="n">user_alpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                <span class="n">max_sampled</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
                <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Source of descriptions:</span>
<span class="sd">        https://making.lyst.com/lightfm/docs/_modules/lightfm/lightfm.html#LightFM</span>
<span class="sd">        A hybrid latent representation recommender model.</span>
<span class="sd">        The model learns embeddings (latent representations in a high-dimensional</span>
<span class="sd">        space) for users and items in a way that encodes user preferences over items.</span>
<span class="sd">        When multiplied together, these representations produce scores for every item</span>
<span class="sd">        for a given user; items scored highly are more likely to be interesting to</span>
<span class="sd">        the user.</span>
<span class="sd">        The user and item representations are expressed in terms of representations</span>
<span class="sd">        of their features: an embedding is estimated for every feature, and these</span>
<span class="sd">        features are then summed together to arrive at representations for users and</span>
<span class="sd">        items. For example, if the movie &#39;Wizard of Oz&#39; is described by the following</span>
<span class="sd">        features: &#39;musical fantasy&#39;, &#39;Judy Garland&#39;, and &#39;Wizard of Oz&#39;, then its</span>
<span class="sd">        embedding will be given by taking the features&#39; embeddings and adding them</span>
<span class="sd">        together. The same applies to user features.</span>
<span class="sd">        The embeddings are learned through `stochastic gradient</span>
<span class="sd">        descent &lt;http://cs231n.github.io/optimization-1/&gt;`_ methods.</span>
<span class="sd">        Four loss functions are available:</span>
<span class="sd">        - logistic: useful when both positive (1) and negative (-1) interactions</span>
<span class="sd">        are present.</span>
<span class="sd">        - BPR: Bayesian Personalised Ranking [1]_ pairwise loss. Maximises the</span>
<span class="sd">        prediction difference between a positive example and a randomly</span>
<span class="sd">        chosen negative example. Useful when only positive interactions</span>
<span class="sd">        are present and optimising ROC AUC is desired.</span>
<span class="sd">        - WARP: Weighted Approximate-Rank Pairwise [2]_ loss. Maximises</span>
<span class="sd">        the rank of positive examples by repeatedly sampling negative</span>
<span class="sd">        examples until rank violating one is found. Useful when only</span>
<span class="sd">        positive interactions are present and optimising the top of</span>
<span class="sd">        the recommendation list (precision@k) is desired.</span>
<span class="sd">        - k-OS WARP: k-th order statistic loss [3]_. A modification of WARP that</span>
<span class="sd">        uses the k-th positive example for any given user as a basis for pairwise</span>
<span class="sd">        updates.</span>
<span class="sd">        Two learning rate schedules are available:</span>
<span class="sd">        - adagrad: [4]_</span>
<span class="sd">        - adadelta: [5]_</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        no_components: int, optional</span>
<span class="sd">            the dimensionality of the feature latent embeddings.</span>
<span class="sd">        k: int, optional</span>
<span class="sd">            for k-OS training, the k-th positive example will be selected from the</span>
<span class="sd">            n positive examples sampled for every user.</span>
<span class="sd">        n: int, optional</span>
<span class="sd">            for k-OS training, maximum number of positives sampled for each update.</span>
<span class="sd">        learning_schedule: string, optional</span>
<span class="sd">            one of (&#39;adagrad&#39;, &#39;adadelta&#39;).</span>
<span class="sd">        loss: string, optional</span>
<span class="sd">            one of  (&#39;logistic&#39;, &#39;bpr&#39;, &#39;warp&#39;, &#39;warp-kos&#39;): the loss function.</span>
<span class="sd">        learning_rate: float, optional</span>
<span class="sd">            initial learning rate for the adagrad learning schedule.</span>
<span class="sd">        rho: float, optional</span>
<span class="sd">            moving average coefficient for the adadelta learning schedule.</span>
<span class="sd">        epsilon: float, optional</span>
<span class="sd">            conditioning parameter for the adadelta learning schedule.</span>
<span class="sd">        item_alpha: float, optional</span>
<span class="sd">            L2 penalty on item features. Tip: setting this number too high can slow</span>
<span class="sd">            down training. One good way to check is if the final weights in the</span>
<span class="sd">            embeddings turned out to be mostly zero. The same idea applies to</span>
<span class="sd">            the user_alpha parameter.</span>
<span class="sd">        user_alpha: float, optional</span>
<span class="sd">            L2 penalty on user features.</span>
<span class="sd">        max_sampled: int, optional</span>
<span class="sd">            maximum number of negative samples used during WARP fitting.</span>
<span class="sd">            It requires a lot of sampling to find negative triplets for users that</span>
<span class="sd">            are already well represented by the model; this can lead to very long</span>
<span class="sd">            training times and overfitting. Setting this to a higher number will</span>
<span class="sd">            generally lead to longer training times, but may in some cases improve</span>
<span class="sd">            accuracy.</span>
<span class="sd">        random_state: int seed, RandomState instance, or None</span>
<span class="sd">            The seed of the pseudo random number generator to use when shuffling</span>
<span class="sd">            the data and initializing the parameters.</span>
<span class="sd">        epochs: (int, optional) number of epochs to run</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">LightFM</span><span class="p">(</span>
            <span class="n">no_components</span><span class="o">=</span><span class="n">no_components</span><span class="p">,</span>
            <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
            <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
            <span class="n">learning_schedule</span><span class="o">=</span><span class="n">learning_schedule</span><span class="p">,</span>
            <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
            <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">,</span>
            <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">,</span>
            <span class="n">epsilon</span><span class="o">=</span><span class="n">epsilon</span><span class="p">,</span>
            <span class="n">item_alpha</span><span class="o">=</span><span class="n">item_alpha</span><span class="p">,</span>
            <span class="n">user_alpha</span><span class="o">=</span><span class="n">user_alpha</span><span class="p">,</span>
            <span class="n">max_sampled</span><span class="o">=</span><span class="n">max_sampled</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epochs</span> <span class="o">=</span> <span class="n">epochs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span> <span class="o">=</span> <span class="n">train_ui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_id_code</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;user_id_code&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_code_id</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;user_code_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_code_id</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;item_code_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping_user_test_items</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">similarity_matrix</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span> <span class="o">=</span> <span class="n">show_progress</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="p">,</span>
            <span class="n">epochs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span>
            <span class="n">num_threads</span><span class="o">=</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">(),</span>
            <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">recommend</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target_users</span><span class="p">,</span>
        <span class="n">n_recommendations</span><span class="p">,</span>
        <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Recommends n_recommendations items for target_users</span>
<span class="sd">        :return:</span>
<span class="sd">            pd.DataFrame (user, item_1, item_2, ..., item_n)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">items_to_recommend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_code_id</span><span class="p">))</span>

        <span class="k">with</span> <span class="n">ThreadPool</span><span class="p">()</span> <span class="k">as</span> <span class="n">thread_pool</span><span class="p">:</span>
            <span class="n">recommendations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">thread_pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span>
                        <span class="n">partial</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">recommend_per_user</span><span class="p">,</span>
                            <span class="n">n_recommendations</span><span class="o">=</span><span class="n">n_recommendations</span><span class="p">,</span>
                            <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="n">filter_out_interacted_items</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">target_users</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendations</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">recommend_per_user</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">n_recommendations</span><span class="p">,</span> <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recommends n items per user</span>
<span class="sd">        :param user: User id</span>
<span class="sd">        :param n_recommendations: Number of recommendations</span>
<span class="sd">        :param filter_out_interacted_items: boolean value to filter interacted items</span>
<span class="sd">        :return: list of format [user_id, item1, item2 ...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id_code</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">u_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">interacted_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">u_code</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">u_code</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">]</span>

            <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">u_code</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">items_to_recommend</span><span class="p">)</span>

            <span class="n">item_recommendations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items_to_recommend</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">scores</span><span class="p">)][</span>
                <span class="p">:</span> <span class="n">n_recommendations</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">interacted_items</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">item_recommendations</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">item_code_id</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_recommendations</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interacted_items</span>
            <span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">[</span><span class="n">user</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">item_recommendations</span>
            <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_recommendations</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">item_recommendations</span><span class="p">))</span>
        <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="RP3Beta">RP3Beta<a class="anchor-link" href="#RP3Beta"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">RP3Beta</span><span class="p">(</span><span class="n">BaseRecommender</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Module implementing a RP3Beta model</span>
<span class="sd">    RP3Beta model proposed in the paper &quot;Updatable, Accurate, Diverse, and Scalable Recommendations for Interactive</span>
<span class="sd">    Applications&quot;. In our implementation we perform direct computations on sparse matrices instead of random walks</span>
<span class="sd">    approximation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ui</span><span class="p">,</span>
                 <span class="n">encode_maps</span><span class="p">,</span>
                 <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">beta</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span> <span class="o">=</span> <span class="n">train_ui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_id_code</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;user_id_code&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_code_id</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;user_code_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_code_id</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;item_code_id&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_ui</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">similarity_matrix</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span> <span class="o">=</span> <span class="n">show_progress</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Define Pui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_ui</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>

        <span class="c1"># Define Piu</span>
        <span class="n">p_iu</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">tocsr</span><span class="p">(),</span> <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">similarity_matrix</span> <span class="o">=</span> <span class="n">p_iu</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_ui</span>
        <span class="n">item_orders</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">similarity_matrix</span> <span class="o">*=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">diags</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">item_orders</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">recommend</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target_users</span><span class="p">,</span>
        <span class="n">n_recommendations</span><span class="p">,</span>
        <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Recommends n_recommendations items for target_users</span>
<span class="sd">        :return:</span>
<span class="sd">            pd.DataFrame (user, item_1, item_2, ..., item_n)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">ThreadPool</span><span class="p">()</span> <span class="k">as</span> <span class="n">thread_pool</span><span class="p">:</span>
            <span class="n">recommendations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">thread_pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span>
                        <span class="n">partial</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">recommend_per_user</span><span class="p">,</span>
                            <span class="n">n_recommendations</span><span class="o">=</span><span class="n">n_recommendations</span><span class="p">,</span>
                            <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="n">filter_out_interacted_items</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">target_users</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendations</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">recommend_per_user</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">n_recommendations</span><span class="p">,</span> <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recommends n items per user</span>
<span class="sd">        :param user: User id</span>
<span class="sd">        :param n_recommendations: Number of recommendations</span>
<span class="sd">        :param filter_out_interacted_items: boolean value to filter interacted items</span>
<span class="sd">        :return: list of format [user_id, item1, item2 ...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id_code</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">u_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">exclude_items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">filter_out_interacted_items</span><span class="p">:</span>
                <span class="n">exclude_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">u_code</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">u_code</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="p">]</span>

            <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p_ui</span><span class="p">[</span><span class="n">u_code</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity_matrix</span>
            <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span>
                <span class="p">(</span><span class="o">-</span><span class="n">scores</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[:</span> <span class="n">n_recommendations</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">exclude_items</span><span class="p">)]</span>
            <span class="p">]</span>

            <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">item_code_id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">u_recommended_items</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_items</span>
            <span class="p">]</span>

            <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="n">u_recommended_items</span><span class="p">[:</span><span class="n">n_recommendations</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="p">[</span><span class="n">user</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">u_recommended_items</span>
            <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_recommendations</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">u_recommended_items</span><span class="p">))</span>
        <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SLIM">SLIM<a class="anchor-link" href="#SLIM"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">SLIM</span><span class="p">(</span><span class="n">BaseRecommender</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Module implementing SLIM model</span>
<span class="sd">    SLIM model proposed in &quot;SLIM: Sparse Linear Methods for Top-N Recommender Systems</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train_ui</span><span class="p">,</span>
                 <span class="n">encode_maps</span><span class="p">,</span>
                 <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span>
                 <span class="n">l1_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="n">iterations</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                 <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span> <span class="o">=</span> <span class="n">train_ui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_id_code</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;user_id_code&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_code_id</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;user_code_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_code_id</span> <span class="o">=</span> <span class="n">encode_maps</span><span class="p">[</span><span class="s1">&#39;item_code_id&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">l1_ratio</span> <span class="o">=</span> <span class="n">l1_ratio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iterations</span> <span class="o">=</span> <span class="n">iterations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">similarity_matrix</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span> <span class="o">=</span> <span class="n">show_progress</span>

    <span class="k">def</span> <span class="nf">fit_per_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits ElasticNet per item</span>
<span class="sd">        :param column_id: Id of column to setup as predicted value</span>
<span class="sd">        :return: coefficients of the ElasticNet model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ElasticNet</span><span class="p">(</span>
            <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">l1_ratio</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">l1_ratio</span><span class="p">,</span>
            <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">copy_X</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">selection</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
            <span class="n">max_iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">iterations</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># set to zeros all entries in the given column of train_ui</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="p">[:,</span> <span class="n">column_id</span><span class="p">]</span><span class="o">.</span><span class="n">A</span>
        <span class="n">start_indptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">column_id</span><span class="p">]</span>
        <span class="n">end_indptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">column_id</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">column_ratings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">start_indptr</span><span class="p">:</span><span class="n">end_indptr</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">start_indptr</span><span class="p">:</span><span class="n">end_indptr</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># learn item-item similarities</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># return original ratings to train_ui</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">start_indptr</span><span class="p">:</span><span class="n">end_indptr</span><span class="p">]</span> <span class="o">=</span> <span class="n">column_ratings</span>

        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">sparse_coef_</span><span class="o">.</span><span class="n">T</span>

    <span class="nd">@ignore_warnings</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">ConvergenceWarning</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">tocsc</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">ThreadPool</span><span class="p">()</span> <span class="k">as</span> <span class="n">thread_pool</span><span class="p">:</span>
            <span class="n">coefs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">thread_pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_per_item</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
                    <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">similarity_matrix</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">recommend</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target_users</span><span class="p">,</span>
        <span class="n">n_recommendations</span><span class="p">,</span>
        <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Recommends n_recommendations items for target_users</span>
<span class="sd">        :return:</span>
<span class="sd">            pd.DataFrame (user, item_1, item_2, ..., item_n)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">ThreadPool</span><span class="p">()</span> <span class="k">as</span> <span class="n">thread_pool</span><span class="p">:</span>
            <span class="n">recommendations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">tqdm</span><span class="p">(</span>
                    <span class="n">thread_pool</span><span class="o">.</span><span class="n">imap</span><span class="p">(</span>
                        <span class="n">partial</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">recommend_per_user</span><span class="p">,</span>
                            <span class="n">n_recommendations</span><span class="o">=</span><span class="n">n_recommendations</span><span class="p">,</span>
                            <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="n">filter_out_interacted_items</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">target_users</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">disable</span><span class="o">=</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_progress</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendations</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">recommend_per_user</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">n_recommendations</span><span class="p">,</span> <span class="n">filter_out_interacted_items</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recommends n items per user</span>
<span class="sd">        :param user: User id</span>
<span class="sd">        :param n_recommendations: Number of recommendations</span>
<span class="sd">        :param filter_out_interacted_items: boolean value to filter interacted items</span>
<span class="sd">        :return: list of format [user_id, item1, item2 ...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_id_code</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">u_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">exclude_items</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">filter_out_interacted_items</span><span class="p">:</span>
                <span class="n">exclude_items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">u_code</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="o">.</span><span class="n">indptr</span><span class="p">[</span><span class="n">u_code</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="p">]</span>

            <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_ui</span><span class="p">[</span><span class="n">u_code</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity_matrix</span>
            <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span>
                <span class="p">(</span><span class="o">-</span><span class="n">scores</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[:</span> <span class="n">n_recommendations</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">exclude_items</span><span class="p">)]</span>
            <span class="p">]</span>

            <span class="n">u_recommended_items</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">item_code_id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">u_recommended_items</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_items</span>
            <span class="p">][:</span><span class="n">n_recommendations</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="p">[</span><span class="n">user</span><span class="p">]</span>
            <span class="o">+</span> <span class="n">u_recommended_items</span>
            <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_recommendations</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">u_recommended_items</span><span class="p">))</span>
        <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Runs">Runs<a class="anchor-link" href="#Runs"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">interactions_train</span> <span class="o">=</span> <span class="n">load_interactions</span><span class="p">(</span><span class="s1">&#39;train.gzip&#39;</span><span class="p">)</span>

<span class="c1"># encode user ids and convert interactions into sparse interaction matrix</span>
<span class="n">train_ui</span><span class="p">,</span> <span class="n">encode_maps</span> <span class="o">=</span> <span class="n">dataprep</span><span class="p">(</span><span class="n">interactions_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">target_users</span> <span class="o">=</span> <span class="n">load_target_users</span><span class="p">(</span><span class="s1">&#39;target_users_subset_validation.gzip&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;itempop&#39;</span><span class="p">:</span> <span class="n">TopPop</span><span class="p">,</span>
          <span class="s1">&#39;random&#39;</span><span class="p">:</span> <span class="n">Random</span><span class="p">,</span>
          <span class="s1">&#39;als&#39;</span><span class="p">:</span> <span class="n">ALS</span><span class="p">,</span>
          <span class="s1">&#39;lightfm&#39;</span><span class="p">:</span> <span class="n">LFM</span><span class="p">,</span>
          <span class="s1">&#39;rp3&#39;</span><span class="p">:</span> <span class="n">RP3Beta</span><span class="p">,</span>
          <span class="s1">&#39;slim&#39;</span><span class="p">:</span> <span class="n">SLIM</span><span class="p">,</span>
          <span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Training-Random-Model">Training Random Model<a class="anchor-link" href="#Training-Random-Model"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;random&#39;</span>

<span class="n">Model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>

<span class="c1"># number of recommendations</span>
<span class="n">N_RECOMMENDATIONS</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># initiate the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">train_ui</span><span class="p">,</span> <span class="n">encode_maps</span><span class="p">)</span>

<span class="c1"># train the model</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># # recommend</span>
<span class="n">recommendations</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">recommend</span><span class="p">(</span><span class="n">target_users</span><span class="o">=</span><span class="n">target_users</span><span class="p">,</span> <span class="n">n_recommendations</span><span class="o">=</span><span class="n">N_RECOMMENDATIONS</span><span class="p">)</span>

<span class="c1"># # save the recommendations</span>
<span class="n">save_recommendations</span><span class="p">(</span><span class="n">recommendations</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.gzip&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_name</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>5373it [00:00, 17610.42it/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Training-Item-Pop-Model">Training Item Pop Model<a class="anchor-link" href="#Training-Item-Pop-Model"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;itempop&#39;</span>

<span class="n">Model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>

<span class="c1"># number of recommendations</span>
<span class="n">N_RECOMMENDATIONS</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># initiate the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">train_ui</span><span class="p">,</span> <span class="n">encode_maps</span><span class="p">)</span>

<span class="c1"># train the model</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># # recommend</span>
<span class="n">recommendations</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">recommend</span><span class="p">(</span><span class="n">target_users</span><span class="o">=</span><span class="n">target_users</span><span class="p">,</span> <span class="n">n_recommendations</span><span class="o">=</span><span class="n">N_RECOMMENDATIONS</span><span class="p">)</span>

<span class="c1"># # save the recommendations</span>
<span class="n">save_recommendations</span><span class="p">(</span><span class="n">recommendations</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.gzip&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_name</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>5373it [00:00, 15331.51it/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Training-ALS-Model">Training ALS Model<a class="anchor-link" href="#Training-ALS-Model"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;als&#39;</span>

<span class="n">Model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>

<span class="n">FACTORS</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">REGULARIZATION</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">ITERATIONS</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">EVENT_WEIGHTS_MULTIPLIER</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">N_RECOMMENDATIONS</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># initiate the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">train_ui</span><span class="p">,</span>
              <span class="n">encode_maps</span><span class="p">,</span>
              <span class="n">factors</span><span class="o">=</span><span class="n">FACTORS</span><span class="p">,</span>
              <span class="n">regularization</span><span class="o">=</span><span class="n">REGULARIZATION</span><span class="p">,</span>
              <span class="n">iterations</span><span class="o">=</span><span class="n">ITERATIONS</span><span class="p">,</span>
              <span class="n">event_weights_multiplier</span><span class="o">=</span><span class="n">EVENT_WEIGHTS_MULTIPLIER</span><span class="p">,</span>
              <span class="p">)</span>

<span class="c1"># train the model</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># # recommend</span>
<span class="n">recommendations</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">recommend</span><span class="p">(</span><span class="n">target_users</span><span class="o">=</span><span class="n">target_users</span><span class="p">,</span> <span class="n">n_recommendations</span><span class="o">=</span><span class="n">N_RECOMMENDATIONS</span><span class="p">)</span>

<span class="c1"># # save the recommendations</span>
<span class="n">save_recommendations</span><span class="p">(</span><span class="n">recommendations</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.gzip&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_name</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>WARNING:root:OpenBLAS detected. Its highly recommend to set the environment variable &#39;export OPENBLAS_NUM_THREADS=1&#39; to disable its internal multithreading
5373it [00:04, 1170.63it/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Training-LightFM-Model">Training LightFM Model<a class="anchor-link" href="#Training-LightFM-Model"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;lightfm&#39;</span>

<span class="n">Model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>

<span class="n">no_components</span><span class="o">=</span><span class="mi">200</span>
<span class="n">learning_schedule</span><span class="o">=</span><span class="s2">&quot;adadelta&quot;</span>
<span class="n">loss</span><span class="o">=</span><span class="s2">&quot;warp&quot;</span>
<span class="n">max_sampled</span><span class="o">=</span><span class="mi">61</span>
<span class="n">epochs</span><span class="o">=</span><span class="mi">11</span>

<span class="n">N_RECOMMENDATIONS</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># initiate the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">train_ui</span><span class="p">,</span>
              <span class="n">encode_maps</span><span class="p">,</span>
              <span class="n">no_components</span><span class="o">=</span><span class="n">no_components</span><span class="p">,</span>
              <span class="n">learning_schedule</span><span class="o">=</span><span class="n">learning_schedule</span><span class="p">,</span>
              <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
              <span class="n">max_sampled</span><span class="o">=</span><span class="n">max_sampled</span><span class="p">,</span>
              <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
              <span class="p">)</span>

<span class="c1"># train the model</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># # recommend</span>
<span class="n">recommendations</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">recommend</span><span class="p">(</span><span class="n">target_users</span><span class="o">=</span><span class="n">target_users</span><span class="p">,</span> <span class="n">n_recommendations</span><span class="o">=</span><span class="n">N_RECOMMENDATIONS</span><span class="p">)</span>

<span class="c1"># # save the recommendations</span>
<span class="n">save_recommendations</span><span class="p">(</span><span class="n">recommendations</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.gzip&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_name</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Epoch: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 11/11 [00:24&lt;00:00,  2.22s/it]
5373it [00:11, 486.61it/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Training-RP3Beta-Model">Training RP3Beta Model<a class="anchor-link" href="#Training-RP3Beta-Model"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;rp3&#39;</span>

<span class="n">Model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>

<span class="n">ALPHA</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">BETA</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">N_RECOMMENDATIONS</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># initiate the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">train_ui</span><span class="p">,</span>
              <span class="n">encode_maps</span><span class="p">,</span>
              <span class="n">alpha</span><span class="o">=</span><span class="n">ALPHA</span><span class="p">,</span>
              <span class="n">beta</span><span class="o">=</span><span class="n">BETA</span><span class="p">,</span>
              <span class="p">)</span>

<span class="c1"># train the model</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># # recommend</span>
<span class="n">recommendations</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">recommend</span><span class="p">(</span><span class="n">target_users</span><span class="o">=</span><span class="n">target_users</span><span class="p">,</span> <span class="n">n_recommendations</span><span class="o">=</span><span class="n">N_RECOMMENDATIONS</span><span class="p">)</span>

<span class="c1"># # save the recommendations</span>
<span class="n">save_recommendations</span><span class="p">(</span><span class="n">recommendations</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.gzip&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_name</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>5373it [00:03, 1637.26it/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Training-SLIM-Model">Training SLIM Model<a class="anchor-link" href="#Training-SLIM-Model"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;slim&#39;</span>

<span class="n">Model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>

<span class="n">N_RECOMMENDATIONS</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># initiate the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">train_ui</span><span class="p">,</span>
              <span class="n">encode_maps</span><span class="p">,</span>
              <span class="p">)</span>

<span class="c1"># train the model</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># # recommend</span>
<span class="n">recommendations</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">recommend</span><span class="p">(</span><span class="n">target_users</span><span class="o">=</span><span class="n">target_users</span><span class="p">,</span> <span class="n">n_recommendations</span><span class="o">=</span><span class="n">N_RECOMMENDATIONS</span><span class="p">)</span>

<span class="c1"># # save the recommendations</span>
<span class="n">save_recommendations</span><span class="p">(</span><span class="n">recommendations</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.gzip&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model_name</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>2376it [00:14, 163.75it/s]
5373it [00:02, 2016.80it/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Evaluation">Evaluation<a class="anchor-link" href="#Evaluation"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">(</span>
    <span class="n">recommendations_path</span><span class="o">=</span><span class="s1">&#39;/content&#39;</span><span class="p">,</span>
    <span class="n">test_path</span><span class="o">=</span><span class="s1">&#39;validation.gzip&#39;</span><span class="p">,</span>
    <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">models_to_evaluate</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
<span class="p">)</span>

<span class="n">evaluator</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>

<span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate_models</span><span class="p">()</span>

<span class="n">evaluator</span><span class="o">.</span><span class="n">evaluation_results</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>5373it [00:00, 11755.66it/s]
5373it [00:00, 11352.94it/s]
5373it [00:00, 11671.65it/s]
5373it [00:00, 11761.84it/s]
5373it [00:00, 11632.48it/s]
5373it [00:00, 11745.21it/s]
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>precision</th>
      <th>recall</th>
      <th>F_1</th>
      <th>F_05</th>
      <th>ndcg</th>
      <th>mAP</th>
      <th>MRR</th>
      <th>LAUC</th>
      <th>HR</th>
      <th>reco_in_test</th>
      <th>test_coverage</th>
      <th>Shannon</th>
      <th>Gini</th>
      <th>users_without_reco</th>
      <th>users_without_k_reco</th>
    </tr>
    <tr>
      <th>model_name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>rp3</th>
      <td>0.023004</td>
      <td>0.187388</td>
      <td>0.040282</td>
      <td>0.027746</td>
      <td>0.124805</td>
      <td>0.100025</td>
      <td>0.114362</td>
      <td>0.590383</td>
      <td>0.214964</td>
      <td>0.874577</td>
      <td>0.896476</td>
      <td>6.444258</td>
      <td>0.640194</td>
      <td>0.002978</td>
      <td>0.030151</td>
    </tr>
    <tr>
      <th>lightfm</th>
      <td>0.018053</td>
      <td>0.148499</td>
      <td>0.031659</td>
      <td>0.021784</td>
      <td>0.102187</td>
      <td>0.083530</td>
      <td>0.095443</td>
      <td>0.570879</td>
      <td>0.169738</td>
      <td>0.897394</td>
      <td>0.786344</td>
      <td>6.558708</td>
      <td>0.603250</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>slim</th>
      <td>0.015336</td>
      <td>0.125498</td>
      <td>0.026881</td>
      <td>0.018503</td>
      <td>0.094253</td>
      <td>0.080069</td>
      <td>0.091860</td>
      <td>0.559400</td>
      <td>0.145729</td>
      <td>0.467430</td>
      <td>0.467695</td>
      <td>5.874312</td>
      <td>0.798783</td>
      <td>0.170854</td>
      <td>0.697190</td>
    </tr>
    <tr>
      <th>als</th>
      <td>0.011148</td>
      <td>0.091039</td>
      <td>0.019523</td>
      <td>0.013446</td>
      <td>0.061763</td>
      <td>0.049716</td>
      <td>0.057786</td>
      <td>0.542032</td>
      <td>0.107203</td>
      <td>0.841280</td>
      <td>0.740088</td>
      <td>6.327765</td>
      <td>0.690216</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>itempop</th>
      <td>0.004262</td>
      <td>0.033163</td>
      <td>0.007400</td>
      <td>0.005128</td>
      <td>0.017145</td>
      <td>0.011278</td>
      <td>0.014088</td>
      <td>0.512925</td>
      <td>0.041876</td>
      <td>1.000000</td>
      <td>0.010279</td>
      <td>2.339907</td>
      <td>0.993313</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>random</th>
      <td>0.000577</td>
      <td>0.004510</td>
      <td>0.000994</td>
      <td>0.000692</td>
      <td>0.001861</td>
      <td>0.000966</td>
      <td>0.001209</td>
      <td>0.498580</td>
      <td>0.005770</td>
      <td>0.565364</td>
      <td>0.986050</td>
      <td>7.180956</td>
      <td>0.128753</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">evaluator</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">(</span>
    <span class="n">recommendations_path</span><span class="o">=</span><span class="s1">&#39;/content&#39;</span><span class="p">,</span>
    <span class="n">test_path</span><span class="o">=</span><span class="s1">&#39;validation.gzip&#39;</span><span class="p">,</span>
    <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">models_to_evaluate</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
<span class="p">)</span>

<span class="n">evaluator</span><span class="o">.</span><span class="n">prepare</span><span class="p">()</span>

<span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate_models</span><span class="p">()</span>

<span class="n">evaluator</span><span class="o">.</span><span class="n">evaluation_results</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>5373it [00:00, 12328.94it/s]
5373it [00:00, 11966.13it/s]
5373it [00:00, 11717.03it/s]
5373it [00:00, 11618.24it/s]
5373it [00:00, 11584.71it/s]
5373it [00:00, 11754.46it/s]
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>precision</th>
      <th>recall</th>
      <th>F_1</th>
      <th>F_05</th>
      <th>ndcg</th>
      <th>mAP</th>
      <th>MRR</th>
      <th>LAUC</th>
      <th>HR</th>
      <th>reco_in_test</th>
      <th>test_coverage</th>
      <th>Shannon</th>
      <th>Gini</th>
      <th>users_without_reco</th>
      <th>users_without_k_reco</th>
    </tr>
    <tr>
      <th>model_name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>rp3</th>
      <td>0.023004</td>
      <td>0.187388</td>
      <td>0.040282</td>
      <td>0.027746</td>
      <td>0.124805</td>
      <td>0.100025</td>
      <td>0.114362</td>
      <td>0.590383</td>
      <td>0.214964</td>
      <td>0.874577</td>
      <td>0.896476</td>
      <td>6.444258</td>
      <td>0.640194</td>
      <td>0.002978</td>
      <td>0.030151</td>
    </tr>
    <tr>
      <th>lightfm</th>
      <td>0.018053</td>
      <td>0.148499</td>
      <td>0.031659</td>
      <td>0.021784</td>
      <td>0.102187</td>
      <td>0.083530</td>
      <td>0.095443</td>
      <td>0.570879</td>
      <td>0.169738</td>
      <td>0.897394</td>
      <td>0.786344</td>
      <td>6.558708</td>
      <td>0.603250</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>slim</th>
      <td>0.015336</td>
      <td>0.125498</td>
      <td>0.026881</td>
      <td>0.018503</td>
      <td>0.094253</td>
      <td>0.080069</td>
      <td>0.091860</td>
      <td>0.559400</td>
      <td>0.145729</td>
      <td>0.467430</td>
      <td>0.467695</td>
      <td>5.874312</td>
      <td>0.798783</td>
      <td>0.170854</td>
      <td>0.697190</td>
    </tr>
    <tr>
      <th>als</th>
      <td>0.011148</td>
      <td>0.091039</td>
      <td>0.019523</td>
      <td>0.013446</td>
      <td>0.061763</td>
      <td>0.049716</td>
      <td>0.057786</td>
      <td>0.542032</td>
      <td>0.107203</td>
      <td>0.841280</td>
      <td>0.740088</td>
      <td>6.327765</td>
      <td>0.690216</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>itempop</th>
      <td>0.004262</td>
      <td>0.033163</td>
      <td>0.007400</td>
      <td>0.005128</td>
      <td>0.017145</td>
      <td>0.011278</td>
      <td>0.014088</td>
      <td>0.512925</td>
      <td>0.041876</td>
      <td>1.000000</td>
      <td>0.010279</td>
      <td>2.339907</td>
      <td>0.993313</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>random</th>
      <td>0.000577</td>
      <td>0.004510</td>
      <td>0.000994</td>
      <td>0.000692</td>
      <td>0.001861</td>
      <td>0.000966</td>
      <td>0.001209</td>
      <td>0.498580</td>
      <td>0.005770</td>
      <td>0.565364</td>
      <td>0.986050</td>
      <td>7.180956</td>
      <td>0.128753</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">qq</span> <span class="n">install</span> <span class="n">tree</span>
<span class="err">!</span><span class="n">rm</span> <span class="o">-</span><span class="n">r</span> <span class="n">sample_data</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">tree</span> <span class="o">--</span><span class="n">du</span> <span class="o">-</span><span class="n">h</span> <span class="o">-</span><span class="n">C</span> <span class="o">.</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-blue-intense-fg ansi-bold">.</span>
â”œâ”€â”€ [122K]  als.gzip
â”œâ”€â”€ [ 69M]  df_subset_items.parquet.snappy
â”œâ”€â”€ [ 69M]  df_subset_users.parquet.snappy
â”œâ”€â”€ [2.0G]  interactions.csv
â”œâ”€â”€ [ 26K]  itempop.gzip
â”œâ”€â”€ [137K]  lightfm.gzip
â”œâ”€â”€ [509M]  <span class="ansi-red-intense-fg ansi-bold">olx-jobs-interactions.zip</span>
â”œâ”€â”€ [151K]  random.gzip
â”œâ”€â”€ [4.5K]  README.txt
â”œâ”€â”€ [121K]  rp3.gzip
â”œâ”€â”€ [ 61K]  slim.gzip
â”œâ”€â”€ [524K]  target_users_all.gzip
â”œâ”€â”€ [ 20K]  target_users_subset_validation.gzip
â”œâ”€â”€ [4.0M]  test.gzip
â”œâ”€â”€ [837K]  train.gzip
â”œâ”€â”€ [ 30M]  train_valid.gzip
â””â”€â”€ [ 61K]  validation.gzip

 2.6G used in 0 directories, 17 files
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">watermark</span>
<span class="o">%</span><span class="n">reload_ext</span> <span class="n">watermark</span>
<span class="o">%</span><span class="n">watermark</span> <span class="o">-</span><span class="n">a</span> <span class="s2">&quot;Sparsh A.&quot;</span> <span class="o">-</span><span class="n">m</span> <span class="o">-</span><span class="n">iv</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="n">lightfm</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Author: Sparsh A.

Last updated: 2021-12-10 10:37:34

lightfm: 1.16

Compiler    : GCC 7.5.0
OS          : Linux
Release     : 5.4.104+
Machine     : x86_64
Processor   : x86_64
CPU cores   : 2
Architecture: 64bit

scipy     : 1.4.1
implicit  : 0.4.8
numpy     : 1.19.5
IPython   : 5.5.0
sklearn   : 0.0
matplotlib: 3.2.2
sys       : 3.7.12 (default, Sep 10 2021, 00:21:48) 
[GCC 7.5.0]
pandas    : 1.1.5

</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">sklearn</span>
<span class="n">sklearn</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;1.0.1&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>END</strong></p>

</div>
</div>
</div>
</div>

<script type="application/vnd.jupyter.widget-state+json">
{"9968de8625a44cd5845470867cd1e547": {"model_module": "@jupyter-widgets/controls", "model_name": "HBoxModel", "model_module_version": "1.5.0", "state": {"_view_name": "HBoxView", "_dom_classes": [], "_model_name": "HBoxModel", "_view_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_view_count": null, "_view_module_version": "1.5.0", "box_style": "", "layout": "IPY_MODEL_cdfb05654b1b4039aba929e38b5e11ab", "_model_module": "@jupyter-widgets/controls", "children": ["IPY_MODEL_a7dcc1acdc8c45edaf07863a3bfb1030", "IPY_MODEL_7d7e8822c9ce44879d76a786bcd482ab", "IPY_MODEL_46fafbbc6545402f891b745e1995a671"]}}, "cdfb05654b1b4039aba929e38b5e11ab": {"model_module": "@jupyter-widgets/base", "model_name": "LayoutModel", "model_module_version": "1.2.0", "state": {"_view_name": "LayoutView", "grid_template_rows": null, "right": null, "justify_content": null, "_view_module": "@jupyter-widgets/base", "overflow": null, "_model_module_version": "1.2.0", "_view_count": null, "flex_flow": null, "width": null, "min_width": null, "border": null, "align_items": null, "bottom": null, "_model_module": "@jupyter-widgets/base", "top": null, "grid_column": null, "overflow_y": null, "overflow_x": null, "grid_auto_flow": null, "grid_area": null, "grid_template_columns": null, "flex": null, "_model_name": "LayoutModel", "justify_items": null, "grid_row": null, "max_height": null, "align_content": null, "visibility": null, "align_self": null, "height": null, "min_height": null, "padding": null, "grid_auto_rows": null, "grid_gap": null, "max_width": null, "order": null, "_view_module_version": "1.2.0", "grid_template_areas": null, "object_position": null, "object_fit": null, "grid_auto_columns": null, "margin": null, "display": null, "left": null}}, "a7dcc1acdc8c45edaf07863a3bfb1030": {"model_module": "@jupyter-widgets/controls", "model_name": "HTMLModel", "model_module_version": "1.5.0", "state": {"_view_name": "HTMLView", "style": "IPY_MODEL_6f51152ee8a24d8d82d8b580d049f581", "_dom_classes": [], "description": "", "_model_name": "HTMLModel", "placeholder": "\u200b", "_view_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "value": "100%", "_view_count": null, "_view_module_version": "1.5.0", "description_tooltip": null, "_model_module": "@jupyter-widgets/controls", "layout": "IPY_MODEL_ea5f5db35ee24faabf20a62cabc099a6"}}, "7d7e8822c9ce44879d76a786bcd482ab": {"model_module": "@jupyter-widgets/controls", "model_name": "FloatProgressModel", "model_module_version": "1.5.0", "state": {"_view_name": "ProgressView", "style": "IPY_MODEL_b2ec7053720e49319db46cc44bd5a023", "_dom_classes": [], "description": "", "_model_name": "FloatProgressModel", "bar_style": "success", "max": 6, "_view_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "value": 6, "_view_count": null, "_view_module_version": "1.5.0", "orientation": "horizontal", "min": 0, "description_tooltip": null, "_model_module": "@jupyter-widgets/controls", "layout": "IPY_MODEL_32c31fca0efb4eea86fd74daeae46c68"}}, "46fafbbc6545402f891b745e1995a671": {"model_module": "@jupyter-widgets/controls", "model_name": "HTMLModel", "model_module_version": "1.5.0", "state": {"_view_name": "HTMLView", "style": "IPY_MODEL_e62cf418ba9b4278a008d24c69033fb0", "_dom_classes": [], "description": "", "_model_name": "HTMLModel", "placeholder": "\u200b", "_view_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "value": " 6/6 [00:54&lt;00:00,  9.20s/it]", "_view_count": null, "_view_module_version": "1.5.0", "description_tooltip": null, "_model_module": "@jupyter-widgets/controls", "layout": "IPY_MODEL_ffb1a52956204822a6d5481632c587f6"}}, "6f51152ee8a24d8d82d8b580d049f581": {"model_module": "@jupyter-widgets/controls", "model_name": "DescriptionStyleModel", "model_module_version": "1.5.0", "state": {"_view_name": "StyleView", "_model_name": "DescriptionStyleModel", "description_width": "", "_view_module": "@jupyter-widgets/base", "_model_module_version": "1.5.0", "_view_count": null, "_view_module_version": "1.2.0", "_model_module": "@jupyter-widgets/controls"}}, "ea5f5db35ee24faabf20a62cabc099a6": {"model_module": "@jupyter-widgets/base", "model_name": "LayoutModel", "model_module_version": "1.2.0", "state": {"_view_name": "LayoutView", "grid_template_rows": null, "right": null, "justify_content": null, "_view_module": "@jupyter-widgets/base", "overflow": null, "_model_module_version": "1.2.0", "_view_count": null, "flex_flow": null, "width": null, "min_width": null, "border": null, "align_items": null, "bottom": null, "_model_module": "@jupyter-widgets/base", "top": null, "grid_column": null, "overflow_y": null, "overflow_x": null, "grid_auto_flow": null, "grid_area": null, "grid_template_columns": null, "flex": null, "_model_name": "LayoutModel", "justify_items": null, "grid_row": null, "max_height": null, "align_content": null, "visibility": null, "align_self": null, "height": null, "min_height": null, "padding": null, "grid_auto_rows": null, "grid_gap": null, "max_width": null, "order": null, "_view_module_version": "1.2.0", "grid_template_areas": null, "object_position": null, "object_fit": null, "grid_auto_columns": null, "margin": null, "display": null, "left": null}}, "b2ec7053720e49319db46cc44bd5a023": {"model_module": "@jupyter-widgets/controls", "model_name": "ProgressStyleModel", "model_module_version": "1.5.0", "state": {"_view_name": "StyleView", "_model_name": "ProgressStyleModel", "description_width": "", "_view_module": "@jupyter-widgets/base", "_model_module_version": "1.5.0", "_view_count": null, "_view_module_version": "1.2.0", "bar_color": null, "_model_module": "@jupyter-widgets/controls"}}, "32c31fca0efb4eea86fd74daeae46c68": {"model_module": "@jupyter-widgets/base", "model_name": "LayoutModel", "model_module_version": "1.2.0", "state": {"_view_name": "LayoutView", "grid_template_rows": null, "right": null, "justify_content": null, "_view_module": "@jupyter-widgets/base", "overflow": null, "_model_module_version": "1.2.0", "_view_count": null, "flex_flow": null, "width": null, "min_width": null, "border": null, "align_items": null, "bottom": null, "_model_module": "@jupyter-widgets/base", "top": null, "grid_column": null, "overflow_y": null, "overflow_x": null, "grid_auto_flow": null, "grid_area": null, "grid_template_columns": null, "flex": null, "_model_name": "LayoutModel", "justify_items": null, "grid_row": null, "max_height": null, "align_content": null, "visibility": null, "align_self": null, "height": null, "min_height": null, "padding": null, "grid_auto_rows": null, "grid_gap": null, "max_width": null, "order": null, "_view_module_version": "1.2.0", "grid_template_areas": null, "object_position": null, "object_fit": null, "grid_auto_columns": null, "margin": null, "display": null, "left": null}}, "e62cf418ba9b4278a008d24c69033fb0": {"model_module": "@jupyter-widgets/controls", "model_name": "DescriptionStyleModel", "model_module_version": "1.5.0", "state": {"_view_name": "StyleView", "_model_name": "DescriptionStyleModel", "description_width": "", "_view_module": "@jupyter-widgets/base", "_model_module_version": "1.5.0", "_view_count": null, "_view_module_version": "1.2.0", "_model_module": "@jupyter-widgets/controls"}}, "ffb1a52956204822a6d5481632c587f6": {"model_module": "@jupyter-widgets/base", "model_name": "LayoutModel", "model_module_version": "1.2.0", "state": {"_view_name": "LayoutView", "grid_template_rows": null, "right": null, "justify_content": null, "_view_module": "@jupyter-widgets/base", "overflow": null, "_model_module_version": "1.2.0", "_view_count": null, "flex_flow": null, "width": null, "min_width": null, "border": null, "align_items": null, "bottom": null, "_model_module": "@jupyter-widgets/base", "top": null, "grid_column": null, "overflow_y": null, "overflow_x": null, "grid_auto_flow": null, "grid_area": null, "grid_template_columns": null, "flex": null, "_model_name": "LayoutModel", "justify_items": null, "grid_row": null, "max_height": null, "align_content": null, "visibility": null, "align_self": null, "height": null, "min_height": null, "padding": null, "grid_auto_rows": null, "grid_gap": null, "max_width": null, "order": null, "_view_module_version": "1.2.0", "grid_template_areas": null, "object_position": null, "object_fit": null, "grid_auto_columns": null, "margin": null, "display": null, "left": null}}}
</script>



  </div><a class="u-url" href="/2022/01/12/olx-baselines.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Jupyter notebook database.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/recohut" target="_blank" title="recohut"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
