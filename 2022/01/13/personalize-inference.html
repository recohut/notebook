<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Amazon Personalize Generic Module - Inference Layer | reconb</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Amazon Personalize Generic Module - Inference Layer" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Jupyter notebook database." />
<meta property="og:description" content="Jupyter notebook database." />
<link rel="canonical" href="https://nb.recohut.com/2022/01/13/personalize-inference.html" />
<meta property="og:url" content="https://nb.recohut.com/2022/01/13/personalize-inference.html" />
<meta property="og:site_name" content="reconb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-13T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Amazon Personalize Generic Module - Inference Layer" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-13T00:00:00-06:00","datePublished":"2022-01-13T00:00:00-06:00","description":"Jupyter notebook database.","headline":"Amazon Personalize Generic Module - Inference Layer","mainEntityOfPage":{"@type":"WebPage","@id":"https://nb.recohut.com/2022/01/13/personalize-inference.html"},"url":"https://nb.recohut.com/2022/01/13/personalize-inference.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nb.recohut.com/feed.xml" title="reconb" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">reconb</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Amazon Personalize Generic Module - Inference Layer</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-01-13T00:00:00-06:00" itemprop="datePublished">
        Jan 13, 2022
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      19 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/recohut/notebook/tree/master/_notebooks/2022-01-13-personalize-inference.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/recohut/notebook/master?filepath=_notebooks%2F2022-01-13-personalize-inference.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/recohut/notebook/blob/master/_notebooks/2022-01-13-personalize-inference.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Frecohut%2Fnotebook%2Fblob%2Fmaster%2F_notebooks%2F2022-01-13-personalize-inference.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-01-13-personalize-inference.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Environment-Setup">Environment Setup<a class="anchor-link" href="#Environment-Setup"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="o">-</span><span class="n">q</span> <span class="n">dvc</span> <span class="n">dvc</span><span class="p">[</span><span class="n">gdrive</span><span class="p">]</span>
<span class="err">!</span><span class="n">dvc</span> <span class="n">pull</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;./code&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">boto3</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">~/.</span><span class="n">aws</span> <span class="o">&amp;&amp;</span> <span class="n">cp</span> <span class="o">/</span><span class="n">content</span><span class="o">/</span><span class="n">drive</span><span class="o">/</span><span class="n">MyDrive</span><span class="o">/</span><span class="n">AWS</span><span class="o">/</span><span class="n">d01_admin</span><span class="o">/*</span> <span class="o">~/.</span><span class="n">aws</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="o">%</span><span class="n">reload_ext</span> <span class="n">autoreload</span>
<span class="o">%</span><span class="n">autoreload</span> <span class="mi">2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">personalize</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;personalize&#39;</span><span class="p">)</span>
<span class="n">personalize_runtime</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;personalize-runtime&#39;</span><span class="p">)</span>
<span class="n">personalize_events</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="s1">&#39;personalize-events&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">generic_modules.import_model</span> <span class="kn">import</span> <span class="n">personalize_model</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./artifacts/etc/personalize_model_sims.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outp</span><span class="p">:</span>
    <span class="n">sims_model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">outp</span><span class="p">)</span>

<span class="n">sims_model</span><span class="o">.</span><span class="vm">__dict__</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;campaign_arn&#39;: &#39;arn:aws:personalize:us-east-1:746888961694:campaign/personalize-poc-sims-campaign&#39;,
 &#39;dataset_group_arn&#39;: &#39;arn:aws:personalize:us-east-1:746888961694:dataset-group/immersion-day-dataset-group-movielens-latest&#39;,
 &#39;filter_arns&#39;: [&#39;arn:aws:personalize:us-east-1:746888961694:filter/watched&#39;,
  &#39;arn:aws:personalize:us-east-1:746888961694:filter/unwatched&#39;],
 &#39;solution_arn&#39;: &#39;arn:aws:personalize:us-east-1:746888961694:solution/personalize-poc-sims&#39;,
 &#39;solution_version_arn&#39;: &#39;arn:aws:personalize:us-east-1:746888961694:solution/personalize-poc-sims/edb3d46e&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./artifacts/etc/personalize_model_pers.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outp</span><span class="p">:</span>
    <span class="n">pers_model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">outp</span><span class="p">)</span>

<span class="n">pers_model</span><span class="o">.</span><span class="vm">__dict__</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;campaign_arn&#39;: &#39;arn:aws:personalize:us-east-1:746888961694:campaign/personalize-poc-userpersonalization&#39;,
 &#39;dataset_group_arn&#39;: &#39;arn:aws:personalize:us-east-1:746888961694:dataset-group/immersion-day-dataset-group-movielens-latest&#39;,
 &#39;filter_arns&#39;: [&#39;arn:aws:personalize:us-east-1:746888961694:filter/watched&#39;,
  &#39;arn:aws:personalize:us-east-1:746888961694:filter/unwatched&#39;],
 &#39;solution_arn&#39;: &#39;arn:aws:personalize:us-east-1:746888961694:solution/personalize-poc-sims&#39;,
 &#39;solution_version_arn&#39;: &#39;arn:aws:personalize:us-east-1:746888961694:solution/personalize-poc-sims/edb3d46e&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Interact-with-Campaigns">Interact with Campaigns<a class="anchor-link" href="#Interact-with-Campaigns"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First, let's create a supporting function to help make sense of the results returned by a Personalize campaign. Personalize returns only an item_id. This is great for keeping data compact, but it means you need to query a database or lookup table to get a human-readable result for the notebooks. We will create a helper function to return a human-readable result from the Movielens dataset.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Start by loading in the dataset which we can use for our lookup table.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">items_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/bronze/ml-latest-small/movies.csv&#39;</span><span class="p">,</span>
                       <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">,</span>
                       <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;movieId&#39;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">},</span>
                       <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Render some sample data</span>
<span class="n">items_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
    </tr>
    <tr>
      <th>movieId</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Toy Story (1995)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Jumanji (1995)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Grumpier Old Men (1995)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Waiting to Exhale (1995)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Father of the Bride Part II (1995)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">movie_id_example</span> <span class="o">=</span> <span class="mi">589</span>
<span class="n">title</span> <span class="o">=</span> <span class="n">items_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">movie_id_example</span><span class="p">][</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Terminator 2: Judgment Day (1991)
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">get_movie_by_id</span><span class="p">(</span><span class="n">movie_id</span><span class="p">,</span> <span class="n">movie_df</span><span class="o">=</span><span class="n">items_df</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">movie_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">movie_id</span><span class="p">)][</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;Error obtaining title&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">get_movie_by_id</span><span class="p">(</span><span class="n">movie_id</span><span class="o">=</span><span class="s2">&quot;1197&quot;</span><span class="p">))</span>
<span class="c1"># A bad type of value</span>
<span class="nb">print</span><span class="p">(</span><span class="n">get_movie_by_id</span><span class="p">(</span><span class="n">movie_id</span><span class="o">=</span><span class="s2">&quot;987.9393939&quot;</span><span class="p">))</span>
<span class="c1"># Really bad values</span>
<span class="nb">print</span><span class="p">(</span><span class="n">get_movie_by_id</span><span class="p">(</span><span class="n">movie_id</span><span class="o">=</span><span class="s2">&quot;Steve&quot;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Princess Bride, The (1987)
Error obtaining title
Error obtaining title
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SIMS">SIMS<a class="anchor-link" href="#SIMS"> </a></h3><p>SIMS requires just an item as input, and it will return items which users interact with in similar ways to their interaction with the input item. In this particular case the item is a movie.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">get_recommendations_response</span> <span class="o">=</span> <span class="n">personalize_runtime</span><span class="o">.</span><span class="n">get_recommendations</span><span class="p">(</span>
    <span class="n">campaignArn</span> <span class="o">=</span> <span class="n">sims_model</span><span class="o">.</span><span class="n">campaign_arn</span><span class="p">,</span>
    <span class="n">itemId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">589</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">item_list</span> <span class="o">=</span> <span class="n">get_recommendations_response</span><span class="p">[</span><span class="s1">&#39;itemList&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">get_movie_by_id</span><span class="p">(</span><span class="n">movie_id</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;itemId&#39;</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Jurassic Park (1993)
Braveheart (1995)
Terminator, The (1984)
Fugitive, The (1993)
Speed (1994)
Crimson Tide (1995)
GoldenEye (1995)
Batman (1989)
Clear and Present Danger (1994)
True Lies (1994)
Mask, The (1994)
Die Hard: With a Vengeance (1995)
In the Line of Fire (1993)
Lion King, The (1994)
Forrest Gump (1994)
Ghost (1990)
Apollo 13 (1995)
Star Trek: Generations (1994)
Cliffhanger (1993)
Firm, The (1993)
Die Hard (1988)
Mission: Impossible (1996)
Seven (a.k.a. Se7en) (1995)
Indiana Jones and the Last Crusade (1989)
Mrs. Doubtfire (1993)
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_new_recommendations_df</span><span class="p">(</span><span class="n">recommendations_df</span><span class="p">,</span> <span class="n">movie_ID</span><span class="p">):</span>
    <span class="c1"># Get the movie name</span>
    <span class="n">movie_name</span> <span class="o">=</span> <span class="n">get_movie_by_id</span><span class="p">(</span><span class="n">movie_ID</span><span class="p">)</span>
    <span class="c1"># Get the recommendations</span>
    <span class="n">get_recommendations_response</span> <span class="o">=</span> <span class="n">personalize_runtime</span><span class="o">.</span><span class="n">get_recommendations</span><span class="p">(</span>
        <span class="n">campaignArn</span> <span class="o">=</span> <span class="n">sims_model</span><span class="o">.</span><span class="n">campaign_arn</span><span class="p">,</span>
        <span class="n">itemId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">movie_ID</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="c1"># Build a new dataframe of recommendations</span>
    <span class="n">item_list</span> <span class="o">=</span> <span class="n">get_recommendations_response</span><span class="p">[</span><span class="s1">&#39;itemList&#39;</span><span class="p">]</span>
    <span class="n">recommendation_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">:</span>
        <span class="n">movie</span> <span class="o">=</span> <span class="n">get_movie_by_id</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;itemId&#39;</span><span class="p">])</span>
        <span class="n">recommendation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span>
    <span class="n">new_rec_DF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendation_list</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">movie_name</span><span class="p">])</span>
    <span class="c1"># Add this dataframe to the old one</span>
    <span class="n">recommendations_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">recommendations_df</span><span class="p">,</span> <span class="n">new_rec_DF</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">recommendations_df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">samples</span> <span class="o">=</span> <span class="n">items_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">samples</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
    </tr>
    <tr>
      <th>movieId</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>27793</th>
      <td>Starship Troopers 2: Hero of the Federation (2...</td>
    </tr>
    <tr>
      <th>113862</th>
      <td>Guest, The (2014)</td>
    </tr>
    <tr>
      <th>5735</th>
      <td>Faces of Death (1978)</td>
    </tr>
    <tr>
      <th>2498</th>
      <td>My Favorite Martian (1999)</td>
    </tr>
    <tr>
      <th>74342</th>
      <td>Captain Newman, M.D. (1963)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">sims_recommendations_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">movies</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="k">for</span> <span class="n">movie</span> <span class="ow">in</span> <span class="n">movies</span><span class="p">:</span>
    <span class="n">sims_recommendations_df</span> <span class="o">=</span> <span class="n">get_new_recommendations_df</span><span class="p">(</span><span class="n">sims_recommendations_df</span><span class="p">,</span> <span class="n">movie</span><span class="p">)</span>

<span class="n">sims_recommendations_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Starship Troopers 2: Hero of the Federation (2004)</th>
      <th>Guest, The (2014)</th>
      <th>Faces of Death (1978)</th>
      <th>My Favorite Martian (1999)</th>
      <th>Captain Newman, M.D. (1963)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Shawshank Redemption, The (1994)</td>
      <td>Shawshank Redemption, The (1994)</td>
      <td>Shawshank Redemption, The (1994)</td>
      <td>Moonraker (1979)</td>
      <td>Willy/Milly (1986)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Forrest Gump (1994)</td>
      <td>Forrest Gump (1994)</td>
      <td>Forrest Gump (1994)</td>
      <td>Beverly Hills Cop (1984)</td>
      <td>Dr. Phibes Rises Again (1972)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Pulp Fiction (1994)</td>
      <td>Pulp Fiction (1994)</td>
      <td>Pulp Fiction (1994)</td>
      <td>Lucy (2014)</td>
      <td>Tears for Sale (2008)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Silence of the Lambs, The (1991)</td>
      <td>Silence of the Lambs, The (1991)</td>
      <td>Silence of the Lambs, The (1991)</td>
      <td>Matrix, The (1999)</td>
      <td>Spellbound (2011)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Braveheart (1995)</td>
      <td>Braveheart (1995)</td>
      <td>Braveheart (1995)</td>
      <td>NaN</td>
      <td>Jimmy Carr: Telling Jokes (2009)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Matrix, The (1999)</td>
      <td>Matrix, The (1999)</td>
      <td>Matrix, The (1999)</td>
      <td>NaN</td>
      <td>Maz Jobrani: Immigrant (2017)</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Schindler's List (1993)</td>
      <td>Schindler's List (1993)</td>
      <td>Schindler's List (1993)</td>
      <td>NaN</td>
      <td>Runaway Brain (1995)</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Star Wars: Episode IV - A New Hope (1977)</td>
      <td>Star Wars: Episode IV - A New Hope (1977)</td>
      <td>Star Wars: Episode IV - A New Hope (1977)</td>
      <td>NaN</td>
      <td>L.A. Slasher (2015)</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Jurassic Park (1993)</td>
      <td>Jurassic Park (1993)</td>
      <td>Jurassic Park (1993)</td>
      <td>NaN</td>
      <td>Tenchi MuyÃƒÂ´! In Love (1996)</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Terminator 2: Judgment Day (1991)</td>
      <td>Terminator 2: Judgment Day (1991)</td>
      <td>Terminator 2: Judgment Day (1991)</td>
      <td>NaN</td>
      <td>The Editor (2015)</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Fugitive, The (1993)</td>
      <td>Fugitive, The (1993)</td>
      <td>Fugitive, The (1993)</td>
      <td>NaN</td>
      <td>History of Future Folk, The (2012)</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Apollo 13 (1995)</td>
      <td>Apollo 13 (1995)</td>
      <td>Apollo 13 (1995)</td>
      <td>NaN</td>
      <td>Scooby-Doo Goes Hollywood (1979)</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Fight Club (1999)</td>
      <td>Fight Club (1999)</td>
      <td>Fight Club (1999)</td>
      <td>NaN</td>
      <td>A Walk in the Woods (2015)</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Toy Story (1995)</td>
      <td>Toy Story (1995)</td>
      <td>Toy Story (1995)</td>
      <td>NaN</td>
      <td>Killer Movie (2008)</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Seven (a.k.a. Se7en) (1995)</td>
      <td>Seven (a.k.a. Se7en) (1995)</td>
      <td>Seven (a.k.a. Se7en) (1995)</td>
      <td>NaN</td>
      <td>Mickey's Once Upon a Christmas (1999)</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Usual Suspects, The (1995)</td>
      <td>Usual Suspects, The (1995)</td>
      <td>Usual Suspects, The (1995)</td>
      <td>NaN</td>
      <td>Don't Look Now: We're Being Shot At (La grande...</td>
    </tr>
    <tr>
      <th>16</th>
      <td>American Beauty (1999)</td>
      <td>American Beauty (1999)</td>
      <td>American Beauty (1999)</td>
      <td>NaN</td>
      <td>Tales of Manhattan (1942)</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Raiders of the Lost Ark (Indiana Jones and the...</td>
      <td>Raiders of the Lost Ark (Indiana Jones and the...</td>
      <td>Raiders of the Lost Ark (Indiana Jones and the...</td>
      <td>NaN</td>
      <td>Delhi Belly (2011)</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Lord of the Rings: The Fellowship of the Ring,...</td>
      <td>Lord of the Rings: The Fellowship of the Ring,...</td>
      <td>Lord of the Rings: The Fellowship of the Ring,...</td>
      <td>NaN</td>
      <td>Calcium Kid, The (2004)</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Fargo (1996)</td>
      <td>Fargo (1996)</td>
      <td>Fargo (1996)</td>
      <td>NaN</td>
      <td>Cottage, The (2008)</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Dances with Wolves (1990)</td>
      <td>Dances with Wolves (1990)</td>
      <td>Dances with Wolves (1990)</td>
      <td>NaN</td>
      <td>I Bought a Vampire Motorcycle (1990)</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Lord of the Rings: The Return of the King, The...</td>
      <td>Lord of the Rings: The Return of the King, The...</td>
      <td>Lord of the Rings: The Return of the King, The...</td>
      <td>NaN</td>
      <td>The Electric Hotel (1908)</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Independence Day (a.k.a. ID4) (1996)</td>
      <td>Independence Day (a.k.a. ID4) (1996)</td>
      <td>Independence Day (a.k.a. ID4) (1996)</td>
      <td>NaN</td>
      <td>My Left Eye Sees Ghosts (Ngo joh aan gin diy g...</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Lord of the Rings: The Two Towers, The (2002)</td>
      <td>Lord of the Rings: The Two Towers, The (2002)</td>
      <td>Lord of the Rings: The Two Towers, The (2002)</td>
      <td>NaN</td>
      <td>Very Potter Musical, A (2009)</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Godfather, The (1972)</td>
      <td>Godfather, The (1972)</td>
      <td>Godfather, The (1972)</td>
      <td>NaN</td>
      <td>Teahouse of the August Moon, The (1956)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is a good time to think about the hyperparameters of the Personalize recipes. The SIMS recipe has a popularity_discount_factor hyperparameter (see documentation). Leveraging this hyperparameter allows you to control the nuance you see in the results. This parameter and its behavior will be unique to every dataset you encounter, and depends on the goals of the business. You can iterate on the value of this hyperparameter until you are satisfied with the results, or you can start by leveraging Personalize's hyperparameter optimization (HPO) feature. For more information on hyperparameters and HPO tuning, see the documentation.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="User-Personalization-Model">User Personalization Model<a class="anchor-link" href="#User-Personalization-Model"> </a></h3><p>HRNN is one of the more advanced algorithms provided by Amazon Personalize. It supports personalization of the items for a specific user based on their past behavior and can intake real time events in order to alter recommendations for a user without retraining.</p>
<p>Since HRNN relies on having a sampling of users, let's load the data we need for that and select 3 random users. Since Movielens does not include user data, we will select 3 random numbers from the range of user id's in the dataset.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">users</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">users</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[260, 583, 287]</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_new_recommendations_df_users</span><span class="p">(</span><span class="n">recommendations_df</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
    <span class="c1"># Get the movie name</span>
    <span class="c1">#movie_name = get_movie_by_id(artist_ID)</span>
    <span class="c1"># Get the recommendations</span>
    <span class="n">get_recommendations_response</span> <span class="o">=</span> <span class="n">personalize_runtime</span><span class="o">.</span><span class="n">get_recommendations</span><span class="p">(</span>
        <span class="n">campaignArn</span> <span class="o">=</span> <span class="n">pers_model</span><span class="o">.</span><span class="n">campaign_arn</span><span class="p">,</span>
        <span class="n">userId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="c1"># Build a new dataframe of recommendations</span>
    <span class="n">item_list</span> <span class="o">=</span> <span class="n">get_recommendations_response</span><span class="p">[</span><span class="s1">&#39;itemList&#39;</span><span class="p">]</span>
    <span class="n">recommendation_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">:</span>
        <span class="n">movie</span> <span class="o">=</span> <span class="n">get_movie_by_id</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;itemId&#39;</span><span class="p">])</span>
        <span class="n">recommendation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span>
    <span class="n">new_rec_DF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendation_list</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">user_id</span><span class="p">])</span>
    <span class="c1"># Add this dataframe to the old one</span>
    <span class="n">recommendations_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">recommendations_df</span><span class="p">,</span> <span class="n">new_rec_DF</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">recommendations_df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">recommendations_df_users</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="c1">#users = users_df.sample(3).index.tolist()</span>

<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
    <span class="n">recommendations_df_users</span> <span class="o">=</span> <span class="n">get_new_recommendations_df_users</span><span class="p">(</span><span class="n">recommendations_df_users</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>

<span class="n">recommendations_df_users</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>260</th>
      <th>583</th>
      <th>287</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Bowling for Columbine (2002)</td>
      <td>27 Dresses (2008)</td>
      <td>Apocalypse Now (1979)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Apollo 13 (1995)</td>
      <td>300 (2007)</td>
      <td>Forrest Gump (1994)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Dead Poets Society (1989)</td>
      <td>Austin Powers: International Man of Mystery (1...</td>
      <td>Schindler's List (1993)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Fahrenheit 9/11 (2004)</td>
      <td>Yes Man (2008)</td>
      <td>Pianist, The (2002)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Amadeus (1984)</td>
      <td>Notting Hill (1999)</td>
      <td>Graduate, The (1967)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Baraka (1992)</td>
      <td>Step Brothers (2008)</td>
      <td>Full Metal Jacket (1987)</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lord of the Rings: The Two Towers, The (2002)</td>
      <td>Juno (2007)</td>
      <td>Apollo 13 (1995)</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Hearts of Darkness: A Filmmakers Apocalypse (1...</td>
      <td>Blades of Glory (2007)</td>
      <td>Boot, Das (Boat, The) (1981)</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Pink Floyd: The Wall (1982)</td>
      <td>Hangover, The (2009)</td>
      <td>Amadeus (1984)</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Schindler's List (1993)</td>
      <td>Forgetting Sarah Marshall (2008)</td>
      <td>Hotel Rwanda (2004)</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Crumb (1994)</td>
      <td>Forrest Gump (1994)</td>
      <td>Blade Runner (1982)</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Hoop Dreams (1994)</td>
      <td>Sleepless in Seattle (1993)</td>
      <td>Black Hawk Down (2001)</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Stop Making Sense (1984)</td>
      <td>Hurt Locker, The (2008)</td>
      <td>Dr. Strangelove or: How I Learned to Stop Worr...</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Everest (1998)</td>
      <td>Semi-Pro (2008)</td>
      <td>Patton (1970)</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2001: A Space Odyssey (1968)</td>
      <td>Inglourious Basterds (2009)</td>
      <td>Blazing Saddles (1974)</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Apocalypse Now (1979)</td>
      <td>Tropic Thunder (2008)</td>
      <td>Eternal Sunshine of the Spotless Mind (2004)</td>
    </tr>
    <tr>
      <th>16</th>
      <td>To Kill a Mockingbird (1962)</td>
      <td>Sherlock Holmes (2009)</td>
      <td>Dead Poets Society (1989)</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Corporation, The (2003)</td>
      <td>Stranger than Fiction (2006)</td>
      <td>Platoon (1986)</td>
    </tr>
    <tr>
      <th>18</th>
      <td>War Room, The (1993)</td>
      <td>Zombieland (2009)</td>
      <td>Killing Fields, The (1984)</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Times of Harvey Milk, The (1984)</td>
      <td>Titanic (1997)</td>
      <td>Braveheart (1995)</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Lord of the Rings: The Fellowship of the Ring,...</td>
      <td>50 First Dates (2004)</td>
      <td>Crouching Tiger, Hidden Dragon (Wo hu cang lon...</td>
    </tr>
    <tr>
      <th>21</th>
      <td>4 Little Girls (1997)</td>
      <td>Hot Fuzz (2007)</td>
      <td>Clockwork Orange, A (1971)</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Fog of War: Eleven Lessons from the Life of Ro...</td>
      <td>Liar Liar (1997)</td>
      <td>Godfather, The (1972)</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Scent of a Woman (1992)</td>
      <td>You've Got Mail (1998)</td>
      <td>One Flew Over the Cuckoo's Nest (1975)</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Usual Suspects, The (1995)</td>
      <td>House Bunny, The (2008)</td>
      <td>Inglourious Basterds (2009)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Static-and-Dynamic-Filters">Static and Dynamic Filters<a class="anchor-link" href="#Static-and-Dynamic-Filters"> </a></h2><p>Lets interact with the static filters we created in the previous notebook, and utilize dynamic filters in realtime.</p>
<p>A few common use cases for dynamic filters in Video On Demand are:</p>
<p>Categorical filters based on Item Metadata (that arent range based) - Often your item metadata will have information about the title such as Genre, Keyword, Year, Director, Actor etc. Filtering on these can provide recommendations within that data, such as action movies, Steven Spielberg movies, Movies from 1995 etc.</p>
<p>Events - you may want to filter out certain events and provide results based on those events, such as moving a title from a "suggestions to watch" recommendation to a "watch again" recommendations.</p>
<p>Now lets apply item filters to see recommendations for one of these users within each decade of our static filters.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">get_new_recommendations_df_by_static_filter</span><span class="p">(</span><span class="n">recommendations_df</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">filter_arn</span><span class="p">):</span>
    <span class="c1"># Get the movie name</span>
    <span class="c1">#movie_name = get_movie_by_id(artist_ID)</span>
    <span class="c1"># Get the recommendations</span>
    <span class="n">get_recommendations_response</span> <span class="o">=</span> <span class="n">personalize_runtime</span><span class="o">.</span><span class="n">get_recommendations</span><span class="p">(</span>
        <span class="n">campaignArn</span> <span class="o">=</span> <span class="n">pers_model</span><span class="o">.</span><span class="n">campaign_arn</span><span class="p">,</span>
        <span class="n">userId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
        <span class="n">filterArn</span> <span class="o">=</span> <span class="n">filter_arn</span>
    <span class="p">)</span>
    <span class="c1"># Build a new dataframe of recommendations</span>
    <span class="n">item_list</span> <span class="o">=</span> <span class="n">get_recommendations_response</span><span class="p">[</span><span class="s1">&#39;itemList&#39;</span><span class="p">]</span>
    <span class="n">recommendation_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">:</span>
        <span class="n">movie</span> <span class="o">=</span> <span class="n">get_movie_by_id</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;itemId&#39;</span><span class="p">])</span>
        <span class="n">recommendation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span>
    <span class="c1">#print(recommendation_list)</span>
    <span class="n">filter_name</span> <span class="o">=</span> <span class="n">filter_arn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">new_rec_DF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendation_list</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter_name</span><span class="p">])</span>
    <span class="c1"># Add this dataframe to the old one</span>
    <span class="n">recommendations_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">recommendations_df</span><span class="p">,</span> <span class="n">new_rec_DF</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">recommendations_df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">get_new_recommendations_df_by_dynamicfilter</span><span class="p">(</span><span class="n">recommendations_df</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">genre_filter_arn</span><span class="p">,</span> <span class="n">filter_values</span><span class="p">):</span>
    <span class="c1"># Get the movie name</span>
    <span class="c1">#movie_name = get_movie_by_id(artist_ID)</span>
    <span class="c1"># Get the recommendations</span>
    <span class="n">get_recommendations_response</span> <span class="o">=</span> <span class="n">personalize_runtime</span><span class="o">.</span><span class="n">get_recommendations</span><span class="p">(</span>
        <span class="n">campaignArn</span> <span class="o">=</span> <span class="n">pers_model</span><span class="o">.</span><span class="n">campaign_arn</span><span class="p">,</span>
        <span class="n">userId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
        <span class="n">filterArn</span> <span class="o">=</span> <span class="n">genre_filter_arn</span><span class="p">,</span>
        <span class="n">filterValues</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">&quot;GENRE&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">filter_values</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="c1"># Build a new dataframe of recommendations</span>
    <span class="n">item_list</span> <span class="o">=</span> <span class="n">get_recommendations_response</span><span class="p">[</span><span class="s1">&#39;itemList&#39;</span><span class="p">]</span>
    <span class="n">recommendation_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">:</span>
        <span class="n">movie</span> <span class="o">=</span> <span class="n">get_movie_by_id</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;itemId&#39;</span><span class="p">])</span>
        <span class="n">recommendation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span>
    <span class="n">filter_name</span> <span class="o">=</span> <span class="n">genre_filter_arn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">new_rec_DF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendation_list</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">filter_values</span><span class="p">])</span>
    <span class="c1"># Add this dataframe to the old one</span>
    <span class="n">recommendations_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">recommendations_df</span><span class="p">,</span> <span class="n">new_rec_DF</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">recommendations_df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">pers_model</span><span class="o">.</span><span class="n">filter_arns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;arn:aws:personalize:us-east-1:746888961694:filter/watched&#39;,
 &#39;arn:aws:personalize:us-east-1:746888961694:filter/unwatched&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">recommendations_df_decade_shelves</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">filter_arn</span> <span class="ow">in</span> <span class="n">pers_model</span><span class="o">.</span><span class="n">filter_arns</span><span class="p">:</span>
    <span class="n">recommendations_df_decade_shelves</span> <span class="o">=</span> <span class="n">get_new_recommendations_df_by_static_filter</span><span class="p">(</span><span class="n">recommendations_df_decade_shelves</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">filter_arn</span><span class="p">)</span>

<span class="n">recommendations_df_decade_shelves</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>watched</th>
      <th>unwatched</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Apocalypse Now (1979)</td>
      <td>Forrest Gump (1994)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Schindler's List (1993)</td>
      <td>Pianist, The (2002)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Sideways (2004)</td>
      <td>Graduate, The (1967)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Saving Private Ryan (1998)</td>
      <td>Full Metal Jacket (1987)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Amelie (Fabuleux destin d'AmÃƒÂ©lie Poulain, Le)...</td>
      <td>Apollo 13 (1995)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Usual Suspects, The (1995)</td>
      <td>Boot, Das (Boat, The) (1981)</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Breakfast Club, The (1985)</td>
      <td>Amadeus (1984)</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Truman Show, The (1998)</td>
      <td>Hotel Rwanda (2004)</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Requiem for a Dream (2000)</td>
      <td>Blade Runner (1982)</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Traffic (2000)</td>
      <td>Black Hawk Down (2001)</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Donnie Darko (2001)</td>
      <td>Dr. Strangelove or: How I Learned to Stop Worr...</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Lost in Translation (2003)</td>
      <td>Patton (1970)</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Fight Club (1999)</td>
      <td>Blazing Saddles (1974)</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Lord of the Rings: The Fellowship of the Ring,...</td>
      <td>Eternal Sunshine of the Spotless Mind (2004)</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Being John Malkovich (1999)</td>
      <td>Dead Poets Society (1989)</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Pi (1998)</td>
      <td>Platoon (1986)</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Monty Python and the Holy Grail (1975)</td>
      <td>Killing Fields, The (1984)</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Punch-Drunk Love (2002)</td>
      <td>Braveheart (1995)</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Lord of the Rings: The Two Towers, The (2002)</td>
      <td>Crouching Tiger, Hidden Dragon (Wo hu cang lon...</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Virgin Suicides, The (1999)</td>
      <td>Clockwork Orange, A (1971)</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Magnolia (1999)</td>
      <td>Godfather, The (1972)</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Frida (2002)</td>
      <td>One Flew Over the Cuckoo's Nest (1975)</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Fargo (1996)</td>
      <td>Inglourious Basterds (2009)</td>
    </tr>
    <tr>
      <th>23</th>
      <td>City of Lost Children, The (CitÃƒÂ© des enfants ...</td>
      <td>Good Will Hunting (1997)</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Dazed and Confused (1993)</td>
      <td>Lord of War (2005)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Real-Time-Events">Real-Time Events<a class="anchor-link" href="#Real-Time-Events"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_event_tracker</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;MovieTracker&#39;</span><span class="p">,</span>
    <span class="n">datasetGroupArn</span><span class="o">=</span><span class="n">pers_model</span><span class="o">.</span><span class="n">dataset_group_arn</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;eventTrackerArn&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;trackingId&#39;</span><span class="p">])</span>

<span class="n">TRACKING_ID</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;trackingId&#39;</span><span class="p">]</span>
<span class="n">event_tracker_arn</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;eventTrackerArn&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>arn:aws:personalize:us-east-1:746888961694:event-tracker/30109ae4
b3e19ad6-ec08-440c-988d-44ba91a2464d
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will create some code that simulates a user interacting with a particular item. After running this code, you will get recommendations that differ from the results above.</p>
<p>We start by creating some methods for the simulation of real time events.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">session_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">send_movie_click</span><span class="p">(</span><span class="n">USER_ID</span><span class="p">,</span> <span class="n">ITEM_ID</span><span class="p">,</span> <span class="n">EVENT_TYPE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulates a click as an envent</span>
<span class="sd">    to send an event to Amazon Personalize&#39;s Event Tracker</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Configure Session</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">session_ID</span> <span class="o">=</span> <span class="n">session_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">USER_ID</span><span class="p">)]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">session_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">USER_ID</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">())</span>
        <span class="n">session_ID</span> <span class="o">=</span> <span class="n">session_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">USER_ID</span><span class="p">)]</span>
        
    <span class="c1"># Configure Properties:</span>
    <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;itemId&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ITEM_ID</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="n">event_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        
    <span class="c1"># Make Call</span>
    
    <span class="n">personalize_events</span><span class="o">.</span><span class="n">put_events</span><span class="p">(</span>
    <span class="n">trackingId</span> <span class="o">=</span> <span class="n">TRACKING_ID</span><span class="p">,</span>
    <span class="n">userId</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">USER_ID</span><span class="p">),</span>
    <span class="n">sessionId</span> <span class="o">=</span> <span class="n">session_ID</span><span class="p">,</span>
    <span class="n">eventList</span> <span class="o">=</span> <span class="p">[{</span>
        <span class="s1">&#39;sentAt&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
        <span class="s1">&#39;eventType&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">EVENT_TYPE</span><span class="p">),</span>
        <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="n">event_json</span>
        <span class="p">}]</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">get_new_recommendations_df_users_real_time</span><span class="p">(</span><span class="n">recommendations_df</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">item_id</span><span class="p">,</span> <span class="n">event_type</span><span class="p">):</span>
    <span class="c1"># Get the artist name (header of column)</span>
    <span class="n">movie_name</span> <span class="o">=</span> <span class="n">get_movie_by_id</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>
    <span class="c1"># Interact with different movies</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sending event &#39;</span> <span class="o">+</span> <span class="n">event_type</span> <span class="o">+</span> <span class="s1">&#39; for &#39;</span> <span class="o">+</span> <span class="n">get_movie_by_id</span><span class="p">(</span><span class="n">item_id</span><span class="p">))</span>
    <span class="n">send_movie_click</span><span class="p">(</span><span class="n">USER_ID</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ITEM_ID</span><span class="o">=</span><span class="n">item_id</span><span class="p">,</span> <span class="n">EVENT_TYPE</span><span class="o">=</span><span class="n">event_type</span><span class="p">)</span>
    <span class="c1"># Get the recommendations (note you should have a base recommendation DF created before)</span>
    <span class="n">get_recommendations_response</span> <span class="o">=</span> <span class="n">personalize_runtime</span><span class="o">.</span><span class="n">get_recommendations</span><span class="p">(</span>
        <span class="n">campaignArn</span> <span class="o">=</span> <span class="n">pers_model</span><span class="o">.</span><span class="n">campaign_arn</span><span class="p">,</span>
        <span class="n">userId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="c1"># Build a new dataframe of recommendations</span>
    <span class="n">item_list</span> <span class="o">=</span> <span class="n">get_recommendations_response</span><span class="p">[</span><span class="s1">&#39;itemList&#39;</span><span class="p">]</span>
    <span class="n">recommendation_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">:</span>
        <span class="n">artist</span> <span class="o">=</span> <span class="n">get_movie_by_id</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;itemId&#39;</span><span class="p">])</span>
        <span class="n">recommendation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">artist</span><span class="p">)</span>
    <span class="n">new_rec_DF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendation_list</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">movie_name</span><span class="p">])</span>
    <span class="c1"># Add this dataframe to the old one</span>
    <span class="c1">#recommendations_df = recommendations_df.join(new_rec_DF)</span>
    <span class="n">recommendations_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">recommendations_df</span><span class="p">,</span> <span class="n">new_rec_DF</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">recommendations_df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>At this point, we haven't generated any real-time events yet; we have only set up the code. To compare the recommendations before and after the real-time events, let's pick one user and generate the original recommendations for them.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user</span>

<span class="c1"># Get recommendations for the user</span>
<span class="n">get_recommendations_response</span> <span class="o">=</span> <span class="n">personalize_runtime</span><span class="o">.</span><span class="n">get_recommendations</span><span class="p">(</span>
        <span class="n">campaignArn</span> <span class="o">=</span> <span class="n">pers_model</span><span class="o">.</span><span class="n">campaign_arn</span><span class="p">,</span>
        <span class="n">userId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
    <span class="p">)</span>

<span class="c1"># Build a new dataframe for the recommendations</span>
<span class="n">item_list</span> <span class="o">=</span> <span class="n">get_recommendations_response</span><span class="p">[</span><span class="s1">&#39;itemList&#39;</span><span class="p">]</span>
<span class="n">recommendation_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">:</span>
    <span class="n">artist</span> <span class="o">=</span> <span class="n">get_movie_by_id</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;itemId&#39;</span><span class="p">])</span>
    <span class="n">recommendation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">artist</span><span class="p">)</span>
<span class="n">user_recommendations_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendation_list</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">user_id</span><span class="p">])</span>
<span class="n">user_recommendations_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>287</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Apocalypse Now (1979)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Forrest Gump (1994)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Schindler's List (1993)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Pianist, The (2002)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Graduate, The (1967)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Full Metal Jacket (1987)</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Apollo 13 (1995)</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Boot, Das (Boat, The) (1981)</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Amadeus (1984)</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Hotel Rwanda (2004)</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Blade Runner (1982)</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Black Hawk Down (2001)</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Dr. Strangelove or: How I Learned to Stop Worr...</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Patton (1970)</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Blazing Saddles (1974)</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Eternal Sunshine of the Spotless Mind (2004)</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Dead Poets Society (1989)</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Platoon (1986)</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Killing Fields, The (1984)</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Braveheart (1995)</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Crouching Tiger, Hidden Dragon (Wo hu cang lon...</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Clockwork Orange, A (1971)</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Godfather, The (1972)</td>
    </tr>
    <tr>
      <th>23</th>
      <td>One Flew Over the Cuckoo's Nest (1975)</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Inglourious Basterds (2009)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ok, so now we have a list of recommendations for this user before we have applied any real-time events. Now let's pick 3 random artists which we will simulate our user interacting with, and then see how this changes the recommendations.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">movies</span> <span class="o">=</span> <span class="n">items_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="c1"># Note this will take about 15 seconds to complete due to the sleeps</span>
<span class="k">for</span> <span class="n">movie</span> <span class="ow">in</span> <span class="n">movies</span><span class="p">:</span>
    <span class="n">user_recommendations_df</span> <span class="o">=</span> <span class="n">get_new_recommendations_df_users_real_time</span><span class="p">(</span><span class="n">user_recommendations_df</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">movie</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>sending event click for Gaslight (1944)
sending event click for Terminator 2: Judgment Day (1991)
sending event click for Boss of It All, The (DirektÃƒÂ¸ren for det hele) (2006)
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can look at how the click events changed the recommendations.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">user_recommendations_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>287</th>
      <th>Gaslight (1944)</th>
      <th>Terminator 2: Judgment Day (1991)</th>
      <th>Boss of It All, The (DirektÃƒÂ¸ren for det hele) (2006)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Apocalypse Now (1979)</td>
      <td>Apocalypse Now (1979)</td>
      <td>Gaslight (1944)</td>
      <td>Terminator 2: Judgment Day (1991)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Forrest Gump (1994)</td>
      <td>Forrest Gump (1994)</td>
      <td>Rosemary's Baby (1968)</td>
      <td>Planet of the Apes (1968)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Schindler's List (1993)</td>
      <td>Schindler's List (1993)</td>
      <td>Wait Until Dark (1967)</td>
      <td>Day the Earth Stood Still, The (1951)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Pianist, The (2002)</td>
      <td>Pianist, The (2002)</td>
      <td>Night of the Hunter, The (1955)</td>
      <td>Jurassic Park (1993)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Graduate, The (1967)</td>
      <td>Graduate, The (1967)</td>
      <td>Sorry, Wrong Number (1948)</td>
      <td>Terminator, The (1984)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Full Metal Jacket (1987)</td>
      <td>Full Metal Jacket (1987)</td>
      <td>Carnival of Souls (1962)</td>
      <td>In the Line of Fire (1993)</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Apollo 13 (1995)</td>
      <td>Apollo 13 (1995)</td>
      <td>Insider, The (1999)</td>
      <td>Braveheart (1995)</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Boot, Das (Boat, The) (1981)</td>
      <td>Boot, Das (Boat, The) (1981)</td>
      <td>Lord of the Flies (1963)</td>
      <td>Vertigo (1958)</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Amadeus (1984)</td>
      <td>Amadeus (1984)</td>
      <td>Day the Earth Stood Still, The (1951)</td>
      <td>Night of the Living Dead (1968)</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Hotel Rwanda (2004)</td>
      <td>Hotel Rwanda (2004)</td>
      <td>Cape Fear (1962)</td>
      <td>Twelve Monkeys (a.k.a. 12 Monkeys) (1995)</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Blade Runner (1982)</td>
      <td>Blade Runner (1982)</td>
      <td>Strangers on a Train (1951)</td>
      <td>For a Few Dollars More (Per qualche dollaro in...</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Black Hawk Down (2001)</td>
      <td>Black Hawk Down (2001)</td>
      <td>Birds, The (1963)</td>
      <td>Equilibrium (2002)</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Dr. Strangelove or: How I Learned to Stop Worr...</td>
      <td>Dr. Strangelove or: How I Learned to Stop Worr...</td>
      <td>What Ever Happened to Baby Jane? (1962)</td>
      <td>Firm, The (1993)</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Patton (1970)</td>
      <td>Patton (1970)</td>
      <td>All About Eve (1950)</td>
      <td>Goldfinger (1964)</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Blazing Saddles (1974)</td>
      <td>Blazing Saddles (1974)</td>
      <td>Ugetsu (Ugetsu monogatari) (1953)</td>
      <td>E.T. the Extra-Terrestrial (1982)</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Eternal Sunshine of the Spotless Mind (2004)</td>
      <td>Eternal Sunshine of the Spotless Mind (2004)</td>
      <td>Grapes of Wrath, The (1940)</td>
      <td>Third Man, The (1949)</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Dead Poets Society (1989)</td>
      <td>Dead Poets Society (1989)</td>
      <td>Stray Dog (Nora inu) (1949)</td>
      <td>Rosemary's Baby (1968)</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Platoon (1986)</td>
      <td>Platoon (1986)</td>
      <td>Bad Seed, The (1956)</td>
      <td>Lion King, The (1994)</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Killing Fields, The (1984)</td>
      <td>Killing Fields, The (1984)</td>
      <td>Seventh Seal, The (Sjunde inseglet, Det) (1957)</td>
      <td>Fantasia (1940)</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Braveheart (1995)</td>
      <td>Braveheart (1995)</td>
      <td>For a Few Dollars More (Per qualche dollaro in...</td>
      <td>Birds, The (1963)</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Crouching Tiger, Hidden Dragon (Wo hu cang lon...</td>
      <td>Crouching Tiger, Hidden Dragon (Wo hu cang lon...</td>
      <td>All the President's Men (1976)</td>
      <td>Gaslight (1944)</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Clockwork Orange, A (1971)</td>
      <td>Clockwork Orange, A (1971)</td>
      <td>Rope (1948)</td>
      <td>Rear Window (1954)</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Godfather, The (1972)</td>
      <td>Godfather, The (1972)</td>
      <td>To Kill a Mockingbird (1962)</td>
      <td>Pi (1998)</td>
    </tr>
    <tr>
      <th>23</th>
      <td>One Flew Over the Cuckoo's Nest (1975)</td>
      <td>One Flew Over the Cuckoo's Nest (1975)</td>
      <td>Fail-Safe (1964)</td>
      <td>Metropolis (1927)</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Inglourious Basterds (2009)</td>
      <td>Inglourious Basterds (2009)</td>
      <td>Five Easy Pieces (1970)</td>
      <td>Fugitive, The (1993)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Generic-Module">Generic Module<a class="anchor-link" href="#Generic-Module"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>


<span class="k">class</span> <span class="nc">personalize_inference</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">dataset_group_arn</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">campaign_arn</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">event_tracker_arn</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">role_arn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">solution_version_arn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">batch_job_arn</span><span class="o">=</span><span class="kc">None</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">personalize</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">personalize_runtime</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">personalize_events</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_group_arn</span> <span class="o">=</span> <span class="n">dataset_group_arn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">campaign_arn</span> <span class="o">=</span> <span class="n">campaign_arn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_tracker_arn</span> <span class="o">=</span> <span class="n">event_tracker_arn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_tracker_id</span> <span class="o">=</span> <span class="n">event_tracker_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">role_arn</span> <span class="o">=</span> <span class="n">role_arn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solution_version_arn</span> <span class="o">=</span> <span class="n">solution_version_arn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_job_arn</span> <span class="o">=</span> <span class="n">batch_job_arn</span>

    <span class="k">def</span> <span class="nf">setup_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">personalize</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;personalize&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">personalize_runtime</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;personalize-runtime&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">personalize_events</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="s1">&#39;personalize-events&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SUCCESS | We can communicate with Personalize!&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR | Connection can&#39;t be established!&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_recommendations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">userid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                            <span class="n">filter_arn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filter_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">get_recommendations_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">personalize_runtime</span><span class="o">.</span><span class="n">get_recommendations</span><span class="p">(</span>
            <span class="n">campaignArn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">campaign_arn</span><span class="p">,</span>
            <span class="n">itemId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">itemid</span><span class="p">),</span>
            <span class="n">userId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">userid</span><span class="p">),</span>
            <span class="n">filterArn</span> <span class="o">=</span> <span class="n">filter_arn</span><span class="p">,</span>
            <span class="n">filterValues</span> <span class="o">=</span> <span class="n">filter_values</span><span class="p">,</span>
            <span class="n">numResults</span> <span class="o">=</span> <span class="n">k</span>
            <span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">get_rankings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inputlist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">get_recommendations_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">personalize_runtime</span><span class="o">.</span><span class="n">get_personalized_ranking</span><span class="p">(</span>
            <span class="n">campaignArn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">campaign_arn</span><span class="p">,</span>
            <span class="n">userId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">userid</span><span class="p">),</span>
            <span class="n">inputList</span> <span class="o">=</span> <span class="n">inputlist</span>
            <span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">create_event_tracker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">personalize</span><span class="o">.</span><span class="n">create_event_tracker</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">datasetGroupArn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_group_arn</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_tracker_arn</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;eventTrackerArn&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_tracker_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;trackingId&#39;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">put_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sessionid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eventlist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">personalize_events</span><span class="o">.</span><span class="n">put_events</span><span class="p">(</span>
            <span class="n">trackingId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_tracker_id</span><span class="p">,</span>
            <span class="n">userId</span> <span class="o">=</span> <span class="n">userid</span><span class="p">,</span> 
            <span class="n">sessionId</span> <span class="o">=</span> <span class="n">sessionid</span><span class="p">,</span>
            <span class="n">eventList</span> <span class="o">=</span> <span class="n">eventlist</span>
            <span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">create_batch_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jobname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">personalize</span><span class="o">.</span><span class="n">create_batch_inference_job</span><span class="p">(</span>
            <span class="n">solutionVersionArn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solution_version_arn</span><span class="p">,</span>
            <span class="n">jobName</span> <span class="o">=</span> <span class="n">jobname</span><span class="p">,</span>
            <span class="n">roleArn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">role_arn</span><span class="p">,</span>
            <span class="n">jobInput</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;s3DataSource&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">input_path</span><span class="p">}},</span>
            <span class="n">jobOutput</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;s3DataDestination&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">output_path</span><span class="p">}}</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_job_arn</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;batchInferenceJobArn&#39;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">check_batch_job_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">batch_job_response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">personalize</span><span class="o">.</span><span class="n">describe_batch_inference_job</span><span class="p">(</span>
        <span class="n">batchInferenceJobArn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_job_arn</span>
        <span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">batch_job_response</span><span class="p">[</span><span class="s2">&quot;batchInferenceJob&quot;</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">status</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;personalize&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;personalize_runtime&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;personalize_events&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">attributes</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

</div>



  </div><a class="u-url" href="/2022/01/13/personalize-inference.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Jupyter notebook database.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/recohut" target="_blank" title="recohut"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
