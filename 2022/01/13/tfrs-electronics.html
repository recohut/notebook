<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Retrieval model using TFRS on Amazon Electronics | reconb</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Retrieval model using TFRS on Amazon Electronics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Jupyter notebook database." />
<meta property="og:description" content="Jupyter notebook database." />
<link rel="canonical" href="https://nb.recohut.com/2022/01/13/tfrs-electronics.html" />
<meta property="og:url" content="https://nb.recohut.com/2022/01/13/tfrs-electronics.html" />
<meta property="og:site_name" content="reconb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-13T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Retrieval model using TFRS on Amazon Electronics" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-13T00:00:00-06:00","datePublished":"2022-01-13T00:00:00-06:00","description":"Jupyter notebook database.","headline":"Retrieval model using TFRS on Amazon Electronics","mainEntityOfPage":{"@type":"WebPage","@id":"https://nb.recohut.com/2022/01/13/tfrs-electronics.html"},"url":"https://nb.recohut.com/2022/01/13/tfrs-electronics.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nb.recohut.com/feed.xml" title="reconb" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">reconb</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Retrieval model using TFRS on Amazon Electronics</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-01-13T00:00:00-06:00" itemprop="datePublished">
        Jan 13, 2022
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      6 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/recohut/notebook/tree/master/_notebooks/2022-01-13-tfrs-electronics.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/recohut/notebook/master?filepath=_notebooks%2F2022-01-13-tfrs-electronics.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/recohut/notebook/blob/master/_notebooks/2022-01-13-tfrs-electronics.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Frecohut%2Fnotebook%2Fblob%2Fmaster%2F_notebooks%2F2022-01-13-tfrs-electronics.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-01-13-tfrs-electronics.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup">Setup<a class="anchor-link" href="#Setup"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">tensorflow</span><span class="o">-</span><span class="n">recommenders</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Text</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">tensorflow_recommenders</span> <span class="k">as</span> <span class="nn">tfrs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data">Data<a class="anchor-link" href="#Data"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">wget</span> <span class="o">-</span><span class="n">q</span> <span class="o">--</span><span class="n">show</span><span class="o">-</span><span class="n">progress</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">snap</span><span class="o">.</span><span class="n">stanford</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">amazon</span><span class="o">/</span><span class="n">productGraph</span><span class="o">/</span><span class="n">categoryFiles</span><span class="o">/</span><span class="n">ratings_Electronics</span><span class="o">.</span><span class="n">csv</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>ratings_Electronics 100%[===================&gt;] 304.00M  4.01MB/s    in 42s     

2021-12-13 07:26:48 (7.25 MB/s) - â€˜ratings_Electronics.csvâ€™ saved [318766497/318766497]

</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;ratings_Electronics.csv&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;userId&#39;</span><span class="p">,</span> <span class="s1">&#39;productId&#39;</span><span class="p">,</span><span class="s1">&#39;Rating&#39;</span><span class="p">,</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>productId</th>
      <th>Rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AKM1MP6P0OYPR</td>
      <td>0132793040</td>
      <td>5.0</td>
      <td>1365811200</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A2CX7LUOHB2NDG</td>
      <td>0321732944</td>
      <td>5.0</td>
      <td>1341100800</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A2NWSAGRHCP8N5</td>
      <td>0439886341</td>
      <td>1.0</td>
      <td>1367193600</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A2WNBOD3WNDNKT</td>
      <td>0439886341</td>
      <td>3.0</td>
      <td>1374451200</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A1GI0U4ZRJA8WN</td>
      <td>0439886341</td>
      <td>1.0</td>
      <td>1334707200</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>productId</th>
      <th>Rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AKM1MP6P0OYPR</td>
      <td>0132793040</td>
      <td>5.0</td>
      <td>1365811200</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A2CX7LUOHB2NDG</td>
      <td>0321732944</td>
      <td>5.0</td>
      <td>1341100800</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A2NWSAGRHCP8N5</td>
      <td>0439886341</td>
      <td>1.0</td>
      <td>1367193600</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A2WNBOD3WNDNKT</td>
      <td>0439886341</td>
      <td>3.0</td>
      <td>1374451200</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A1GI0U4ZRJA8WN</td>
      <td>0439886341</td>
      <td>1.0</td>
      <td>1334707200</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 7824482 entries, 0 to 7824481
Data columns (total 4 columns):
 #   Column     Dtype  
---  ------     -----  
 0   userId     object 
 1   productId  object 
 2   Rating     float64
 3   timestamp  int64  
dtypes: float64(1), int64(1), object(2)
memory usage: 298.5+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Minimum rating is: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Rating</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Maximum rating is: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Rating</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Minimum rating is: 1
Maximum rating is: 5
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Rating&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">set_ylabels</span><span class="p">(</span><span class="s2">&quot;Total number of ratings&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
" />
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">num_of_rated_products_per_user</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;userId&#39;</span><span class="p">)[</span><span class="s1">&#39;Rating&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">num_of_rated_products_per_user</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>userId
A5JLAU2ARJ0BO     520
ADLVFFE4VBT8      501
A3OXHLG6DIBRW8    498
A6FIAB28IS79      431
A680RUE1FDO8B     406
Name: Rating, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">new_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;productId&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Rating&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">new_df</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>productId</th>
      <th>Rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>225497</td>
      <td>225497</td>
      <td>225497.000000</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>213764</td>
      <td>1945</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>top</th>
      <td>A680RUE1FDO8B</td>
      <td>B0074BW614</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>12</td>
      <td>1804</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.172645</td>
    </tr>
    <tr>
      <th>std</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.288490</td>
    </tr>
    <tr>
      <th>min</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">new_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">interactions_dict</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Rating&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">interactions_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">interactions_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">interactions</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">interactions_dict</span><span class="p">)</span>

<span class="n">items_dict</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;productId&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">items_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">items_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">items_dict</span><span class="p">)</span>

<span class="n">interactions</span> <span class="o">=</span> <span class="n">interactions</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;userId&#39;</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;userId&#39;</span><span class="p">],</span> 
    <span class="s1">&#39;productId&#39;</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;productId&#39;</span><span class="p">],</span> 
<span class="p">})</span>

<span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;productId&#39;</span><span class="p">])</span>

<span class="c1">### get unique item and user id&#39;s as a lookup table</span>
<span class="n">unique_item_titles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">1000</span><span class="p">))))</span>
<span class="n">unique_user_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">interactions</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">1_000</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;userId&quot;</span><span class="p">]))))</span>

<span class="c1"># Randomly shuffle data and split between train and test.</span>
<span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">shuffled</span> <span class="o">=</span> <span class="n">interactions</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">200_000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">reshuffle_each_iteration</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">shuffled</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">180_000</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">shuffled</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">180_000</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">20_000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Model">Model<a class="anchor-link" href="#Model"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">RetailModel</span><span class="p">(</span><span class="n">tfrs</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_model</span><span class="p">,</span> <span class="n">item_model</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
        <span class="c1">### Candidate model (item)</span>
        <span class="c1">### This is Keras preprocessing layers to first convert user ids to integers, </span>
        <span class="c1">### and then convert those to user embeddings via an Embedding layer. </span>
        <span class="c1">### We use the list of unique user ids we computed earlier as a vocabulary:</span>
        <span class="n">item_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
                                        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">StringLookup</span><span class="p">(</span>
                                        <span class="n">vocabulary</span><span class="o">=</span><span class="n">unique_item_titles</span><span class="p">,</span> <span class="n">mask_token</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                                        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_item_titles</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">embedding_dimension</span><span class="p">)</span>
                                        <span class="p">])</span>
        <span class="c1">### we pass the embedding layer into item model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_model</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span> <span class="o">=</span> <span class="n">item_model</span>
            
        <span class="c1">### Query model (users)    </span>
        <span class="n">user_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
                                        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">StringLookup</span><span class="p">(</span>
                                        <span class="n">vocabulary</span><span class="o">=</span><span class="n">unique_user_ids</span><span class="p">,</span> <span class="n">mask_token</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                                        <span class="c1"># We add an additional embedding to account for unknown tokens.</span>
                                        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_user_ids</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">embedding_dimension</span><span class="p">)</span>
                                        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_model</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span> <span class="o">=</span> <span class="n">user_model</span>
        <span class="c1">### for retrieval model. we take top-k accuracy as metrics</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="n">tfrs</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">FactorizedTopK</span><span class="p">(</span>
                                            <span class="n">candidates</span><span class="o">=</span><span class="n">items</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">item_model</span><span class="p">))</span>
        
        <span class="c1"># define the task, which is retrieval                                    )    </span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">tfrs</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">Retrieval</span><span class="p">(</span>
                                    <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span>
                                    <span class="p">)</span>
       
        <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Layer</span> <span class="o">=</span> <span class="n">task</span>

    <span class="k">def</span> <span class="nf">compute_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="c1"># We pick out the user features and pass them into the user model.</span>
        <span class="n">user_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_model</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;userId&quot;</span><span class="p">])</span>
        <span class="c1"># And pick out the movie features and pass them into the movie model,</span>
        <span class="c1"># getting embeddings back.</span>
        <span class="n">positive_movie_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_model</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s2">&quot;productId&quot;</span><span class="p">])</span>

        <span class="c1"># The task computes the loss and the metrics.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">user_embeddings</span><span class="p">,</span> <span class="n">positive_movie_embeddings</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Training-and-Evaluation">Training and Evaluation<a class="anchor-link" href="#Training-and-Evaluation"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">embedding_dimension</span> <span class="o">=</span> <span class="mi">32</span>

<span class="c1">## we pass the model, which is the same model we created in the query and candidate tower, into the model</span>
<span class="n">item_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
                                <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">StringLookup</span><span class="p">(</span>
                                <span class="n">vocabulary</span><span class="o">=</span><span class="n">unique_item_titles</span><span class="p">,</span> <span class="n">mask_token</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                                <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_item_titles</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">embedding_dimension</span><span class="p">)</span>
                                <span class="p">])</span>

<span class="n">user_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
                                <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">StringLookup</span><span class="p">(</span>
                                <span class="n">vocabulary</span><span class="o">=</span><span class="n">unique_user_ids</span><span class="p">,</span> <span class="n">mask_token</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                                <span class="c1"># We add an additional embedding to account for unknown tokens.</span>
                                <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_user_ids</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">embedding_dimension</span><span class="p">)</span>
                                <span class="p">])</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RetailModel</span><span class="p">(</span><span class="n">user_model</span><span class="p">,</span> <span class="n">item_model</span><span class="p">)</span>

<span class="c1"># a smaller learning rate may make the model move slower and prone to overfitting, so we stick to 0.1</span>
<span class="c1"># other optimizers, such as SGD and Adam, are listed here https://www.tensorflow.org/api_docs/python/tf/keras/optimizers</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adagrad</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span>

<span class="n">cached_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">100_000</span><span class="p">)</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">8192</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
<span class="n">cached_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

<span class="c1">## fit the model with ten epochs</span>
<span class="n">model_hist</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cached_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1">#evaluate the model</span>
<span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">cached_test</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Epoch 1/10
22/22 [==============================] - 60s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.0012 - factorized_top_k/top_5_categorical_accuracy: 0.0075 - factorized_top_k/top_10_categorical_accuracy: 0.0128 - factorized_top_k/top_50_categorical_accuracy: 0.0439 - factorized_top_k/top_100_categorical_accuracy: 0.0751 - loss: 73623.2249 - regularization_loss: 0.0000e+00 - total_loss: 73623.2249
Epoch 2/10
22/22 [==============================] - 58s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.1562 - factorized_top_k/top_5_categorical_accuracy: 0.3927 - factorized_top_k/top_10_categorical_accuracy: 0.4832 - factorized_top_k/top_50_categorical_accuracy: 0.7217 - factorized_top_k/top_100_categorical_accuracy: 0.8168 - loss: 72300.0727 - regularization_loss: 0.0000e+00 - total_loss: 72300.0727
Epoch 3/10
22/22 [==============================] - 57s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.3928 - factorized_top_k/top_5_categorical_accuracy: 0.8414 - factorized_top_k/top_10_categorical_accuracy: 0.9092 - factorized_top_k/top_50_categorical_accuracy: 0.9773 - factorized_top_k/top_100_categorical_accuracy: 0.9875 - loss: 62442.3733 - regularization_loss: 0.0000e+00 - total_loss: 62442.3733
Epoch 4/10
22/22 [==============================] - 57s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.4745 - factorized_top_k/top_5_categorical_accuracy: 0.9653 - factorized_top_k/top_10_categorical_accuracy: 0.9771 - factorized_top_k/top_50_categorical_accuracy: 0.9912 - factorized_top_k/top_100_categorical_accuracy: 0.9952 - loss: 41883.9874 - regularization_loss: 0.0000e+00 - total_loss: 41883.9874
Epoch 5/10
22/22 [==============================] - 58s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.5190 - factorized_top_k/top_5_categorical_accuracy: 0.9847 - factorized_top_k/top_10_categorical_accuracy: 0.9901 - factorized_top_k/top_50_categorical_accuracy: 0.9970 - factorized_top_k/top_100_categorical_accuracy: 0.9985 - loss: 25103.2581 - regularization_loss: 0.0000e+00 - total_loss: 25103.2581
Epoch 6/10
22/22 [==============================] - 58s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.5073 - factorized_top_k/top_5_categorical_accuracy: 0.9922 - factorized_top_k/top_10_categorical_accuracy: 0.9959 - factorized_top_k/top_50_categorical_accuracy: 0.9989 - factorized_top_k/top_100_categorical_accuracy: 0.9994 - loss: 18442.5861 - regularization_loss: 0.0000e+00 - total_loss: 18442.5861
Epoch 7/10
22/22 [==============================] - 58s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.5146 - factorized_top_k/top_5_categorical_accuracy: 0.9947 - factorized_top_k/top_10_categorical_accuracy: 0.9973 - factorized_top_k/top_50_categorical_accuracy: 0.9993 - factorized_top_k/top_100_categorical_accuracy: 0.9997 - loss: 17059.8658 - regularization_loss: 0.0000e+00 - total_loss: 17059.8658
Epoch 8/10
22/22 [==============================] - 57s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.5250 - factorized_top_k/top_5_categorical_accuracy: 0.9957 - factorized_top_k/top_10_categorical_accuracy: 0.9979 - factorized_top_k/top_50_categorical_accuracy: 0.9995 - factorized_top_k/top_100_categorical_accuracy: 0.9997 - loss: 16671.5239 - regularization_loss: 0.0000e+00 - total_loss: 16671.5239
Epoch 9/10
22/22 [==============================] - 57s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.5178 - factorized_top_k/top_5_categorical_accuracy: 0.9963 - factorized_top_k/top_10_categorical_accuracy: 0.9983 - factorized_top_k/top_50_categorical_accuracy: 0.9996 - factorized_top_k/top_100_categorical_accuracy: 0.9998 - loss: 16467.4731 - regularization_loss: 0.0000e+00 - total_loss: 16467.4731
Epoch 10/10
22/22 [==============================] - 57s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.5187 - factorized_top_k/top_5_categorical_accuracy: 0.9968 - factorized_top_k/top_10_categorical_accuracy: 0.9985 - factorized_top_k/top_50_categorical_accuracy: 0.9996 - factorized_top_k/top_100_categorical_accuracy: 0.9998 - loss: 16336.3414 - regularization_loss: 0.0000e+00 - total_loss: 16336.3414
5/5 [==============================] - 6s 1s/step - factorized_top_k/top_1_categorical_accuracy: 1.5000e-04 - factorized_top_k/top_5_categorical_accuracy: 0.0026 - factorized_top_k/top_10_categorical_accuracy: 0.0055 - factorized_top_k/top_50_categorical_accuracy: 0.0257 - factorized_top_k/top_100_categorical_accuracy: 0.0498 - loss: 34445.1074 - regularization_loss: 0.0000e+00 - total_loss: 34445.1074
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;factorized_top_k/top_100_categorical_accuracy&#39;: 0.04984999820590019,
 &#39;factorized_top_k/top_10_categorical_accuracy&#39;: 0.005450000055134296,
 &#39;factorized_top_k/top_1_categorical_accuracy&#39;: 0.0001500000071246177,
 &#39;factorized_top_k/top_50_categorical_accuracy&#39;: 0.02565000019967556,
 &#39;factorized_top_k/top_5_categorical_accuracy&#39;: 0.0026000000070780516,
 &#39;loss&#39;: 31409.376953125,
 &#39;regularization_loss&#39;: 0,
 &#39;total_loss&#39;: 31409.376953125}</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">epochs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">model_hist</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">&quot;factorized_top_k/top_100_categorical_accuracy&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Accuracy vs epoch&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;epoch&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Top-100 accuracy&quot;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.legend.Legend at 0x7f96b5003c50&gt;</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
" />
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Inference">Inference<a class="anchor-link" href="#Inference"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">tfrs</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">factorized_top_k</span><span class="o">.</span><span class="n">BruteForce</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">user_model</span><span class="p">)</span>

<span class="c1"># recommends products out of the entire product dataset.</span>
<span class="n">index</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">item_model</span><span class="p">),</span> <span class="n">items</span><span class="p">)</span>

<span class="c1"># Get recommendations.</span>
<span class="n">j</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">titles</span> <span class="o">=</span> <span class="n">index</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="n">j</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recommendations for user %s: </span><span class="si">{</span><span class="n">titles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">watermark</span>
<span class="o">%</span><span class="n">reload_ext</span> <span class="n">watermark</span>
<span class="o">%</span><span class="n">watermark</span> <span class="o">-</span><span class="n">a</span> <span class="s2">&quot;Sparsh A.&quot;</span> <span class="o">-</span><span class="n">m</span> <span class="o">-</span><span class="n">iv</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">d</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Author: Sparsh A.

Last updated: 2021-12-13 07:52:48

Compiler    : GCC 7.5.0
OS          : Linux
Release     : 5.4.104+
Machine     : x86_64
Processor   : x86_64
CPU cores   : 2
Architecture: 64bit

IPython                : 5.5.0
tensorflow_recommenders: 0.6.0
seaborn                : 0.11.2
pandas                 : 1.1.5
numpy                  : 1.19.5
matplotlib             : 3.2.2
tensorflow             : 2.7.0

</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>END</strong></p>

</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/2022/01/13/tfrs-electronics.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Jupyter notebook database.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/recohut" target="_blank" title="recohut"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
