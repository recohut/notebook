<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Entire item space exploration with Contextual bandits on MIND news dataset | reconb</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Entire item space exploration with Contextual bandits on MIND news dataset" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Jupyter notebook database." />
<meta property="og:description" content="Jupyter notebook database." />
<link rel="canonical" href="https://nb.recohut.com/2022/01/13/cab-mind.html" />
<meta property="og:url" content="https://nb.recohut.com/2022/01/13/cab-mind.html" />
<meta property="og:site_name" content="reconb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-13T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Entire item space exploration with Contextual bandits on MIND news dataset" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-13T00:00:00-06:00","datePublished":"2022-01-13T00:00:00-06:00","description":"Jupyter notebook database.","headline":"Entire item space exploration with Contextual bandits on MIND news dataset","mainEntityOfPage":{"@type":"WebPage","@id":"https://nb.recohut.com/2022/01/13/cab-mind.html"},"url":"https://nb.recohut.com/2022/01/13/cab-mind.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nb.recohut.com/feed.xml" title="reconb" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">reconb</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Entire item space exploration with Contextual bandits on MIND news dataset</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-01-13T00:00:00-06:00" itemprop="datePublished">
        Jan 13, 2022
      </time>
       ‚Ä¢ <span class="read-time" title="Estimated read time">
    
    
      139 min read
    
</span></p>

    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/recohut/notebook/tree/master/_notebooks/2022-01-13-cab-mind.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/recohut/notebook/master?filepath=_notebooks%2F2022-01-13-cab-mind.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/recohut/notebook/blob/master/_notebooks/2022-01-13-cab-mind.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Frecohut%2Fnotebook%2Fblob%2Fmaster%2F_notebooks%2F2022-01-13-cab-mind.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-01-13-cab-mind.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Executive-summary">Executive summary<a class="anchor-link" href="#Executive-summary"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<table>
<thead><tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Problem</td>
<td>Contextual bandit (CB) strive to make a good trade-off between exploration and exploitation so that users' potential interests have chances to expose. However, classical CB can only be applied to a small, sampled item set (usually hundreds), which forces the typical applications in recommender systems limited to candidate post-ranking, homepage top item ranking, ad creative selection, or online model selection (A/B test).</td>
</tr>
<tr>
<td>Solution</td>
<td>Hierarchical CB (HCB) to make classical CB model (such as LinUCB and Thompson Sampling) capable to explore users' interest in the entire item space without limiting it to a small item set. We first construct a hierarchy item tree via a bottom-up clustering algorithm to organize items in a coarse-to-fine manner. Then uses HCB to explore users' interest in the hierarchy tree. HCB takes the exploration problem as a series of decision-making processes, where the goal is to find a path from the root to a leaf node, and the feedback will be back-propagated to all the nodes in the path. For example, in e-commerce scenario, ‚ÄúApparel &gt; Clothing &gt; Women‚Äôs Clothing &gt; Dresses‚Äù is a path from general apparel to women‚Äôs dresses. Progressive hierarchical CB (pHCB) algorithm is an extension of HCB, which progressively extends visible nodes which reach a confidence level for exploration, to avoid misleading actions on upper-level nodes in the sequential decision-making process. Consequently, the pHCB avoids greedily selecting only one node at each level to improve the HCB.</td>
</tr>
<tr>
<td>Dataset</td>
<td>MIND</td>
</tr>
<tr>
<td>Preprocessing</td>
<td>We use Sentence BERT to train news embeddings from their contents, and adopt a GRU as the user model to fine-tune news embeddings from the sequence of click logs. Tree structure construction - to construct a tree structure with ùêø levels, at first, ùëÅ items are clustered into ‚Åç different subsets based on the similarity of item embeddings. We treat each subset as a new node on the tree, with an embedding vector being the average of all item embeddings belonging to this node. Afterward, these ‚Åç nodes will be further clustered into ‚Åç different subsets using K-Means and each subset will be treated as a new node on the tree, forming a parent-children relation. This step will be repeated several times until the depth of the tree structure researches ùêø. As a result, the constructed tree structure, denoted by H, contains ‚Åç nodes at each level, where ‚Åç = 1 because only a root node appears at the first level. Intuitively, items within the same node are more similar to each other, thus the clustering results reflect the dependencies among items. In H, only the root node does not have parent node, and leaf nodes have no children nodes.</td>
</tr>
<tr>
<td>Metrics</td>
<td>Cumulative reward.</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Process-flow">Process flow<a class="anchor-link" href="#Process-flow"> </a></h2><p><img src="https://github.com/RecoHut-Stanzas/S832885/raw/main/images/P422159_process_flow.svg" alt="" /></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Theory">Theory<a class="anchor-link" href="#Theory"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<table>
<thead><tr>
<th style="text-align:center">HCB flow</th>
<th style="text-align:center">HCB algorithm</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="https://github.com/RecoHut-Stanzas/S832885/raw/main/images/hcb_flow.png" alt="" /></td>
<td style="text-align:center"><img src="https://github.com/RecoHut-Stanzas/S832885/raw/main/images/hcb_algo.png" alt="" /></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the HCB illustration, The policy selects a path {A,C,I,P} from root to a certain leaf node.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<table>
<thead><tr>
<th style="text-align:center">pHCB flow</th>
<th style="text-align:center">pHCB algorithm</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="https://github.com/RecoHut-Stanzas/S832885/raw/main/images/phcb_flow.png" alt="" /></td>
<td style="text-align:center"><img src="https://github.com/RecoHut-Stanzas/S832885/raw/main/images/phcb_algo.png" alt="" /></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In pHCB illustration, at round $ùëá_ùëé$, the receptive field consists of nodes B, C and D; After several trials, at round $ùëá_ùëè$, node C meets the conditions of expansion, so the receptive field changes to nodes B, D, G, H and I.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup">Setup<a class="anchor-link" href="#Setup"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">branch</span> <span class="n">v1</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">RecoHut</span><span class="o">-</span><span class="n">Datasets</span><span class="o">/</span><span class="n">mind</span><span class="o">.</span><span class="n">git</span> <span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Cloning into &#39;data&#39;...
remote: Enumerating objects: 20, done.
remote: Counting objects: 100% (20/20), done.
remote: Compressing objects: 100% (17/17), done.
remote: Total 20 (delta 2), reused 16 (delta 2), pack-reused 0
Unpacking objects: 100% (20/20), done.
Checking out files: 100% (10/10), done.
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span><span class="n">timedelta</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">thread_num</span><span class="o">=</span><span class="mi">20</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">Params</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">free_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="s1">&#39;free_memory&#39;</span><span class="p">):</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">free_memory</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">config</span><span class="p">():</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">Params</span><span class="p">()</span>

    <span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span>         <span class="o">=</span> <span class="s1">&#39;MIND&#39;</span> <span class="c1">#TaoBao or MIND</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">T</span>               <span class="o">=</span> <span class="mi">1000</span> <span class="c1">#the number of rounds of each bandit algorithm</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">k</span>               <span class="o">=</span> <span class="mi">1</span> <span class="c1">#the number of items recommended to user at each round, default is 1</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">activate_num</span>    <span class="o">=</span> <span class="mi">10</span> <span class="c1">#the hyper-papamter p for pHCB</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">activate_prob</span>   <span class="o">=</span> <span class="mf">0.1</span> <span class="c1">#the hyper-papamter q for pHCB</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">epsilon</span>         <span class="o">=</span> <span class="mf">0.05</span> <span class="c1">#the epsilon value for greedy-based algorithms</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">new_tree_file</span>   <span class="o">=</span> <span class="s1">&#39;1000_10_btree.pkl&#39;</span> <span class="c1">#the tree file name</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">noise_scale</span>     <span class="o">=</span> <span class="mf">0.001</span> <span class="c1">#the standard deviation of environmental noise</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">keep_prob</span>       <span class="o">=</span> <span class="mf">0.0001</span> <span class="c1">#sample ratio; default is 1.0, which means testing all users</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">linucb_para</span>     <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}</span> <span class="c1">#the hyper-parameters for linucb algorithm</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span>        <span class="o">=</span> <span class="mi">50</span> <span class="c1">#the size of candidate pool</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">random_choice</span>   <span class="o">=</span> <span class="kc">False</span> <span class="c1">#whether random choice an item to user</span>

    <span class="k">return</span> <span class="n">cfg</span>

<span class="k">def</span> <span class="nf">log_config</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span><span class="n">logger</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> : </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">))</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">config</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">get_timestamp</span><span class="p">():</span>
    <span class="c1"># return datetime.now().strftime(&#39;%y%m%d-%H%M%S&#39;)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%y%m</span><span class="si">%d</span><span class="s1">-%H%M%S&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">setup_logger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="n">screen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;set up logger&#39;&#39;&#39;</span>
    <span class="n">lg</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">)</span>
    <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1">.</span><span class="si">%(msecs)03d</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
                                  <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
    <span class="n">lg</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;./logger/&#39;</span>
    <span class="n">time_now</span> <span class="o">=</span> <span class="n">get_timestamp</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">tofile</span><span class="p">:</span>
        <span class="n">log_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">phase</span> <span class="o">+</span> <span class="s1">&#39;_</span><span class="si">{}</span><span class="s1">.log&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_now</span><span class="p">))</span>
        <span class="n">fh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
        <span class="n">lg</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">screen</span><span class="p">:</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
        <span class="n">sh</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
        <span class="n">lg</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">time_now</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="LinUCB">LinUCB<a class="anchor-link" href="#LinUCB"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Items">Items<a class="anchor-link" href="#Items"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">Item</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gid</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">bias</span><span class="p">,</span><span class="n">para</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gid</span>     <span class="o">=</span> <span class="n">gid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span>      <span class="o">=</span> <span class="p">{}</span> <span class="c1">#feature vector for training/simulator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x1</span> <span class="c1">#training</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x2</span> <span class="c1">#simulator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bias</span> <span class="c1">#bias</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para</span>    <span class="o">=</span> <span class="n">para</span> <span class="c1">#other info</span>

<span class="k">class</span> <span class="nc">ItemManager</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span>    <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span>   <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_items</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">load_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">item_info</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">j_s</span> <span class="ow">in</span> <span class="n">item_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">gid</span> <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;gid&#39;</span><span class="p">]</span>
            <span class="n">x1</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">]</span>
            <span class="n">x2</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">]</span>
            <span class="n">bias</span><span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span>
            <span class="n">para</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">para</span><span class="p">[</span><span class="s1">&#39;category2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;category2&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">bias</span><span class="p">,</span><span class="n">para</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_items</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Users">Users<a class="anchor-link" href="#Users"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">bias</span><span class="p">,</span><span class="n">para</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span>     <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span>      <span class="o">=</span> <span class="p">{}</span> <span class="c1">#feature vector for training/simulator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x1</span> <span class="c1"># training</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x2</span> <span class="c1"># simulator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bias</span> <span class="c1"># simulator bias</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para</span>    <span class="o">=</span> <span class="n">para</span> <span class="c1">#other info</span>

<span class="k">class</span> <span class="nc">UserManager</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span>    <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span>   <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_users</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">load_users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user_info</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">j_s</span> <span class="ow">in</span> <span class="n">user_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">&gt;</span><span class="n">cfg</span><span class="o">.</span><span class="n">keep_prob</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">uid</span> <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span>
            <span class="n">x1</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">]</span>
            <span class="n">x2</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">]</span>
            <span class="n">bias</span><span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">bias</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_users</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Naive-LinUCB">Naive LinUCB<a class="anchor-link" href="#Naive-LinUCB"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">LinUCBUserStructNLUCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="n">init</span><span class="p">,</span><span class="n">alpha</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))</span>  
        <span class="k">if</span> <span class="n">init</span><span class="o">!=</span><span class="s1">&#39;zero&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span> <span class="c1"># store the new alpha calculated in each iteration</span>

    <span class="k">def</span> <span class="nf">getProb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fv</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span>
        <span class="n">mean</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">fv</span><span class="p">)</span>
        <span class="n">var</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">fv</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="p">),</span><span class="n">fv</span><span class="p">))</span>
        <span class="n">pta</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">*</span><span class="n">var</span>
        <span class="k">return</span> <span class="n">pta</span>

    <span class="k">def</span> <span class="nf">getInv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_Minv</span><span class="p">,</span> <span class="n">nfv</span><span class="p">):</span>
        <span class="c1"># new_M=old_M+nfv*nfv&#39;</span>
        <span class="c1"># try to get the inverse of new_M</span>
        <span class="n">tmp_a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">old_Minv</span><span class="p">,</span><span class="n">nfv</span><span class="p">),</span><span class="n">nfv</span><span class="p">),</span><span class="n">old_Minv</span><span class="p">)</span>
        <span class="n">tmp_b</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">nfv</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">old_Minv</span><span class="p">),</span><span class="n">nfv</span><span class="p">)</span>
        <span class="n">new_Minv</span><span class="o">=</span><span class="n">old_Minv</span><span class="o">-</span><span class="n">tmp_a</span><span class="o">/</span><span class="n">tmp_b</span>
        <span class="k">return</span> <span class="n">new_Minv</span>

    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_fv</span><span class="p">,</span> <span class="n">reward</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">+=</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">a_fv</span><span class="p">,</span> <span class="n">a_fv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">+=</span><span class="n">a_fv</span><span class="o">*</span><span class="n">reward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getInv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="p">,</span><span class="n">a_fv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NaiveLinUCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">para</span><span class="p">,</span><span class="n">init</span><span class="o">=</span><span class="s1">&#39;zero&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">=</span><span class="n">init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">=</span><span class="n">para</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">=-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">decide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">=</span><span class="n">LinUCBUserStructNLUCB</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="s2">&quot;zero&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">arm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arms</span><span class="p">):</span>
            <span class="c1">#each item is an arm</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">getProb</span><span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">reward</span><span class="o">&gt;</span><span class="n">max_r</span><span class="p">:</span>
                <span class="n">aid</span> <span class="o">=</span> <span class="n">index</span>
                <span class="n">max_r</span> <span class="o">=</span> <span class="n">reward</span>
        <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">arms</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">arm_picker</span>


    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">picked_arm</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">uid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">picked_arm</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span><span class="n">reward</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="HCB">HCB<a class="anchor-link" href="#HCB"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">LinUCBBaseStruct</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="n">init</span><span class="p">,</span><span class="n">alpha</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))</span>  
        <span class="k">if</span> <span class="n">init</span><span class="o">!=</span><span class="s1">&#39;zero&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span> <span class="c1"># store the new alpha calcuated in each iteratioin</span>

    <span class="k">def</span> <span class="nf">getProb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fv</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span>
        <span class="n">mean</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">fv</span><span class="p">)</span>
        <span class="n">var</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">fv</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="p">),</span><span class="n">fv</span><span class="p">))</span>
        <span class="n">pta</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">*</span><span class="n">var</span>
        <span class="k">return</span> <span class="n">pta</span>

    <span class="k">def</span> <span class="nf">getInv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_Minv</span><span class="p">,</span> <span class="n">nfv</span><span class="p">):</span>
        <span class="c1"># new_M=old_M+nfv*nfv&#39;</span>
        <span class="c1"># try to get the inverse of new_M</span>
        <span class="n">tmp_a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">old_Minv</span><span class="p">,</span><span class="n">nfv</span><span class="p">),</span><span class="n">nfv</span><span class="p">),</span><span class="n">old_Minv</span><span class="p">)</span>
        <span class="n">tmp_b</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">nfv</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">old_Minv</span><span class="p">),</span><span class="n">nfv</span><span class="p">)</span>
        <span class="n">new_Minv</span><span class="o">=</span><span class="n">old_Minv</span><span class="o">-</span><span class="n">tmp_a</span><span class="o">/</span><span class="n">tmp_b</span>
        <span class="k">return</span> <span class="n">new_Minv</span>

    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_fv</span><span class="p">,</span> <span class="n">reward</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">+=</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">a_fv</span><span class="p">,</span> <span class="n">a_fv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">+=</span><span class="n">a_fv</span><span class="o">*</span><span class="n">reward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getInv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="p">,</span><span class="n">a_fv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">LinUCBUserStructHCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">root</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="n">init</span><span class="p">,</span><span class="n">alpha</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_linucb</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cfg</span><span class="o">.</span><span class="n">random_choice</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linucb</span> <span class="o">=</span> <span class="n">NaiveLinUCB</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">linucb_para</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">HCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">para</span><span class="p">,</span><span class="n">init</span><span class="o">=</span><span class="s1">&#39;zero&#39;</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">=</span><span class="n">init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">=</span><span class="n">para</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">=-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_depth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">new_tree_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span>


    <span class="k">def</span> <span class="nf">decide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">=</span><span class="n">LinUCBUserStructHCB</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span><span class="s2">&quot;zero&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">current_node</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">root</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">user</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span><span class="p">(</span><span class="n">current_node</span><span class="o">.</span><span class="n">is_leaf</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">children</span> <span class="o">=</span> <span class="n">current_node</span><span class="o">.</span><span class="n">children</span>
            <span class="n">max_r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
            <span class="n">aid</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">depth</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">base_linucb</span><span class="p">:</span>
                <span class="n">user</span><span class="o">.</span><span class="n">base_linucb</span><span class="p">[</span><span class="n">depth</span><span class="p">]</span> <span class="o">=</span> <span class="n">LinUCBBaseStruct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span><span class="s2">&quot;zero&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">poolsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">total_depth</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">poolsize</span><span class="p">:</span>
                <span class="n">arms</span> <span class="o">=</span> <span class="n">children</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">),</span><span class="n">poolsize</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">aids</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">arm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arms</span><span class="p">):</span>
                <span class="n">reward</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">base_linucb</span><span class="p">[</span><span class="n">depth</span><span class="p">]</span><span class="o">.</span><span class="n">getProb</span><span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">emb</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">reward</span><span class="o">&gt;</span><span class="n">max_r</span><span class="p">:</span>
                    <span class="n">aid</span> <span class="o">=</span> <span class="n">index</span>
                    <span class="n">max_r</span> <span class="o">=</span> <span class="n">reward</span>
            <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">arms</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span>
            <span class="n">user</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arm_picker</span><span class="p">)</span>
            <span class="n">current_node</span> <span class="o">=</span> <span class="n">arm_picker</span>
            <span class="n">depth</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">arm_picker</span><span class="p">,</span><span class="n">aid</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">feedback</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">path</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">arm_picker</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">user</span><span class="o">.</span><span class="n">base_linucb</span><span class="p">[</span><span class="n">depth</span><span class="p">]</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">emb</span><span class="p">,</span><span class="n">feedback</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="pHCB">pHCB<a class="anchor-link" href="#pHCB"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">ArmStructPHCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arm</span><span class="p">,</span><span class="n">depth</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arm</span> <span class="o">=</span> <span class="n">arm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gids</span> <span class="o">=</span> <span class="n">arm</span><span class="o">.</span><span class="n">gids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span> <span class="c1"># only when arm is a tree node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemclick</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vv</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vv</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">&lt;</span><span class="n">cfg</span><span class="o">.</span><span class="n">activate_num</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vv</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">&lt;</span><span class="n">cfg</span><span class="o">.</span><span class="n">activate_prob</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

<span class="k">class</span> <span class="nc">LinUCBUserStructPHCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="n">init</span><span class="p">,</span><span class="n">alpha</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="n">arms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))</span>  
        <span class="k">if</span> <span class="n">init</span><span class="o">!=</span><span class="s1">&#39;zero&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span> <span class="c1"># store the new alpha calcuated in each iteratioin</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cfg</span><span class="o">.</span><span class="n">random_choice</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linucb</span> <span class="o">=</span> <span class="n">NaiveLinUCB</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">linucb_para</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getProb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fv</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span>
        <span class="n">mean</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">fv</span><span class="p">)</span>
        <span class="n">var</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">fv</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="p">),</span><span class="n">fv</span><span class="p">))</span>
        <span class="n">pta</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">*</span><span class="n">var</span>
        <span class="k">return</span> <span class="n">pta</span>

    <span class="k">def</span> <span class="nf">getInv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_Minv</span><span class="p">,</span> <span class="n">nfv</span><span class="p">):</span>
        <span class="c1"># new_M=old_M+nfv*nfv&#39;</span>
        <span class="c1"># try to get the inverse of new_M</span>
        <span class="n">tmp_a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">old_Minv</span><span class="p">,</span><span class="n">nfv</span><span class="p">),</span><span class="n">nfv</span><span class="p">),</span><span class="n">old_Minv</span><span class="p">)</span>
        <span class="n">tmp_b</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">nfv</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">old_Minv</span><span class="p">),</span><span class="n">nfv</span><span class="p">)</span>
        <span class="n">new_Minv</span><span class="o">=</span><span class="n">old_Minv</span><span class="o">-</span><span class="n">tmp_a</span><span class="o">/</span><span class="n">tmp_b</span>
        <span class="k">return</span> <span class="n">new_Minv</span>
         
    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_fv</span><span class="p">,</span> <span class="n">reward</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">+=</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">a_fv</span><span class="p">,</span> <span class="n">a_fv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">+=</span><span class="n">a_fv</span><span class="o">*</span><span class="n">reward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getInv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="p">,</span><span class="n">a_fv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">pHCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">para</span><span class="p">,</span><span class="n">init</span><span class="o">=</span><span class="s1">&#39;zero&#39;</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">=</span><span class="n">init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">=</span><span class="n">para</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">=-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>

    <span class="k">def</span> <span class="nf">decide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">arms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">arms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ArmStructPHCB</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">=</span><span class="n">LinUCBUserStructPHCB</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="s2">&quot;zero&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">:</span>
            <span class="n">aids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">),</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">aids</span><span class="p">:</span>
            <span class="n">arm</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">arm</span><span class="o">.</span><span class="n">depth</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">getProb</span><span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">emb</span><span class="p">)</span><span class="o">*</span><span class="n">depth</span>
            <span class="k">if</span> <span class="n">reward</span><span class="o">&gt;</span><span class="n">max_r</span><span class="p">:</span>
                <span class="n">aid</span> <span class="o">=</span> <span class="n">index</span>
                <span class="n">max_r</span> <span class="o">=</span> <span class="n">reward</span>
        <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">arm_picker</span><span class="p">,</span><span class="n">aid</span>


    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">picked_arm</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">uid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">picked_arm</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">emb</span><span class="p">,</span><span class="n">reward</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">feedback</span><span class="p">):</span>
        <span class="n">gid</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">gid</span>
        <span class="n">arm_picker</span><span class="o">.</span><span class="n">feedback</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">+=</span> <span class="n">feedback</span>
        <span class="n">arm_picker</span><span class="o">.</span><span class="n">vv</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">arm_picker</span><span class="o">.</span><span class="n">itemclick</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">feedback</span><span class="p">,</span><span class="n">uid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arm_picker</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span> <span class="ow">and</span> <span class="n">arm_picker</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">is_leaf</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">arm_picker</span><span class="o">.</span><span class="n">depth</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">arm_picker</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">arm</span> <span class="o">=</span> <span class="n">ArmStructPHCB</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">depth</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">arm</span><span class="o">.</span><span class="n">gids</span><span class="p">:</span>
                    <span class="n">arm</span><span class="o">.</span><span class="n">itemclick</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">=</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">itemclick</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
                    <span class="n">arm</span><span class="o">.</span><span class="n">feedback</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">=</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">feedback</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
                    <span class="n">arm</span><span class="o">.</span><span class="n">vv</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">=</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">vv</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
                <span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="CLinUCB">CLinUCB<a class="anchor-link" href="#CLinUCB"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">ArmStructCLUCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arm</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arm</span> <span class="o">=</span> <span class="n">arm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gids</span> <span class="o">=</span> <span class="n">arm</span><span class="o">.</span><span class="n">gids</span>

<span class="k">class</span> <span class="nc">LinUCBUserStructCLUCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="n">init</span><span class="p">,</span><span class="n">alpha</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="n">arms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))</span>  
        <span class="k">if</span> <span class="n">init</span><span class="o">!=</span><span class="s1">&#39;zero&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span> <span class="c1"># store the new alpha calcuated in each iteratioin</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cfg</span><span class="o">.</span><span class="n">random_choice</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linucb</span> <span class="o">=</span> <span class="n">NaiveLinUCB</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">linucb_para</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">getProb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fv</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span>
        <span class="n">mean</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">fv</span><span class="p">)</span>
        <span class="n">var</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">fv</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="p">),</span><span class="n">fv</span><span class="p">))</span>
        <span class="n">pta</span><span class="o">=</span><span class="n">mean</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">*</span><span class="n">var</span>
        <span class="k">return</span> <span class="n">pta</span>

    <span class="k">def</span> <span class="nf">getInv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_Minv</span><span class="p">,</span> <span class="n">nfv</span><span class="p">):</span>
        <span class="c1"># new_M=old_M+nfv*nfv&#39;</span>
        <span class="c1"># try to get the inverse of new_M</span>
        <span class="n">tmp_a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">old_Minv</span><span class="p">,</span><span class="n">nfv</span><span class="p">),</span><span class="n">nfv</span><span class="p">),</span><span class="n">old_Minv</span><span class="p">)</span>
        <span class="n">tmp_b</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">nfv</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">old_Minv</span><span class="p">),</span><span class="n">nfv</span><span class="p">)</span>
        <span class="n">new_Minv</span><span class="o">=</span><span class="n">old_Minv</span><span class="o">-</span><span class="n">tmp_a</span><span class="o">/</span><span class="n">tmp_b</span>
        <span class="k">return</span> <span class="n">new_Minv</span>

         
    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_fv</span><span class="p">,</span> <span class="n">reward</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">+=</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">a_fv</span><span class="p">,</span> <span class="n">a_fv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">+=</span><span class="n">a_fv</span><span class="o">*</span><span class="n">reward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getInv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="p">,</span><span class="n">a_fv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ainv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CLinUCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">para</span><span class="p">,</span><span class="n">arms</span><span class="p">,</span><span class="n">init</span><span class="o">=</span><span class="s1">&#39;zero&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">=</span><span class="n">init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="n">ArmStructCLUCB</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span> <span class="k">for</span> <span class="n">arm</span> <span class="ow">in</span> <span class="n">arms</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">=</span><span class="n">para</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">=-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">decide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">=</span><span class="n">LinUCBUserStructCLUCB</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="s2">&quot;zero&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">:</span>
            <span class="n">arms</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">arms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">),</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">aids</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">arm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arms</span><span class="p">):</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">getProb</span><span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">emb</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reward</span><span class="o">&gt;</span><span class="n">max_r</span><span class="p">:</span>
                <span class="n">aid</span> <span class="o">=</span> <span class="n">index</span>
                <span class="n">max_r</span> <span class="o">=</span> <span class="n">reward</span>
        <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">arms</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">arm_picker</span><span class="p">,</span><span class="n">aid</span>


    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">picked_arm</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">uid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">picked_arm</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">emb</span><span class="p">,</span><span class="n">reward</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">feedback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">feedback</span><span class="p">,</span><span class="n">uid</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Simulation">Simulation<a class="anchor-link" href="#Simulation"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">dir_path</span> <span class="o">=</span> <span class="s1">&#39;./data/&#39;</span>
<span class="n">logger_name</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="s1">&#39;simulator_multi_process_linucb&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;./logger&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">time_now</span> <span class="o">=</span> <span class="n">setup_logger</span><span class="p">(</span><span class="s1">&#39;simulator_multi_process&#39;</span><span class="p">,</span> <span class="n">logger_name</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="n">screen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;simulator_multi_process&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">Tree</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emb</span>         <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span>        <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gids</span>        <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span>    <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_leaf</span>     <span class="o">=</span> <span class="kc">False</span>

<span class="k">class</span> <span class="nc">simulateExp</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">users</span><span class="p">,</span><span class="n">items</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">out_folder</span><span class="p">,</span><span class="n">test_iter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="n">users</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span>  <span class="o">=</span> <span class="n">tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_folder</span> <span class="o">=</span> <span class="n">out_folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_iter</span> <span class="o">=</span> <span class="n">test_iter</span>

    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">noise_scale</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feedback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">gid</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span><span class="n">item</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">user</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_candidatePool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">select_gids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">gids</span><span class="p">,</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">arms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">select_gids</span><span class="p">:</span>
            <span class="n">arms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">arms</span>


    <span class="k">def</span> <span class="nf">get_leafNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">root</span><span class="p">):</span>
        <span class="c1"># current = [self.tree]</span>
        <span class="n">current</span> <span class="o">=</span> <span class="p">[</span><span class="n">root</span><span class="p">]</span>
        <span class="n">leafNodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">current</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">:</span>
                    <span class="n">leafNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">temp</span> <span class="o">+=</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="k">return</span> <span class="n">leafNodes</span>


    <span class="k">def</span> <span class="nf">get_categoryNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span>
        <span class="n">categoryNodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">para</span><span class="p">[</span><span class="s1">&#39;category2&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">categoryNodes</span><span class="p">:</span>
                <span class="n">categoryNodes</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">()</span>
            <span class="n">categoryNodes</span><span class="p">[</span><span class="n">category</span><span class="p">]</span><span class="o">.</span><span class="n">gids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">node</span> <span class="ow">in</span> <span class="n">categoryNodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">gids</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">emb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">emb</span> <span class="o">=</span> <span class="n">emb</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>


    <span class="k">def</span> <span class="nf">simulationPerUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">iters</span><span class="p">):</span>
        <span class="n">process_id</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[simulationPerUser] uid: </span><span class="si">%d</span><span class="s1">, process_id: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span> <span class="n">process_id</span><span class="p">))</span>
        <span class="n">user_reward</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">iter_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iters</span><span class="p">):</span>
            <span class="n">cur_iter_noise</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="p">()</span>
            <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">algname</span><span class="p">,</span><span class="n">alg</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">algname</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;naive_linucb&#39;</span><span class="p">]:</span>
                    <span class="n">arms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_candidatePool</span><span class="p">()</span>
                    <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">alg</span><span class="o">.</span><span class="n">decide</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">)</span>
                    <span class="n">feedback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feedback</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">gid</span><span class="p">)</span>
                    <span class="n">alg</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">feedback</span><span class="p">,</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
                    <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">][</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="n">feedback</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">arm_picker</span><span class="p">,</span><span class="n">aid</span> <span class="o">=</span> <span class="n">alg</span><span class="o">.</span><span class="n">decide</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">random_choice</span><span class="p">:</span>
                    <span class="n">replace</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">gids</span><span class="p">)</span><span class="o">&lt;</span><span class="n">cfg</span><span class="o">.</span><span class="n">k</span> <span class="k">else</span> <span class="kc">False</span>
                    <span class="n">gids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">gids</span><span class="p">,</span><span class="n">cfg</span><span class="o">.</span><span class="n">k</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="n">replace</span><span class="p">)</span>
                    <span class="n">all_feedback</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gids</span><span class="p">:</span>
                        <span class="n">feedback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feedback</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">gid</span><span class="p">)</span>
                        <span class="n">alg</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">gid</span><span class="p">,</span><span class="n">feedback</span><span class="p">)</span>
                        <span class="n">all_feedback</span> <span class="o">+=</span> <span class="n">feedback</span>
                    <span class="n">avg_feedback</span> <span class="o">=</span> <span class="n">all_feedback</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">gids</span><span class="p">)</span>
                    <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">][</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_feedback</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">gids</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">:</span>
                        <span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">arm_picker</span><span class="o">.</span><span class="n">gids</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">gids</span><span class="p">,</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">alg</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">linucb</span><span class="o">.</span><span class="n">decide</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">)</span>
                    <span class="n">feedback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feedback</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">gid</span><span class="p">)</span>
                    <span class="n">alg</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">feedback</span><span class="p">)</span>
                    <span class="n">alg</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">linucb</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">feedback</span><span class="p">,</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
                    <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">][</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="n">feedback</span>
        <span class="k">return</span> <span class="n">user_reward</span>

    <span class="k">def</span> <span class="nf">run_algorithms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">algorithms</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;run algorithms&#39;</span><span class="p">)</span>
        <span class="n">pool</span><span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">thread_num</span><span class="p">)</span>
        <span class="n">results</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">uid</span><span class="p">,</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">result</span><span class="o">=</span><span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulationPerUser</span><span class="p">,(</span><span class="n">user</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">test_iter</span><span class="p">))</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="n">all_user_reward</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">tmp_reward</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">all_user_reward</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_reward</span><span class="p">)</span>

        <span class="n">AlgReward</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
            <span class="n">AlgReward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">iter_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_iter</span><span class="p">):</span>
            <span class="n">iter_avg_reward</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
                <span class="n">iter_avg_reward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">user_reward</span> <span class="ow">in</span> <span class="n">all_user_reward</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">]:</span>
                    <span class="n">iter_avg_reward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span> <span class="o">+=</span> <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">][</span><span class="n">algname</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
                <span class="n">AlgReward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iter_avg_reward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">all_user_reward</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
            <span class="n">AlgReward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">AlgReward</span><span class="p">[</span><span class="n">algname</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">AlgReward</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">Users</span> <span class="o">=</span> <span class="n">UserManager</span><span class="p">(</span><span class="n">dir_path</span> <span class="o">+</span> <span class="s1">&#39;/user_info.pkl&#39;</span><span class="p">)</span>
    <span class="n">Items</span> <span class="o">=</span> <span class="n">ItemManager</span><span class="p">(</span><span class="n">dir_path</span> <span class="o">+</span> <span class="s1">&#39;/item_info.pkl&#39;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">dir_path</span>  <span class="o">+</span> <span class="s1">&#39;tree/&#39;</span> <span class="o">+</span> <span class="n">cfg</span><span class="o">.</span><span class="n">new_tree_file</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
    <span class="n">Users</span><span class="o">.</span><span class="n">load_users</span><span class="p">()</span>
    <span class="n">Items</span><span class="o">.</span><span class="n">load_items</span><span class="p">()</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">log_config</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;number of users = </span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Users</span><span class="o">.</span><span class="n">n_users</span><span class="p">))</span>
    <span class="n">simiExp</span> <span class="o">=</span> <span class="n">simulateExp</span><span class="p">(</span><span class="n">Users</span><span class="o">.</span><span class="n">users</span><span class="p">,</span><span class="n">Items</span><span class="o">.</span><span class="n">items</span><span class="p">,</span><span class="n">root</span><span class="p">,</span><span class="n">dir_path</span><span class="p">,</span><span class="n">cfg</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">leafNodes</span> <span class="o">=</span> <span class="n">simiExp</span><span class="o">.</span><span class="n">get_leafNodes</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">categoryNodes</span> <span class="o">=</span> <span class="n">simiExp</span><span class="o">.</span><span class="n">get_categoryNodes</span><span class="p">()</span>
    <span class="n">algorithms</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">algorithms</span><span class="p">[</span><span class="s1">&#39;hcb&#39;</span><span class="p">]</span>            <span class="o">=</span> <span class="n">HCB</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">linucb_para</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
    <span class="n">algorithms</span><span class="p">[</span><span class="s1">&#39;phcb&#39;</span><span class="p">]</span>           <span class="o">=</span> <span class="n">pHCB</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">linucb_para</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
    <span class="n">algorithms</span><span class="p">[</span><span class="s1">&#39;naive_linucb&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">NaiveLinUCB</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">linucb_para</span><span class="p">)</span>
    <span class="n">algorithms</span><span class="p">[</span><span class="s1">&#39;linucb_leaf&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">CLinUCB</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">linucb_para</span><span class="p">,</span><span class="n">leafNodes</span><span class="p">)</span>
    <span class="n">algorithms</span><span class="p">[</span><span class="s1">&#39;linucb_category&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">CLinUCB</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">linucb_para</span><span class="p">,</span><span class="n">categoryNodes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current algorithms = &#39;</span><span class="p">,</span><span class="n">algorithms</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">AlgReward</span> <span class="o">=</span> <span class="n">simiExp</span><span class="o">.</span><span class="n">run_algorithms</span><span class="p">(</span><span class="n">algorithms</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">iter_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">iter_</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">iter_</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">10</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;iter = </span><span class="si">{:d}</span><span class="s1"> alg = </span><span class="si">{}</span><span class="s1"> cumulate_reward = </span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">iter_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">algname</span><span class="p">,</span><span class="n">AlgReward</span><span class="p">[</span><span class="n">algname</span><span class="p">][</span><span class="n">iter_</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>21-12-11 06:54:10.074 - INFO: dataset : MIND
21-12-11 06:54:10.076 - INFO: T : 1000
21-12-11 06:54:10.077 - INFO: k : 1
21-12-11 06:54:10.079 - INFO: activate_num : 10
21-12-11 06:54:10.082 - INFO: activate_prob : 0.1
21-12-11 06:54:10.086 - INFO: epsilon : 0.05
21-12-11 06:54:10.087 - INFO: new_tree_file : 1000_10_btree.pkl
21-12-11 06:54:10.090 - INFO: noise_scale : 0.001
21-12-11 06:54:10.092 - INFO: keep_prob : 0.0001
21-12-11 06:54:10.095 - INFO: linucb_para : {&#39;alpha&#39;: 0.5}
21-12-11 06:54:10.105 - INFO: poolsize : 50
21-12-11 06:54:10.112 - INFO: random_choice : False
21-12-11 06:54:10.113 - INFO: number of users = 4
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>current algorithms =  dict_keys([&#39;hcb&#39;, &#39;phcb&#39;, &#39;naive_linucb&#39;, &#39;linucb_leaf&#39;, &#39;linucb_category&#39;])
run algorithms
[simulationPerUser] uid: 702071, process_id: 345
[simulationPerUser] uid: 704098, process_id: 346
[simulationPerUser] uid: 730858, process_id: 347
[simulationPerUser] uid: 735718, process_id: 348
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>21-12-11 06:55:56.384 - INFO: iter = 1 alg = hcb cumulate_reward = 0.000
21-12-11 06:55:56.385 - INFO: iter = 1 alg = phcb cumulate_reward = 0.005
21-12-11 06:55:56.388 - INFO: iter = 1 alg = naive_linucb cumulate_reward = 0.008
21-12-11 06:55:56.389 - INFO: iter = 1 alg = linucb_leaf cumulate_reward = 0.016
21-12-11 06:55:56.391 - INFO: iter = 1 alg = linucb_category cumulate_reward = 0.055
21-12-11 06:55:56.393 - INFO: iter = 10 alg = hcb cumulate_reward = 1.167
21-12-11 06:55:56.395 - INFO: iter = 10 alg = phcb cumulate_reward = 1.028
21-12-11 06:55:56.397 - INFO: iter = 10 alg = naive_linucb cumulate_reward = 1.153
21-12-11 06:55:56.398 - INFO: iter = 10 alg = linucb_leaf cumulate_reward = 0.753
21-12-11 06:55:56.399 - INFO: iter = 10 alg = linucb_category cumulate_reward = 0.830
21-12-11 06:55:56.400 - INFO: iter = 20 alg = hcb cumulate_reward = 2.059
21-12-11 06:55:56.401 - INFO: iter = 20 alg = phcb cumulate_reward = 2.673
21-12-11 06:55:56.402 - INFO: iter = 20 alg = naive_linucb cumulate_reward = 2.112
21-12-11 06:55:56.403 - INFO: iter = 20 alg = linucb_leaf cumulate_reward = 1.577
21-12-11 06:55:56.404 - INFO: iter = 20 alg = linucb_category cumulate_reward = 1.666
21-12-11 06:55:56.405 - INFO: iter = 30 alg = hcb cumulate_reward = 3.398
21-12-11 06:55:56.406 - INFO: iter = 30 alg = phcb cumulate_reward = 3.554
21-12-11 06:55:56.407 - INFO: iter = 30 alg = naive_linucb cumulate_reward = 2.767
21-12-11 06:55:56.408 - INFO: iter = 30 alg = linucb_leaf cumulate_reward = 2.908
21-12-11 06:55:56.410 - INFO: iter = 30 alg = linucb_category cumulate_reward = 2.299
21-12-11 06:55:56.412 - INFO: iter = 40 alg = hcb cumulate_reward = 4.826
21-12-11 06:55:56.413 - INFO: iter = 40 alg = phcb cumulate_reward = 4.899
21-12-11 06:55:56.414 - INFO: iter = 40 alg = naive_linucb cumulate_reward = 4.064
21-12-11 06:55:56.415 - INFO: iter = 40 alg = linucb_leaf cumulate_reward = 3.645
21-12-11 06:55:56.416 - INFO: iter = 40 alg = linucb_category cumulate_reward = 3.198
21-12-11 06:55:56.418 - INFO: iter = 50 alg = hcb cumulate_reward = 6.195
21-12-11 06:55:56.419 - INFO: iter = 50 alg = phcb cumulate_reward = 6.101
21-12-11 06:55:56.420 - INFO: iter = 50 alg = naive_linucb cumulate_reward = 4.839
21-12-11 06:55:56.421 - INFO: iter = 50 alg = linucb_leaf cumulate_reward = 4.702
21-12-11 06:55:56.422 - INFO: iter = 50 alg = linucb_category cumulate_reward = 3.786
21-12-11 06:55:56.423 - INFO: iter = 60 alg = hcb cumulate_reward = 7.495
21-12-11 06:55:56.424 - INFO: iter = 60 alg = phcb cumulate_reward = 8.194
21-12-11 06:55:56.426 - INFO: iter = 60 alg = naive_linucb cumulate_reward = 5.848
21-12-11 06:55:56.427 - INFO: iter = 60 alg = linucb_leaf cumulate_reward = 5.867
21-12-11 06:55:56.428 - INFO: iter = 60 alg = linucb_category cumulate_reward = 4.415
21-12-11 06:55:56.429 - INFO: iter = 70 alg = hcb cumulate_reward = 9.205
21-12-11 06:55:56.430 - INFO: iter = 70 alg = phcb cumulate_reward = 10.481
21-12-11 06:55:56.431 - INFO: iter = 70 alg = naive_linucb cumulate_reward = 6.898
21-12-11 06:55:56.433 - INFO: iter = 70 alg = linucb_leaf cumulate_reward = 7.704
21-12-11 06:55:56.437 - INFO: iter = 70 alg = linucb_category cumulate_reward = 5.823
21-12-11 06:55:56.438 - INFO: iter = 80 alg = hcb cumulate_reward = 11.729
21-12-11 06:55:56.439 - INFO: iter = 80 alg = phcb cumulate_reward = 13.474
21-12-11 06:55:56.441 - INFO: iter = 80 alg = naive_linucb cumulate_reward = 8.456
21-12-11 06:55:56.442 - INFO: iter = 80 alg = linucb_leaf cumulate_reward = 9.285
21-12-11 06:55:56.443 - INFO: iter = 80 alg = linucb_category cumulate_reward = 7.329
21-12-11 06:55:56.444 - INFO: iter = 90 alg = hcb cumulate_reward = 15.356
21-12-11 06:55:56.445 - INFO: iter = 90 alg = phcb cumulate_reward = 17.351
21-12-11 06:55:56.446 - INFO: iter = 90 alg = naive_linucb cumulate_reward = 10.830
21-12-11 06:55:56.448 - INFO: iter = 90 alg = linucb_leaf cumulate_reward = 11.303
21-12-11 06:55:56.449 - INFO: iter = 90 alg = linucb_category cumulate_reward = 9.554
21-12-11 06:55:56.450 - INFO: iter = 100 alg = hcb cumulate_reward = 20.085
21-12-11 06:55:56.452 - INFO: iter = 100 alg = phcb cumulate_reward = 21.814
21-12-11 06:55:56.453 - INFO: iter = 100 alg = naive_linucb cumulate_reward = 12.649
21-12-11 06:55:56.454 - INFO: iter = 100 alg = linucb_leaf cumulate_reward = 13.645
21-12-11 06:55:56.455 - INFO: iter = 100 alg = linucb_category cumulate_reward = 12.675
21-12-11 06:55:56.457 - INFO: iter = 110 alg = hcb cumulate_reward = 24.431
21-12-11 06:55:56.458 - INFO: iter = 110 alg = phcb cumulate_reward = 25.831
21-12-11 06:55:56.459 - INFO: iter = 110 alg = naive_linucb cumulate_reward = 14.373
21-12-11 06:55:56.460 - INFO: iter = 110 alg = linucb_leaf cumulate_reward = 16.587
21-12-11 06:55:56.461 - INFO: iter = 110 alg = linucb_category cumulate_reward = 15.995
21-12-11 06:55:56.462 - INFO: iter = 120 alg = hcb cumulate_reward = 29.748
21-12-11 06:55:56.464 - INFO: iter = 120 alg = phcb cumulate_reward = 30.041
21-12-11 06:55:56.466 - INFO: iter = 120 alg = naive_linucb cumulate_reward = 16.556
21-12-11 06:55:56.467 - INFO: iter = 120 alg = linucb_leaf cumulate_reward = 20.033
21-12-11 06:55:56.468 - INFO: iter = 120 alg = linucb_category cumulate_reward = 19.023
21-12-11 06:55:56.469 - INFO: iter = 130 alg = hcb cumulate_reward = 34.510
21-12-11 06:55:56.470 - INFO: iter = 130 alg = phcb cumulate_reward = 36.062
21-12-11 06:55:56.471 - INFO: iter = 130 alg = naive_linucb cumulate_reward = 18.927
21-12-11 06:55:56.472 - INFO: iter = 130 alg = linucb_leaf cumulate_reward = 23.496
21-12-11 06:55:56.473 - INFO: iter = 130 alg = linucb_category cumulate_reward = 23.143
21-12-11 06:55:56.473 - INFO: iter = 140 alg = hcb cumulate_reward = 40.302
21-12-11 06:55:56.475 - INFO: iter = 140 alg = phcb cumulate_reward = 41.874
21-12-11 06:55:56.476 - INFO: iter = 140 alg = naive_linucb cumulate_reward = 21.837
21-12-11 06:55:56.477 - INFO: iter = 140 alg = linucb_leaf cumulate_reward = 27.991
21-12-11 06:55:56.479 - INFO: iter = 140 alg = linucb_category cumulate_reward = 27.120
21-12-11 06:55:56.480 - INFO: iter = 150 alg = hcb cumulate_reward = 46.511
21-12-11 06:55:56.481 - INFO: iter = 150 alg = phcb cumulate_reward = 47.808
21-12-11 06:55:56.483 - INFO: iter = 150 alg = naive_linucb cumulate_reward = 25.099
21-12-11 06:55:56.486 - INFO: iter = 150 alg = linucb_leaf cumulate_reward = 32.739
21-12-11 06:55:56.487 - INFO: iter = 150 alg = linucb_category cumulate_reward = 30.584
21-12-11 06:55:56.488 - INFO: iter = 160 alg = hcb cumulate_reward = 52.096
21-12-11 06:55:56.489 - INFO: iter = 160 alg = phcb cumulate_reward = 54.343
21-12-11 06:55:56.490 - INFO: iter = 160 alg = naive_linucb cumulate_reward = 27.984
21-12-11 06:55:56.491 - INFO: iter = 160 alg = linucb_leaf cumulate_reward = 37.454
21-12-11 06:55:56.492 - INFO: iter = 160 alg = linucb_category cumulate_reward = 34.935
21-12-11 06:55:56.493 - INFO: iter = 170 alg = hcb cumulate_reward = 58.886
21-12-11 06:55:56.495 - INFO: iter = 170 alg = phcb cumulate_reward = 60.806
21-12-11 06:55:56.496 - INFO: iter = 170 alg = naive_linucb cumulate_reward = 31.402
21-12-11 06:55:56.497 - INFO: iter = 170 alg = linucb_leaf cumulate_reward = 41.700
21-12-11 06:55:56.498 - INFO: iter = 170 alg = linucb_category cumulate_reward = 38.711
21-12-11 06:55:56.499 - INFO: iter = 180 alg = hcb cumulate_reward = 65.741
21-12-11 06:55:56.500 - INFO: iter = 180 alg = phcb cumulate_reward = 68.064
21-12-11 06:55:56.501 - INFO: iter = 180 alg = naive_linucb cumulate_reward = 34.206
21-12-11 06:55:56.502 - INFO: iter = 180 alg = linucb_leaf cumulate_reward = 46.454
21-12-11 06:55:56.503 - INFO: iter = 180 alg = linucb_category cumulate_reward = 42.142
21-12-11 06:55:56.504 - INFO: iter = 190 alg = hcb cumulate_reward = 72.871
21-12-11 06:55:56.505 - INFO: iter = 190 alg = phcb cumulate_reward = 74.933
21-12-11 06:55:56.507 - INFO: iter = 190 alg = naive_linucb cumulate_reward = 37.035
21-12-11 06:55:56.508 - INFO: iter = 190 alg = linucb_leaf cumulate_reward = 51.903
21-12-11 06:55:56.509 - INFO: iter = 190 alg = linucb_category cumulate_reward = 45.472
21-12-11 06:55:56.510 - INFO: iter = 200 alg = hcb cumulate_reward = 79.590
21-12-11 06:55:56.511 - INFO: iter = 200 alg = phcb cumulate_reward = 82.178
21-12-11 06:55:56.512 - INFO: iter = 200 alg = naive_linucb cumulate_reward = 40.377
21-12-11 06:55:56.513 - INFO: iter = 200 alg = linucb_leaf cumulate_reward = 57.353
21-12-11 06:55:56.514 - INFO: iter = 200 alg = linucb_category cumulate_reward = 48.582
21-12-11 06:55:56.515 - INFO: iter = 210 alg = hcb cumulate_reward = 86.056
21-12-11 06:55:56.516 - INFO: iter = 210 alg = phcb cumulate_reward = 88.618
21-12-11 06:55:56.518 - INFO: iter = 210 alg = naive_linucb cumulate_reward = 43.747
21-12-11 06:55:56.519 - INFO: iter = 210 alg = linucb_leaf cumulate_reward = 62.549
21-12-11 06:55:56.519 - INFO: iter = 210 alg = linucb_category cumulate_reward = 52.851
21-12-11 06:55:56.521 - INFO: iter = 220 alg = hcb cumulate_reward = 92.169
21-12-11 06:55:56.522 - INFO: iter = 220 alg = phcb cumulate_reward = 95.544
21-12-11 06:55:56.523 - INFO: iter = 220 alg = naive_linucb cumulate_reward = 47.103
21-12-11 06:55:56.524 - INFO: iter = 220 alg = linucb_leaf cumulate_reward = 67.277
21-12-11 06:55:56.525 - INFO: iter = 220 alg = linucb_category cumulate_reward = 57.345
21-12-11 06:55:56.526 - INFO: iter = 230 alg = hcb cumulate_reward = 98.815
21-12-11 06:55:56.527 - INFO: iter = 230 alg = phcb cumulate_reward = 102.421
21-12-11 06:55:56.528 - INFO: iter = 230 alg = naive_linucb cumulate_reward = 50.376
21-12-11 06:55:56.530 - INFO: iter = 230 alg = linucb_leaf cumulate_reward = 72.385
21-12-11 06:55:56.531 - INFO: iter = 230 alg = linucb_category cumulate_reward = 61.818
21-12-11 06:55:56.532 - INFO: iter = 240 alg = hcb cumulate_reward = 106.011
21-12-11 06:55:56.533 - INFO: iter = 240 alg = phcb cumulate_reward = 108.983
21-12-11 06:55:56.535 - INFO: iter = 240 alg = naive_linucb cumulate_reward = 53.678
21-12-11 06:55:56.536 - INFO: iter = 240 alg = linucb_leaf cumulate_reward = 77.195
21-12-11 06:55:56.538 - INFO: iter = 240 alg = linucb_category cumulate_reward = 67.232
21-12-11 06:55:56.539 - INFO: iter = 250 alg = hcb cumulate_reward = 112.916
21-12-11 06:55:56.540 - INFO: iter = 250 alg = phcb cumulate_reward = 116.260
21-12-11 06:55:56.541 - INFO: iter = 250 alg = naive_linucb cumulate_reward = 57.236
21-12-11 06:55:56.543 - INFO: iter = 250 alg = linucb_leaf cumulate_reward = 82.124
21-12-11 06:55:56.544 - INFO: iter = 250 alg = linucb_category cumulate_reward = 71.969
21-12-11 06:55:56.544 - INFO: iter = 260 alg = hcb cumulate_reward = 119.060
21-12-11 06:55:56.545 - INFO: iter = 260 alg = phcb cumulate_reward = 123.243
21-12-11 06:55:56.547 - INFO: iter = 260 alg = naive_linucb cumulate_reward = 59.950
21-12-11 06:55:56.548 - INFO: iter = 260 alg = linucb_leaf cumulate_reward = 87.740
21-12-11 06:55:56.550 - INFO: iter = 260 alg = linucb_category cumulate_reward = 76.101
21-12-11 06:55:56.551 - INFO: iter = 270 alg = hcb cumulate_reward = 126.245
21-12-11 06:55:56.552 - INFO: iter = 270 alg = phcb cumulate_reward = 130.662
21-12-11 06:55:56.553 - INFO: iter = 270 alg = naive_linucb cumulate_reward = 63.867
21-12-11 06:55:56.554 - INFO: iter = 270 alg = linucb_leaf cumulate_reward = 92.914
21-12-11 06:55:56.555 - INFO: iter = 270 alg = linucb_category cumulate_reward = 81.157
21-12-11 06:55:56.556 - INFO: iter = 280 alg = hcb cumulate_reward = 132.960
21-12-11 06:55:56.557 - INFO: iter = 280 alg = phcb cumulate_reward = 137.311
21-12-11 06:55:56.558 - INFO: iter = 280 alg = naive_linucb cumulate_reward = 67.355
21-12-11 06:55:56.559 - INFO: iter = 280 alg = linucb_leaf cumulate_reward = 98.101
21-12-11 06:55:56.560 - INFO: iter = 280 alg = linucb_category cumulate_reward = 86.082
21-12-11 06:55:56.561 - INFO: iter = 290 alg = hcb cumulate_reward = 140.493
21-12-11 06:55:56.562 - INFO: iter = 290 alg = phcb cumulate_reward = 144.308
21-12-11 06:55:56.563 - INFO: iter = 290 alg = naive_linucb cumulate_reward = 71.751
21-12-11 06:55:56.564 - INFO: iter = 290 alg = linucb_leaf cumulate_reward = 103.706
21-12-11 06:55:56.564 - INFO: iter = 290 alg = linucb_category cumulate_reward = 90.708
21-12-11 06:55:56.565 - INFO: iter = 300 alg = hcb cumulate_reward = 146.771
21-12-11 06:55:56.567 - INFO: iter = 300 alg = phcb cumulate_reward = 150.681
21-12-11 06:55:56.568 - INFO: iter = 300 alg = naive_linucb cumulate_reward = 75.365
21-12-11 06:55:56.569 - INFO: iter = 300 alg = linucb_leaf cumulate_reward = 108.966
21-12-11 06:55:56.570 - INFO: iter = 300 alg = linucb_category cumulate_reward = 95.219
21-12-11 06:55:56.571 - INFO: iter = 310 alg = hcb cumulate_reward = 153.161
21-12-11 06:55:56.572 - INFO: iter = 310 alg = phcb cumulate_reward = 158.389
21-12-11 06:55:56.573 - INFO: iter = 310 alg = naive_linucb cumulate_reward = 78.823
21-12-11 06:55:56.574 - INFO: iter = 310 alg = linucb_leaf cumulate_reward = 115.060
21-12-11 06:55:56.575 - INFO: iter = 310 alg = linucb_category cumulate_reward = 99.832
21-12-11 06:55:56.576 - INFO: iter = 320 alg = hcb cumulate_reward = 159.733
21-12-11 06:55:56.577 - INFO: iter = 320 alg = phcb cumulate_reward = 165.773
21-12-11 06:55:56.603 - INFO: iter = 320 alg = naive_linucb cumulate_reward = 83.069
21-12-11 06:55:56.605 - INFO: iter = 320 alg = linucb_leaf cumulate_reward = 120.973
21-12-11 06:55:56.606 - INFO: iter = 320 alg = linucb_category cumulate_reward = 104.863
21-12-11 06:55:56.608 - INFO: iter = 330 alg = hcb cumulate_reward = 166.756
21-12-11 06:55:56.610 - INFO: iter = 330 alg = phcb cumulate_reward = 173.535
21-12-11 06:55:56.612 - INFO: iter = 330 alg = naive_linucb cumulate_reward = 86.730
21-12-11 06:55:56.613 - INFO: iter = 330 alg = linucb_leaf cumulate_reward = 127.000
21-12-11 06:55:56.615 - INFO: iter = 330 alg = linucb_category cumulate_reward = 109.960
21-12-11 06:55:56.617 - INFO: iter = 340 alg = hcb cumulate_reward = 173.788
21-12-11 06:55:56.619 - INFO: iter = 340 alg = phcb cumulate_reward = 181.477
21-12-11 06:55:56.620 - INFO: iter = 340 alg = naive_linucb cumulate_reward = 90.401
21-12-11 06:55:56.622 - INFO: iter = 340 alg = linucb_leaf cumulate_reward = 133.100
21-12-11 06:55:56.626 - INFO: iter = 340 alg = linucb_category cumulate_reward = 115.386
21-12-11 06:55:56.627 - INFO: iter = 350 alg = hcb cumulate_reward = 181.230
21-12-11 06:55:56.629 - INFO: iter = 350 alg = phcb cumulate_reward = 188.550
21-12-11 06:55:56.630 - INFO: iter = 350 alg = naive_linucb cumulate_reward = 94.055
21-12-11 06:55:56.634 - INFO: iter = 350 alg = linucb_leaf cumulate_reward = 138.550
21-12-11 06:55:56.635 - INFO: iter = 350 alg = linucb_category cumulate_reward = 120.540
21-12-11 06:55:56.636 - INFO: iter = 360 alg = hcb cumulate_reward = 188.784
21-12-11 06:55:56.637 - INFO: iter = 360 alg = phcb cumulate_reward = 196.105
21-12-11 06:55:56.638 - INFO: iter = 360 alg = naive_linucb cumulate_reward = 98.119
21-12-11 06:55:56.639 - INFO: iter = 360 alg = linucb_leaf cumulate_reward = 144.134
21-12-11 06:55:56.640 - INFO: iter = 360 alg = linucb_category cumulate_reward = 124.932
21-12-11 06:55:56.641 - INFO: iter = 370 alg = hcb cumulate_reward = 196.134
21-12-11 06:55:56.642 - INFO: iter = 370 alg = phcb cumulate_reward = 203.613
21-12-11 06:55:56.643 - INFO: iter = 370 alg = naive_linucb cumulate_reward = 102.055
21-12-11 06:55:56.644 - INFO: iter = 370 alg = linucb_leaf cumulate_reward = 150.435
21-12-11 06:55:56.645 - INFO: iter = 370 alg = linucb_category cumulate_reward = 129.574
21-12-11 06:55:56.646 - INFO: iter = 380 alg = hcb cumulate_reward = 202.969
21-12-11 06:55:56.647 - INFO: iter = 380 alg = phcb cumulate_reward = 211.808
21-12-11 06:55:56.648 - INFO: iter = 380 alg = naive_linucb cumulate_reward = 106.272
21-12-11 06:55:56.649 - INFO: iter = 380 alg = linucb_leaf cumulate_reward = 156.308
21-12-11 06:55:56.650 - INFO: iter = 380 alg = linucb_category cumulate_reward = 134.437
21-12-11 06:55:56.651 - INFO: iter = 390 alg = hcb cumulate_reward = 210.053
21-12-11 06:55:56.652 - INFO: iter = 390 alg = phcb cumulate_reward = 219.907
21-12-11 06:55:56.653 - INFO: iter = 390 alg = naive_linucb cumulate_reward = 110.089
21-12-11 06:55:56.654 - INFO: iter = 390 alg = linucb_leaf cumulate_reward = 162.504
21-12-11 06:55:56.655 - INFO: iter = 390 alg = linucb_category cumulate_reward = 139.296
21-12-11 06:55:56.656 - INFO: iter = 400 alg = hcb cumulate_reward = 216.965
21-12-11 06:55:56.657 - INFO: iter = 400 alg = phcb cumulate_reward = 227.788
21-12-11 06:55:56.659 - INFO: iter = 400 alg = naive_linucb cumulate_reward = 113.838
21-12-11 06:55:56.659 - INFO: iter = 400 alg = linucb_leaf cumulate_reward = 168.512
21-12-11 06:55:56.661 - INFO: iter = 400 alg = linucb_category cumulate_reward = 144.530
21-12-11 06:55:56.661 - INFO: iter = 410 alg = hcb cumulate_reward = 223.744
21-12-11 06:55:56.663 - INFO: iter = 410 alg = phcb cumulate_reward = 235.806
21-12-11 06:55:56.663 - INFO: iter = 410 alg = naive_linucb cumulate_reward = 117.656
21-12-11 06:55:56.664 - INFO: iter = 410 alg = linucb_leaf cumulate_reward = 176.057
21-12-11 06:55:56.665 - INFO: iter = 410 alg = linucb_category cumulate_reward = 149.588
21-12-11 06:55:56.666 - INFO: iter = 420 alg = hcb cumulate_reward = 230.789
21-12-11 06:55:56.667 - INFO: iter = 420 alg = phcb cumulate_reward = 244.078
21-12-11 06:55:56.668 - INFO: iter = 420 alg = naive_linucb cumulate_reward = 121.668
21-12-11 06:55:56.669 - INFO: iter = 420 alg = linucb_leaf cumulate_reward = 182.241
21-12-11 06:55:56.671 - INFO: iter = 420 alg = linucb_category cumulate_reward = 154.919
21-12-11 06:55:56.672 - INFO: iter = 430 alg = hcb cumulate_reward = 237.882
21-12-11 06:55:56.674 - INFO: iter = 430 alg = phcb cumulate_reward = 251.990
21-12-11 06:55:56.675 - INFO: iter = 430 alg = naive_linucb cumulate_reward = 125.960
21-12-11 06:55:56.676 - INFO: iter = 430 alg = linucb_leaf cumulate_reward = 188.700
21-12-11 06:55:56.677 - INFO: iter = 430 alg = linucb_category cumulate_reward = 161.058
21-12-11 06:55:56.678 - INFO: iter = 440 alg = hcb cumulate_reward = 244.806
21-12-11 06:55:56.679 - INFO: iter = 440 alg = phcb cumulate_reward = 259.949
21-12-11 06:55:56.680 - INFO: iter = 440 alg = naive_linucb cumulate_reward = 129.093
21-12-11 06:55:56.681 - INFO: iter = 440 alg = linucb_leaf cumulate_reward = 194.830
21-12-11 06:55:56.682 - INFO: iter = 440 alg = linucb_category cumulate_reward = 166.228
21-12-11 06:55:56.683 - INFO: iter = 450 alg = hcb cumulate_reward = 251.403
21-12-11 06:55:56.684 - INFO: iter = 450 alg = phcb cumulate_reward = 267.385
21-12-11 06:55:56.685 - INFO: iter = 450 alg = naive_linucb cumulate_reward = 133.270
21-12-11 06:55:56.686 - INFO: iter = 450 alg = linucb_leaf cumulate_reward = 201.460
21-12-11 06:55:56.687 - INFO: iter = 450 alg = linucb_category cumulate_reward = 171.854
21-12-11 06:55:56.688 - INFO: iter = 460 alg = hcb cumulate_reward = 258.982
21-12-11 06:55:56.689 - INFO: iter = 460 alg = phcb cumulate_reward = 274.784
21-12-11 06:55:56.690 - INFO: iter = 460 alg = naive_linucb cumulate_reward = 137.243
21-12-11 06:55:56.691 - INFO: iter = 460 alg = linucb_leaf cumulate_reward = 207.983
21-12-11 06:55:56.692 - INFO: iter = 460 alg = linucb_category cumulate_reward = 176.741
21-12-11 06:55:56.693 - INFO: iter = 470 alg = hcb cumulate_reward = 266.287
21-12-11 06:55:56.695 - INFO: iter = 470 alg = phcb cumulate_reward = 282.866
21-12-11 06:55:56.696 - INFO: iter = 470 alg = naive_linucb cumulate_reward = 141.650
21-12-11 06:55:56.697 - INFO: iter = 470 alg = linucb_leaf cumulate_reward = 213.617
21-12-11 06:55:56.698 - INFO: iter = 470 alg = linucb_category cumulate_reward = 182.312
21-12-11 06:55:56.699 - INFO: iter = 480 alg = hcb cumulate_reward = 273.388
21-12-11 06:55:56.700 - INFO: iter = 480 alg = phcb cumulate_reward = 291.047
21-12-11 06:55:56.701 - INFO: iter = 480 alg = naive_linucb cumulate_reward = 145.242
21-12-11 06:55:56.702 - INFO: iter = 480 alg = linucb_leaf cumulate_reward = 219.433
21-12-11 06:55:56.703 - INFO: iter = 480 alg = linucb_category cumulate_reward = 187.926
21-12-11 06:55:56.704 - INFO: iter = 490 alg = hcb cumulate_reward = 280.450
21-12-11 06:55:56.705 - INFO: iter = 490 alg = phcb cumulate_reward = 299.121
21-12-11 06:55:56.706 - INFO: iter = 490 alg = naive_linucb cumulate_reward = 149.529
21-12-11 06:55:56.707 - INFO: iter = 490 alg = linucb_leaf cumulate_reward = 225.427
21-12-11 06:55:56.708 - INFO: iter = 490 alg = linucb_category cumulate_reward = 193.758
21-12-11 06:55:56.709 - INFO: iter = 500 alg = hcb cumulate_reward = 287.360
21-12-11 06:55:56.710 - INFO: iter = 500 alg = phcb cumulate_reward = 306.677
21-12-11 06:55:56.711 - INFO: iter = 500 alg = naive_linucb cumulate_reward = 153.920
21-12-11 06:55:56.712 - INFO: iter = 500 alg = linucb_leaf cumulate_reward = 231.245
21-12-11 06:55:56.713 - INFO: iter = 500 alg = linucb_category cumulate_reward = 199.428
21-12-11 06:55:56.714 - INFO: iter = 510 alg = hcb cumulate_reward = 294.429
21-12-11 06:55:56.715 - INFO: iter = 510 alg = phcb cumulate_reward = 314.555
21-12-11 06:55:56.716 - INFO: iter = 510 alg = naive_linucb cumulate_reward = 157.889
21-12-11 06:55:56.717 - INFO: iter = 510 alg = linucb_leaf cumulate_reward = 237.094
21-12-11 06:55:56.718 - INFO: iter = 510 alg = linucb_category cumulate_reward = 205.330
21-12-11 06:55:56.719 - INFO: iter = 520 alg = hcb cumulate_reward = 301.028
21-12-11 06:55:56.720 - INFO: iter = 520 alg = phcb cumulate_reward = 323.099
21-12-11 06:55:56.721 - INFO: iter = 520 alg = naive_linucb cumulate_reward = 161.525
21-12-11 06:55:56.721 - INFO: iter = 520 alg = linucb_leaf cumulate_reward = 243.647
21-12-11 06:55:56.722 - INFO: iter = 520 alg = linucb_category cumulate_reward = 210.376
21-12-11 06:55:56.723 - INFO: iter = 530 alg = hcb cumulate_reward = 307.653
21-12-11 06:55:56.724 - INFO: iter = 530 alg = phcb cumulate_reward = 330.813
21-12-11 06:55:56.725 - INFO: iter = 530 alg = naive_linucb cumulate_reward = 165.544
21-12-11 06:55:56.726 - INFO: iter = 530 alg = linucb_leaf cumulate_reward = 250.172
21-12-11 06:55:56.728 - INFO: iter = 530 alg = linucb_category cumulate_reward = 215.749
21-12-11 06:55:56.728 - INFO: iter = 540 alg = hcb cumulate_reward = 315.246
21-12-11 06:55:56.729 - INFO: iter = 540 alg = phcb cumulate_reward = 338.830
21-12-11 06:55:56.731 - INFO: iter = 540 alg = naive_linucb cumulate_reward = 169.202
21-12-11 06:55:56.732 - INFO: iter = 540 alg = linucb_leaf cumulate_reward = 256.391
21-12-11 06:55:56.733 - INFO: iter = 540 alg = linucb_category cumulate_reward = 221.299
21-12-11 06:55:56.734 - INFO: iter = 550 alg = hcb cumulate_reward = 322.992
21-12-11 06:55:56.735 - INFO: iter = 550 alg = phcb cumulate_reward = 347.144
21-12-11 06:55:56.736 - INFO: iter = 550 alg = naive_linucb cumulate_reward = 173.203
21-12-11 06:55:56.737 - INFO: iter = 550 alg = linucb_leaf cumulate_reward = 263.300
21-12-11 06:55:56.738 - INFO: iter = 550 alg = linucb_category cumulate_reward = 226.731
21-12-11 06:55:56.739 - INFO: iter = 560 alg = hcb cumulate_reward = 330.300
21-12-11 06:55:56.740 - INFO: iter = 560 alg = phcb cumulate_reward = 355.052
21-12-11 06:55:56.741 - INFO: iter = 560 alg = naive_linucb cumulate_reward = 177.272
21-12-11 06:55:56.742 - INFO: iter = 560 alg = linucb_leaf cumulate_reward = 268.928
21-12-11 06:55:56.743 - INFO: iter = 560 alg = linucb_category cumulate_reward = 231.382
21-12-11 06:55:56.744 - INFO: iter = 570 alg = hcb cumulate_reward = 337.142
21-12-11 06:55:56.745 - INFO: iter = 570 alg = phcb cumulate_reward = 363.016
21-12-11 06:55:56.746 - INFO: iter = 570 alg = naive_linucb cumulate_reward = 181.085
21-12-11 06:55:56.747 - INFO: iter = 570 alg = linucb_leaf cumulate_reward = 275.130
21-12-11 06:55:56.748 - INFO: iter = 570 alg = linucb_category cumulate_reward = 236.741
21-12-11 06:55:56.749 - INFO: iter = 580 alg = hcb cumulate_reward = 344.087
21-12-11 06:55:56.750 - INFO: iter = 580 alg = phcb cumulate_reward = 370.756
21-12-11 06:55:56.751 - INFO: iter = 580 alg = naive_linucb cumulate_reward = 185.425
21-12-11 06:55:56.752 - INFO: iter = 580 alg = linucb_leaf cumulate_reward = 280.869
21-12-11 06:55:56.753 - INFO: iter = 580 alg = linucb_category cumulate_reward = 241.422
21-12-11 06:55:56.754 - INFO: iter = 590 alg = hcb cumulate_reward = 351.325
21-12-11 06:55:56.755 - INFO: iter = 590 alg = phcb cumulate_reward = 378.738
21-12-11 06:55:56.756 - INFO: iter = 590 alg = naive_linucb cumulate_reward = 189.747
21-12-11 06:55:56.757 - INFO: iter = 590 alg = linucb_leaf cumulate_reward = 287.287
21-12-11 06:55:56.758 - INFO: iter = 590 alg = linucb_category cumulate_reward = 247.135
21-12-11 06:55:56.759 - INFO: iter = 600 alg = hcb cumulate_reward = 358.820
21-12-11 06:55:56.760 - INFO: iter = 600 alg = phcb cumulate_reward = 386.981
21-12-11 06:55:56.761 - INFO: iter = 600 alg = naive_linucb cumulate_reward = 193.487
21-12-11 06:55:56.762 - INFO: iter = 600 alg = linucb_leaf cumulate_reward = 294.102
21-12-11 06:55:56.763 - INFO: iter = 600 alg = linucb_category cumulate_reward = 253.160
21-12-11 06:55:56.764 - INFO: iter = 610 alg = hcb cumulate_reward = 366.447
21-12-11 06:55:56.765 - INFO: iter = 610 alg = phcb cumulate_reward = 394.721
21-12-11 06:55:56.766 - INFO: iter = 610 alg = naive_linucb cumulate_reward = 197.209
21-12-11 06:55:56.767 - INFO: iter = 610 alg = linucb_leaf cumulate_reward = 300.440
21-12-11 06:55:56.768 - INFO: iter = 610 alg = linucb_category cumulate_reward = 258.371
21-12-11 06:55:56.769 - INFO: iter = 620 alg = hcb cumulate_reward = 373.491
21-12-11 06:55:56.770 - INFO: iter = 620 alg = phcb cumulate_reward = 403.113
21-12-11 06:55:56.771 - INFO: iter = 620 alg = naive_linucb cumulate_reward = 201.787
21-12-11 06:55:56.772 - INFO: iter = 620 alg = linucb_leaf cumulate_reward = 306.828
21-12-11 06:55:56.773 - INFO: iter = 620 alg = linucb_category cumulate_reward = 263.695
21-12-11 06:55:56.774 - INFO: iter = 630 alg = hcb cumulate_reward = 380.264
21-12-11 06:55:56.775 - INFO: iter = 630 alg = phcb cumulate_reward = 411.066
21-12-11 06:55:56.776 - INFO: iter = 630 alg = naive_linucb cumulate_reward = 205.313
21-12-11 06:55:56.777 - INFO: iter = 630 alg = linucb_leaf cumulate_reward = 313.361
21-12-11 06:55:56.778 - INFO: iter = 630 alg = linucb_category cumulate_reward = 268.770
21-12-11 06:55:56.779 - INFO: iter = 640 alg = hcb cumulate_reward = 387.853
21-12-11 06:55:56.780 - INFO: iter = 640 alg = phcb cumulate_reward = 419.000
21-12-11 06:55:56.781 - INFO: iter = 640 alg = naive_linucb cumulate_reward = 208.964
21-12-11 06:55:56.782 - INFO: iter = 640 alg = linucb_leaf cumulate_reward = 320.155
21-12-11 06:55:56.782 - INFO: iter = 640 alg = linucb_category cumulate_reward = 273.854
21-12-11 06:55:56.783 - INFO: iter = 650 alg = hcb cumulate_reward = 394.911
21-12-11 06:55:56.784 - INFO: iter = 650 alg = phcb cumulate_reward = 426.614
21-12-11 06:55:56.785 - INFO: iter = 650 alg = naive_linucb cumulate_reward = 213.129
21-12-11 06:55:56.786 - INFO: iter = 650 alg = linucb_leaf cumulate_reward = 326.727
21-12-11 06:55:56.787 - INFO: iter = 650 alg = linucb_category cumulate_reward = 279.061
21-12-11 06:55:56.788 - INFO: iter = 660 alg = hcb cumulate_reward = 402.055
21-12-11 06:55:56.789 - INFO: iter = 660 alg = phcb cumulate_reward = 433.991
21-12-11 06:55:56.790 - INFO: iter = 660 alg = naive_linucb cumulate_reward = 217.636
21-12-11 06:55:56.791 - INFO: iter = 660 alg = linucb_leaf cumulate_reward = 333.509
21-12-11 06:55:56.792 - INFO: iter = 660 alg = linucb_category cumulate_reward = 284.760
21-12-11 06:55:56.793 - INFO: iter = 670 alg = hcb cumulate_reward = 409.609
21-12-11 06:55:56.794 - INFO: iter = 670 alg = phcb cumulate_reward = 441.422
21-12-11 06:55:56.795 - INFO: iter = 670 alg = naive_linucb cumulate_reward = 220.853
21-12-11 06:55:56.796 - INFO: iter = 670 alg = linucb_leaf cumulate_reward = 340.910
21-12-11 06:55:56.797 - INFO: iter = 670 alg = linucb_category cumulate_reward = 290.434
21-12-11 06:55:56.798 - INFO: iter = 680 alg = hcb cumulate_reward = 416.733
21-12-11 06:55:56.799 - INFO: iter = 680 alg = phcb cumulate_reward = 449.422
21-12-11 06:55:56.800 - INFO: iter = 680 alg = naive_linucb cumulate_reward = 224.947
21-12-11 06:55:56.801 - INFO: iter = 680 alg = linucb_leaf cumulate_reward = 347.424
21-12-11 06:55:56.801 - INFO: iter = 680 alg = linucb_category cumulate_reward = 295.628
21-12-11 06:55:56.802 - INFO: iter = 690 alg = hcb cumulate_reward = 423.752
21-12-11 06:55:56.803 - INFO: iter = 690 alg = phcb cumulate_reward = 457.266
21-12-11 06:55:56.804 - INFO: iter = 690 alg = naive_linucb cumulate_reward = 228.558
21-12-11 06:55:56.805 - INFO: iter = 690 alg = linucb_leaf cumulate_reward = 354.771
21-12-11 06:55:56.806 - INFO: iter = 690 alg = linucb_category cumulate_reward = 301.495
21-12-11 06:55:56.807 - INFO: iter = 700 alg = hcb cumulate_reward = 431.289
21-12-11 06:55:56.808 - INFO: iter = 700 alg = phcb cumulate_reward = 464.578
21-12-11 06:55:56.809 - INFO: iter = 700 alg = naive_linucb cumulate_reward = 232.595
21-12-11 06:55:56.810 - INFO: iter = 700 alg = linucb_leaf cumulate_reward = 361.873
21-12-11 06:55:56.811 - INFO: iter = 700 alg = linucb_category cumulate_reward = 307.260
21-12-11 06:55:56.812 - INFO: iter = 710 alg = hcb cumulate_reward = 438.747
21-12-11 06:55:56.813 - INFO: iter = 710 alg = phcb cumulate_reward = 472.908
21-12-11 06:55:56.813 - INFO: iter = 710 alg = naive_linucb cumulate_reward = 236.892
21-12-11 06:55:56.814 - INFO: iter = 710 alg = linucb_leaf cumulate_reward = 368.308
21-12-11 06:55:56.815 - INFO: iter = 710 alg = linucb_category cumulate_reward = 313.113
21-12-11 06:55:56.816 - INFO: iter = 720 alg = hcb cumulate_reward = 445.815
21-12-11 06:55:56.817 - INFO: iter = 720 alg = phcb cumulate_reward = 480.861
21-12-11 06:55:56.818 - INFO: iter = 720 alg = naive_linucb cumulate_reward = 240.910
21-12-11 06:55:56.819 - INFO: iter = 720 alg = linucb_leaf cumulate_reward = 374.985
21-12-11 06:55:56.820 - INFO: iter = 720 alg = linucb_category cumulate_reward = 318.270
21-12-11 06:55:56.821 - INFO: iter = 730 alg = hcb cumulate_reward = 452.928
21-12-11 06:55:56.822 - INFO: iter = 730 alg = phcb cumulate_reward = 489.384
21-12-11 06:55:56.823 - INFO: iter = 730 alg = naive_linucb cumulate_reward = 245.066
21-12-11 06:55:56.824 - INFO: iter = 730 alg = linucb_leaf cumulate_reward = 381.665
21-12-11 06:55:56.825 - INFO: iter = 730 alg = linucb_category cumulate_reward = 323.551
21-12-11 06:55:56.826 - INFO: iter = 740 alg = hcb cumulate_reward = 459.898
21-12-11 06:55:56.827 - INFO: iter = 740 alg = phcb cumulate_reward = 497.399
21-12-11 06:55:56.828 - INFO: iter = 740 alg = naive_linucb cumulate_reward = 249.401
21-12-11 06:55:56.829 - INFO: iter = 740 alg = linucb_leaf cumulate_reward = 387.894
21-12-11 06:55:56.830 - INFO: iter = 740 alg = linucb_category cumulate_reward = 329.623
21-12-11 06:55:56.831 - INFO: iter = 750 alg = hcb cumulate_reward = 467.726
21-12-11 06:55:56.832 - INFO: iter = 750 alg = phcb cumulate_reward = 505.412
21-12-11 06:55:56.833 - INFO: iter = 750 alg = naive_linucb cumulate_reward = 252.801
21-12-11 06:55:56.833 - INFO: iter = 750 alg = linucb_leaf cumulate_reward = 394.941
21-12-11 06:55:56.835 - INFO: iter = 750 alg = linucb_category cumulate_reward = 335.660
21-12-11 06:55:56.836 - INFO: iter = 760 alg = hcb cumulate_reward = 474.818
21-12-11 06:55:56.837 - INFO: iter = 760 alg = phcb cumulate_reward = 513.511
21-12-11 06:55:56.839 - INFO: iter = 760 alg = naive_linucb cumulate_reward = 256.917
21-12-11 06:55:56.840 - INFO: iter = 760 alg = linucb_leaf cumulate_reward = 401.661
21-12-11 06:55:56.841 - INFO: iter = 760 alg = linucb_category cumulate_reward = 341.556
21-12-11 06:55:56.842 - INFO: iter = 770 alg = hcb cumulate_reward = 481.801
21-12-11 06:55:56.843 - INFO: iter = 770 alg = phcb cumulate_reward = 521.684
21-12-11 06:55:56.844 - INFO: iter = 770 alg = naive_linucb cumulate_reward = 260.191
21-12-11 06:55:56.844 - INFO: iter = 770 alg = linucb_leaf cumulate_reward = 408.135
21-12-11 06:55:56.845 - INFO: iter = 770 alg = linucb_category cumulate_reward = 347.167
21-12-11 06:55:56.846 - INFO: iter = 780 alg = hcb cumulate_reward = 488.974
21-12-11 06:55:56.847 - INFO: iter = 780 alg = phcb cumulate_reward = 529.369
21-12-11 06:55:56.848 - INFO: iter = 780 alg = naive_linucb cumulate_reward = 264.072
21-12-11 06:55:56.849 - INFO: iter = 780 alg = linucb_leaf cumulate_reward = 414.429
21-12-11 06:55:56.850 - INFO: iter = 780 alg = linucb_category cumulate_reward = 352.212
21-12-11 06:55:56.851 - INFO: iter = 790 alg = hcb cumulate_reward = 496.246
21-12-11 06:55:56.852 - INFO: iter = 790 alg = phcb cumulate_reward = 537.460
21-12-11 06:55:56.853 - INFO: iter = 790 alg = naive_linucb cumulate_reward = 267.253
21-12-11 06:55:56.854 - INFO: iter = 790 alg = linucb_leaf cumulate_reward = 420.975
21-12-11 06:55:56.855 - INFO: iter = 790 alg = linucb_category cumulate_reward = 358.005
21-12-11 06:55:56.856 - INFO: iter = 800 alg = hcb cumulate_reward = 503.857
21-12-11 06:55:56.857 - INFO: iter = 800 alg = phcb cumulate_reward = 545.298
21-12-11 06:55:56.858 - INFO: iter = 800 alg = naive_linucb cumulate_reward = 271.729
21-12-11 06:55:56.859 - INFO: iter = 800 alg = linucb_leaf cumulate_reward = 427.567
21-12-11 06:55:56.860 - INFO: iter = 800 alg = linucb_category cumulate_reward = 362.534
21-12-11 06:55:56.862 - INFO: iter = 810 alg = hcb cumulate_reward = 511.895
21-12-11 06:55:56.863 - INFO: iter = 810 alg = phcb cumulate_reward = 553.322
21-12-11 06:55:56.864 - INFO: iter = 810 alg = naive_linucb cumulate_reward = 275.885
21-12-11 06:55:56.865 - INFO: iter = 810 alg = linucb_leaf cumulate_reward = 434.171
21-12-11 06:55:56.865 - INFO: iter = 810 alg = linucb_category cumulate_reward = 368.769
21-12-11 06:55:56.866 - INFO: iter = 820 alg = hcb cumulate_reward = 518.877
21-12-11 06:55:56.867 - INFO: iter = 820 alg = phcb cumulate_reward = 561.342
21-12-11 06:55:56.868 - INFO: iter = 820 alg = naive_linucb cumulate_reward = 279.536
21-12-11 06:55:56.869 - INFO: iter = 820 alg = linucb_leaf cumulate_reward = 440.639
21-12-11 06:55:56.870 - INFO: iter = 820 alg = linucb_category cumulate_reward = 374.505
21-12-11 06:55:56.871 - INFO: iter = 830 alg = hcb cumulate_reward = 526.537
21-12-11 06:55:56.872 - INFO: iter = 830 alg = phcb cumulate_reward = 569.177
21-12-11 06:55:56.873 - INFO: iter = 830 alg = naive_linucb cumulate_reward = 283.384
21-12-11 06:55:56.874 - INFO: iter = 830 alg = linucb_leaf cumulate_reward = 447.168
21-12-11 06:55:56.875 - INFO: iter = 830 alg = linucb_category cumulate_reward = 380.420
21-12-11 06:55:56.876 - INFO: iter = 840 alg = hcb cumulate_reward = 534.514
21-12-11 06:55:56.877 - INFO: iter = 840 alg = phcb cumulate_reward = 577.054
21-12-11 06:55:56.878 - INFO: iter = 840 alg = naive_linucb cumulate_reward = 287.572
21-12-11 06:55:56.879 - INFO: iter = 840 alg = linucb_leaf cumulate_reward = 453.069
21-12-11 06:55:56.880 - INFO: iter = 840 alg = linucb_category cumulate_reward = 386.884
21-12-11 06:55:56.881 - INFO: iter = 850 alg = hcb cumulate_reward = 541.935
21-12-11 06:55:56.882 - INFO: iter = 850 alg = phcb cumulate_reward = 585.046
21-12-11 06:55:56.883 - INFO: iter = 850 alg = naive_linucb cumulate_reward = 291.202
21-12-11 06:55:56.884 - INFO: iter = 850 alg = linucb_leaf cumulate_reward = 460.236
21-12-11 06:55:56.885 - INFO: iter = 850 alg = linucb_category cumulate_reward = 393.071
21-12-11 06:55:56.885 - INFO: iter = 860 alg = hcb cumulate_reward = 549.512
21-12-11 06:55:56.886 - INFO: iter = 860 alg = phcb cumulate_reward = 593.145
21-12-11 06:55:56.887 - INFO: iter = 860 alg = naive_linucb cumulate_reward = 295.566
21-12-11 06:55:56.888 - INFO: iter = 860 alg = linucb_leaf cumulate_reward = 467.405
21-12-11 06:55:56.889 - INFO: iter = 860 alg = linucb_category cumulate_reward = 398.903
21-12-11 06:55:56.890 - INFO: iter = 870 alg = hcb cumulate_reward = 556.741
21-12-11 06:55:56.891 - INFO: iter = 870 alg = phcb cumulate_reward = 601.475
21-12-11 06:55:56.892 - INFO: iter = 870 alg = naive_linucb cumulate_reward = 299.481
21-12-11 06:55:56.893 - INFO: iter = 870 alg = linucb_leaf cumulate_reward = 473.971
21-12-11 06:55:56.894 - INFO: iter = 870 alg = linucb_category cumulate_reward = 404.449
21-12-11 06:55:56.895 - INFO: iter = 880 alg = hcb cumulate_reward = 564.633
21-12-11 06:55:56.896 - INFO: iter = 880 alg = phcb cumulate_reward = 609.393
21-12-11 06:55:56.897 - INFO: iter = 880 alg = naive_linucb cumulate_reward = 303.268
21-12-11 06:55:56.898 - INFO: iter = 880 alg = linucb_leaf cumulate_reward = 480.811
21-12-11 06:55:56.899 - INFO: iter = 880 alg = linucb_category cumulate_reward = 410.053
21-12-11 06:55:56.900 - INFO: iter = 890 alg = hcb cumulate_reward = 572.348
21-12-11 06:55:56.901 - INFO: iter = 890 alg = phcb cumulate_reward = 617.134
21-12-11 06:55:56.902 - INFO: iter = 890 alg = naive_linucb cumulate_reward = 307.501
21-12-11 06:55:56.903 - INFO: iter = 890 alg = linucb_leaf cumulate_reward = 487.301
21-12-11 06:55:56.904 - INFO: iter = 890 alg = linucb_category cumulate_reward = 415.829
21-12-11 06:55:56.905 - INFO: iter = 900 alg = hcb cumulate_reward = 580.227
21-12-11 06:55:56.906 - INFO: iter = 900 alg = phcb cumulate_reward = 625.080
21-12-11 06:55:56.907 - INFO: iter = 900 alg = naive_linucb cumulate_reward = 311.004
21-12-11 06:55:56.908 - INFO: iter = 900 alg = linucb_leaf cumulate_reward = 493.429
21-12-11 06:55:56.909 - INFO: iter = 900 alg = linucb_category cumulate_reward = 421.540
21-12-11 06:55:56.910 - INFO: iter = 910 alg = hcb cumulate_reward = 587.097
21-12-11 06:55:56.911 - INFO: iter = 910 alg = phcb cumulate_reward = 632.978
21-12-11 06:55:56.912 - INFO: iter = 910 alg = naive_linucb cumulate_reward = 315.120
21-12-11 06:55:56.913 - INFO: iter = 910 alg = linucb_leaf cumulate_reward = 500.844
21-12-11 06:55:56.914 - INFO: iter = 910 alg = linucb_category cumulate_reward = 426.607
21-12-11 06:55:56.914 - INFO: iter = 920 alg = hcb cumulate_reward = 594.795
21-12-11 06:55:56.915 - INFO: iter = 920 alg = phcb cumulate_reward = 641.219
21-12-11 06:55:56.916 - INFO: iter = 920 alg = naive_linucb cumulate_reward = 319.187
21-12-11 06:55:56.918 - INFO: iter = 920 alg = linucb_leaf cumulate_reward = 507.586
21-12-11 06:55:56.919 - INFO: iter = 920 alg = linucb_category cumulate_reward = 432.801
21-12-11 06:55:56.920 - INFO: iter = 930 alg = hcb cumulate_reward = 602.054
21-12-11 06:55:56.921 - INFO: iter = 930 alg = phcb cumulate_reward = 648.524
21-12-11 06:55:56.922 - INFO: iter = 930 alg = naive_linucb cumulate_reward = 323.093
21-12-11 06:55:56.923 - INFO: iter = 930 alg = linucb_leaf cumulate_reward = 514.074
21-12-11 06:55:56.924 - INFO: iter = 930 alg = linucb_category cumulate_reward = 438.576
21-12-11 06:55:56.925 - INFO: iter = 940 alg = hcb cumulate_reward = 609.080
21-12-11 06:55:56.925 - INFO: iter = 940 alg = phcb cumulate_reward = 656.692
21-12-11 06:55:56.926 - INFO: iter = 940 alg = naive_linucb cumulate_reward = 326.964
21-12-11 06:55:56.927 - INFO: iter = 940 alg = linucb_leaf cumulate_reward = 521.191
21-12-11 06:55:56.928 - INFO: iter = 940 alg = linucb_category cumulate_reward = 444.381
21-12-11 06:55:56.929 - INFO: iter = 950 alg = hcb cumulate_reward = 616.009
21-12-11 06:55:56.930 - INFO: iter = 950 alg = phcb cumulate_reward = 664.489
21-12-11 06:55:56.931 - INFO: iter = 950 alg = naive_linucb cumulate_reward = 331.465
21-12-11 06:55:56.932 - INFO: iter = 950 alg = linucb_leaf cumulate_reward = 528.095
21-12-11 06:55:56.933 - INFO: iter = 950 alg = linucb_category cumulate_reward = 450.056
21-12-11 06:55:56.941 - INFO: iter = 960 alg = hcb cumulate_reward = 622.715
21-12-11 06:55:56.943 - INFO: iter = 960 alg = phcb cumulate_reward = 672.535
21-12-11 06:55:56.944 - INFO: iter = 960 alg = naive_linucb cumulate_reward = 335.934
21-12-11 06:55:56.946 - INFO: iter = 960 alg = linucb_leaf cumulate_reward = 534.514
21-12-11 06:55:56.948 - INFO: iter = 960 alg = linucb_category cumulate_reward = 455.875
21-12-11 06:55:56.953 - INFO: iter = 970 alg = hcb cumulate_reward = 630.854
21-12-11 06:55:56.954 - INFO: iter = 970 alg = phcb cumulate_reward = 680.319
21-12-11 06:55:56.955 - INFO: iter = 970 alg = naive_linucb cumulate_reward = 339.995
21-12-11 06:55:56.956 - INFO: iter = 970 alg = linucb_leaf cumulate_reward = 541.141
21-12-11 06:55:56.957 - INFO: iter = 970 alg = linucb_category cumulate_reward = 461.264
21-12-11 06:55:56.958 - INFO: iter = 980 alg = hcb cumulate_reward = 637.784
21-12-11 06:55:56.959 - INFO: iter = 980 alg = phcb cumulate_reward = 688.707
21-12-11 06:55:56.960 - INFO: iter = 980 alg = naive_linucb cumulate_reward = 343.519
21-12-11 06:55:56.961 - INFO: iter = 980 alg = linucb_leaf cumulate_reward = 547.745
21-12-11 06:55:56.962 - INFO: iter = 980 alg = linucb_category cumulate_reward = 466.952
21-12-11 06:55:56.963 - INFO: iter = 990 alg = hcb cumulate_reward = 645.414
21-12-11 06:55:56.964 - INFO: iter = 990 alg = phcb cumulate_reward = 696.841
21-12-11 06:55:56.965 - INFO: iter = 990 alg = naive_linucb cumulate_reward = 347.785
21-12-11 06:55:56.966 - INFO: iter = 990 alg = linucb_leaf cumulate_reward = 554.635
21-12-11 06:55:56.967 - INFO: iter = 990 alg = linucb_category cumulate_reward = 472.500
21-12-11 06:55:56.968 - INFO: iter = 1000 alg = hcb cumulate_reward = 652.859
21-12-11 06:55:56.969 - INFO: iter = 1000 alg = phcb cumulate_reward = 704.666
21-12-11 06:55:56.970 - INFO: iter = 1000 alg = naive_linucb cumulate_reward = 351.138
21-12-11 06:55:56.971 - INFO: iter = 1000 alg = linucb_leaf cumulate_reward = 561.548
21-12-11 06:55:56.972 - INFO: iter = 1000 alg = linucb_category cumulate_reward = 478.569
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#1013;-greedy">&#1013;-greedy<a class="anchor-link" href="#&#1013;-greedy"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Items">Items<a class="anchor-link" href="#Items"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">Item</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gid</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">bias</span><span class="p">,</span><span class="n">para</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gid</span>     <span class="o">=</span> <span class="n">gid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span>      <span class="o">=</span> <span class="p">{}</span> <span class="c1">#feature vector for training/simulator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x1</span> <span class="c1">#training</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x2</span> <span class="c1">#simulator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bias</span> <span class="c1">#bias</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para</span>    <span class="o">=</span> <span class="n">para</span> <span class="c1">#other info</span>

<span class="k">class</span> <span class="nc">ItemManager</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span>    <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span>   <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_items</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">load_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">item_info</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">j_s</span> <span class="ow">in</span> <span class="n">item_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">gid</span> <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;gid&#39;</span><span class="p">]</span>
            <span class="n">x1</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">]</span>
            <span class="n">x2</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">]</span>
            <span class="n">bias</span><span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span>
            <span class="n">para</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">para</span><span class="p">[</span><span class="s1">&#39;category2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;category2&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">bias</span><span class="p">,</span><span class="n">para</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_items</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Users">Users<a class="anchor-link" href="#Users"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">bias</span><span class="p">,</span><span class="n">para</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span>     <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span>      <span class="o">=</span> <span class="p">{}</span> <span class="c1">#feature vector for training/simulator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x1</span> <span class="c1"># training</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x2</span> <span class="c1"># simulator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bias</span> <span class="c1"># simulator bias</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para</span>    <span class="o">=</span> <span class="n">para</span> <span class="c1">#other info</span>

<span class="k">class</span> <span class="nc">UserManager</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span>    <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span>   <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_users</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">load_users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user_info</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">j_s</span> <span class="ow">in</span> <span class="n">user_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">&gt;</span><span class="n">cfg</span><span class="o">.</span><span class="n">keep_prob</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">uid</span> <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span>
            <span class="n">x1</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">]</span>
            <span class="n">x2</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">]</span>
            <span class="n">bias</span><span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">bias</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_users</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_nnexp_users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">user_info</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        <span class="n">user_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">user_info</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;gini&#39;</span><span class="p">],</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_users</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">user_info</span><span class="p">)</span><span class="o">*</span><span class="n">cfg</span><span class="o">.</span><span class="n">keep_prob</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">uid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">user_info</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">&gt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_users</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">j_s</span> <span class="o">=</span> <span class="n">user_info</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
            <span class="n">uid</span> <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span>
            <span class="n">x1</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">]</span>
            <span class="n">x2</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">]</span>
            <span class="n">bias</span><span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span>
            <span class="n">his</span> <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;his&#39;</span><span class="p">]</span>
            <span class="n">imp</span> <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;imp&#39;</span><span class="p">]</span>
            <span class="n">para</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;his&#39;</span><span class="p">:</span><span class="n">his</span><span class="p">,</span><span class="s1">&#39;imp&#39;</span><span class="p">:</span><span class="n">imp</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">bias</span><span class="p">,</span><span class="n">para</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_users</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Naive-&#1013;-greedy">Naive &#1013;-greedy<a class="anchor-link" href="#Naive-&#1013;-greedy"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">EGUserStructNEG</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vv</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gid</span><span class="p">,</span><span class="n">reward</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">+=</span> <span class="n">reward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vv</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">getProb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gid</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vv</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">vv</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">NaiveEG</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">decide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">=</span><span class="n">EGUserStructNEG</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">arm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arms</span><span class="p">):</span>
            <span class="c1">#each item is an arm</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">getProb</span><span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">gid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reward</span><span class="o">&gt;</span><span class="n">max_r</span><span class="p">:</span>
                <span class="n">aid</span> <span class="o">=</span> <span class="n">index</span>
                <span class="n">max_r</span> <span class="o">=</span> <span class="n">reward</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">epsilon</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">&gt;=</span><span class="n">eps</span><span class="p">:</span>
            <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">arms</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arms</span><span class="p">))</span>
            <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">arms</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">arm_picker</span>


    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">picked_arm</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">uid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">picked_arm</span><span class="o">.</span><span class="n">gid</span><span class="p">,</span><span class="n">reward</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="HCB">HCB<a class="anchor-link" href="#HCB"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">ArmStructHCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_leaf</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gids</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">gids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemclick</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vv</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">UserStructHCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">root</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cfg</span><span class="o">.</span><span class="n">random_choice</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eg</span> <span class="o">=</span> <span class="n">NaiveEG</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">HEGreedy</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">epsilon</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_depth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">new_tree_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">EstimateReward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arm</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">vv</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">reward</span>

    <span class="k">def</span> <span class="nf">build_arm_struct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arm_root</span> <span class="o">=</span> <span class="n">ArmStructHCB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">arm_root</span><span class="p">]</span>
        <span class="k">while</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">new_tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">arm</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">arm</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">arm</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="n">arm_child</span> <span class="o">=</span> <span class="n">ArmStructHCB</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                    <span class="n">arm</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arm_child</span><span class="p">)</span>
                    <span class="n">new_tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arm_child</span><span class="p">)</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">new_tmp</span>
        <span class="k">return</span> <span class="n">arm_root</span>

    <span class="k">def</span> <span class="nf">decide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_arm_struct</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">=</span><span class="n">UserStructHCB</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="n">root</span><span class="p">)</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">current_node</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">root</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">user</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span><span class="p">(</span><span class="n">current_node</span><span class="o">.</span><span class="n">is_leaf</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">children</span> <span class="o">=</span> <span class="n">current_node</span><span class="o">.</span><span class="n">children</span>
            <span class="n">max_r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
            <span class="n">aid</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">poolsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">poolsize</span><span class="p">:</span>
                <span class="n">arms</span> <span class="o">=</span> <span class="n">children</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">),</span><span class="n">poolsize</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">aids</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">arm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arms</span><span class="p">):</span>
                <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EstimateReward</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">reward</span><span class="o">&gt;</span><span class="n">max_r</span><span class="p">:</span>
                    <span class="n">aid</span> <span class="o">=</span> <span class="n">index</span>
                    <span class="n">max_r</span> <span class="o">=</span> <span class="n">reward</span>
            <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">arms</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span>
            <span class="n">user</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arm_picker</span><span class="p">)</span>
            <span class="n">current_node</span> <span class="o">=</span> <span class="n">arm_picker</span>
            <span class="n">depth</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">arm_picker</span><span class="p">,</span><span class="n">aid</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">feedback</span><span class="p">):</span>
        <span class="n">gid</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">gid</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">path</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">arm_picker</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">arm_picker</span><span class="o">.</span><span class="n">feedback</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">+=</span> <span class="n">feedback</span>
            <span class="n">arm_picker</span><span class="o">.</span><span class="n">vv</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">arm_picker</span><span class="o">.</span><span class="n">itemclick</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="pHCB">pHCB<a class="anchor-link" href="#pHCB"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">ArmStructPHCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arm</span><span class="p">,</span><span class="n">depth</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arm</span> <span class="o">=</span> <span class="n">arm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gids</span> <span class="o">=</span> <span class="n">arm</span><span class="o">.</span><span class="n">gids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span> <span class="c1"># only when arm is a tree node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemclick</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vv</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vv</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">&lt;</span><span class="n">cfg</span><span class="o">.</span><span class="n">activate_num</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vv</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">&lt;</span><span class="n">cfg</span><span class="o">.</span><span class="n">activate_prob</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

<span class="k">class</span> <span class="nc">UserStructPHCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span>  <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="n">arms</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cfg</span><span class="o">.</span><span class="n">random_choice</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eg</span> <span class="o">=</span> <span class="n">NaiveEG</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">pHEGreedy</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">epsilon</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>

    <span class="k">def</span> <span class="nf">EstimateReward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arm</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">vv</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">reward</span>

    <span class="k">def</span> <span class="nf">decide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
            <span class="n">arms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">arms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ArmStructPHCB</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">=</span><span class="n">UserStructPHCB</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">)</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">:</span>
            <span class="n">aids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">),</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">aids</span><span class="p">:</span>
            <span class="n">arm</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EstimateReward</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reward</span><span class="o">&gt;</span><span class="n">max_r</span><span class="p">:</span>
                <span class="n">aid</span> <span class="o">=</span> <span class="n">index</span>
                <span class="n">max_r</span> <span class="o">=</span> <span class="n">reward</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">:</span>
            <span class="n">aid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">))</span>
        <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">arm_picker</span><span class="p">,</span><span class="n">aid</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">feedback</span><span class="p">):</span>
        <span class="n">gid</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">gid</span>
        <span class="n">arm_picker</span><span class="o">.</span><span class="n">feedback</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">+=</span> <span class="n">feedback</span>
        <span class="n">arm_picker</span><span class="o">.</span><span class="n">vv</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">arm_picker</span><span class="o">.</span><span class="n">itemclick</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">arm_picker</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span> <span class="ow">and</span> <span class="n">arm_picker</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">is_leaf</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">arm_picker</span><span class="o">.</span><span class="n">depth</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">arm_picker</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">arm</span> <span class="o">=</span> <span class="n">ArmStructPHCB</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">depth</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">arm</span><span class="o">.</span><span class="n">gids</span><span class="p">:</span>
                    <span class="n">arm</span><span class="o">.</span><span class="n">itemclick</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">=</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">itemclick</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
                    <span class="n">arm</span><span class="o">.</span><span class="n">feedback</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">=</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">feedback</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
                    <span class="n">arm</span><span class="o">.</span><span class="n">vv</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">=</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">vv</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
                <span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="CEG">CEG<a class="anchor-link" href="#CEG"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">ArmStructCEG</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arm</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arm</span> <span class="o">=</span> <span class="n">arm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gids</span> <span class="o">=</span> <span class="n">arm</span><span class="o">.</span><span class="n">gids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vv</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">class</span> <span class="nc">ESUserStructCEG</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cfg</span><span class="o">.</span><span class="n">random_choice</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eg</span> <span class="o">=</span> <span class="n">NaiveEG</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getProb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arm</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">arm</span><span class="o">.</span><span class="n">vv</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">arm</span><span class="o">.</span><span class="n">feedback</span><span class="o">/</span><span class="n">arm</span><span class="o">.</span><span class="n">vv</span>

    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">,</span> <span class="n">reward</span><span class="p">):</span>
        <span class="n">arm</span><span class="o">.</span><span class="n">vv</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">arm</span><span class="o">.</span><span class="n">feedback</span> <span class="o">+=</span> <span class="n">reward</span>


<span class="k">class</span> <span class="nc">CEG</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arms</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="n">ArmStructCEG</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span> <span class="k">for</span> <span class="n">arm</span> <span class="ow">in</span> <span class="n">arms</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">decide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">=</span><span class="n">ESUserStructCEG</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">:</span>
            <span class="n">arms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">),</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">aids</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">arm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arms</span><span class="p">):</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">getProb</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reward</span><span class="o">&gt;</span><span class="n">max_r</span><span class="p">:</span>
                <span class="n">aid</span> <span class="o">=</span> <span class="n">index</span>
                <span class="n">max_r</span> <span class="o">=</span> <span class="n">reward</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">epsilon</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">&gt;=</span><span class="n">eps</span><span class="p">:</span>
            <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">arms</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arms</span><span class="p">))</span>
            <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">arms</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">arm_picker</span><span class="p">,</span><span class="n">aid</span>


    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">picked_arm</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">uid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">picked_arm</span><span class="p">,</span><span class="n">reward</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">feedback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">feedback</span><span class="p">,</span><span class="n">uid</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Simulation">Simulation<a class="anchor-link" href="#Simulation"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">Tree</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emb</span>         <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span>        <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gids</span>        <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span>    <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_leaf</span>     <span class="o">=</span> <span class="kc">False</span>

<span class="k">class</span> <span class="nc">simulateExp</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">users</span><span class="p">,</span><span class="n">items</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">out_folder</span><span class="p">,</span><span class="n">test_iter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="n">users</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span>  <span class="o">=</span> <span class="n">tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_folder</span> <span class="o">=</span> <span class="n">out_folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_iter</span> <span class="o">=</span> <span class="n">test_iter</span>

    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">noise_scale</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feedback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">gid</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span><span class="n">item</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">user</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_candidatePool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">select_gids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">gids</span><span class="p">,</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">arms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">select_gids</span><span class="p">:</span>
            <span class="n">arms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">arms</span>


    <span class="k">def</span> <span class="nf">get_leafNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">root</span><span class="p">):</span>
        <span class="c1"># current = [self.tree]</span>
        <span class="n">current</span> <span class="o">=</span> <span class="p">[</span><span class="n">root</span><span class="p">]</span>
        <span class="n">leafNodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">current</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">:</span>
                    <span class="n">leafNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">temp</span> <span class="o">+=</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="k">return</span> <span class="n">leafNodes</span>


    <span class="k">def</span> <span class="nf">get_categoryNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span>
        <span class="n">categoryNodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">para</span><span class="p">[</span><span class="s1">&#39;category2&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">categoryNodes</span><span class="p">:</span>
                <span class="n">categoryNodes</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">()</span>
            <span class="n">categoryNodes</span><span class="p">[</span><span class="n">category</span><span class="p">]</span><span class="o">.</span><span class="n">gids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">node</span> <span class="ow">in</span> <span class="n">categoryNodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">gids</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">emb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">emb</span> <span class="o">=</span> <span class="n">emb</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">simulationPerUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">iters</span><span class="p">):</span>
        <span class="n">process_id</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[simulationPerUser] uid: </span><span class="si">%d</span><span class="s1">, process_id: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span> <span class="n">process_id</span><span class="p">))</span>
        <span class="n">user_reward</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">iter_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iters</span><span class="p">):</span>
            <span class="n">cur_iter_noise</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="p">()</span>
            <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">algname</span><span class="p">,</span><span class="n">alg</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">algname</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;naive_egreedy&#39;</span><span class="p">]:</span>
                    <span class="n">arms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_candidatePool</span><span class="p">()</span>
                    <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">alg</span><span class="o">.</span><span class="n">decide</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">)</span>
                    <span class="n">feedback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feedback</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">gid</span><span class="p">)</span>
                    <span class="n">alg</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">feedback</span><span class="p">,</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
                    <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">][</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="n">feedback</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">arm_picker</span><span class="p">,</span><span class="n">aid</span> <span class="o">=</span> <span class="n">alg</span><span class="o">.</span><span class="n">decide</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">random_choice</span><span class="p">:</span>
                    <span class="n">replace</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">gids</span><span class="p">)</span><span class="o">&lt;</span><span class="n">cfg</span><span class="o">.</span><span class="n">k</span> <span class="k">else</span> <span class="kc">False</span>
                    <span class="n">gids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">gids</span><span class="p">,</span><span class="n">cfg</span><span class="o">.</span><span class="n">k</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="n">replace</span><span class="p">)</span>
                    <span class="n">all_feedback</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gids</span><span class="p">:</span>
                        <span class="n">feedback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feedback</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">gid</span><span class="p">)</span>
                        <span class="n">alg</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">gid</span><span class="p">,</span><span class="n">feedback</span><span class="p">)</span>
                        <span class="n">all_feedback</span> <span class="o">+=</span> <span class="n">feedback</span>
                    <span class="n">avg_feedback</span> <span class="o">=</span> <span class="n">all_feedback</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">gids</span><span class="p">)</span>
                    <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">][</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_feedback</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">gids</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">:</span>
                        <span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">arm_picker</span><span class="o">.</span><span class="n">gids</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">gids</span><span class="p">,</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">alg</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">eg</span><span class="o">.</span><span class="n">decide</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">)</span>
                    <span class="n">feedback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feedback</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">gid</span><span class="p">)</span>
                    <span class="n">alg</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">feedback</span><span class="p">)</span>
                    <span class="n">alg</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">eg</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">feedback</span><span class="p">,</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
                    <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">][</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="n">feedback</span>
        <span class="k">return</span> <span class="n">user_reward</span>

    <span class="k">def</span> <span class="nf">run_algorithms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">algorithms</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;run algorithms&#39;</span><span class="p">)</span>
        <span class="n">pool</span><span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">thread_num</span><span class="p">)</span>
        <span class="n">results</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">uid</span><span class="p">,</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">result</span><span class="o">=</span><span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulationPerUser</span><span class="p">,(</span><span class="n">user</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">test_iter</span><span class="p">))</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="n">all_user_reward</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">tmp_reward</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">all_user_reward</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_reward</span><span class="p">)</span>

        <span class="n">AlgReward</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
            <span class="n">AlgReward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">iter_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_iter</span><span class="p">):</span>
            <span class="n">iter_avg_reward</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
                <span class="n">iter_avg_reward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">user_reward</span> <span class="ow">in</span> <span class="n">all_user_reward</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">]:</span>
                    <span class="n">iter_avg_reward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span> <span class="o">+=</span> <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">][</span><span class="n">algname</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
                <span class="n">AlgReward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iter_avg_reward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">all_user_reward</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
            <span class="n">AlgReward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">AlgReward</span><span class="p">[</span><span class="n">algname</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">AlgReward</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">Users</span> <span class="o">=</span> <span class="n">UserManager</span><span class="p">(</span><span class="n">dir_path</span> <span class="o">+</span> <span class="s1">&#39;/user_info.pkl&#39;</span><span class="p">)</span>
    <span class="n">Items</span> <span class="o">=</span> <span class="n">ItemManager</span><span class="p">(</span><span class="n">dir_path</span> <span class="o">+</span> <span class="s1">&#39;/item_info.pkl&#39;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">dir_path</span>  <span class="o">+</span> <span class="s1">&#39;tree/&#39;</span> <span class="o">+</span> <span class="n">cfg</span><span class="o">.</span><span class="n">new_tree_file</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
    <span class="n">Users</span><span class="o">.</span><span class="n">load_users</span><span class="p">()</span>
    <span class="n">Items</span><span class="o">.</span><span class="n">load_items</span><span class="p">()</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">log_config</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;number of users = </span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Users</span><span class="o">.</span><span class="n">n_users</span><span class="p">))</span>
    <span class="n">simiExp</span> <span class="o">=</span> <span class="n">simulateExp</span><span class="p">(</span><span class="n">Users</span><span class="o">.</span><span class="n">users</span><span class="p">,</span><span class="n">Items</span><span class="o">.</span><span class="n">items</span><span class="p">,</span><span class="n">root</span><span class="p">,</span><span class="n">dir_path</span><span class="p">,</span><span class="n">cfg</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">leafNodes</span> <span class="o">=</span> <span class="n">simiExp</span><span class="o">.</span><span class="n">get_leafNodes</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">categoryNodes</span> <span class="o">=</span> <span class="n">simiExp</span><span class="o">.</span><span class="n">get_categoryNodes</span><span class="p">()</span>
    <span class="n">algorithms</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">algorithms</span><span class="p">[</span><span class="s1">&#39;hcb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HEGreedy</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
    <span class="n">algorithms</span><span class="p">[</span><span class="s1">&#39;phcb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pHEGreedy</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
    <span class="n">algorithms</span><span class="p">[</span><span class="s1">&#39;naive_egreedy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NaiveEG</span><span class="p">()</span>
    <span class="n">algorithms</span><span class="p">[</span><span class="s1">&#39;egreedy_leaf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CEG</span><span class="p">(</span><span class="n">leafNodes</span><span class="p">)</span>
    <span class="n">algorithms</span><span class="p">[</span><span class="s1">&#39;egreedy_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CEG</span><span class="p">(</span><span class="n">categoryNodes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current algorithms = &#39;</span><span class="p">,</span><span class="n">algorithms</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">AlgReward</span> <span class="o">=</span> <span class="n">simiExp</span><span class="o">.</span><span class="n">run_algorithms</span><span class="p">(</span><span class="n">algorithms</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">iter_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">iter_</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">iter_</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">10</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;iter = </span><span class="si">{:d}</span><span class="s1"> alg = </span><span class="si">{}</span><span class="s1"> cumulate_reward = </span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">iter_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">algname</span><span class="p">,</span><span class="n">AlgReward</span><span class="p">[</span><span class="n">algname</span><span class="p">][</span><span class="n">iter_</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>21-12-11 07:06:16.853 - INFO: dataset : MIND
21-12-11 07:06:16.855 - INFO: T : 1000
21-12-11 07:06:16.857 - INFO: k : 1
21-12-11 07:06:16.859 - INFO: activate_num : 10
21-12-11 07:06:16.861 - INFO: activate_prob : 0.1
21-12-11 07:06:16.863 - INFO: epsilon : 0.05
21-12-11 07:06:16.864 - INFO: new_tree_file : 1000_10_btree.pkl
21-12-11 07:06:16.865 - INFO: noise_scale : 0.001
21-12-11 07:06:16.866 - INFO: keep_prob : 0.0001
21-12-11 07:06:16.867 - INFO: linucb_para : {&#39;alpha&#39;: 0.5}
21-12-11 07:06:16.868 - INFO: poolsize : 50
21-12-11 07:06:16.869 - INFO: random_choice : False
21-12-11 07:06:16.870 - INFO: number of users = 2
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>current algorithms =  dict_keys([&#39;hcb&#39;, &#39;phcb&#39;, &#39;naive_egreedy&#39;, &#39;egreedy_leaf&#39;, &#39;egreedy_category&#39;])
run algorithms
[simulationPerUser] uid: 712466, process_id: 482
[simulationPerUser] uid: 716513, process_id: 483
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>21-12-11 07:07:01.298 - INFO: iter = 1 alg = hcb cumulate_reward = 0.059
21-12-11 07:07:01.299 - INFO: iter = 1 alg = phcb cumulate_reward = 0.040
21-12-11 07:07:01.301 - INFO: iter = 1 alg = naive_egreedy cumulate_reward = 0.005
21-12-11 07:07:01.305 - INFO: iter = 1 alg = egreedy_leaf cumulate_reward = 0.010
21-12-11 07:07:01.306 - INFO: iter = 1 alg = egreedy_category cumulate_reward = 0.197
21-12-11 07:07:01.308 - INFO: iter = 10 alg = hcb cumulate_reward = 0.458
21-12-11 07:07:01.310 - INFO: iter = 10 alg = phcb cumulate_reward = 1.306
21-12-11 07:07:01.311 - INFO: iter = 10 alg = naive_egreedy cumulate_reward = 0.303
21-12-11 07:07:01.312 - INFO: iter = 10 alg = egreedy_leaf cumulate_reward = 0.764
21-12-11 07:07:01.313 - INFO: iter = 10 alg = egreedy_category cumulate_reward = 0.905
21-12-11 07:07:01.314 - INFO: iter = 20 alg = hcb cumulate_reward = 1.651
21-12-11 07:07:01.315 - INFO: iter = 20 alg = phcb cumulate_reward = 2.492
21-12-11 07:07:01.316 - INFO: iter = 20 alg = naive_egreedy cumulate_reward = 1.226
21-12-11 07:07:01.317 - INFO: iter = 20 alg = egreedy_leaf cumulate_reward = 1.795
21-12-11 07:07:01.318 - INFO: iter = 20 alg = egreedy_category cumulate_reward = 1.590
21-12-11 07:07:01.319 - INFO: iter = 30 alg = hcb cumulate_reward = 3.203
21-12-11 07:07:01.320 - INFO: iter = 30 alg = phcb cumulate_reward = 4.177
21-12-11 07:07:01.321 - INFO: iter = 30 alg = naive_egreedy cumulate_reward = 1.847
21-12-11 07:07:01.322 - INFO: iter = 30 alg = egreedy_leaf cumulate_reward = 2.234
21-12-11 07:07:01.323 - INFO: iter = 30 alg = egreedy_category cumulate_reward = 2.007
21-12-11 07:07:01.323 - INFO: iter = 40 alg = hcb cumulate_reward = 4.675
21-12-11 07:07:01.324 - INFO: iter = 40 alg = phcb cumulate_reward = 5.479
21-12-11 07:07:01.325 - INFO: iter = 40 alg = naive_egreedy cumulate_reward = 2.630
21-12-11 07:07:01.326 - INFO: iter = 40 alg = egreedy_leaf cumulate_reward = 3.072
21-12-11 07:07:01.327 - INFO: iter = 40 alg = egreedy_category cumulate_reward = 2.589
21-12-11 07:07:01.328 - INFO: iter = 50 alg = hcb cumulate_reward = 5.885
21-12-11 07:07:01.329 - INFO: iter = 50 alg = phcb cumulate_reward = 6.906
21-12-11 07:07:01.330 - INFO: iter = 50 alg = naive_egreedy cumulate_reward = 3.016
21-12-11 07:07:01.331 - INFO: iter = 50 alg = egreedy_leaf cumulate_reward = 3.548
21-12-11 07:07:01.332 - INFO: iter = 50 alg = egreedy_category cumulate_reward = 3.210
21-12-11 07:07:01.333 - INFO: iter = 60 alg = hcb cumulate_reward = 7.449
21-12-11 07:07:01.334 - INFO: iter = 60 alg = phcb cumulate_reward = 8.951
21-12-11 07:07:01.334 - INFO: iter = 60 alg = naive_egreedy cumulate_reward = 4.121
21-12-11 07:07:01.335 - INFO: iter = 60 alg = egreedy_leaf cumulate_reward = 4.509
21-12-11 07:07:01.336 - INFO: iter = 60 alg = egreedy_category cumulate_reward = 4.407
21-12-11 07:07:01.337 - INFO: iter = 70 alg = hcb cumulate_reward = 9.002
21-12-11 07:07:01.338 - INFO: iter = 70 alg = phcb cumulate_reward = 10.159
21-12-11 07:07:01.339 - INFO: iter = 70 alg = naive_egreedy cumulate_reward = 4.413
21-12-11 07:07:01.340 - INFO: iter = 70 alg = egreedy_leaf cumulate_reward = 4.996
21-12-11 07:07:01.341 - INFO: iter = 70 alg = egreedy_category cumulate_reward = 5.053
21-12-11 07:07:01.342 - INFO: iter = 80 alg = hcb cumulate_reward = 10.784
21-12-11 07:07:01.343 - INFO: iter = 80 alg = phcb cumulate_reward = 11.967
21-12-11 07:07:01.344 - INFO: iter = 80 alg = naive_egreedy cumulate_reward = 5.258
21-12-11 07:07:01.345 - INFO: iter = 80 alg = egreedy_leaf cumulate_reward = 6.087
21-12-11 07:07:01.346 - INFO: iter = 80 alg = egreedy_category cumulate_reward = 5.680
21-12-11 07:07:01.347 - INFO: iter = 90 alg = hcb cumulate_reward = 12.529
21-12-11 07:07:01.347 - INFO: iter = 90 alg = phcb cumulate_reward = 13.879
21-12-11 07:07:01.348 - INFO: iter = 90 alg = naive_egreedy cumulate_reward = 5.753
21-12-11 07:07:01.349 - INFO: iter = 90 alg = egreedy_leaf cumulate_reward = 6.484
21-12-11 07:07:01.350 - INFO: iter = 90 alg = egreedy_category cumulate_reward = 6.596
21-12-11 07:07:01.351 - INFO: iter = 100 alg = hcb cumulate_reward = 14.025
21-12-11 07:07:01.352 - INFO: iter = 100 alg = phcb cumulate_reward = 16.530
21-12-11 07:07:01.353 - INFO: iter = 100 alg = naive_egreedy cumulate_reward = 6.970
21-12-11 07:07:01.354 - INFO: iter = 100 alg = egreedy_leaf cumulate_reward = 7.491
21-12-11 07:07:01.355 - INFO: iter = 100 alg = egreedy_category cumulate_reward = 8.125
21-12-11 07:07:01.356 - INFO: iter = 110 alg = hcb cumulate_reward = 15.231
21-12-11 07:07:01.357 - INFO: iter = 110 alg = phcb cumulate_reward = 17.800
21-12-11 07:07:01.357 - INFO: iter = 110 alg = naive_egreedy cumulate_reward = 7.356
21-12-11 07:07:01.358 - INFO: iter = 110 alg = egreedy_leaf cumulate_reward = 8.211
21-12-11 07:07:01.359 - INFO: iter = 110 alg = egreedy_category cumulate_reward = 9.254
21-12-11 07:07:01.360 - INFO: iter = 120 alg = hcb cumulate_reward = 17.384
21-12-11 07:07:01.361 - INFO: iter = 120 alg = phcb cumulate_reward = 19.594
21-12-11 07:07:01.362 - INFO: iter = 120 alg = naive_egreedy cumulate_reward = 8.145
21-12-11 07:07:01.363 - INFO: iter = 120 alg = egreedy_leaf cumulate_reward = 9.292
21-12-11 07:07:01.364 - INFO: iter = 120 alg = egreedy_category cumulate_reward = 9.939
21-12-11 07:07:01.365 - INFO: iter = 130 alg = hcb cumulate_reward = 19.338
21-12-11 07:07:01.366 - INFO: iter = 130 alg = phcb cumulate_reward = 20.823
21-12-11 07:07:01.366 - INFO: iter = 130 alg = naive_egreedy cumulate_reward = 8.666
21-12-11 07:07:01.367 - INFO: iter = 130 alg = egreedy_leaf cumulate_reward = 9.826
21-12-11 07:07:01.368 - INFO: iter = 130 alg = egreedy_category cumulate_reward = 10.768
21-12-11 07:07:01.369 - INFO: iter = 140 alg = hcb cumulate_reward = 21.917
21-12-11 07:07:01.370 - INFO: iter = 140 alg = phcb cumulate_reward = 23.145
21-12-11 07:07:01.371 - INFO: iter = 140 alg = naive_egreedy cumulate_reward = 9.723
21-12-11 07:07:01.372 - INFO: iter = 140 alg = egreedy_leaf cumulate_reward = 10.806
21-12-11 07:07:01.373 - INFO: iter = 140 alg = egreedy_category cumulate_reward = 11.588
21-12-11 07:07:01.374 - INFO: iter = 150 alg = hcb cumulate_reward = 24.040
21-12-11 07:07:01.375 - INFO: iter = 150 alg = phcb cumulate_reward = 24.539
21-12-11 07:07:01.376 - INFO: iter = 150 alg = naive_egreedy cumulate_reward = 10.165
21-12-11 07:07:01.376 - INFO: iter = 150 alg = egreedy_leaf cumulate_reward = 12.118
21-12-11 07:07:01.377 - INFO: iter = 150 alg = egreedy_category cumulate_reward = 13.220
21-12-11 07:07:01.378 - INFO: iter = 160 alg = hcb cumulate_reward = 25.635
21-12-11 07:07:01.379 - INFO: iter = 160 alg = phcb cumulate_reward = 26.833
21-12-11 07:07:01.380 - INFO: iter = 160 alg = naive_egreedy cumulate_reward = 10.801
21-12-11 07:07:01.381 - INFO: iter = 160 alg = egreedy_leaf cumulate_reward = 12.938
21-12-11 07:07:01.382 - INFO: iter = 160 alg = egreedy_category cumulate_reward = 14.447
21-12-11 07:07:01.383 - INFO: iter = 170 alg = hcb cumulate_reward = 27.364
21-12-11 07:07:01.384 - INFO: iter = 170 alg = phcb cumulate_reward = 29.370
21-12-11 07:07:01.385 - INFO: iter = 170 alg = naive_egreedy cumulate_reward = 11.757
21-12-11 07:07:01.386 - INFO: iter = 170 alg = egreedy_leaf cumulate_reward = 13.592
21-12-11 07:07:01.387 - INFO: iter = 170 alg = egreedy_category cumulate_reward = 16.158
21-12-11 07:07:01.387 - INFO: iter = 180 alg = hcb cumulate_reward = 28.922
21-12-11 07:07:01.388 - INFO: iter = 180 alg = phcb cumulate_reward = 31.105
21-12-11 07:07:01.389 - INFO: iter = 180 alg = naive_egreedy cumulate_reward = 12.145
21-12-11 07:07:01.390 - INFO: iter = 180 alg = egreedy_leaf cumulate_reward = 14.585
21-12-11 07:07:01.391 - INFO: iter = 180 alg = egreedy_category cumulate_reward = 17.897
21-12-11 07:07:01.392 - INFO: iter = 190 alg = hcb cumulate_reward = 31.022
21-12-11 07:07:01.393 - INFO: iter = 190 alg = phcb cumulate_reward = 32.998
21-12-11 07:07:01.394 - INFO: iter = 190 alg = naive_egreedy cumulate_reward = 12.343
21-12-11 07:07:01.395 - INFO: iter = 190 alg = egreedy_leaf cumulate_reward = 15.307
21-12-11 07:07:01.396 - INFO: iter = 190 alg = egreedy_category cumulate_reward = 19.053
21-12-11 07:07:01.396 - INFO: iter = 200 alg = hcb cumulate_reward = 33.247
21-12-11 07:07:01.397 - INFO: iter = 200 alg = phcb cumulate_reward = 34.930
21-12-11 07:07:01.398 - INFO: iter = 200 alg = naive_egreedy cumulate_reward = 12.814
21-12-11 07:07:01.399 - INFO: iter = 200 alg = egreedy_leaf cumulate_reward = 16.357
21-12-11 07:07:01.400 - INFO: iter = 200 alg = egreedy_category cumulate_reward = 19.897
21-12-11 07:07:01.401 - INFO: iter = 210 alg = hcb cumulate_reward = 35.876
21-12-11 07:07:01.402 - INFO: iter = 210 alg = phcb cumulate_reward = 37.472
21-12-11 07:07:01.403 - INFO: iter = 210 alg = naive_egreedy cumulate_reward = 13.427
21-12-11 07:07:01.404 - INFO: iter = 210 alg = egreedy_leaf cumulate_reward = 17.281
21-12-11 07:07:01.405 - INFO: iter = 210 alg = egreedy_category cumulate_reward = 21.054
21-12-11 07:07:01.405 - INFO: iter = 220 alg = hcb cumulate_reward = 38.194
21-12-11 07:07:01.406 - INFO: iter = 220 alg = phcb cumulate_reward = 40.033
21-12-11 07:07:01.407 - INFO: iter = 220 alg = naive_egreedy cumulate_reward = 14.887
21-12-11 07:07:01.408 - INFO: iter = 220 alg = egreedy_leaf cumulate_reward = 17.782
21-12-11 07:07:01.409 - INFO: iter = 220 alg = egreedy_category cumulate_reward = 22.213
21-12-11 07:07:01.410 - INFO: iter = 230 alg = hcb cumulate_reward = 40.468
21-12-11 07:07:01.411 - INFO: iter = 230 alg = phcb cumulate_reward = 42.242
21-12-11 07:07:01.412 - INFO: iter = 230 alg = naive_egreedy cumulate_reward = 15.355
21-12-11 07:07:01.413 - INFO: iter = 230 alg = egreedy_leaf cumulate_reward = 19.120
21-12-11 07:07:01.414 - INFO: iter = 230 alg = egreedy_category cumulate_reward = 22.919
21-12-11 07:07:01.415 - INFO: iter = 240 alg = hcb cumulate_reward = 42.727
21-12-11 07:07:01.415 - INFO: iter = 240 alg = phcb cumulate_reward = 45.038
21-12-11 07:07:01.416 - INFO: iter = 240 alg = naive_egreedy cumulate_reward = 15.710
21-12-11 07:07:01.417 - INFO: iter = 240 alg = egreedy_leaf cumulate_reward = 20.548
21-12-11 07:07:01.418 - INFO: iter = 240 alg = egreedy_category cumulate_reward = 24.474
21-12-11 07:07:01.419 - INFO: iter = 250 alg = hcb cumulate_reward = 45.540
21-12-11 07:07:01.419 - INFO: iter = 250 alg = phcb cumulate_reward = 47.842
21-12-11 07:07:01.420 - INFO: iter = 250 alg = naive_egreedy cumulate_reward = 16.111
21-12-11 07:07:01.421 - INFO: iter = 250 alg = egreedy_leaf cumulate_reward = 21.477
21-12-11 07:07:01.422 - INFO: iter = 250 alg = egreedy_category cumulate_reward = 25.932
21-12-11 07:07:01.423 - INFO: iter = 260 alg = hcb cumulate_reward = 47.104
21-12-11 07:07:01.424 - INFO: iter = 260 alg = phcb cumulate_reward = 50.651
21-12-11 07:07:01.424 - INFO: iter = 260 alg = naive_egreedy cumulate_reward = 16.844
21-12-11 07:07:01.425 - INFO: iter = 260 alg = egreedy_leaf cumulate_reward = 22.784
21-12-11 07:07:01.426 - INFO: iter = 260 alg = egreedy_category cumulate_reward = 26.929
21-12-11 07:07:01.427 - INFO: iter = 270 alg = hcb cumulate_reward = 49.497
21-12-11 07:07:01.428 - INFO: iter = 270 alg = phcb cumulate_reward = 52.649
21-12-11 07:07:01.429 - INFO: iter = 270 alg = naive_egreedy cumulate_reward = 17.572
21-12-11 07:07:01.430 - INFO: iter = 270 alg = egreedy_leaf cumulate_reward = 23.559
21-12-11 07:07:01.431 - INFO: iter = 270 alg = egreedy_category cumulate_reward = 28.561
21-12-11 07:07:01.432 - INFO: iter = 280 alg = hcb cumulate_reward = 51.603
21-12-11 07:07:01.433 - INFO: iter = 280 alg = phcb cumulate_reward = 55.217
21-12-11 07:07:01.433 - INFO: iter = 280 alg = naive_egreedy cumulate_reward = 18.011
21-12-11 07:07:01.434 - INFO: iter = 280 alg = egreedy_leaf cumulate_reward = 24.873
21-12-11 07:07:01.435 - INFO: iter = 280 alg = egreedy_category cumulate_reward = 30.054
21-12-11 07:07:01.436 - INFO: iter = 290 alg = hcb cumulate_reward = 53.289
21-12-11 07:07:01.437 - INFO: iter = 290 alg = phcb cumulate_reward = 57.720
21-12-11 07:07:01.438 - INFO: iter = 290 alg = naive_egreedy cumulate_reward = 19.542
21-12-11 07:07:01.439 - INFO: iter = 290 alg = egreedy_leaf cumulate_reward = 25.845
21-12-11 07:07:01.440 - INFO: iter = 290 alg = egreedy_category cumulate_reward = 31.436
21-12-11 07:07:01.441 - INFO: iter = 300 alg = hcb cumulate_reward = 55.449
21-12-11 07:07:01.442 - INFO: iter = 300 alg = phcb cumulate_reward = 60.621
21-12-11 07:07:01.443 - INFO: iter = 300 alg = naive_egreedy cumulate_reward = 20.369
21-12-11 07:07:01.444 - INFO: iter = 300 alg = egreedy_leaf cumulate_reward = 27.438
21-12-11 07:07:01.445 - INFO: iter = 300 alg = egreedy_category cumulate_reward = 32.888
21-12-11 07:07:01.445 - INFO: iter = 310 alg = hcb cumulate_reward = 57.433
21-12-11 07:07:01.446 - INFO: iter = 310 alg = phcb cumulate_reward = 63.015
21-12-11 07:07:01.447 - INFO: iter = 310 alg = naive_egreedy cumulate_reward = 20.990
21-12-11 07:07:01.448 - INFO: iter = 310 alg = egreedy_leaf cumulate_reward = 28.272
21-12-11 07:07:01.449 - INFO: iter = 310 alg = egreedy_category cumulate_reward = 34.530
21-12-11 07:07:01.450 - INFO: iter = 320 alg = hcb cumulate_reward = 59.604
21-12-11 07:07:01.452 - INFO: iter = 320 alg = phcb cumulate_reward = 66.923
21-12-11 07:07:01.452 - INFO: iter = 320 alg = naive_egreedy cumulate_reward = 21.448
21-12-11 07:07:01.453 - INFO: iter = 320 alg = egreedy_leaf cumulate_reward = 29.726
21-12-11 07:07:01.454 - INFO: iter = 320 alg = egreedy_category cumulate_reward = 36.211
21-12-11 07:07:01.455 - INFO: iter = 330 alg = hcb cumulate_reward = 61.501
21-12-11 07:07:01.456 - INFO: iter = 330 alg = phcb cumulate_reward = 70.671
21-12-11 07:07:01.457 - INFO: iter = 330 alg = naive_egreedy cumulate_reward = 21.790
21-12-11 07:07:01.458 - INFO: iter = 330 alg = egreedy_leaf cumulate_reward = 31.123
21-12-11 07:07:01.459 - INFO: iter = 330 alg = egreedy_category cumulate_reward = 38.021
21-12-11 07:07:01.460 - INFO: iter = 340 alg = hcb cumulate_reward = 63.434
21-12-11 07:07:01.461 - INFO: iter = 340 alg = phcb cumulate_reward = 74.048
21-12-11 07:07:01.462 - INFO: iter = 340 alg = naive_egreedy cumulate_reward = 22.184
21-12-11 07:07:01.463 - INFO: iter = 340 alg = egreedy_leaf cumulate_reward = 32.479
21-12-11 07:07:01.464 - INFO: iter = 340 alg = egreedy_category cumulate_reward = 39.243
21-12-11 07:07:01.465 - INFO: iter = 350 alg = hcb cumulate_reward = 66.196
21-12-11 07:07:01.466 - INFO: iter = 350 alg = phcb cumulate_reward = 78.055
21-12-11 07:07:01.467 - INFO: iter = 350 alg = naive_egreedy cumulate_reward = 23.028
21-12-11 07:07:01.468 - INFO: iter = 350 alg = egreedy_leaf cumulate_reward = 34.228
21-12-11 07:07:01.469 - INFO: iter = 350 alg = egreedy_category cumulate_reward = 40.287
21-12-11 07:07:01.470 - INFO: iter = 360 alg = hcb cumulate_reward = 68.419
21-12-11 07:07:01.471 - INFO: iter = 360 alg = phcb cumulate_reward = 82.107
21-12-11 07:07:01.472 - INFO: iter = 360 alg = naive_egreedy cumulate_reward = 23.795
21-12-11 07:07:01.473 - INFO: iter = 360 alg = egreedy_leaf cumulate_reward = 34.637
21-12-11 07:07:01.474 - INFO: iter = 360 alg = egreedy_category cumulate_reward = 41.131
21-12-11 07:07:01.475 - INFO: iter = 370 alg = hcb cumulate_reward = 70.327
21-12-11 07:07:01.476 - INFO: iter = 370 alg = phcb cumulate_reward = 85.515
21-12-11 07:07:01.477 - INFO: iter = 370 alg = naive_egreedy cumulate_reward = 24.610
21-12-11 07:07:01.478 - INFO: iter = 370 alg = egreedy_leaf cumulate_reward = 35.727
21-12-11 07:07:01.479 - INFO: iter = 370 alg = egreedy_category cumulate_reward = 42.145
21-12-11 07:07:01.480 - INFO: iter = 380 alg = hcb cumulate_reward = 72.872
21-12-11 07:07:01.482 - INFO: iter = 380 alg = phcb cumulate_reward = 89.502
21-12-11 07:07:01.483 - INFO: iter = 380 alg = naive_egreedy cumulate_reward = 25.041
21-12-11 07:07:01.484 - INFO: iter = 380 alg = egreedy_leaf cumulate_reward = 37.138
21-12-11 07:07:01.485 - INFO: iter = 380 alg = egreedy_category cumulate_reward = 44.073
21-12-11 07:07:01.486 - INFO: iter = 390 alg = hcb cumulate_reward = 75.543
21-12-11 07:07:01.487 - INFO: iter = 390 alg = phcb cumulate_reward = 93.871
21-12-11 07:07:01.489 - INFO: iter = 390 alg = naive_egreedy cumulate_reward = 25.657
21-12-11 07:07:01.490 - INFO: iter = 390 alg = egreedy_leaf cumulate_reward = 38.990
21-12-11 07:07:01.491 - INFO: iter = 390 alg = egreedy_category cumulate_reward = 45.816
21-12-11 07:07:01.492 - INFO: iter = 400 alg = hcb cumulate_reward = 78.176
21-12-11 07:07:01.493 - INFO: iter = 400 alg = phcb cumulate_reward = 97.240
21-12-11 07:07:01.494 - INFO: iter = 400 alg = naive_egreedy cumulate_reward = 26.890
21-12-11 07:07:01.495 - INFO: iter = 400 alg = egreedy_leaf cumulate_reward = 40.276
21-12-11 07:07:01.496 - INFO: iter = 400 alg = egreedy_category cumulate_reward = 47.150
21-12-11 07:07:01.497 - INFO: iter = 410 alg = hcb cumulate_reward = 80.605
21-12-11 07:07:01.498 - INFO: iter = 410 alg = phcb cumulate_reward = 101.195
21-12-11 07:07:01.499 - INFO: iter = 410 alg = naive_egreedy cumulate_reward = 27.598
21-12-11 07:07:01.501 - INFO: iter = 410 alg = egreedy_leaf cumulate_reward = 41.901
21-12-11 07:07:01.502 - INFO: iter = 410 alg = egreedy_category cumulate_reward = 48.913
21-12-11 07:07:01.503 - INFO: iter = 420 alg = hcb cumulate_reward = 83.145
21-12-11 07:07:01.504 - INFO: iter = 420 alg = phcb cumulate_reward = 104.608
21-12-11 07:07:01.505 - INFO: iter = 420 alg = naive_egreedy cumulate_reward = 28.477
21-12-11 07:07:01.506 - INFO: iter = 420 alg = egreedy_leaf cumulate_reward = 43.254
21-12-11 07:07:01.506 - INFO: iter = 420 alg = egreedy_category cumulate_reward = 49.876
21-12-11 07:07:01.508 - INFO: iter = 430 alg = hcb cumulate_reward = 85.572
21-12-11 07:07:01.509 - INFO: iter = 430 alg = phcb cumulate_reward = 108.786
21-12-11 07:07:01.509 - INFO: iter = 430 alg = naive_egreedy cumulate_reward = 29.147
21-12-11 07:07:01.510 - INFO: iter = 430 alg = egreedy_leaf cumulate_reward = 44.135
21-12-11 07:07:01.511 - INFO: iter = 430 alg = egreedy_category cumulate_reward = 51.162
21-12-11 07:07:01.512 - INFO: iter = 440 alg = hcb cumulate_reward = 87.510
21-12-11 07:07:01.513 - INFO: iter = 440 alg = phcb cumulate_reward = 112.137
21-12-11 07:07:01.514 - INFO: iter = 440 alg = naive_egreedy cumulate_reward = 29.662
21-12-11 07:07:01.515 - INFO: iter = 440 alg = egreedy_leaf cumulate_reward = 45.580
21-12-11 07:07:01.516 - INFO: iter = 440 alg = egreedy_category cumulate_reward = 52.769
21-12-11 07:07:01.517 - INFO: iter = 450 alg = hcb cumulate_reward = 89.818
21-12-11 07:07:01.518 - INFO: iter = 450 alg = phcb cumulate_reward = 116.417
21-12-11 07:07:01.519 - INFO: iter = 450 alg = naive_egreedy cumulate_reward = 30.609
21-12-11 07:07:01.520 - INFO: iter = 450 alg = egreedy_leaf cumulate_reward = 46.340
21-12-11 07:07:01.521 - INFO: iter = 450 alg = egreedy_category cumulate_reward = 55.145
21-12-11 07:07:01.522 - INFO: iter = 460 alg = hcb cumulate_reward = 91.998
21-12-11 07:07:01.523 - INFO: iter = 460 alg = phcb cumulate_reward = 120.860
21-12-11 07:07:01.524 - INFO: iter = 460 alg = naive_egreedy cumulate_reward = 30.934
21-12-11 07:07:01.525 - INFO: iter = 460 alg = egreedy_leaf cumulate_reward = 47.727
21-12-11 07:07:01.526 - INFO: iter = 460 alg = egreedy_category cumulate_reward = 57.225
21-12-11 07:07:01.527 - INFO: iter = 470 alg = hcb cumulate_reward = 94.658
21-12-11 07:07:01.528 - INFO: iter = 470 alg = phcb cumulate_reward = 124.850
21-12-11 07:07:01.529 - INFO: iter = 470 alg = naive_egreedy cumulate_reward = 31.481
21-12-11 07:07:01.530 - INFO: iter = 470 alg = egreedy_leaf cumulate_reward = 49.182
21-12-11 07:07:01.531 - INFO: iter = 470 alg = egreedy_category cumulate_reward = 59.072
21-12-11 07:07:01.532 - INFO: iter = 480 alg = hcb cumulate_reward = 97.377
21-12-11 07:07:01.533 - INFO: iter = 480 alg = phcb cumulate_reward = 129.145
21-12-11 07:07:01.534 - INFO: iter = 480 alg = naive_egreedy cumulate_reward = 31.978
21-12-11 07:07:01.535 - INFO: iter = 480 alg = egreedy_leaf cumulate_reward = 50.174
21-12-11 07:07:01.536 - INFO: iter = 480 alg = egreedy_category cumulate_reward = 61.100
21-12-11 07:07:01.537 - INFO: iter = 490 alg = hcb cumulate_reward = 100.001
21-12-11 07:07:01.538 - INFO: iter = 490 alg = phcb cumulate_reward = 133.968
21-12-11 07:07:01.539 - INFO: iter = 490 alg = naive_egreedy cumulate_reward = 32.549
21-12-11 07:07:01.540 - INFO: iter = 490 alg = egreedy_leaf cumulate_reward = 52.758
21-12-11 07:07:01.541 - INFO: iter = 490 alg = egreedy_category cumulate_reward = 62.807
21-12-11 07:07:01.542 - INFO: iter = 500 alg = hcb cumulate_reward = 102.003
21-12-11 07:07:01.543 - INFO: iter = 500 alg = phcb cumulate_reward = 138.649
21-12-11 07:07:01.544 - INFO: iter = 500 alg = naive_egreedy cumulate_reward = 32.786
21-12-11 07:07:01.545 - INFO: iter = 500 alg = egreedy_leaf cumulate_reward = 54.328
21-12-11 07:07:01.546 - INFO: iter = 500 alg = egreedy_category cumulate_reward = 64.343
21-12-11 07:07:01.547 - INFO: iter = 510 alg = hcb cumulate_reward = 104.203
21-12-11 07:07:01.548 - INFO: iter = 510 alg = phcb cumulate_reward = 142.045
21-12-11 07:07:01.549 - INFO: iter = 510 alg = naive_egreedy cumulate_reward = 32.886
21-12-11 07:07:01.550 - INFO: iter = 510 alg = egreedy_leaf cumulate_reward = 55.553
21-12-11 07:07:01.551 - INFO: iter = 510 alg = egreedy_category cumulate_reward = 66.205
21-12-11 07:07:01.551 - INFO: iter = 520 alg = hcb cumulate_reward = 106.206
21-12-11 07:07:01.552 - INFO: iter = 520 alg = phcb cumulate_reward = 147.469
21-12-11 07:07:01.553 - INFO: iter = 520 alg = naive_egreedy cumulate_reward = 33.560
21-12-11 07:07:01.554 - INFO: iter = 520 alg = egreedy_leaf cumulate_reward = 57.243
21-12-11 07:07:01.555 - INFO: iter = 520 alg = egreedy_category cumulate_reward = 68.314
21-12-11 07:07:01.556 - INFO: iter = 530 alg = hcb cumulate_reward = 108.501
21-12-11 07:07:01.557 - INFO: iter = 530 alg = phcb cumulate_reward = 151.538
21-12-11 07:07:01.558 - INFO: iter = 530 alg = naive_egreedy cumulate_reward = 34.584
21-12-11 07:07:01.559 - INFO: iter = 530 alg = egreedy_leaf cumulate_reward = 58.711
21-12-11 07:07:01.560 - INFO: iter = 530 alg = egreedy_category cumulate_reward = 69.510
21-12-11 07:07:01.561 - INFO: iter = 540 alg = hcb cumulate_reward = 110.560
21-12-11 07:07:01.562 - INFO: iter = 540 alg = phcb cumulate_reward = 155.842
21-12-11 07:07:01.564 - INFO: iter = 540 alg = naive_egreedy cumulate_reward = 35.582
21-12-11 07:07:01.564 - INFO: iter = 540 alg = egreedy_leaf cumulate_reward = 59.630
21-12-11 07:07:01.565 - INFO: iter = 540 alg = egreedy_category cumulate_reward = 70.771
21-12-11 07:07:01.566 - INFO: iter = 550 alg = hcb cumulate_reward = 112.845
21-12-11 07:07:01.567 - INFO: iter = 550 alg = phcb cumulate_reward = 160.822
21-12-11 07:07:01.568 - INFO: iter = 550 alg = naive_egreedy cumulate_reward = 36.307
21-12-11 07:07:01.569 - INFO: iter = 550 alg = egreedy_leaf cumulate_reward = 62.005
21-12-11 07:07:01.570 - INFO: iter = 550 alg = egreedy_category cumulate_reward = 72.427
21-12-11 07:07:01.571 - INFO: iter = 560 alg = hcb cumulate_reward = 115.238
21-12-11 07:07:01.572 - INFO: iter = 560 alg = phcb cumulate_reward = 165.813
21-12-11 07:07:01.573 - INFO: iter = 560 alg = naive_egreedy cumulate_reward = 37.743
21-12-11 07:07:01.574 - INFO: iter = 560 alg = egreedy_leaf cumulate_reward = 63.205
21-12-11 07:07:01.575 - INFO: iter = 560 alg = egreedy_category cumulate_reward = 73.992
21-12-11 07:07:01.576 - INFO: iter = 570 alg = hcb cumulate_reward = 118.045
21-12-11 07:07:01.577 - INFO: iter = 570 alg = phcb cumulate_reward = 170.207
21-12-11 07:07:01.578 - INFO: iter = 570 alg = naive_egreedy cumulate_reward = 38.428
21-12-11 07:07:01.579 - INFO: iter = 570 alg = egreedy_leaf cumulate_reward = 64.539
21-12-11 07:07:01.580 - INFO: iter = 570 alg = egreedy_category cumulate_reward = 75.433
21-12-11 07:07:01.581 - INFO: iter = 580 alg = hcb cumulate_reward = 120.605
21-12-11 07:07:01.582 - INFO: iter = 580 alg = phcb cumulate_reward = 175.614
21-12-11 07:07:01.583 - INFO: iter = 580 alg = naive_egreedy cumulate_reward = 39.331
21-12-11 07:07:01.584 - INFO: iter = 580 alg = egreedy_leaf cumulate_reward = 65.624
21-12-11 07:07:01.585 - INFO: iter = 580 alg = egreedy_category cumulate_reward = 76.613
21-12-11 07:07:01.586 - INFO: iter = 590 alg = hcb cumulate_reward = 123.067
21-12-11 07:07:01.587 - INFO: iter = 590 alg = phcb cumulate_reward = 180.471
21-12-11 07:07:01.587 - INFO: iter = 590 alg = naive_egreedy cumulate_reward = 40.036
21-12-11 07:07:01.588 - INFO: iter = 590 alg = egreedy_leaf cumulate_reward = 67.259
21-12-11 07:07:01.589 - INFO: iter = 590 alg = egreedy_category cumulate_reward = 78.648
21-12-11 07:07:01.590 - INFO: iter = 600 alg = hcb cumulate_reward = 125.489
21-12-11 07:07:01.591 - INFO: iter = 600 alg = phcb cumulate_reward = 184.350
21-12-11 07:07:01.592 - INFO: iter = 600 alg = naive_egreedy cumulate_reward = 40.323
21-12-11 07:07:01.593 - INFO: iter = 600 alg = egreedy_leaf cumulate_reward = 68.952
21-12-11 07:07:01.594 - INFO: iter = 600 alg = egreedy_category cumulate_reward = 80.524
21-12-11 07:07:01.595 - INFO: iter = 610 alg = hcb cumulate_reward = 127.538
21-12-11 07:07:01.596 - INFO: iter = 610 alg = phcb cumulate_reward = 189.450
21-12-11 07:07:01.597 - INFO: iter = 610 alg = naive_egreedy cumulate_reward = 40.708
21-12-11 07:07:01.598 - INFO: iter = 610 alg = egreedy_leaf cumulate_reward = 70.619
21-12-11 07:07:01.599 - INFO: iter = 610 alg = egreedy_category cumulate_reward = 83.088
21-12-11 07:07:01.600 - INFO: iter = 620 alg = hcb cumulate_reward = 129.676
21-12-11 07:07:01.601 - INFO: iter = 620 alg = phcb cumulate_reward = 195.276
21-12-11 07:07:01.602 - INFO: iter = 620 alg = naive_egreedy cumulate_reward = 41.160
21-12-11 07:07:01.603 - INFO: iter = 620 alg = egreedy_leaf cumulate_reward = 72.452
21-12-11 07:07:01.604 - INFO: iter = 620 alg = egreedy_category cumulate_reward = 84.927
21-12-11 07:07:01.605 - INFO: iter = 630 alg = hcb cumulate_reward = 132.006
21-12-11 07:07:01.606 - INFO: iter = 630 alg = phcb cumulate_reward = 200.032
21-12-11 07:07:01.607 - INFO: iter = 630 alg = naive_egreedy cumulate_reward = 42.126
21-12-11 07:07:01.608 - INFO: iter = 630 alg = egreedy_leaf cumulate_reward = 74.509
21-12-11 07:07:01.608 - INFO: iter = 630 alg = egreedy_category cumulate_reward = 86.325
21-12-11 07:07:01.609 - INFO: iter = 640 alg = hcb cumulate_reward = 134.458
21-12-11 07:07:01.610 - INFO: iter = 640 alg = phcb cumulate_reward = 204.192
21-12-11 07:07:01.611 - INFO: iter = 640 alg = naive_egreedy cumulate_reward = 42.614
21-12-11 07:07:01.612 - INFO: iter = 640 alg = egreedy_leaf cumulate_reward = 76.516
21-12-11 07:07:01.613 - INFO: iter = 640 alg = egreedy_category cumulate_reward = 88.838
21-12-11 07:07:01.614 - INFO: iter = 650 alg = hcb cumulate_reward = 136.836
21-12-11 07:07:01.615 - INFO: iter = 650 alg = phcb cumulate_reward = 208.763
21-12-11 07:07:01.616 - INFO: iter = 650 alg = naive_egreedy cumulate_reward = 43.442
21-12-11 07:07:01.617 - INFO: iter = 650 alg = egreedy_leaf cumulate_reward = 78.468
21-12-11 07:07:01.618 - INFO: iter = 650 alg = egreedy_category cumulate_reward = 90.626
21-12-11 07:07:01.619 - INFO: iter = 660 alg = hcb cumulate_reward = 139.454
21-12-11 07:07:01.620 - INFO: iter = 660 alg = phcb cumulate_reward = 214.303
21-12-11 07:07:01.621 - INFO: iter = 660 alg = naive_egreedy cumulate_reward = 44.621
21-12-11 07:07:01.622 - INFO: iter = 660 alg = egreedy_leaf cumulate_reward = 79.870
21-12-11 07:07:01.623 - INFO: iter = 660 alg = egreedy_category cumulate_reward = 92.941
21-12-11 07:07:01.624 - INFO: iter = 670 alg = hcb cumulate_reward = 141.787
21-12-11 07:07:01.625 - INFO: iter = 670 alg = phcb cumulate_reward = 219.437
21-12-11 07:07:01.626 - INFO: iter = 670 alg = naive_egreedy cumulate_reward = 45.283
21-12-11 07:07:01.627 - INFO: iter = 670 alg = egreedy_leaf cumulate_reward = 80.861
21-12-11 07:07:01.628 - INFO: iter = 670 alg = egreedy_category cumulate_reward = 95.208
21-12-11 07:07:01.629 - INFO: iter = 680 alg = hcb cumulate_reward = 144.019
21-12-11 07:07:01.630 - INFO: iter = 680 alg = phcb cumulate_reward = 223.894
21-12-11 07:07:01.630 - INFO: iter = 680 alg = naive_egreedy cumulate_reward = 45.785
21-12-11 07:07:01.631 - INFO: iter = 680 alg = egreedy_leaf cumulate_reward = 81.801
21-12-11 07:07:01.632 - INFO: iter = 680 alg = egreedy_category cumulate_reward = 97.407
21-12-11 07:07:01.633 - INFO: iter = 690 alg = hcb cumulate_reward = 146.863
21-12-11 07:07:01.634 - INFO: iter = 690 alg = phcb cumulate_reward = 228.413
21-12-11 07:07:01.635 - INFO: iter = 690 alg = naive_egreedy cumulate_reward = 46.929
21-12-11 07:07:01.636 - INFO: iter = 690 alg = egreedy_leaf cumulate_reward = 83.837
21-12-11 07:07:01.637 - INFO: iter = 690 alg = egreedy_category cumulate_reward = 100.444
21-12-11 07:07:01.638 - INFO: iter = 700 alg = hcb cumulate_reward = 149.326
21-12-11 07:07:01.639 - INFO: iter = 700 alg = phcb cumulate_reward = 233.737
21-12-11 07:07:01.640 - INFO: iter = 700 alg = naive_egreedy cumulate_reward = 47.631
21-12-11 07:07:01.641 - INFO: iter = 700 alg = egreedy_leaf cumulate_reward = 85.386
21-12-11 07:07:01.642 - INFO: iter = 700 alg = egreedy_category cumulate_reward = 102.477
21-12-11 07:07:01.643 - INFO: iter = 710 alg = hcb cumulate_reward = 151.412
21-12-11 07:07:01.644 - INFO: iter = 710 alg = phcb cumulate_reward = 238.707
21-12-11 07:07:01.645 - INFO: iter = 710 alg = naive_egreedy cumulate_reward = 48.067
21-12-11 07:07:01.646 - INFO: iter = 710 alg = egreedy_leaf cumulate_reward = 86.716
21-12-11 07:07:01.647 - INFO: iter = 710 alg = egreedy_category cumulate_reward = 105.037
21-12-11 07:07:01.648 - INFO: iter = 720 alg = hcb cumulate_reward = 154.068
21-12-11 07:07:01.648 - INFO: iter = 720 alg = phcb cumulate_reward = 243.210
21-12-11 07:07:01.649 - INFO: iter = 720 alg = naive_egreedy cumulate_reward = 48.670
21-12-11 07:07:01.650 - INFO: iter = 720 alg = egreedy_leaf cumulate_reward = 88.247
21-12-11 07:07:01.651 - INFO: iter = 720 alg = egreedy_category cumulate_reward = 106.464
21-12-11 07:07:01.652 - INFO: iter = 730 alg = hcb cumulate_reward = 156.188
21-12-11 07:07:01.653 - INFO: iter = 730 alg = phcb cumulate_reward = 247.751
21-12-11 07:07:01.654 - INFO: iter = 730 alg = naive_egreedy cumulate_reward = 49.134
21-12-11 07:07:01.655 - INFO: iter = 730 alg = egreedy_leaf cumulate_reward = 89.752
21-12-11 07:07:01.656 - INFO: iter = 730 alg = egreedy_category cumulate_reward = 109.003
21-12-11 07:07:01.657 - INFO: iter = 740 alg = hcb cumulate_reward = 159.122
21-12-11 07:07:01.658 - INFO: iter = 740 alg = phcb cumulate_reward = 253.009
21-12-11 07:07:01.659 - INFO: iter = 740 alg = naive_egreedy cumulate_reward = 49.879
21-12-11 07:07:01.660 - INFO: iter = 740 alg = egreedy_leaf cumulate_reward = 91.170
21-12-11 07:07:01.661 - INFO: iter = 740 alg = egreedy_category cumulate_reward = 111.624
21-12-11 07:07:01.662 - INFO: iter = 750 alg = hcb cumulate_reward = 162.047
21-12-11 07:07:01.663 - INFO: iter = 750 alg = phcb cumulate_reward = 257.719
21-12-11 07:07:01.663 - INFO: iter = 750 alg = naive_egreedy cumulate_reward = 50.291
21-12-11 07:07:01.664 - INFO: iter = 750 alg = egreedy_leaf cumulate_reward = 92.242
21-12-11 07:07:01.665 - INFO: iter = 750 alg = egreedy_category cumulate_reward = 114.163
21-12-11 07:07:01.666 - INFO: iter = 760 alg = hcb cumulate_reward = 164.711
21-12-11 07:07:01.667 - INFO: iter = 760 alg = phcb cumulate_reward = 262.771
21-12-11 07:07:01.668 - INFO: iter = 760 alg = naive_egreedy cumulate_reward = 50.638
21-12-11 07:07:01.669 - INFO: iter = 760 alg = egreedy_leaf cumulate_reward = 93.395
21-12-11 07:07:01.670 - INFO: iter = 760 alg = egreedy_category cumulate_reward = 115.858
21-12-11 07:07:01.671 - INFO: iter = 770 alg = hcb cumulate_reward = 167.013
21-12-11 07:07:01.671 - INFO: iter = 770 alg = phcb cumulate_reward = 267.783
21-12-11 07:07:01.672 - INFO: iter = 770 alg = naive_egreedy cumulate_reward = 51.044
21-12-11 07:07:01.673 - INFO: iter = 770 alg = egreedy_leaf cumulate_reward = 94.801
21-12-11 07:07:01.674 - INFO: iter = 770 alg = egreedy_category cumulate_reward = 117.871
21-12-11 07:07:01.675 - INFO: iter = 780 alg = hcb cumulate_reward = 169.464
21-12-11 07:07:01.676 - INFO: iter = 780 alg = phcb cumulate_reward = 273.764
21-12-11 07:07:01.677 - INFO: iter = 780 alg = naive_egreedy cumulate_reward = 51.444
21-12-11 07:07:01.678 - INFO: iter = 780 alg = egreedy_leaf cumulate_reward = 96.254
21-12-11 07:07:01.679 - INFO: iter = 780 alg = egreedy_category cumulate_reward = 120.645
21-12-11 07:07:01.680 - INFO: iter = 790 alg = hcb cumulate_reward = 171.889
21-12-11 07:07:01.681 - INFO: iter = 790 alg = phcb cumulate_reward = 278.488
21-12-11 07:07:01.682 - INFO: iter = 790 alg = naive_egreedy cumulate_reward = 52.931
21-12-11 07:07:01.682 - INFO: iter = 790 alg = egreedy_leaf cumulate_reward = 97.274
21-12-11 07:07:01.683 - INFO: iter = 790 alg = egreedy_category cumulate_reward = 122.913
21-12-11 07:07:01.684 - INFO: iter = 800 alg = hcb cumulate_reward = 174.101
21-12-11 07:07:01.685 - INFO: iter = 800 alg = phcb cumulate_reward = 284.016
21-12-11 07:07:01.686 - INFO: iter = 800 alg = naive_egreedy cumulate_reward = 54.045
21-12-11 07:07:01.687 - INFO: iter = 800 alg = egreedy_leaf cumulate_reward = 99.601
21-12-11 07:07:01.688 - INFO: iter = 800 alg = egreedy_category cumulate_reward = 124.815
21-12-11 07:07:01.689 - INFO: iter = 810 alg = hcb cumulate_reward = 176.814
21-12-11 07:07:01.690 - INFO: iter = 810 alg = phcb cumulate_reward = 289.399
21-12-11 07:07:01.691 - INFO: iter = 810 alg = naive_egreedy cumulate_reward = 55.286
21-12-11 07:07:01.692 - INFO: iter = 810 alg = egreedy_leaf cumulate_reward = 101.518
21-12-11 07:07:01.693 - INFO: iter = 810 alg = egreedy_category cumulate_reward = 127.354
21-12-11 07:07:01.694 - INFO: iter = 820 alg = hcb cumulate_reward = 179.529
21-12-11 07:07:01.695 - INFO: iter = 820 alg = phcb cumulate_reward = 294.787
21-12-11 07:07:01.696 - INFO: iter = 820 alg = naive_egreedy cumulate_reward = 56.066
21-12-11 07:07:01.697 - INFO: iter = 820 alg = egreedy_leaf cumulate_reward = 103.467
21-12-11 07:07:01.698 - INFO: iter = 820 alg = egreedy_category cumulate_reward = 129.782
21-12-11 07:07:01.699 - INFO: iter = 830 alg = hcb cumulate_reward = 182.131
21-12-11 07:07:01.700 - INFO: iter = 830 alg = phcb cumulate_reward = 300.370
21-12-11 07:07:01.700 - INFO: iter = 830 alg = naive_egreedy cumulate_reward = 56.453
21-12-11 07:07:01.701 - INFO: iter = 830 alg = egreedy_leaf cumulate_reward = 104.820
21-12-11 07:07:01.704 - INFO: iter = 830 alg = egreedy_category cumulate_reward = 131.649
21-12-11 07:07:01.705 - INFO: iter = 840 alg = hcb cumulate_reward = 184.868
21-12-11 07:07:01.706 - INFO: iter = 840 alg = phcb cumulate_reward = 305.085
21-12-11 07:07:01.707 - INFO: iter = 840 alg = naive_egreedy cumulate_reward = 56.936
21-12-11 07:07:01.708 - INFO: iter = 840 alg = egreedy_leaf cumulate_reward = 106.659
21-12-11 07:07:01.709 - INFO: iter = 840 alg = egreedy_category cumulate_reward = 133.896
21-12-11 07:07:01.710 - INFO: iter = 850 alg = hcb cumulate_reward = 187.188
21-12-11 07:07:01.711 - INFO: iter = 850 alg = phcb cumulate_reward = 309.248
21-12-11 07:07:01.711 - INFO: iter = 850 alg = naive_egreedy cumulate_reward = 58.051
21-12-11 07:07:01.712 - INFO: iter = 850 alg = egreedy_leaf cumulate_reward = 107.685
21-12-11 07:07:01.718 - INFO: iter = 850 alg = egreedy_category cumulate_reward = 136.277
21-12-11 07:07:01.722 - INFO: iter = 860 alg = hcb cumulate_reward = 189.717
21-12-11 07:07:01.725 - INFO: iter = 860 alg = phcb cumulate_reward = 314.379
21-12-11 07:07:01.727 - INFO: iter = 860 alg = naive_egreedy cumulate_reward = 58.440
21-12-11 07:07:01.729 - INFO: iter = 860 alg = egreedy_leaf cumulate_reward = 109.437
21-12-11 07:07:01.731 - INFO: iter = 860 alg = egreedy_category cumulate_reward = 138.411
21-12-11 07:07:01.733 - INFO: iter = 870 alg = hcb cumulate_reward = 192.685
21-12-11 07:07:01.735 - INFO: iter = 870 alg = phcb cumulate_reward = 319.424
21-12-11 07:07:01.736 - INFO: iter = 870 alg = naive_egreedy cumulate_reward = 59.064
21-12-11 07:07:01.737 - INFO: iter = 870 alg = egreedy_leaf cumulate_reward = 110.583
21-12-11 07:07:01.739 - INFO: iter = 870 alg = egreedy_category cumulate_reward = 140.492
21-12-11 07:07:01.741 - INFO: iter = 880 alg = hcb cumulate_reward = 196.067
21-12-11 07:07:01.743 - INFO: iter = 880 alg = phcb cumulate_reward = 324.419
21-12-11 07:07:01.744 - INFO: iter = 880 alg = naive_egreedy cumulate_reward = 60.448
21-12-11 07:07:01.745 - INFO: iter = 880 alg = egreedy_leaf cumulate_reward = 112.195
21-12-11 07:07:01.747 - INFO: iter = 880 alg = egreedy_category cumulate_reward = 142.620
21-12-11 07:07:01.748 - INFO: iter = 890 alg = hcb cumulate_reward = 198.956
21-12-11 07:07:01.749 - INFO: iter = 890 alg = phcb cumulate_reward = 329.019
21-12-11 07:07:01.751 - INFO: iter = 890 alg = naive_egreedy cumulate_reward = 61.604
21-12-11 07:07:01.753 - INFO: iter = 890 alg = egreedy_leaf cumulate_reward = 113.758
21-12-11 07:07:01.755 - INFO: iter = 890 alg = egreedy_category cumulate_reward = 144.704
21-12-11 07:07:01.757 - INFO: iter = 900 alg = hcb cumulate_reward = 201.800
21-12-11 07:07:01.759 - INFO: iter = 900 alg = phcb cumulate_reward = 334.238
21-12-11 07:07:01.761 - INFO: iter = 900 alg = naive_egreedy cumulate_reward = 61.883
21-12-11 07:07:01.762 - INFO: iter = 900 alg = egreedy_leaf cumulate_reward = 114.736
21-12-11 07:07:01.764 - INFO: iter = 900 alg = egreedy_category cumulate_reward = 147.139
21-12-11 07:07:01.765 - INFO: iter = 910 alg = hcb cumulate_reward = 204.856
21-12-11 07:07:01.766 - INFO: iter = 910 alg = phcb cumulate_reward = 339.043
21-12-11 07:07:01.768 - INFO: iter = 910 alg = naive_egreedy cumulate_reward = 62.378
21-12-11 07:07:01.770 - INFO: iter = 910 alg = egreedy_leaf cumulate_reward = 116.195
21-12-11 07:07:01.771 - INFO: iter = 910 alg = egreedy_category cumulate_reward = 149.802
21-12-11 07:07:01.773 - INFO: iter = 920 alg = hcb cumulate_reward = 207.746
21-12-11 07:07:01.774 - INFO: iter = 920 alg = phcb cumulate_reward = 344.445
21-12-11 07:07:01.776 - INFO: iter = 920 alg = naive_egreedy cumulate_reward = 62.753
21-12-11 07:07:01.786 - INFO: iter = 920 alg = egreedy_leaf cumulate_reward = 117.836
21-12-11 07:07:01.787 - INFO: iter = 920 alg = egreedy_category cumulate_reward = 152.284
21-12-11 07:07:01.790 - INFO: iter = 930 alg = hcb cumulate_reward = 210.271
21-12-11 07:07:01.792 - INFO: iter = 930 alg = phcb cumulate_reward = 350.013
21-12-11 07:07:01.793 - INFO: iter = 930 alg = naive_egreedy cumulate_reward = 63.573
21-12-11 07:07:01.795 - INFO: iter = 930 alg = egreedy_leaf cumulate_reward = 120.014
21-12-11 07:07:01.797 - INFO: iter = 930 alg = egreedy_category cumulate_reward = 154.366
21-12-11 07:07:01.799 - INFO: iter = 940 alg = hcb cumulate_reward = 212.954
21-12-11 07:07:01.802 - INFO: iter = 940 alg = phcb cumulate_reward = 355.169
21-12-11 07:07:01.803 - INFO: iter = 940 alg = naive_egreedy cumulate_reward = 64.657
21-12-11 07:07:01.804 - INFO: iter = 940 alg = egreedy_leaf cumulate_reward = 121.758
21-12-11 07:07:01.805 - INFO: iter = 940 alg = egreedy_category cumulate_reward = 157.386
21-12-11 07:07:01.806 - INFO: iter = 950 alg = hcb cumulate_reward = 216.061
21-12-11 07:07:01.807 - INFO: iter = 950 alg = phcb cumulate_reward = 360.530
21-12-11 07:07:01.808 - INFO: iter = 950 alg = naive_egreedy cumulate_reward = 65.429
21-12-11 07:07:01.810 - INFO: iter = 950 alg = egreedy_leaf cumulate_reward = 123.027
21-12-11 07:07:01.811 - INFO: iter = 950 alg = egreedy_category cumulate_reward = 159.887
21-12-11 07:07:01.812 - INFO: iter = 960 alg = hcb cumulate_reward = 218.529
21-12-11 07:07:01.813 - INFO: iter = 960 alg = phcb cumulate_reward = 365.537
21-12-11 07:07:01.816 - INFO: iter = 960 alg = naive_egreedy cumulate_reward = 66.215
21-12-11 07:07:01.817 - INFO: iter = 960 alg = egreedy_leaf cumulate_reward = 124.010
21-12-11 07:07:01.818 - INFO: iter = 960 alg = egreedy_category cumulate_reward = 162.894
21-12-11 07:07:01.819 - INFO: iter = 970 alg = hcb cumulate_reward = 221.723
21-12-11 07:07:01.820 - INFO: iter = 970 alg = phcb cumulate_reward = 371.330
21-12-11 07:07:01.824 - INFO: iter = 970 alg = naive_egreedy cumulate_reward = 67.335
21-12-11 07:07:01.826 - INFO: iter = 970 alg = egreedy_leaf cumulate_reward = 125.842
21-12-11 07:07:01.827 - INFO: iter = 970 alg = egreedy_category cumulate_reward = 165.400
21-12-11 07:07:01.829 - INFO: iter = 980 alg = hcb cumulate_reward = 224.460
21-12-11 07:07:01.830 - INFO: iter = 980 alg = phcb cumulate_reward = 376.782
21-12-11 07:07:01.831 - INFO: iter = 980 alg = naive_egreedy cumulate_reward = 68.317
21-12-11 07:07:01.832 - INFO: iter = 980 alg = egreedy_leaf cumulate_reward = 127.170
21-12-11 07:07:01.833 - INFO: iter = 980 alg = egreedy_category cumulate_reward = 168.463
21-12-11 07:07:01.834 - INFO: iter = 990 alg = hcb cumulate_reward = 227.485
21-12-11 07:07:01.835 - INFO: iter = 990 alg = phcb cumulate_reward = 381.906
21-12-11 07:07:01.836 - INFO: iter = 990 alg = naive_egreedy cumulate_reward = 68.897
21-12-11 07:07:01.837 - INFO: iter = 990 alg = egreedy_leaf cumulate_reward = 128.139
21-12-11 07:07:01.838 - INFO: iter = 990 alg = egreedy_category cumulate_reward = 170.738
21-12-11 07:07:01.839 - INFO: iter = 1000 alg = hcb cumulate_reward = 229.716
21-12-11 07:07:01.840 - INFO: iter = 1000 alg = phcb cumulate_reward = 386.052
21-12-11 07:07:01.841 - INFO: iter = 1000 alg = naive_egreedy cumulate_reward = 69.591
21-12-11 07:07:01.842 - INFO: iter = 1000 alg = egreedy_leaf cumulate_reward = 129.938
21-12-11 07:07:01.844 - INFO: iter = 1000 alg = egreedy_category cumulate_reward = 173.188
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="TS">TS<a class="anchor-link" href="#TS"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Config">Config<a class="anchor-link" href="#Config"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">config</span><span class="p">():</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">Params</span><span class="p">()</span>

    <span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span>         <span class="o">=</span> <span class="s1">&#39;MIND&#39;</span> <span class="c1">#TaoBao or MIND</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">T</span>               <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">k</span>               <span class="o">=</span> <span class="mi">1</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">activate_num</span>    <span class="o">=</span> <span class="mi">10</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">activate_prob</span>   <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">epsilon</span>         <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">new_tree_file</span>   <span class="o">=</span> <span class="s1">&#39;1000_10_btree_ts.pkl&#39;</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">noise_scale</span>     <span class="o">=</span> <span class="mf">0.001</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">keep_prob</span>       <span class="o">=</span> <span class="mf">0.0001</span>
    <span class="c1"># ts_para: the hyper-parameters for thompson sampling algorithm</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">ts_para</span>         <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;R&#39;</span><span class="p">:</span><span class="mf">0.0001</span><span class="p">,</span><span class="s1">&#39;delta&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;epsilon&#39;</span><span class="p">:</span><span class="mf">0.05</span><span class="p">,</span><span class="s1">&#39;lambda&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;dim&#39;</span><span class="p">:{</span><span class="s1">&#39;MIND&#39;</span><span class="p">:</span><span class="mi">64</span><span class="p">,</span><span class="s1">&#39;TaoBao&#39;</span><span class="p">:</span><span class="mi">32</span><span class="p">},</span><span class="s1">&#39;reduce_dim&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">}</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span>        <span class="o">=</span> <span class="mi">50</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">random_choice</span>   <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">cfg</span>

<span class="n">cfg</span> <span class="o">=</span> <span class="n">config</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Items">Items<a class="anchor-link" href="#Items"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">Item</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gid</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">bias</span><span class="p">,</span><span class="n">para</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gid</span>     <span class="o">=</span> <span class="n">gid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span>      <span class="o">=</span> <span class="p">{}</span> <span class="c1">#feature vector for training/simulator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x1</span> <span class="c1">#training</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x2</span> <span class="c1">#simulator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bias</span> <span class="c1">#bias</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para</span>    <span class="o">=</span> <span class="n">para</span> <span class="c1">#other info</span>

<span class="k">class</span> <span class="nc">ItemManager</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span>    <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span>   <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_items</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">load_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">item_info</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">j_s</span> <span class="ow">in</span> <span class="n">item_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">gid</span> <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;gid&#39;</span><span class="p">]</span>
            <span class="n">x1</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">]</span>
            <span class="n">x2</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">]</span>
            <span class="n">bias</span><span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span>
            <span class="n">para</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">para</span><span class="p">[</span><span class="s1">&#39;category2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;category2&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">gid</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">bias</span><span class="p">,</span><span class="n">para</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_items</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Users">Users<a class="anchor-link" href="#Users"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">bias</span><span class="p">,</span><span class="n">para</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span>     <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span>      <span class="o">=</span> <span class="p">{}</span> <span class="c1">#feature vector for training/simulator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x1</span> <span class="c1"># training</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x2</span> <span class="c1"># simulator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bias</span> <span class="c1"># simulator bias</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">para</span>    <span class="o">=</span> <span class="n">para</span> <span class="c1">#other info</span>

<span class="k">class</span> <span class="nc">UserManager</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span>    <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span>   <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_users</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">load_users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user_info</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">j_s</span> <span class="ow">in</span> <span class="n">user_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">&gt;</span><span class="n">cfg</span><span class="o">.</span><span class="n">keep_prob</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">uid</span> <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span>
            <span class="n">x1</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">]</span>
            <span class="n">x2</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">]</span>
            <span class="n">bias</span><span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">bias</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_users</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_nnexp_users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">user_info</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
        <span class="n">user_info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">user_info</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;gini&#39;</span><span class="p">],</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_users</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">user_info</span><span class="p">)</span><span class="o">*</span><span class="n">cfg</span><span class="o">.</span><span class="n">keep_prob</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">uid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">user_info</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">&gt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_users</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">j_s</span> <span class="o">=</span> <span class="n">user_info</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
            <span class="n">uid</span> <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]</span>
            <span class="n">x1</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">]</span>
            <span class="n">x2</span>  <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">]</span>
            <span class="n">bias</span><span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;bias&#39;</span><span class="p">]</span>
            <span class="n">his</span> <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;his&#39;</span><span class="p">]</span>
            <span class="n">imp</span> <span class="o">=</span> <span class="n">j_s</span><span class="p">[</span><span class="s1">&#39;imp&#39;</span><span class="p">]</span>
            <span class="n">para</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;his&#39;</span><span class="p">:</span><span class="n">his</span><span class="p">,</span><span class="s1">&#39;imp&#39;</span><span class="p">:</span><span class="n">imp</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">bias</span><span class="p">,</span><span class="n">para</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_users</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Naive-TS">Naive TS<a class="anchor-link" href="#Naive-TS"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">TSUserStructNTS</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">,</span> <span class="n">v_squared</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">lambda_</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span> <span class="o">=</span> <span class="n">v_squared</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fv</span><span class="p">,</span> <span class="n">reward</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">fv</span><span class="p">,</span> <span class="n">fv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">+=</span> <span class="n">fv</span><span class="o">*</span><span class="n">reward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getProb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fv</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_estimate</span><span class="p">,</span> <span class="n">fv</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NaiveTS</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">para</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="n">para</span><span class="p">[</span><span class="s1">&#39;reduce_dim&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_v_squared</span><span class="p">(</span><span class="n">para</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">],</span> <span class="n">para</span><span class="p">[</span><span class="s1">&#39;epsilon&#39;</span><span class="p">],</span> <span class="n">para</span><span class="p">[</span><span class="s1">&#39;delta&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span> <span class="o">=</span> <span class="n">para</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_v_squared</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="o">/</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">delta</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">v</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">decide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">=</span><span class="n">TSUserStructNTS</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span><span class="p">)</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">arm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arms</span><span class="p">):</span>
            <span class="c1">#each item is an arm</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">getProb</span><span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">reward</span><span class="o">&gt;</span><span class="n">max_r</span><span class="p">:</span>
                <span class="n">aid</span> <span class="o">=</span> <span class="n">index</span>
                <span class="n">max_r</span> <span class="o">=</span> <span class="n">reward</span>
        <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">arms</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">arm_picker</span>

    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">picked_arm</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">uid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">picked_arm</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span><span class="n">reward</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="HCB">HCB<a class="anchor-link" href="#HCB"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">TSBaseStructHCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="n">lambda_</span><span class="p">,</span> <span class="n">v_squared</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">lambda_</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span> <span class="o">=</span> <span class="n">v_squared</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fv</span><span class="p">,</span> <span class="n">reward</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">fv</span><span class="p">,</span> <span class="n">fv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">+=</span> <span class="n">fv</span><span class="o">*</span><span class="n">reward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getProb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fv</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_estimate</span><span class="p">,</span> <span class="n">fv</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TSUserStructHCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">root</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_ts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cfg</span><span class="o">.</span><span class="n">random_choice</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">NaiveTS</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">ts_para</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">HTS</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">para</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_depth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">new_tree_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="n">para</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">][</span><span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_v_squared</span><span class="p">(</span><span class="n">para</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">],</span> <span class="n">para</span><span class="p">[</span><span class="s1">&#39;epsilon&#39;</span><span class="p">],</span> <span class="n">para</span><span class="p">[</span><span class="s1">&#39;delta&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span> <span class="o">=</span> <span class="n">para</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_v_squared</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="o">/</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">delta</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">v</span> <span class="o">**</span> <span class="mi">2</span>


    <span class="k">def</span> <span class="nf">decide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">=</span><span class="n">TSUserStructHCB</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">current_node</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">root</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">user</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span><span class="p">(</span><span class="n">current_node</span><span class="o">.</span><span class="n">is_leaf</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">children</span> <span class="o">=</span> <span class="n">current_node</span><span class="o">.</span><span class="n">children</span>
            <span class="n">max_r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
            <span class="n">aid</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">depth</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">base_ts</span><span class="p">:</span>
                <span class="n">user</span><span class="o">.</span><span class="n">base_ts</span><span class="p">[</span><span class="n">depth</span><span class="p">]</span> <span class="o">=</span> <span class="n">TSBaseStructHCB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span><span class="p">)</span>
            <span class="n">poolsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">total_depth</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">poolsize</span><span class="p">:</span>
                <span class="n">arms</span> <span class="o">=</span> <span class="n">children</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">),</span><span class="n">poolsize</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">aids</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">arm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arms</span><span class="p">):</span>
                <span class="n">reward</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">base_ts</span><span class="p">[</span><span class="n">depth</span><span class="p">]</span><span class="o">.</span><span class="n">getProb</span><span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">emb</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">reward</span><span class="o">&gt;</span><span class="n">max_r</span><span class="p">:</span>
                    <span class="n">aid</span> <span class="o">=</span> <span class="n">index</span>
                    <span class="n">max_r</span> <span class="o">=</span> <span class="n">reward</span>
            <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">arms</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span>
            <span class="n">user</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arm_picker</span><span class="p">)</span>
            <span class="n">current_node</span> <span class="o">=</span> <span class="n">arm_picker</span>
            <span class="n">depth</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">arm_picker</span><span class="p">,</span><span class="n">aid</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">feedback</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">path</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">arm_picker</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">user</span><span class="o">.</span><span class="n">base_ts</span><span class="p">[</span><span class="n">depth</span><span class="p">]</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">emb</span><span class="p">,</span><span class="n">feedback</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="pHCB">pHCB<a class="anchor-link" href="#pHCB"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">ArmStructPHCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arm</span><span class="p">,</span><span class="n">depth</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arm</span> <span class="o">=</span> <span class="n">arm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gids</span> <span class="o">=</span> <span class="n">arm</span><span class="o">.</span><span class="n">gids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span> <span class="c1"># only when arm is a tree node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemclick</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feedback</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vv</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vv</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">&lt;</span><span class="n">cfg</span><span class="o">.</span><span class="n">activate_num</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vv</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">&lt;</span><span class="n">cfg</span><span class="o">.</span><span class="n">activate_prob</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

<span class="k">class</span> <span class="nc">TSUserStructPHCB</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span><span class="n">lambda_</span><span class="p">,</span> <span class="n">v_squared</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="n">arms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">lambda_</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span> <span class="o">=</span> <span class="n">v_squared</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cfg</span><span class="o">.</span><span class="n">random_choice</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">NaiveTS</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">ts_para</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fv</span><span class="p">,</span> <span class="n">reward</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">fv</span><span class="p">,</span> <span class="n">fv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">+=</span> <span class="n">fv</span><span class="o">*</span><span class="n">reward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getProb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fv</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_estimate</span><span class="p">,</span> <span class="n">fv</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">pHTS</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">para</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="n">para</span><span class="p">[</span><span class="s1">&#39;dim&#39;</span><span class="p">][</span><span class="n">cfg</span><span class="o">.</span><span class="n">dataset</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_v_squared</span><span class="p">(</span><span class="n">para</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">],</span> <span class="n">para</span><span class="p">[</span><span class="s1">&#39;epsilon&#39;</span><span class="p">],</span> <span class="n">para</span><span class="p">[</span><span class="s1">&#39;delta&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span> <span class="o">=</span> <span class="n">para</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_v_squared</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="o">/</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">delta</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">v</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">decide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">arms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">arms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ArmStructPHCB</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">=</span><span class="n">TSUserStructPHCB</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span><span class="p">)</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">:</span>
            <span class="n">aids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">),</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">aids</span><span class="p">:</span>
            <span class="n">arm</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">arm</span><span class="o">.</span><span class="n">depth</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">getProb</span><span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">emb</span><span class="p">)</span><span class="o">*</span><span class="n">depth</span>
            <span class="k">if</span> <span class="n">reward</span><span class="o">&gt;</span><span class="n">max_r</span><span class="p">:</span>
                <span class="n">aid</span> <span class="o">=</span> <span class="n">index</span>
                <span class="n">max_r</span> <span class="o">=</span> <span class="n">reward</span>
        <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">arm_picker</span><span class="p">,</span><span class="n">aid</span>


    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">picked_arm</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">uid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">picked_arm</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">emb</span><span class="p">,</span><span class="n">reward</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">feedback</span><span class="p">):</span>
        <span class="n">gid</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">gid</span>
        <span class="n">arm_picker</span><span class="o">.</span><span class="n">feedback</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">+=</span> <span class="n">feedback</span>
        <span class="n">arm_picker</span><span class="o">.</span><span class="n">vv</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">arm_picker</span><span class="o">.</span><span class="n">itemclick</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">feedback</span><span class="p">,</span><span class="n">uid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arm_picker</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span> <span class="ow">and</span> <span class="n">arm_picker</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">is_leaf</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">arm_picker</span><span class="o">.</span><span class="n">depth</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">aid</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">arm_picker</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">arm</span> <span class="o">=</span> <span class="n">ArmStructPHCB</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">depth</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">arm</span><span class="o">.</span><span class="n">gids</span><span class="p">:</span>
                    <span class="n">arm</span><span class="o">.</span><span class="n">itemclick</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">=</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">itemclick</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
                    <span class="n">arm</span><span class="o">.</span><span class="n">feedback</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">=</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">feedback</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
                    <span class="n">arm</span><span class="o">.</span><span class="n">vv</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">=</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">vv</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
                <span class="n">user</span><span class="o">.</span><span class="n">arms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="CTS">CTS<a class="anchor-link" href="#CTS"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">ArmStructCTS</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arm</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arm</span> <span class="o">=</span> <span class="n">arm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gids</span> <span class="o">=</span> <span class="n">arm</span><span class="o">.</span><span class="n">gids</span>

<span class="k">class</span> <span class="nc">TSUserStructCTS</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="n">lambda_</span><span class="p">,</span> <span class="n">v_squared</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">uid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">lambda_</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span> <span class="o">=</span> <span class="n">v_squared</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cfg</span><span class="o">.</span><span class="n">random_choice</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">NaiveTS</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">ts_para</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fv</span><span class="p">,</span> <span class="n">reward</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">fv</span><span class="p">,</span> <span class="n">fv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">+=</span> <span class="n">fv</span><span class="o">*</span><span class="n">reward</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_estimate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_hat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getProb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fv</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_estimate</span><span class="p">,</span> <span class="n">fv</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CTS</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">para</span><span class="p">,</span><span class="n">arms</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="n">ArmStructCTS</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span> <span class="k">for</span> <span class="n">arm</span> <span class="ow">in</span> <span class="n">arms</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_v_squared</span><span class="p">(</span><span class="n">para</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">],</span> <span class="n">para</span><span class="p">[</span><span class="s1">&#39;epsilon&#39;</span><span class="p">],</span> <span class="n">para</span><span class="p">[</span><span class="s1">&#39;delta&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span> <span class="o">=</span> <span class="n">para</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_v_squared</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="o">/</span><span class="n">epsilon</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">delta</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">v</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">decide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">=</span><span class="n">TSUserStructCTS</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">v_squared</span><span class="p">)</span>
            <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">aid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_r</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">:</span>
            <span class="n">arms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">),</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">aids</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">arm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arms</span><span class="p">):</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">getProb</span><span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">emb</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reward</span><span class="o">&gt;</span><span class="n">max_r</span><span class="p">:</span>
                <span class="n">aid</span> <span class="o">=</span> <span class="n">index</span>
                <span class="n">max_r</span> <span class="o">=</span> <span class="n">reward</span>
        <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">arms</span><span class="p">[</span><span class="n">aid</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">arm_picker</span><span class="p">,</span><span class="n">aid</span>


    <span class="k">def</span> <span class="nf">updateParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">picked_arm</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">uid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">picked_arm</span><span class="o">.</span><span class="n">arm</span><span class="o">.</span><span class="n">emb</span><span class="p">,</span><span class="n">reward</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">feedback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">feedback</span><span class="p">,</span><span class="n">uid</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Simulation">Simulation<a class="anchor-link" href="#Simulation"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">Tree</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emb</span>         <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span>        <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gids</span>        <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span>    <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_leaf</span>     <span class="o">=</span> <span class="kc">False</span>

<span class="k">class</span> <span class="nc">simulateExp</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">users</span><span class="p">,</span><span class="n">items</span><span class="p">,</span><span class="n">tree</span><span class="p">,</span><span class="n">out_folder</span><span class="p">,</span><span class="n">test_iter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="n">users</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span>  <span class="o">=</span> <span class="n">tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_folder</span> <span class="o">=</span> <span class="n">out_folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_iter</span> <span class="o">=</span> <span class="n">test_iter</span>

    <span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">noise_scale</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_feedback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">uid</span><span class="p">,</span><span class="n">gid</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span><span class="n">item</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">user</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_candidatePool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">gids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">select_gids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">gids</span><span class="p">,</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">arms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">select_gids</span><span class="p">:</span>
            <span class="n">arms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">arms</span>


    <span class="k">def</span> <span class="nf">get_leafNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">root</span><span class="p">):</span>
        <span class="c1"># current = [self.tree]</span>
        <span class="n">current</span> <span class="o">=</span> <span class="p">[</span><span class="n">root</span><span class="p">]</span>
        <span class="n">leafNodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">current</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">:</span>
                    <span class="n">leafNodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">temp</span> <span class="o">+=</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="k">return</span> <span class="n">leafNodes</span>


    <span class="k">def</span> <span class="nf">get_categoryNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span>
        <span class="n">categoryNodes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span>
            <span class="n">category</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">para</span><span class="p">[</span><span class="s1">&#39;category2&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">categoryNodes</span><span class="p">:</span>
                <span class="n">categoryNodes</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">()</span>
            <span class="n">categoryNodes</span><span class="p">[</span><span class="n">category</span><span class="p">]</span><span class="o">.</span><span class="n">gids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">node</span> <span class="ow">in</span> <span class="n">categoryNodes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">gids</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">.</span><span class="n">fv</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">emb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">emb</span> <span class="o">=</span> <span class="n">emb</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">simulationPerUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">user</span><span class="p">,</span><span class="n">iters</span><span class="p">):</span>
        <span class="n">process_id</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[simulationPerUser] uid: </span><span class="si">%d</span><span class="s1">, process_id: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span> <span class="n">process_id</span><span class="p">))</span>
        <span class="n">user_reward</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">iter_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iters</span><span class="p">):</span>
            <span class="n">cur_iter_noise</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="p">()</span>
            <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">algname</span><span class="p">,</span><span class="n">alg</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">algname</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;naive_ts&#39;</span><span class="p">]:</span>
                    <span class="n">arms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_candidatePool</span><span class="p">()</span>
                    <span class="n">arm_picker</span> <span class="o">=</span> <span class="n">alg</span><span class="o">.</span><span class="n">decide</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">)</span>
                    <span class="n">feedback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feedback</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">gid</span><span class="p">)</span>
                    <span class="n">alg</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">feedback</span><span class="p">,</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
                    <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">][</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="n">feedback</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">arm_picker</span><span class="p">,</span><span class="n">aid</span> <span class="o">=</span> <span class="n">alg</span><span class="o">.</span><span class="n">decide</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">random_choice</span><span class="p">:</span>
                    <span class="n">replace</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">gids</span><span class="p">)</span><span class="o">&lt;</span><span class="n">cfg</span><span class="o">.</span><span class="n">k</span> <span class="k">else</span> <span class="kc">False</span>
                    <span class="n">gids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">gids</span><span class="p">,</span><span class="n">cfg</span><span class="o">.</span><span class="n">k</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="n">replace</span><span class="p">)</span>
                    <span class="n">all_feedback</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">gids</span><span class="p">:</span>
                        <span class="n">feedback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feedback</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">gid</span><span class="p">)</span>
                        <span class="n">alg</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">gid</span><span class="p">,</span><span class="n">feedback</span><span class="p">)</span>
                        <span class="n">all_feedback</span> <span class="o">+=</span> <span class="n">feedback</span>
                    <span class="n">avg_feedback</span> <span class="o">=</span> <span class="n">all_feedback</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">gids</span><span class="p">)</span>
                    <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">][</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_feedback</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">gids</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">:</span>
                        <span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">arm_picker</span><span class="o">.</span><span class="n">gids</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span> <span class="k">for</span> <span class="n">gid</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">arm_picker</span><span class="o">.</span><span class="n">gids</span><span class="p">,</span><span class="n">cfg</span><span class="o">.</span><span class="n">poolsize</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">alg</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">decide</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">arms</span><span class="p">)</span>
                    <span class="n">feedback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feedback</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">gid</span><span class="p">)</span>
                    <span class="n">alg</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span><span class="n">aid</span><span class="p">,</span><span class="n">arm_picker</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">feedback</span><span class="p">)</span>
                    <span class="n">alg</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">updateParameters</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">feedback</span><span class="p">,</span><span class="n">user</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
                    <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">][</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="n">feedback</span>
        <span class="k">return</span> <span class="n">user_reward</span>

    <span class="k">def</span> <span class="nf">run_algorithms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">algorithms</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;run algorithms&#39;</span><span class="p">)</span>
        <span class="n">pool</span><span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">thread_num</span><span class="p">)</span>
        <span class="n">results</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">uid</span><span class="p">,</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">result</span><span class="o">=</span><span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simulationPerUser</span><span class="p">,(</span><span class="n">user</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">test_iter</span><span class="p">))</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
        <span class="n">all_user_reward</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">tmp_reward</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">all_user_reward</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp_reward</span><span class="p">)</span>

        <span class="n">AlgReward</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
            <span class="n">AlgReward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">iter_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_iter</span><span class="p">):</span>
            <span class="n">iter_avg_reward</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
                <span class="n">iter_avg_reward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">user_reward</span> <span class="ow">in</span> <span class="n">all_user_reward</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">]:</span>
                    <span class="n">iter_avg_reward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span> <span class="o">+=</span> <span class="n">user_reward</span><span class="p">[</span><span class="n">iter_</span><span class="p">][</span><span class="n">algname</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
                <span class="n">AlgReward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iter_avg_reward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">all_user_reward</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
            <span class="n">AlgReward</span><span class="p">[</span><span class="n">algname</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">AlgReward</span><span class="p">[</span><span class="n">algname</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">AlgReward</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">Users</span> <span class="o">=</span> <span class="n">UserManager</span><span class="p">(</span><span class="n">dir_path</span> <span class="o">+</span> <span class="s1">&#39;/user_info.pkl&#39;</span><span class="p">)</span>
    <span class="n">Items</span> <span class="o">=</span> <span class="n">ItemManager</span><span class="p">(</span><span class="n">dir_path</span> <span class="o">+</span> <span class="s1">&#39;/item_info_ts.pkl&#39;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">dir_path</span> <span class="o">+</span> <span class="s1">&#39;tree/&#39;</span> <span class="o">+</span> <span class="n">cfg</span><span class="o">.</span><span class="n">new_tree_file</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
    <span class="n">Users</span><span class="o">.</span><span class="n">load_users</span><span class="p">()</span>
    <span class="n">Items</span><span class="o">.</span><span class="n">load_items</span><span class="p">()</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">emb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">log_config</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span><span class="n">logger</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;number of users = </span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Users</span><span class="o">.</span><span class="n">n_users</span><span class="p">))</span>
    <span class="n">simiExp</span> <span class="o">=</span> <span class="n">simulateExp</span><span class="p">(</span><span class="n">Users</span><span class="o">.</span><span class="n">users</span><span class="p">,</span><span class="n">Items</span><span class="o">.</span><span class="n">items</span><span class="p">,</span><span class="n">root</span><span class="p">,</span><span class="n">dir_path</span><span class="p">,</span><span class="n">cfg</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">leafNodes</span> <span class="o">=</span> <span class="n">simiExp</span><span class="o">.</span><span class="n">get_leafNodes</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">categoryNodes</span> <span class="o">=</span> <span class="n">simiExp</span><span class="o">.</span><span class="n">get_categoryNodes</span><span class="p">()</span>
    <span class="n">algorithms</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">algorithms</span><span class="p">[</span><span class="s1">&#39;hcb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HTS</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">ts_para</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
    <span class="n">algorithms</span><span class="p">[</span><span class="s1">&#39;phcb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pHTS</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">ts_para</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
    <span class="n">algorithms</span><span class="p">[</span><span class="s1">&#39;naive_ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">NaiveTS</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">ts_para</span><span class="p">)</span>
    <span class="n">algorithms</span><span class="p">[</span><span class="s1">&#39;ts_leaf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CTS</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">ts_para</span><span class="p">,</span><span class="n">leafNodes</span><span class="p">)</span>
    <span class="n">algorithms</span><span class="p">[</span><span class="s1">&#39;ts_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CTS</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">ts_para</span><span class="p">,</span><span class="n">categoryNodes</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current algorithms = &#39;</span><span class="p">,</span><span class="n">algorithms</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">AlgReward</span> <span class="o">=</span> <span class="n">simiExp</span><span class="o">.</span><span class="n">run_algorithms</span><span class="p">(</span><span class="n">algorithms</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">iter_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">iter_</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">iter_</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">10</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">algname</span> <span class="ow">in</span> <span class="n">algorithms</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;iter = </span><span class="si">{:d}</span><span class="s1"> alg = </span><span class="si">{}</span><span class="s1"> cumulate_reward = </span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">iter_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">algname</span><span class="p">,</span><span class="n">AlgReward</span><span class="p">[</span><span class="n">algname</span><span class="p">][</span><span class="n">iter_</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>21-12-11 07:13:12.899 - INFO: dataset : MIND
21-12-11 07:13:12.901 - INFO: T : 1000
21-12-11 07:13:12.903 - INFO: k : 1
21-12-11 07:13:12.904 - INFO: activate_num : 10
21-12-11 07:13:12.906 - INFO: activate_prob : 0.1
21-12-11 07:13:12.907 - INFO: epsilon : 0.05
21-12-11 07:13:12.909 - INFO: new_tree_file : 1000_10_btree_ts.pkl
21-12-11 07:13:12.910 - INFO: noise_scale : 0.001
21-12-11 07:13:12.912 - INFO: keep_prob : 0.0001
21-12-11 07:13:12.913 - INFO: ts_para : {&#39;R&#39;: 0.0001, &#39;delta&#39;: 0.1, &#39;epsilon&#39;: 0.05, &#39;lambda&#39;: 0.1, &#39;dim&#39;: {&#39;MIND&#39;: 64, &#39;TaoBao&#39;: 32}, &#39;reduce_dim&#39;: 16}
21-12-11 07:13:12.914 - INFO: poolsize : 50
21-12-11 07:13:12.915 - INFO: random_choice : False
21-12-11 07:13:12.916 - INFO: number of users = 2
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>current algorithms =  dict_keys([&#39;hcb&#39;, &#39;phcb&#39;, &#39;naive_ts&#39;, &#39;ts_leaf&#39;, &#39;ts_category&#39;])
run algorithms
[simulationPerUser] uid: 709850, process_id: 577
[simulationPerUser] uid: 725620, process_id: 578
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>21-12-11 07:14:54.827 - INFO: iter = 1 alg = hcb cumulate_reward = 0.006
21-12-11 07:14:54.829 - INFO: iter = 1 alg = phcb cumulate_reward = 0.002
21-12-11 07:14:54.831 - INFO: iter = 1 alg = naive_ts cumulate_reward = 0.019
21-12-11 07:14:54.832 - INFO: iter = 1 alg = ts_leaf cumulate_reward = 0.000
21-12-11 07:14:54.834 - INFO: iter = 1 alg = ts_category cumulate_reward = 0.001
21-12-11 07:14:54.836 - INFO: iter = 10 alg = hcb cumulate_reward = 0.139
21-12-11 07:14:54.838 - INFO: iter = 10 alg = phcb cumulate_reward = 0.332
21-12-11 07:14:54.839 - INFO: iter = 10 alg = naive_ts cumulate_reward = 0.061
21-12-11 07:14:54.840 - INFO: iter = 10 alg = ts_leaf cumulate_reward = 0.091
21-12-11 07:14:54.842 - INFO: iter = 10 alg = ts_category cumulate_reward = 0.049
21-12-11 07:14:54.843 - INFO: iter = 20 alg = hcb cumulate_reward = 0.597
21-12-11 07:14:54.844 - INFO: iter = 20 alg = phcb cumulate_reward = 0.602
21-12-11 07:14:54.845 - INFO: iter = 20 alg = naive_ts cumulate_reward = 0.386
21-12-11 07:14:54.846 - INFO: iter = 20 alg = ts_leaf cumulate_reward = 0.463
21-12-11 07:14:54.847 - INFO: iter = 20 alg = ts_category cumulate_reward = 0.373
21-12-11 07:14:54.848 - INFO: iter = 30 alg = hcb cumulate_reward = 1.455
21-12-11 07:14:54.849 - INFO: iter = 30 alg = phcb cumulate_reward = 1.180
21-12-11 07:14:54.850 - INFO: iter = 30 alg = naive_ts cumulate_reward = 0.660
21-12-11 07:14:54.851 - INFO: iter = 30 alg = ts_leaf cumulate_reward = 0.926
21-12-11 07:14:54.852 - INFO: iter = 30 alg = ts_category cumulate_reward = 0.982
21-12-11 07:14:54.853 - INFO: iter = 40 alg = hcb cumulate_reward = 2.613
21-12-11 07:14:54.854 - INFO: iter = 40 alg = phcb cumulate_reward = 1.921
21-12-11 07:14:54.855 - INFO: iter = 40 alg = naive_ts cumulate_reward = 1.582
21-12-11 07:14:54.856 - INFO: iter = 40 alg = ts_leaf cumulate_reward = 1.692
21-12-11 07:14:54.857 - INFO: iter = 40 alg = ts_category cumulate_reward = 1.837
21-12-11 07:14:54.858 - INFO: iter = 50 alg = hcb cumulate_reward = 5.166
21-12-11 07:14:54.859 - INFO: iter = 50 alg = phcb cumulate_reward = 2.487
21-12-11 07:14:54.860 - INFO: iter = 50 alg = naive_ts cumulate_reward = 2.232
21-12-11 07:14:54.861 - INFO: iter = 50 alg = ts_leaf cumulate_reward = 2.482
21-12-11 07:14:54.862 - INFO: iter = 50 alg = ts_category cumulate_reward = 2.489
21-12-11 07:14:54.863 - INFO: iter = 60 alg = hcb cumulate_reward = 7.920
21-12-11 07:14:54.864 - INFO: iter = 60 alg = phcb cumulate_reward = 3.639
21-12-11 07:14:54.865 - INFO: iter = 60 alg = naive_ts cumulate_reward = 3.331
21-12-11 07:14:54.866 - INFO: iter = 60 alg = ts_leaf cumulate_reward = 3.568
21-12-11 07:14:54.867 - INFO: iter = 60 alg = ts_category cumulate_reward = 3.139
21-12-11 07:14:54.868 - INFO: iter = 70 alg = hcb cumulate_reward = 10.979
21-12-11 07:14:54.870 - INFO: iter = 70 alg = phcb cumulate_reward = 4.495
21-12-11 07:14:54.871 - INFO: iter = 70 alg = naive_ts cumulate_reward = 4.630
21-12-11 07:14:54.872 - INFO: iter = 70 alg = ts_leaf cumulate_reward = 5.058
21-12-11 07:14:54.873 - INFO: iter = 70 alg = ts_category cumulate_reward = 4.226
21-12-11 07:14:54.875 - INFO: iter = 80 alg = hcb cumulate_reward = 13.540
21-12-11 07:14:54.875 - INFO: iter = 80 alg = phcb cumulate_reward = 5.493
21-12-11 07:14:54.876 - INFO: iter = 80 alg = naive_ts cumulate_reward = 5.960
21-12-11 07:14:54.877 - INFO: iter = 80 alg = ts_leaf cumulate_reward = 6.639
21-12-11 07:14:54.878 - INFO: iter = 80 alg = ts_category cumulate_reward = 5.687
21-12-11 07:14:54.879 - INFO: iter = 90 alg = hcb cumulate_reward = 16.090
21-12-11 07:14:54.880 - INFO: iter = 90 alg = phcb cumulate_reward = 7.006
21-12-11 07:14:54.881 - INFO: iter = 90 alg = naive_ts cumulate_reward = 7.088
21-12-11 07:14:54.882 - INFO: iter = 90 alg = ts_leaf cumulate_reward = 8.791
21-12-11 07:14:54.883 - INFO: iter = 90 alg = ts_category cumulate_reward = 7.105
21-12-11 07:14:54.884 - INFO: iter = 100 alg = hcb cumulate_reward = 19.625
21-12-11 07:14:54.885 - INFO: iter = 100 alg = phcb cumulate_reward = 8.172
21-12-11 07:14:54.886 - INFO: iter = 100 alg = naive_ts cumulate_reward = 8.489
21-12-11 07:14:54.887 - INFO: iter = 100 alg = ts_leaf cumulate_reward = 10.460
21-12-11 07:14:54.888 - INFO: iter = 100 alg = ts_category cumulate_reward = 8.210
21-12-11 07:14:54.889 - INFO: iter = 110 alg = hcb cumulate_reward = 22.322
21-12-11 07:14:54.890 - INFO: iter = 110 alg = phcb cumulate_reward = 9.430
21-12-11 07:14:54.891 - INFO: iter = 110 alg = naive_ts cumulate_reward = 9.474
21-12-11 07:14:54.892 - INFO: iter = 110 alg = ts_leaf cumulate_reward = 12.175
21-12-11 07:14:54.893 - INFO: iter = 110 alg = ts_category cumulate_reward = 9.298
21-12-11 07:14:54.894 - INFO: iter = 120 alg = hcb cumulate_reward = 24.850
21-12-11 07:14:54.895 - INFO: iter = 120 alg = phcb cumulate_reward = 11.195
21-12-11 07:14:54.896 - INFO: iter = 120 alg = naive_ts cumulate_reward = 10.843
21-12-11 07:14:54.897 - INFO: iter = 120 alg = ts_leaf cumulate_reward = 14.160
21-12-11 07:14:54.898 - INFO: iter = 120 alg = ts_category cumulate_reward = 10.681
21-12-11 07:14:54.899 - INFO: iter = 130 alg = hcb cumulate_reward = 28.484
21-12-11 07:14:54.900 - INFO: iter = 130 alg = phcb cumulate_reward = 12.646
21-12-11 07:14:54.901 - INFO: iter = 130 alg = naive_ts cumulate_reward = 11.986
21-12-11 07:14:54.902 - INFO: iter = 130 alg = ts_leaf cumulate_reward = 16.930
21-12-11 07:14:54.903 - INFO: iter = 130 alg = ts_category cumulate_reward = 12.005
21-12-11 07:14:54.904 - INFO: iter = 140 alg = hcb cumulate_reward = 31.509
21-12-11 07:14:54.905 - INFO: iter = 140 alg = phcb cumulate_reward = 14.472
21-12-11 07:14:54.906 - INFO: iter = 140 alg = naive_ts cumulate_reward = 13.159
21-12-11 07:14:54.907 - INFO: iter = 140 alg = ts_leaf cumulate_reward = 18.929
21-12-11 07:14:54.908 - INFO: iter = 140 alg = ts_category cumulate_reward = 13.385
21-12-11 07:14:54.909 - INFO: iter = 150 alg = hcb cumulate_reward = 33.661
21-12-11 07:14:54.910 - INFO: iter = 150 alg = phcb cumulate_reward = 17.145
21-12-11 07:14:54.911 - INFO: iter = 150 alg = naive_ts cumulate_reward = 14.392
21-12-11 07:14:54.912 - INFO: iter = 150 alg = ts_leaf cumulate_reward = 22.030
21-12-11 07:14:54.913 - INFO: iter = 150 alg = ts_category cumulate_reward = 14.770
21-12-11 07:14:54.914 - INFO: iter = 160 alg = hcb cumulate_reward = 36.554
21-12-11 07:14:54.915 - INFO: iter = 160 alg = phcb cumulate_reward = 20.429
21-12-11 07:14:54.916 - INFO: iter = 160 alg = naive_ts cumulate_reward = 16.040
21-12-11 07:14:54.917 - INFO: iter = 160 alg = ts_leaf cumulate_reward = 23.421
21-12-11 07:14:54.918 - INFO: iter = 160 alg = ts_category cumulate_reward = 16.530
21-12-11 07:14:54.919 - INFO: iter = 170 alg = hcb cumulate_reward = 38.802
21-12-11 07:14:54.920 - INFO: iter = 170 alg = phcb cumulate_reward = 22.549
21-12-11 07:14:54.921 - INFO: iter = 170 alg = naive_ts cumulate_reward = 17.381
21-12-11 07:14:54.922 - INFO: iter = 170 alg = ts_leaf cumulate_reward = 24.921
21-12-11 07:14:54.923 - INFO: iter = 170 alg = ts_category cumulate_reward = 17.831
21-12-11 07:14:54.924 - INFO: iter = 180 alg = hcb cumulate_reward = 41.366
21-12-11 07:14:54.925 - INFO: iter = 180 alg = phcb cumulate_reward = 24.928
21-12-11 07:14:54.926 - INFO: iter = 180 alg = naive_ts cumulate_reward = 18.509
21-12-11 07:14:54.927 - INFO: iter = 180 alg = ts_leaf cumulate_reward = 28.062
21-12-11 07:14:54.928 - INFO: iter = 180 alg = ts_category cumulate_reward = 19.177
21-12-11 07:14:54.928 - INFO: iter = 190 alg = hcb cumulate_reward = 44.236
21-12-11 07:14:54.929 - INFO: iter = 190 alg = phcb cumulate_reward = 27.962
21-12-11 07:14:54.930 - INFO: iter = 190 alg = naive_ts cumulate_reward = 20.254
21-12-11 07:14:54.931 - INFO: iter = 190 alg = ts_leaf cumulate_reward = 30.512
21-12-11 07:14:54.932 - INFO: iter = 190 alg = ts_category cumulate_reward = 20.636
21-12-11 07:14:54.933 - INFO: iter = 200 alg = hcb cumulate_reward = 46.534
21-12-11 07:14:54.934 - INFO: iter = 200 alg = phcb cumulate_reward = 30.286
21-12-11 07:14:54.935 - INFO: iter = 200 alg = naive_ts cumulate_reward = 21.424
21-12-11 07:14:54.936 - INFO: iter = 200 alg = ts_leaf cumulate_reward = 33.012
21-12-11 07:14:54.938 - INFO: iter = 200 alg = ts_category cumulate_reward = 21.823
21-12-11 07:14:54.939 - INFO: iter = 210 alg = hcb cumulate_reward = 48.742
21-12-11 07:14:54.940 - INFO: iter = 210 alg = phcb cumulate_reward = 33.532
21-12-11 07:14:54.941 - INFO: iter = 210 alg = naive_ts cumulate_reward = 22.849
21-12-11 07:14:54.942 - INFO: iter = 210 alg = ts_leaf cumulate_reward = 35.046
21-12-11 07:14:54.942 - INFO: iter = 210 alg = ts_category cumulate_reward = 23.166
21-12-11 07:14:54.943 - INFO: iter = 220 alg = hcb cumulate_reward = 51.873
21-12-11 07:14:54.944 - INFO: iter = 220 alg = phcb cumulate_reward = 35.878
21-12-11 07:14:54.945 - INFO: iter = 220 alg = naive_ts cumulate_reward = 24.771
21-12-11 07:14:54.946 - INFO: iter = 220 alg = ts_leaf cumulate_reward = 37.213
21-12-11 07:14:54.947 - INFO: iter = 220 alg = ts_category cumulate_reward = 24.579
21-12-11 07:14:54.948 - INFO: iter = 230 alg = hcb cumulate_reward = 55.770
21-12-11 07:14:54.949 - INFO: iter = 230 alg = phcb cumulate_reward = 39.208
21-12-11 07:14:54.950 - INFO: iter = 230 alg = naive_ts cumulate_reward = 25.969
21-12-11 07:14:54.951 - INFO: iter = 230 alg = ts_leaf cumulate_reward = 39.476
21-12-11 07:14:54.952 - INFO: iter = 230 alg = ts_category cumulate_reward = 26.227
21-12-11 07:14:54.953 - INFO: iter = 240 alg = hcb cumulate_reward = 58.711
21-12-11 07:14:54.954 - INFO: iter = 240 alg = phcb cumulate_reward = 42.453
21-12-11 07:14:54.954 - INFO: iter = 240 alg = naive_ts cumulate_reward = 27.137
21-12-11 07:14:54.955 - INFO: iter = 240 alg = ts_leaf cumulate_reward = 41.580
21-12-11 07:14:54.957 - INFO: iter = 240 alg = ts_category cumulate_reward = 27.662
21-12-11 07:14:54.957 - INFO: iter = 250 alg = hcb cumulate_reward = 61.782
21-12-11 07:14:54.958 - INFO: iter = 250 alg = phcb cumulate_reward = 46.003
21-12-11 07:14:54.959 - INFO: iter = 250 alg = naive_ts cumulate_reward = 28.833
21-12-11 07:14:54.960 - INFO: iter = 250 alg = ts_leaf cumulate_reward = 43.551
21-12-11 07:14:54.961 - INFO: iter = 250 alg = ts_category cumulate_reward = 28.644
21-12-11 07:14:54.962 - INFO: iter = 260 alg = hcb cumulate_reward = 65.249
21-12-11 07:14:54.963 - INFO: iter = 260 alg = phcb cumulate_reward = 49.478
21-12-11 07:14:54.964 - INFO: iter = 260 alg = naive_ts cumulate_reward = 30.701
21-12-11 07:14:54.965 - INFO: iter = 260 alg = ts_leaf cumulate_reward = 45.958
21-12-11 07:14:54.966 - INFO: iter = 260 alg = ts_category cumulate_reward = 30.170
21-12-11 07:14:54.967 - INFO: iter = 270 alg = hcb cumulate_reward = 67.596
21-12-11 07:14:54.968 - INFO: iter = 270 alg = phcb cumulate_reward = 51.979
21-12-11 07:14:54.969 - INFO: iter = 270 alg = naive_ts cumulate_reward = 31.585
21-12-11 07:14:54.970 - INFO: iter = 270 alg = ts_leaf cumulate_reward = 49.295
21-12-11 07:14:54.971 - INFO: iter = 270 alg = ts_category cumulate_reward = 31.529
21-12-11 07:14:54.972 - INFO: iter = 280 alg = hcb cumulate_reward = 71.408
21-12-11 07:14:54.973 - INFO: iter = 280 alg = phcb cumulate_reward = 55.143
21-12-11 07:14:54.974 - INFO: iter = 280 alg = naive_ts cumulate_reward = 32.841
21-12-11 07:14:54.974 - INFO: iter = 280 alg = ts_leaf cumulate_reward = 52.681
21-12-11 07:14:54.975 - INFO: iter = 280 alg = ts_category cumulate_reward = 32.934
21-12-11 07:14:54.976 - INFO: iter = 290 alg = hcb cumulate_reward = 73.499
21-12-11 07:14:54.977 - INFO: iter = 290 alg = phcb cumulate_reward = 57.958
21-12-11 07:14:54.978 - INFO: iter = 290 alg = naive_ts cumulate_reward = 34.073
21-12-11 07:14:54.979 - INFO: iter = 290 alg = ts_leaf cumulate_reward = 55.728
21-12-11 07:14:54.980 - INFO: iter = 290 alg = ts_category cumulate_reward = 34.276
21-12-11 07:14:54.980 - INFO: iter = 300 alg = hcb cumulate_reward = 77.175
21-12-11 07:14:54.982 - INFO: iter = 300 alg = phcb cumulate_reward = 61.379
21-12-11 07:14:54.983 - INFO: iter = 300 alg = naive_ts cumulate_reward = 35.393
21-12-11 07:14:54.984 - INFO: iter = 300 alg = ts_leaf cumulate_reward = 57.642
21-12-11 07:14:54.984 - INFO: iter = 300 alg = ts_category cumulate_reward = 35.901
21-12-11 07:14:54.986 - INFO: iter = 310 alg = hcb cumulate_reward = 80.895
21-12-11 07:14:54.986 - INFO: iter = 310 alg = phcb cumulate_reward = 64.958
21-12-11 07:14:54.987 - INFO: iter = 310 alg = naive_ts cumulate_reward = 37.370
21-12-11 07:14:54.988 - INFO: iter = 310 alg = ts_leaf cumulate_reward = 60.098
21-12-11 07:14:54.989 - INFO: iter = 310 alg = ts_category cumulate_reward = 37.230
21-12-11 07:14:54.990 - INFO: iter = 320 alg = hcb cumulate_reward = 84.818
21-12-11 07:14:54.991 - INFO: iter = 320 alg = phcb cumulate_reward = 67.473
21-12-11 07:14:54.992 - INFO: iter = 320 alg = naive_ts cumulate_reward = 38.671
21-12-11 07:14:54.993 - INFO: iter = 320 alg = ts_leaf cumulate_reward = 62.964
21-12-11 07:14:54.994 - INFO: iter = 320 alg = ts_category cumulate_reward = 39.038
21-12-11 07:14:54.995 - INFO: iter = 330 alg = hcb cumulate_reward = 87.632
21-12-11 07:14:54.996 - INFO: iter = 330 alg = phcb cumulate_reward = 71.552
21-12-11 07:14:54.997 - INFO: iter = 330 alg = naive_ts cumulate_reward = 39.895
21-12-11 07:14:54.997 - INFO: iter = 330 alg = ts_leaf cumulate_reward = 66.106
21-12-11 07:14:54.999 - INFO: iter = 330 alg = ts_category cumulate_reward = 40.736
21-12-11 07:14:54.999 - INFO: iter = 340 alg = hcb cumulate_reward = 91.131
21-12-11 07:14:55.000 - INFO: iter = 340 alg = phcb cumulate_reward = 75.028
21-12-11 07:14:55.001 - INFO: iter = 340 alg = naive_ts cumulate_reward = 41.021
21-12-11 07:14:55.002 - INFO: iter = 340 alg = ts_leaf cumulate_reward = 69.213
21-12-11 07:14:55.003 - INFO: iter = 340 alg = ts_category cumulate_reward = 42.119
21-12-11 07:14:55.004 - INFO: iter = 350 alg = hcb cumulate_reward = 95.146
21-12-11 07:14:55.005 - INFO: iter = 350 alg = phcb cumulate_reward = 78.721
21-12-11 07:14:55.006 - INFO: iter = 350 alg = naive_ts cumulate_reward = 43.516
21-12-11 07:14:55.007 - INFO: iter = 350 alg = ts_leaf cumulate_reward = 72.285
21-12-11 07:14:55.008 - INFO: iter = 350 alg = ts_category cumulate_reward = 43.608
21-12-11 07:14:55.009 - INFO: iter = 360 alg = hcb cumulate_reward = 98.068
21-12-11 07:14:55.010 - INFO: iter = 360 alg = phcb cumulate_reward = 81.960
21-12-11 07:14:55.011 - INFO: iter = 360 alg = naive_ts cumulate_reward = 45.032
21-12-11 07:14:55.012 - INFO: iter = 360 alg = ts_leaf cumulate_reward = 73.902
21-12-11 07:14:55.013 - INFO: iter = 360 alg = ts_category cumulate_reward = 44.908
21-12-11 07:14:55.014 - INFO: iter = 370 alg = hcb cumulate_reward = 100.849
21-12-11 07:14:55.015 - INFO: iter = 370 alg = phcb cumulate_reward = 85.670
21-12-11 07:14:55.015 - INFO: iter = 370 alg = naive_ts cumulate_reward = 46.729
21-12-11 07:14:55.017 - INFO: iter = 370 alg = ts_leaf cumulate_reward = 76.788
21-12-11 07:14:55.017 - INFO: iter = 370 alg = ts_category cumulate_reward = 46.410
21-12-11 07:14:55.018 - INFO: iter = 380 alg = hcb cumulate_reward = 102.774
21-12-11 07:14:55.019 - INFO: iter = 380 alg = phcb cumulate_reward = 88.737
21-12-11 07:14:55.020 - INFO: iter = 380 alg = naive_ts cumulate_reward = 48.150
21-12-11 07:14:55.021 - INFO: iter = 380 alg = ts_leaf cumulate_reward = 79.434
21-12-11 07:14:55.022 - INFO: iter = 380 alg = ts_category cumulate_reward = 47.794
21-12-11 07:14:55.023 - INFO: iter = 390 alg = hcb cumulate_reward = 106.173
21-12-11 07:14:55.024 - INFO: iter = 390 alg = phcb cumulate_reward = 92.061
21-12-11 07:14:55.025 - INFO: iter = 390 alg = naive_ts cumulate_reward = 49.381
21-12-11 07:14:55.026 - INFO: iter = 390 alg = ts_leaf cumulate_reward = 82.514
21-12-11 07:14:55.027 - INFO: iter = 390 alg = ts_category cumulate_reward = 49.412
21-12-11 07:14:55.028 - INFO: iter = 400 alg = hcb cumulate_reward = 108.233
21-12-11 07:14:55.029 - INFO: iter = 400 alg = phcb cumulate_reward = 95.219
21-12-11 07:14:55.030 - INFO: iter = 400 alg = naive_ts cumulate_reward = 50.468
21-12-11 07:14:55.031 - INFO: iter = 400 alg = ts_leaf cumulate_reward = 85.451
21-12-11 07:14:55.032 - INFO: iter = 400 alg = ts_category cumulate_reward = 50.834
21-12-11 07:14:55.033 - INFO: iter = 410 alg = hcb cumulate_reward = 111.891
21-12-11 07:14:55.034 - INFO: iter = 410 alg = phcb cumulate_reward = 98.546
21-12-11 07:14:55.036 - INFO: iter = 410 alg = naive_ts cumulate_reward = 51.636
21-12-11 07:14:55.037 - INFO: iter = 410 alg = ts_leaf cumulate_reward = 88.626
21-12-11 07:14:55.038 - INFO: iter = 410 alg = ts_category cumulate_reward = 52.467
21-12-11 07:14:55.039 - INFO: iter = 420 alg = hcb cumulate_reward = 115.122
21-12-11 07:14:55.040 - INFO: iter = 420 alg = phcb cumulate_reward = 102.256
21-12-11 07:14:55.041 - INFO: iter = 420 alg = naive_ts cumulate_reward = 52.813
21-12-11 07:14:55.042 - INFO: iter = 420 alg = ts_leaf cumulate_reward = 90.894
21-12-11 07:14:55.043 - INFO: iter = 420 alg = ts_category cumulate_reward = 53.883
21-12-11 07:14:55.044 - INFO: iter = 430 alg = hcb cumulate_reward = 118.636
21-12-11 07:14:55.045 - INFO: iter = 430 alg = phcb cumulate_reward = 105.748
21-12-11 07:14:55.056 - INFO: iter = 430 alg = naive_ts cumulate_reward = 54.448
21-12-11 07:14:55.057 - INFO: iter = 430 alg = ts_leaf cumulate_reward = 95.183
21-12-11 07:14:55.058 - INFO: iter = 430 alg = ts_category cumulate_reward = 55.261
21-12-11 07:14:55.059 - INFO: iter = 440 alg = hcb cumulate_reward = 121.544
21-12-11 07:14:55.060 - INFO: iter = 440 alg = phcb cumulate_reward = 109.281
21-12-11 07:14:55.061 - INFO: iter = 440 alg = naive_ts cumulate_reward = 56.179
21-12-11 07:14:55.064 - INFO: iter = 440 alg = ts_leaf cumulate_reward = 97.832
21-12-11 07:14:55.065 - INFO: iter = 440 alg = ts_category cumulate_reward = 57.094
21-12-11 07:14:55.066 - INFO: iter = 450 alg = hcb cumulate_reward = 124.356
21-12-11 07:14:55.067 - INFO: iter = 450 alg = phcb cumulate_reward = 113.144
21-12-11 07:14:55.068 - INFO: iter = 450 alg = naive_ts cumulate_reward = 57.443
21-12-11 07:14:55.069 - INFO: iter = 450 alg = ts_leaf cumulate_reward = 101.299
21-12-11 07:14:55.070 - INFO: iter = 450 alg = ts_category cumulate_reward = 59.144
21-12-11 07:14:55.071 - INFO: iter = 460 alg = hcb cumulate_reward = 128.145
21-12-11 07:14:55.072 - INFO: iter = 460 alg = phcb cumulate_reward = 116.856
21-12-11 07:14:55.073 - INFO: iter = 460 alg = naive_ts cumulate_reward = 59.032
21-12-11 07:14:55.074 - INFO: iter = 460 alg = ts_leaf cumulate_reward = 104.324
21-12-11 07:14:55.075 - INFO: iter = 460 alg = ts_category cumulate_reward = 60.399
21-12-11 07:14:55.075 - INFO: iter = 470 alg = hcb cumulate_reward = 131.026
21-12-11 07:14:55.077 - INFO: iter = 470 alg = phcb cumulate_reward = 120.509
21-12-11 07:14:55.078 - INFO: iter = 470 alg = naive_ts cumulate_reward = 60.243
21-12-11 07:14:55.079 - INFO: iter = 470 alg = ts_leaf cumulate_reward = 107.142
21-12-11 07:14:55.080 - INFO: iter = 470 alg = ts_category cumulate_reward = 62.267
21-12-11 07:14:55.081 - INFO: iter = 480 alg = hcb cumulate_reward = 133.563
21-12-11 07:14:55.082 - INFO: iter = 480 alg = phcb cumulate_reward = 124.211
21-12-11 07:14:55.083 - INFO: iter = 480 alg = naive_ts cumulate_reward = 62.514
21-12-11 07:14:55.084 - INFO: iter = 480 alg = ts_leaf cumulate_reward = 110.631
21-12-11 07:14:55.085 - INFO: iter = 480 alg = ts_category cumulate_reward = 63.573
21-12-11 07:14:55.086 - INFO: iter = 490 alg = hcb cumulate_reward = 136.247
21-12-11 07:14:55.087 - INFO: iter = 490 alg = phcb cumulate_reward = 127.894
21-12-11 07:14:55.088 - INFO: iter = 490 alg = naive_ts cumulate_reward = 63.953
21-12-11 07:14:55.089 - INFO: iter = 490 alg = ts_leaf cumulate_reward = 113.805
21-12-11 07:14:55.090 - INFO: iter = 490 alg = ts_category cumulate_reward = 64.943
21-12-11 07:14:55.091 - INFO: iter = 500 alg = hcb cumulate_reward = 138.741
21-12-11 07:14:55.092 - INFO: iter = 500 alg = phcb cumulate_reward = 131.842
21-12-11 07:14:55.093 - INFO: iter = 500 alg = naive_ts cumulate_reward = 65.485
21-12-11 07:14:55.094 - INFO: iter = 500 alg = ts_leaf cumulate_reward = 118.004
21-12-11 07:14:55.095 - INFO: iter = 500 alg = ts_category cumulate_reward = 66.419
21-12-11 07:14:55.096 - INFO: iter = 510 alg = hcb cumulate_reward = 142.443
21-12-11 07:14:55.097 - INFO: iter = 510 alg = phcb cumulate_reward = 135.145
21-12-11 07:14:55.099 - INFO: iter = 510 alg = naive_ts cumulate_reward = 66.569
21-12-11 07:14:55.101 - INFO: iter = 510 alg = ts_leaf cumulate_reward = 120.300
21-12-11 07:14:55.102 - INFO: iter = 510 alg = ts_category cumulate_reward = 67.668
21-12-11 07:14:55.103 - INFO: iter = 520 alg = hcb cumulate_reward = 145.509
21-12-11 07:14:55.104 - INFO: iter = 520 alg = phcb cumulate_reward = 138.753
21-12-11 07:14:55.105 - INFO: iter = 520 alg = naive_ts cumulate_reward = 67.669
21-12-11 07:14:55.106 - INFO: iter = 520 alg = ts_leaf cumulate_reward = 123.171
21-12-11 07:14:55.107 - INFO: iter = 520 alg = ts_category cumulate_reward = 68.883
21-12-11 07:14:55.108 - INFO: iter = 530 alg = hcb cumulate_reward = 148.946
21-12-11 07:14:55.109 - INFO: iter = 530 alg = phcb cumulate_reward = 143.516
21-12-11 07:14:55.110 - INFO: iter = 530 alg = naive_ts cumulate_reward = 68.780
21-12-11 07:14:55.111 - INFO: iter = 530 alg = ts_leaf cumulate_reward = 125.911
21-12-11 07:14:55.112 - INFO: iter = 530 alg = ts_category cumulate_reward = 70.261
21-12-11 07:14:55.113 - INFO: iter = 540 alg = hcb cumulate_reward = 151.932
21-12-11 07:14:55.114 - INFO: iter = 540 alg = phcb cumulate_reward = 147.450
21-12-11 07:14:55.115 - INFO: iter = 540 alg = naive_ts cumulate_reward = 70.351
21-12-11 07:14:55.116 - INFO: iter = 540 alg = ts_leaf cumulate_reward = 129.314
21-12-11 07:14:55.117 - INFO: iter = 540 alg = ts_category cumulate_reward = 71.964
21-12-11 07:14:55.118 - INFO: iter = 550 alg = hcb cumulate_reward = 155.102
21-12-11 07:14:55.121 - INFO: iter = 550 alg = phcb cumulate_reward = 151.254
21-12-11 07:14:55.122 - INFO: iter = 550 alg = naive_ts cumulate_reward = 72.102
21-12-11 07:14:55.123 - INFO: iter = 550 alg = ts_leaf cumulate_reward = 132.770
21-12-11 07:14:55.124 - INFO: iter = 550 alg = ts_category cumulate_reward = 73.494
21-12-11 07:14:55.125 - INFO: iter = 560 alg = hcb cumulate_reward = 158.697
21-12-11 07:14:55.126 - INFO: iter = 560 alg = phcb cumulate_reward = 154.452
21-12-11 07:14:55.127 - INFO: iter = 560 alg = naive_ts cumulate_reward = 73.430
21-12-11 07:14:55.128 - INFO: iter = 560 alg = ts_leaf cumulate_reward = 135.945
21-12-11 07:14:55.128 - INFO: iter = 560 alg = ts_category cumulate_reward = 74.967
21-12-11 07:14:55.130 - INFO: iter = 570 alg = hcb cumulate_reward = 161.723
21-12-11 07:14:55.131 - INFO: iter = 570 alg = phcb cumulate_reward = 158.269
21-12-11 07:14:55.132 - INFO: iter = 570 alg = naive_ts cumulate_reward = 74.357
21-12-11 07:14:55.132 - INFO: iter = 570 alg = ts_leaf cumulate_reward = 137.993
21-12-11 07:14:55.134 - INFO: iter = 570 alg = ts_category cumulate_reward = 76.895
21-12-11 07:14:55.134 - INFO: iter = 580 alg = hcb cumulate_reward = 165.171
21-12-11 07:14:55.136 - INFO: iter = 580 alg = phcb cumulate_reward = 161.490
21-12-11 07:14:55.137 - INFO: iter = 580 alg = naive_ts cumulate_reward = 75.869
21-12-11 07:14:55.137 - INFO: iter = 580 alg = ts_leaf cumulate_reward = 141.706
21-12-11 07:14:55.138 - INFO: iter = 580 alg = ts_category cumulate_reward = 79.176
21-12-11 07:14:55.139 - INFO: iter = 590 alg = hcb cumulate_reward = 168.888
21-12-11 07:14:55.140 - INFO: iter = 590 alg = phcb cumulate_reward = 164.749
21-12-11 07:14:55.141 - INFO: iter = 590 alg = naive_ts cumulate_reward = 77.252
21-12-11 07:14:55.142 - INFO: iter = 590 alg = ts_leaf cumulate_reward = 144.037
21-12-11 07:14:55.143 - INFO: iter = 590 alg = ts_category cumulate_reward = 81.175
21-12-11 07:14:55.144 - INFO: iter = 600 alg = hcb cumulate_reward = 172.022
21-12-11 07:14:55.146 - INFO: iter = 600 alg = phcb cumulate_reward = 168.392
21-12-11 07:14:55.146 - INFO: iter = 600 alg = naive_ts cumulate_reward = 78.827
21-12-11 07:14:55.147 - INFO: iter = 600 alg = ts_leaf cumulate_reward = 146.841
21-12-11 07:14:55.148 - INFO: iter = 600 alg = ts_category cumulate_reward = 82.882
21-12-11 07:14:55.149 - INFO: iter = 610 alg = hcb cumulate_reward = 175.430
21-12-11 07:14:55.150 - INFO: iter = 610 alg = phcb cumulate_reward = 172.665
21-12-11 07:14:55.151 - INFO: iter = 610 alg = naive_ts cumulate_reward = 81.223
21-12-11 07:14:55.152 - INFO: iter = 610 alg = ts_leaf cumulate_reward = 149.882
21-12-11 07:14:55.153 - INFO: iter = 610 alg = ts_category cumulate_reward = 84.742
21-12-11 07:14:55.154 - INFO: iter = 620 alg = hcb cumulate_reward = 178.446
21-12-11 07:14:55.155 - INFO: iter = 620 alg = phcb cumulate_reward = 176.404
21-12-11 07:14:55.156 - INFO: iter = 620 alg = naive_ts cumulate_reward = 83.366
21-12-11 07:14:55.157 - INFO: iter = 620 alg = ts_leaf cumulate_reward = 152.477
21-12-11 07:14:55.158 - INFO: iter = 620 alg = ts_category cumulate_reward = 86.575
21-12-11 07:14:55.159 - INFO: iter = 630 alg = hcb cumulate_reward = 182.639
21-12-11 07:14:55.160 - INFO: iter = 630 alg = phcb cumulate_reward = 179.942
21-12-11 07:14:55.161 - INFO: iter = 630 alg = naive_ts cumulate_reward = 84.785
21-12-11 07:14:55.162 - INFO: iter = 630 alg = ts_leaf cumulate_reward = 155.120
21-12-11 07:14:55.163 - INFO: iter = 630 alg = ts_category cumulate_reward = 88.259
21-12-11 07:14:55.164 - INFO: iter = 640 alg = hcb cumulate_reward = 186.251
21-12-11 07:14:55.165 - INFO: iter = 640 alg = phcb cumulate_reward = 182.799
21-12-11 07:14:55.166 - INFO: iter = 640 alg = naive_ts cumulate_reward = 86.544
21-12-11 07:14:55.167 - INFO: iter = 640 alg = ts_leaf cumulate_reward = 157.466
21-12-11 07:14:55.168 - INFO: iter = 640 alg = ts_category cumulate_reward = 89.910
21-12-11 07:14:55.169 - INFO: iter = 650 alg = hcb cumulate_reward = 188.752
21-12-11 07:14:55.170 - INFO: iter = 650 alg = phcb cumulate_reward = 186.038
21-12-11 07:14:55.171 - INFO: iter = 650 alg = naive_ts cumulate_reward = 88.157
21-12-11 07:14:55.172 - INFO: iter = 650 alg = ts_leaf cumulate_reward = 160.373
21-12-11 07:14:55.173 - INFO: iter = 650 alg = ts_category cumulate_reward = 91.556
21-12-11 07:14:55.174 - INFO: iter = 660 alg = hcb cumulate_reward = 192.041
21-12-11 07:14:55.175 - INFO: iter = 660 alg = phcb cumulate_reward = 190.376
21-12-11 07:14:55.176 - INFO: iter = 660 alg = naive_ts cumulate_reward = 89.598
21-12-11 07:14:55.177 - INFO: iter = 660 alg = ts_leaf cumulate_reward = 162.696
21-12-11 07:14:55.178 - INFO: iter = 660 alg = ts_category cumulate_reward = 92.943
21-12-11 07:14:55.179 - INFO: iter = 670 alg = hcb cumulate_reward = 195.035
21-12-11 07:14:55.180 - INFO: iter = 670 alg = phcb cumulate_reward = 194.026
21-12-11 07:14:55.181 - INFO: iter = 670 alg = naive_ts cumulate_reward = 90.923
21-12-11 07:14:55.182 - INFO: iter = 670 alg = ts_leaf cumulate_reward = 164.920
21-12-11 07:14:55.183 - INFO: iter = 670 alg = ts_category cumulate_reward = 94.667
21-12-11 07:14:55.184 - INFO: iter = 680 alg = hcb cumulate_reward = 198.409
21-12-11 07:14:55.198 - INFO: iter = 680 alg = phcb cumulate_reward = 197.628
21-12-11 07:14:55.199 - INFO: iter = 680 alg = naive_ts cumulate_reward = 92.548
21-12-11 07:14:55.205 - INFO: iter = 680 alg = ts_leaf cumulate_reward = 166.826
21-12-11 07:14:55.207 - INFO: iter = 680 alg = ts_category cumulate_reward = 96.488
21-12-11 07:14:55.209 - INFO: iter = 690 alg = hcb cumulate_reward = 202.229
21-12-11 07:14:55.211 - INFO: iter = 690 alg = phcb cumulate_reward = 201.481
21-12-11 07:14:55.213 - INFO: iter = 690 alg = naive_ts cumulate_reward = 94.474
21-12-11 07:14:55.215 - INFO: iter = 690 alg = ts_leaf cumulate_reward = 168.974
21-12-11 07:14:55.217 - INFO: iter = 690 alg = ts_category cumulate_reward = 98.061
21-12-11 07:14:55.218 - INFO: iter = 700 alg = hcb cumulate_reward = 205.209
21-12-11 07:14:55.221 - INFO: iter = 700 alg = phcb cumulate_reward = 205.595
21-12-11 07:14:55.223 - INFO: iter = 700 alg = naive_ts cumulate_reward = 96.014
21-12-11 07:14:55.225 - INFO: iter = 700 alg = ts_leaf cumulate_reward = 172.272
21-12-11 07:14:55.227 - INFO: iter = 700 alg = ts_category cumulate_reward = 100.239
21-12-11 07:14:55.229 - INFO: iter = 710 alg = hcb cumulate_reward = 208.175
21-12-11 07:14:55.231 - INFO: iter = 710 alg = phcb cumulate_reward = 209.877
21-12-11 07:14:55.232 - INFO: iter = 710 alg = naive_ts cumulate_reward = 96.840
21-12-11 07:14:55.233 - INFO: iter = 710 alg = ts_leaf cumulate_reward = 175.312
21-12-11 07:14:55.235 - INFO: iter = 710 alg = ts_category cumulate_reward = 101.578
21-12-11 07:14:55.237 - INFO: iter = 720 alg = hcb cumulate_reward = 211.883
21-12-11 07:14:55.242 - INFO: iter = 720 alg = phcb cumulate_reward = 213.229
21-12-11 07:14:55.244 - INFO: iter = 720 alg = naive_ts cumulate_reward = 98.550
21-12-11 07:14:55.245 - INFO: iter = 720 alg = ts_leaf cumulate_reward = 178.130
21-12-11 07:14:55.246 - INFO: iter = 720 alg = ts_category cumulate_reward = 103.463
21-12-11 07:14:55.247 - INFO: iter = 730 alg = hcb cumulate_reward = 214.878
21-12-11 07:14:55.248 - INFO: iter = 730 alg = phcb cumulate_reward = 215.321
21-12-11 07:14:55.249 - INFO: iter = 730 alg = naive_ts cumulate_reward = 99.709
21-12-11 07:14:55.250 - INFO: iter = 730 alg = ts_leaf cumulate_reward = 180.853
21-12-11 07:14:55.251 - INFO: iter = 730 alg = ts_category cumulate_reward = 104.857
21-12-11 07:14:55.252 - INFO: iter = 740 alg = hcb cumulate_reward = 218.511
21-12-11 07:14:55.253 - INFO: iter = 740 alg = phcb cumulate_reward = 218.008
21-12-11 07:14:55.254 - INFO: iter = 740 alg = naive_ts cumulate_reward = 101.401
21-12-11 07:14:55.255 - INFO: iter = 740 alg = ts_leaf cumulate_reward = 183.513
21-12-11 07:14:55.256 - INFO: iter = 740 alg = ts_category cumulate_reward = 106.288
21-12-11 07:14:55.257 - INFO: iter = 750 alg = hcb cumulate_reward = 222.658
21-12-11 07:14:55.258 - INFO: iter = 750 alg = phcb cumulate_reward = 221.029
21-12-11 07:14:55.259 - INFO: iter = 750 alg = naive_ts cumulate_reward = 102.827
21-12-11 07:14:55.260 - INFO: iter = 750 alg = ts_leaf cumulate_reward = 185.971
21-12-11 07:14:55.261 - INFO: iter = 750 alg = ts_category cumulate_reward = 107.883
21-12-11 07:14:55.261 - INFO: iter = 760 alg = hcb cumulate_reward = 225.146
21-12-11 07:14:55.262 - INFO: iter = 760 alg = phcb cumulate_reward = 224.540
21-12-11 07:14:55.263 - INFO: iter = 760 alg = naive_ts cumulate_reward = 103.842
21-12-11 07:14:55.264 - INFO: iter = 760 alg = ts_leaf cumulate_reward = 189.170
21-12-11 07:14:55.265 - INFO: iter = 760 alg = ts_category cumulate_reward = 109.343
21-12-11 07:14:55.266 - INFO: iter = 770 alg = hcb cumulate_reward = 227.655
21-12-11 07:14:55.267 - INFO: iter = 770 alg = phcb cumulate_reward = 227.118
21-12-11 07:14:55.268 - INFO: iter = 770 alg = naive_ts cumulate_reward = 106.055
21-12-11 07:14:55.269 - INFO: iter = 770 alg = ts_leaf cumulate_reward = 191.737
21-12-11 07:14:55.270 - INFO: iter = 770 alg = ts_category cumulate_reward = 111.085
21-12-11 07:14:55.271 - INFO: iter = 780 alg = hcb cumulate_reward = 230.701
21-12-11 07:14:55.272 - INFO: iter = 780 alg = phcb cumulate_reward = 230.701
21-12-11 07:14:55.273 - INFO: iter = 780 alg = naive_ts cumulate_reward = 107.330
21-12-11 07:14:55.274 - INFO: iter = 780 alg = ts_leaf cumulate_reward = 194.547
21-12-11 07:14:55.275 - INFO: iter = 780 alg = ts_category cumulate_reward = 112.313
21-12-11 07:14:55.276 - INFO: iter = 790 alg = hcb cumulate_reward = 233.725
21-12-11 07:14:55.277 - INFO: iter = 790 alg = phcb cumulate_reward = 234.333
21-12-11 07:14:55.278 - INFO: iter = 790 alg = naive_ts cumulate_reward = 109.203
21-12-11 07:14:55.279 - INFO: iter = 790 alg = ts_leaf cumulate_reward = 198.514
21-12-11 07:14:55.280 - INFO: iter = 790 alg = ts_category cumulate_reward = 114.026
21-12-11 07:14:55.281 - INFO: iter = 800 alg = hcb cumulate_reward = 237.438
21-12-11 07:14:55.282 - INFO: iter = 800 alg = phcb cumulate_reward = 238.320
21-12-11 07:14:55.284 - INFO: iter = 800 alg = naive_ts cumulate_reward = 110.142
21-12-11 07:14:55.285 - INFO: iter = 800 alg = ts_leaf cumulate_reward = 200.853
21-12-11 07:14:55.286 - INFO: iter = 800 alg = ts_category cumulate_reward = 115.373
21-12-11 07:14:55.287 - INFO: iter = 810 alg = hcb cumulate_reward = 240.718
21-12-11 07:14:55.288 - INFO: iter = 810 alg = phcb cumulate_reward = 242.054
21-12-11 07:14:55.289 - INFO: iter = 810 alg = naive_ts cumulate_reward = 111.435
21-12-11 07:14:55.292 - INFO: iter = 810 alg = ts_leaf cumulate_reward = 203.816
21-12-11 07:14:55.293 - INFO: iter = 810 alg = ts_category cumulate_reward = 117.083
21-12-11 07:14:55.294 - INFO: iter = 820 alg = hcb cumulate_reward = 243.473
21-12-11 07:14:55.295 - INFO: iter = 820 alg = phcb cumulate_reward = 247.193
21-12-11 07:14:55.296 - INFO: iter = 820 alg = naive_ts cumulate_reward = 112.964
21-12-11 07:14:55.298 - INFO: iter = 820 alg = ts_leaf cumulate_reward = 206.800
21-12-11 07:14:55.299 - INFO: iter = 820 alg = ts_category cumulate_reward = 118.653
21-12-11 07:14:55.300 - INFO: iter = 830 alg = hcb cumulate_reward = 246.491
21-12-11 07:14:55.301 - INFO: iter = 830 alg = phcb cumulate_reward = 250.494
21-12-11 07:14:55.302 - INFO: iter = 830 alg = naive_ts cumulate_reward = 114.203
21-12-11 07:14:55.303 - INFO: iter = 830 alg = ts_leaf cumulate_reward = 210.112
21-12-11 07:14:55.304 - INFO: iter = 830 alg = ts_category cumulate_reward = 120.476
21-12-11 07:14:55.305 - INFO: iter = 840 alg = hcb cumulate_reward = 249.223
21-12-11 07:14:55.306 - INFO: iter = 840 alg = phcb cumulate_reward = 254.450
21-12-11 07:14:55.307 - INFO: iter = 840 alg = naive_ts cumulate_reward = 115.544
21-12-11 07:14:55.308 - INFO: iter = 840 alg = ts_leaf cumulate_reward = 214.182
21-12-11 07:14:55.309 - INFO: iter = 840 alg = ts_category cumulate_reward = 122.170
21-12-11 07:14:55.310 - INFO: iter = 850 alg = hcb cumulate_reward = 252.287
21-12-11 07:14:55.311 - INFO: iter = 850 alg = phcb cumulate_reward = 257.984
21-12-11 07:14:55.312 - INFO: iter = 850 alg = naive_ts cumulate_reward = 116.703
21-12-11 07:14:55.313 - INFO: iter = 850 alg = ts_leaf cumulate_reward = 217.458
21-12-11 07:14:55.314 - INFO: iter = 850 alg = ts_category cumulate_reward = 123.923
21-12-11 07:14:55.315 - INFO: iter = 860 alg = hcb cumulate_reward = 255.466
21-12-11 07:14:55.316 - INFO: iter = 860 alg = phcb cumulate_reward = 262.576
21-12-11 07:14:55.317 - INFO: iter = 860 alg = naive_ts cumulate_reward = 118.258
21-12-11 07:14:55.318 - INFO: iter = 860 alg = ts_leaf cumulate_reward = 220.578
21-12-11 07:14:55.319 - INFO: iter = 860 alg = ts_category cumulate_reward = 125.595
21-12-11 07:14:55.320 - INFO: iter = 870 alg = hcb cumulate_reward = 258.699
21-12-11 07:14:55.321 - INFO: iter = 870 alg = phcb cumulate_reward = 266.239
21-12-11 07:14:55.322 - INFO: iter = 870 alg = naive_ts cumulate_reward = 119.046
21-12-11 07:14:55.323 - INFO: iter = 870 alg = ts_leaf cumulate_reward = 224.070
21-12-11 07:14:55.323 - INFO: iter = 870 alg = ts_category cumulate_reward = 127.615
21-12-11 07:14:55.325 - INFO: iter = 880 alg = hcb cumulate_reward = 261.694
21-12-11 07:14:55.326 - INFO: iter = 880 alg = phcb cumulate_reward = 269.766
21-12-11 07:14:55.327 - INFO: iter = 880 alg = naive_ts cumulate_reward = 121.059
21-12-11 07:14:55.329 - INFO: iter = 880 alg = ts_leaf cumulate_reward = 227.214
21-12-11 07:14:55.330 - INFO: iter = 880 alg = ts_category cumulate_reward = 129.063
21-12-11 07:14:55.331 - INFO: iter = 890 alg = hcb cumulate_reward = 265.717
21-12-11 07:14:55.332 - INFO: iter = 890 alg = phcb cumulate_reward = 273.031
21-12-11 07:14:55.332 - INFO: iter = 890 alg = naive_ts cumulate_reward = 122.386
21-12-11 07:14:55.334 - INFO: iter = 890 alg = ts_leaf cumulate_reward = 229.848
21-12-11 07:14:55.335 - INFO: iter = 890 alg = ts_category cumulate_reward = 131.130
21-12-11 07:14:55.336 - INFO: iter = 900 alg = hcb cumulate_reward = 269.095
21-12-11 07:14:55.337 - INFO: iter = 900 alg = phcb cumulate_reward = 276.853
21-12-11 07:14:55.338 - INFO: iter = 900 alg = naive_ts cumulate_reward = 124.278
21-12-11 07:14:55.339 - INFO: iter = 900 alg = ts_leaf cumulate_reward = 232.997
21-12-11 07:14:55.339 - INFO: iter = 900 alg = ts_category cumulate_reward = 132.615
21-12-11 07:14:55.340 - INFO: iter = 910 alg = hcb cumulate_reward = 272.170
21-12-11 07:14:55.341 - INFO: iter = 910 alg = phcb cumulate_reward = 280.741
21-12-11 07:14:55.343 - INFO: iter = 910 alg = naive_ts cumulate_reward = 125.011
21-12-11 07:14:55.343 - INFO: iter = 910 alg = ts_leaf cumulate_reward = 236.023
21-12-11 07:14:55.345 - INFO: iter = 910 alg = ts_category cumulate_reward = 134.185
21-12-11 07:14:55.346 - INFO: iter = 920 alg = hcb cumulate_reward = 274.899
21-12-11 07:14:55.347 - INFO: iter = 920 alg = phcb cumulate_reward = 284.068
21-12-11 07:14:55.348 - INFO: iter = 920 alg = naive_ts cumulate_reward = 125.946
21-12-11 07:14:55.349 - INFO: iter = 920 alg = ts_leaf cumulate_reward = 238.578
21-12-11 07:14:55.351 - INFO: iter = 920 alg = ts_category cumulate_reward = 135.910
21-12-11 07:14:55.353 - INFO: iter = 930 alg = hcb cumulate_reward = 278.605
21-12-11 07:14:55.354 - INFO: iter = 930 alg = phcb cumulate_reward = 287.800
21-12-11 07:14:55.356 - INFO: iter = 930 alg = naive_ts cumulate_reward = 127.966
21-12-11 07:14:55.358 - INFO: iter = 930 alg = ts_leaf cumulate_reward = 242.251
21-12-11 07:14:55.359 - INFO: iter = 930 alg = ts_category cumulate_reward = 137.605
21-12-11 07:14:55.360 - INFO: iter = 940 alg = hcb cumulate_reward = 282.045
21-12-11 07:14:55.361 - INFO: iter = 940 alg = phcb cumulate_reward = 290.767
21-12-11 07:14:55.362 - INFO: iter = 940 alg = naive_ts cumulate_reward = 129.291
21-12-11 07:14:55.363 - INFO: iter = 940 alg = ts_leaf cumulate_reward = 245.869
21-12-11 07:14:55.364 - INFO: iter = 940 alg = ts_category cumulate_reward = 139.273
21-12-11 07:14:55.367 - INFO: iter = 950 alg = hcb cumulate_reward = 285.028
21-12-11 07:14:55.369 - INFO: iter = 950 alg = phcb cumulate_reward = 295.387
21-12-11 07:14:55.370 - INFO: iter = 950 alg = naive_ts cumulate_reward = 130.556
21-12-11 07:14:55.371 - INFO: iter = 950 alg = ts_leaf cumulate_reward = 249.490
21-12-11 07:14:55.372 - INFO: iter = 950 alg = ts_category cumulate_reward = 140.643
21-12-11 07:14:55.372 - INFO: iter = 960 alg = hcb cumulate_reward = 288.405
21-12-11 07:14:55.373 - INFO: iter = 960 alg = phcb cumulate_reward = 298.693
21-12-11 07:14:55.374 - INFO: iter = 960 alg = naive_ts cumulate_reward = 132.415
21-12-11 07:14:55.375 - INFO: iter = 960 alg = ts_leaf cumulate_reward = 252.339
21-12-11 07:14:55.376 - INFO: iter = 960 alg = ts_category cumulate_reward = 142.469
21-12-11 07:14:55.377 - INFO: iter = 970 alg = hcb cumulate_reward = 291.994
21-12-11 07:14:55.378 - INFO: iter = 970 alg = phcb cumulate_reward = 303.188
21-12-11 07:14:55.381 - INFO: iter = 970 alg = naive_ts cumulate_reward = 133.563
21-12-11 07:14:55.382 - INFO: iter = 970 alg = ts_leaf cumulate_reward = 255.380
21-12-11 07:14:55.383 - INFO: iter = 970 alg = ts_category cumulate_reward = 144.617
21-12-11 07:14:55.384 - INFO: iter = 980 alg = hcb cumulate_reward = 294.934
21-12-11 07:14:55.385 - INFO: iter = 980 alg = phcb cumulate_reward = 307.617
21-12-11 07:14:55.386 - INFO: iter = 980 alg = naive_ts cumulate_reward = 134.923
21-12-11 07:14:55.387 - INFO: iter = 980 alg = ts_leaf cumulate_reward = 257.866
21-12-11 07:14:55.388 - INFO: iter = 980 alg = ts_category cumulate_reward = 146.461
21-12-11 07:14:55.389 - INFO: iter = 990 alg = hcb cumulate_reward = 298.380
21-12-11 07:14:55.390 - INFO: iter = 990 alg = phcb cumulate_reward = 310.722
21-12-11 07:14:55.391 - INFO: iter = 990 alg = naive_ts cumulate_reward = 136.561
21-12-11 07:14:55.392 - INFO: iter = 990 alg = ts_leaf cumulate_reward = 261.286
21-12-11 07:14:55.393 - INFO: iter = 990 alg = ts_category cumulate_reward = 148.006
21-12-11 07:14:55.394 - INFO: iter = 1000 alg = hcb cumulate_reward = 300.669
21-12-11 07:14:55.395 - INFO: iter = 1000 alg = phcb cumulate_reward = 314.324
21-12-11 07:14:55.396 - INFO: iter = 1000 alg = naive_ts cumulate_reward = 138.210
21-12-11 07:14:55.397 - INFO: iter = 1000 alg = ts_leaf cumulate_reward = 263.675
21-12-11 07:14:55.399 - INFO: iter = 1000 alg = ts_category cumulate_reward = 149.404
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">qq</span> <span class="n">install</span> <span class="n">tree</span>
<span class="err">!</span><span class="n">rm</span> <span class="o">-</span><span class="n">r</span> <span class="n">sample_data</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">tree</span> <span class="o">-</span><span class="n">h</span> <span class="o">--</span><span class="n">du</span> <span class="o">-</span><span class="n">C</span> <span class="o">.</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-blue-intense-fg ansi-bold">.</span>
‚îú‚îÄ‚îÄ [170M]  <span class="ansi-blue-intense-fg ansi-bold">data</span>
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ [ 86M]  item_info.pkl
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ [ 53M]  item_info_ts.pkl
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ [ 601]  README.md
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ [ 19M]  <span class="ansi-blue-intense-fg ansi-bold">tree</span>
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ [7.9M]  10000_1000_100_10_btree.pkl
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ [4.2M]  10000_1000_100_10_btree_ts.pkl
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ [2.1M]  1000_100_10_btree.pkl
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ [1.7M]  1000_100_10_btree_ts.pkl
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ [1.7M]  1000_10_btree.pkl
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ [1.3M]  1000_10_btree_ts.pkl
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ [ 12M]  user_info.pkl
‚îî‚îÄ‚îÄ [130K]  <span class="ansi-blue-intense-fg ansi-bold">logger</span>
    ‚îî‚îÄ‚îÄ [126K]  MIND-simulator_multi_process_linucb_211211-144236.log

 170M used in 3 directories, 11 files
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">watermark</span>
<span class="o">%</span><span class="n">reload_ext</span> <span class="n">watermark</span>
<span class="o">%</span><span class="n">watermark</span> <span class="o">-</span><span class="n">a</span> <span class="s2">&quot;Sparsh A.&quot;</span> <span class="o">-</span><span class="n">m</span> <span class="o">-</span><span class="n">iv</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">d</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Author: Sparsh A.

Last updated: 2021-12-11 07:18:38

Compiler    : GCC 7.5.0
OS          : Linux
Release     : 5.4.104+
Machine     : x86_64
Processor   : x86_64
CPU cores   : 2
Architecture: 64bit

numpy  : 1.19.5
sys    : 3.7.12 (default, Sep 10 2021, 00:21:48) 
[GCC 7.5.0]
torch  : 1.10.0+cu111
IPython: 5.5.0
logging: 0.5.1.2

</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr />

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>END</strong></p>

</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/2022/01/13/cab-mind.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Jupyter notebook database.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/recohut" target="_blank" title="recohut"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
