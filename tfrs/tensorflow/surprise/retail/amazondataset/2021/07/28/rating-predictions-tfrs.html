<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Predicting Ratings using TFRS | reconb</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Predicting Ratings using TFRS" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Training a top-k retrieval model using Tensorflow Recommenders library on Amazon Electronics dataset" />
<meta property="og:description" content="Training a top-k retrieval model using Tensorflow Recommenders library on Amazon Electronics dataset" />
<link rel="canonical" href="https://nb.recohut.com/tfrs/tensorflow/surprise/retail/amazondataset/2021/07/28/rating-predictions-tfrs.html" />
<meta property="og:url" content="https://nb.recohut.com/tfrs/tensorflow/surprise/retail/amazondataset/2021/07/28/rating-predictions-tfrs.html" />
<meta property="og:site_name" content="reconb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-07-28T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Predicting Ratings using TFRS" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-07-28T00:00:00-05:00","datePublished":"2021-07-28T00:00:00-05:00","description":"Training a top-k retrieval model using Tensorflow Recommenders library on Amazon Electronics dataset","headline":"Predicting Ratings using TFRS","mainEntityOfPage":{"@type":"WebPage","@id":"https://nb.recohut.com/tfrs/tensorflow/surprise/retail/amazondataset/2021/07/28/rating-predictions-tfrs.html"},"url":"https://nb.recohut.com/tfrs/tensorflow/surprise/retail/amazondataset/2021/07/28/rating-predictions-tfrs.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nb.recohut.com/feed.xml" title="reconb" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">reconb</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Predicting Ratings using TFRS</h1><p class="page-description">Training a top-k retrieval model using Tensorflow Recommenders library on Amazon Electronics dataset</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-07-28T00:00:00-05:00" itemprop="datePublished">
        Jul 28, 2021
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      6 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#TFRS">TFRS</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#Tensorflow">Tensorflow</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#Surprise">Surprise</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#Retail">Retail</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#AmazonDataset">AmazonDataset</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/recohut/notebook/tree/master/_notebooks/2021-07-28-rating-predictions-tfrs.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/recohut/notebook/master?filepath=_notebooks%2F2021-07-28-rating-predictions-tfrs.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/recohut/notebook/blob/master/_notebooks/2021-07-28-rating-predictions-tfrs.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Frecohut%2Fnotebook%2Fblob%2Fmaster%2F_notebooks%2F2021-07-28-rating-predictions-tfrs.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#Setup">Setup </a></li>
<li class="toc-entry toc-h2"><a href="#Loading-dataset">Loading dataset </a></li>
<li class="toc-entry toc-h2"><a href="#Preprocessing">Preprocessing </a></li>
<li class="toc-entry toc-h2"><a href="#Train/test-split">Train/test split </a></li>
<li class="toc-entry toc-h2"><a href="#Defining-model-architecture">Defining model architecture </a></li>
<li class="toc-entry toc-h2"><a href="#Fitting-and-evaluating">Fitting and evaluating </a></li>
<li class="toc-entry toc-h2"><a href="#Plotting-results">Plotting results </a></li>
<li class="toc-entry toc-h2"><a href="#Recommendations">Recommendations </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-07-28-rating-predictions-tfrs.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup">
<a class="anchor" href="#Setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup<a class="anchor-link" href="#Setup"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">tensorflow</span><span class="o">-</span><span class="n">recommenders</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">surprise</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Text</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">tensorflow_recommenders</span> <span class="k">as</span> <span class="nn">tfrs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">surprise</span> <span class="kn">import</span> <span class="n">Reader</span>
<span class="kn">from</span> <span class="nn">surprise.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">surprise</span> <span class="kn">import</span> <span class="n">Dataset</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">watermark</span>
<span class="o">%</span><span class="n">reload_ext</span> <span class="n">watermark</span>
<span class="o">%</span><span class="n">watermark</span> <span class="o">-</span><span class="n">m</span> <span class="o">-</span><span class="n">iv</span> <span class="o">-</span><span class="n">u</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">d</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loading-dataset">
<a class="anchor" href="#Loading-dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Loading dataset<a class="anchor-link" href="#Loading-dataset"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">snap</span><span class="o">.</span><span class="n">stanford</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">amazon</span><span class="o">/</span><span class="n">productGraph</span><span class="o">/</span><span class="n">categoryFiles</span><span class="o">/</span><span class="n">ratings_Electronics</span><span class="o">.</span><span class="n">csv</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>--2021-07-28 07:54:15--  http://snap.stanford.edu/data/amazon/productGraph/categoryFiles/ratings_Electronics.csv
Resolving snap.stanford.edu (snap.stanford.edu)... 171.64.75.80
Connecting to snap.stanford.edu (snap.stanford.edu)|171.64.75.80|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 318766497 (304M) [text/csv]
Saving to: â€˜ratings_Electronics.csvâ€™

ratings_Electronics 100%[===================&gt;] 304.00M  6.82MB/s    in 52s     

2021-07-28 07:55:07 (5.87 MB/s) - â€˜ratings_Electronics.csvâ€™ saved [318766497/318766497]

</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'ratings_Electronics.csv'</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">'userId'</span><span class="p">,</span> <span class="s1">'productId'</span><span class="p">,</span><span class="s1">'Rating'</span><span class="p">,</span><span class="s1">'timestamp'</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>productId</th>
      <th>Rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AKM1MP6P0OYPR</td>
      <td>0132793040</td>
      <td>5.0</td>
      <td>1365811200</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A2CX7LUOHB2NDG</td>
      <td>0321732944</td>
      <td>5.0</td>
      <td>1341100800</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A2NWSAGRHCP8N5</td>
      <td>0439886341</td>
      <td>1.0</td>
      <td>1367193600</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A2WNBOD3WNDNKT</td>
      <td>0439886341</td>
      <td>3.0</td>
      <td>1374451200</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A1GI0U4ZRJA8WN</td>
      <td>0439886341</td>
      <td>1.0</td>
      <td>1334707200</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>productId</th>
      <th>Rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AKM1MP6P0OYPR</td>
      <td>0132793040</td>
      <td>5.0</td>
      <td>1365811200</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A2CX7LUOHB2NDG</td>
      <td>0321732944</td>
      <td>5.0</td>
      <td>1341100800</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A2NWSAGRHCP8N5</td>
      <td>0439886341</td>
      <td>1.0</td>
      <td>1367193600</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A2WNBOD3WNDNKT</td>
      <td>0439886341</td>
      <td>3.0</td>
      <td>1374451200</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A1GI0U4ZRJA8WN</td>
      <td>0439886341</td>
      <td>1.0</td>
      <td>1334707200</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class 'pandas.core.frame.DataFrame'&gt;
Int64Index: 7824482 entries, 0 to 7824481
Data columns (total 4 columns):
 #   Column     Dtype  
---  ------     -----  
 0   userId     object 
 1   productId  object 
 2   Rating     float64
 3   timestamp  int64  
dtypes: float64(1), int64(1), object(2)
memory usage: 298.5+ MB
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>7.824482e+06</td>
      <td>7.824482e+06</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>4.012337e+00</td>
      <td>1.338178e+09</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.380910e+00</td>
      <td>6.900426e+07</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000e+00</td>
      <td>9.127296e+08</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>3.000000e+00</td>
      <td>1.315354e+09</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>5.000000e+00</td>
      <td>1.361059e+09</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>5.000000e+00</td>
      <td>1.386115e+09</td>
    </tr>
    <tr>
      <th>max</th>
      <td>5.000000e+00</td>
      <td>1.406074e+09</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Minimum rating is: </span><span class="si">%d</span><span class="s1">'</span> <span class="o">%</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Rating</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Maximum rating is: </span><span class="si">%d</span><span class="s1">'</span> <span class="o">%</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Rating</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Minimum rating is: 1
Maximum rating is: 5
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">catplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Rating"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">'count'</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">set_ylabels</span><span class="p">(</span><span class="s2">"Total number of ratings"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Preprocessing">
<a class="anchor" href="#Preprocessing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Preprocessing<a class="anchor-link" href="#Preprocessing"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'timestamp'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">num_of_rated_products_per_user</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">'userId'</span><span class="p">)[</span><span class="s1">'Rating'</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">num_of_rated_products_per_user</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>userId
A5JLAU2ARJ0BO     520
ADLVFFE4VBT8      501
A3OXHLG6DIBRW8    498
A6FIAB28IS79      431
A680RUE1FDO8B     406
Name: Rating, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">new_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">"productId"</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s1">'Rating'</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">new_df</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">'all'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>productId</th>
      <th>Rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>224220</td>
      <td>224220</td>
      <td>224220.000000</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>212344</td>
      <td>1920</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>top</th>
      <td>AN81JUYW2SL24</td>
      <td>B0074BW614</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>12</td>
      <td>1771</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.169374</td>
    </tr>
    <tr>
      <th>std</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.288526</td>
    </tr>
    <tr>
      <th>min</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Train/test-split">
<a class="anchor" href="#Train/test-split" aria-hidden="true"><span class="octicon octicon-link"></span></a>Train/test split<a class="anchor-link" href="#Train/test-split"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">new_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">interactions_dict</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">'Rating'</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">interactions_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">interactions_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">interactions</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">interactions_dict</span><span class="p">)</span>

<span class="n">items_dict</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">'productId'</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="n">items_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">items_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">(</span><span class="n">items_dict</span><span class="p">)</span>

<span class="n">interactions</span> <span class="o">=</span> <span class="n">interactions</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'userId'</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">'userId'</span><span class="p">],</span> 
    <span class="s1">'productId'</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">'productId'</span><span class="p">],</span> 
<span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">'productId'</span><span class="p">])</span>

<span class="c1">### get unique item and user id's as a lookup table</span>
<span class="n">unique_item_titles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">1000</span><span class="p">))))</span>
<span class="n">unique_user_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">interactions</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">1_000</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">"userId"</span><span class="p">]))))</span>

<span class="c1"># Randomly shuffle data and split between train and test.</span>
<span class="n">tf</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">shuffled</span> <span class="o">=</span> <span class="n">interactions</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">200_000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">reshuffle_each_iteration</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">train</span> <span class="o">=</span> <span class="n">shuffled</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">180_000</span><span class="p">)</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">shuffled</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="mi">180_000</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">20_000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Defining-model-architecture">
<a class="anchor" href="#Defining-model-architecture" aria-hidden="true"><span class="octicon octicon-link"></span></a>Defining model architecture<a class="anchor-link" href="#Defining-model-architecture"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">RetailModel</span><span class="p">(</span><span class="n">tfrs</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_model</span><span class="p">,</span> <span class="n">item_model</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        
        <span class="c1">### Candidate model (item)</span>
        <span class="c1">### This is Keras preprocessing layers to first convert user ids to integers, </span>
        <span class="c1">### and then convert those to user embeddings via an Embedding layer. </span>
        <span class="c1">### We use the list of unique user ids we computed earlier as a vocabulary:</span>
        <span class="n">item_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
                                        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">StringLookup</span><span class="p">(</span>
                                        <span class="n">vocabulary</span><span class="o">=</span><span class="n">unique_item_titles</span><span class="p">,</span> <span class="n">mask_token</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                                        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_item_titles</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">embedding_dimension</span><span class="p">)</span>
                                        <span class="p">])</span>
        <span class="c1">### we pass the embedding layer into item model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_model</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span> <span class="o">=</span> <span class="n">item_model</span>
            
        <span class="c1">### Query model (users)    </span>
        <span class="n">user_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
                                        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">StringLookup</span><span class="p">(</span>
                                        <span class="n">vocabulary</span><span class="o">=</span><span class="n">unique_user_ids</span><span class="p">,</span> <span class="n">mask_token</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                                        <span class="c1"># We add an additional embedding to account for unknown tokens.</span>
                                        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_user_ids</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">embedding_dimension</span><span class="p">)</span>
                                        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_model</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span> <span class="o">=</span> <span class="n">user_model</span>
        <span class="c1">### for retrieval model. we take top-k accuracy as metrics</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="n">tfrs</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">FactorizedTopK</span><span class="p">(</span>
                                            <span class="n">candidates</span><span class="o">=</span><span class="n">items</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">item_model</span><span class="p">))</span>
        
        <span class="c1"># define the task, which is retrieval                                    )    </span>
        <span class="n">task</span> <span class="o">=</span> <span class="n">tfrs</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">Retrieval</span><span class="p">(</span>
                                    <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span>
                                    <span class="p">)</span>
       
        <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Layer</span> <span class="o">=</span> <span class="n">task</span>

    <span class="k">def</span> <span class="nf">compute_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Text</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tf</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="c1"># We pick out the user features and pass them into the user model.</span>
        <span class="n">user_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_model</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s2">"userId"</span><span class="p">])</span>
        <span class="c1"># And pick out the movie features and pass them into the movie model,</span>
        <span class="c1"># getting embeddings back.</span>
        <span class="n">positive_movie_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_model</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="s2">"productId"</span><span class="p">])</span>

        <span class="c1"># The task computes the loss and the metrics.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">task</span><span class="p">(</span><span class="n">user_embeddings</span><span class="p">,</span> <span class="n">positive_movie_embeddings</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Fitting-and-evaluating">
<a class="anchor" href="#Fitting-and-evaluating" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fitting and evaluating<a class="anchor-link" href="#Fitting-and-evaluating"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">embedding_dimension</span> <span class="o">=</span> <span class="mi">32</span>

<span class="c1">## we pass the model, which is the same model we created in the query and candidate tower, into the model</span>
<span class="n">item_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
                                <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">StringLookup</span><span class="p">(</span>
                                <span class="n">vocabulary</span><span class="o">=</span><span class="n">unique_item_titles</span><span class="p">,</span> <span class="n">mask_token</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                                <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_item_titles</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">embedding_dimension</span><span class="p">)</span>
                                <span class="p">])</span>

<span class="n">user_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
                                <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">StringLookup</span><span class="p">(</span>
                                <span class="n">vocabulary</span><span class="o">=</span><span class="n">unique_user_ids</span><span class="p">,</span> <span class="n">mask_token</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                                <span class="c1"># We add an additional embedding to account for unknown tokens.</span>
                                <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_user_ids</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">embedding_dimension</span><span class="p">)</span>
                                <span class="p">])</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RetailModel</span><span class="p">(</span><span class="n">user_model</span><span class="p">,</span> <span class="n">item_model</span><span class="p">)</span>

<span class="c1"># a smaller learning rate may make the model move slower and prone to overfitting, so we stick to 0.1</span>
<span class="c1"># other optimizers, such as SGD and Adam, are listed here https://www.tensorflow.org/api_docs/python/tf/keras/optimizers</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adagrad</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">))</span>

<span class="n">cached_train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="mi">100_000</span><span class="p">)</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">8192</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
<span class="n">cached_test</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>

<span class="c1">## fit the model with ten epochs</span>
<span class="n">model_hist</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cached_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1">#evaluate the model</span>
<span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">cached_test</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Epoch 1/10
WARNING:tensorflow:From /usr/local/lib/python3.7/dist-packages/tensorflow/python/ops/array_ops.py:5049: calling gather (from tensorflow.python.ops.array_ops) with validate_indices is deprecated and will be removed in a future version.
Instructions for updating:
The `validate_indices` argument has no effect. Indices are always validated on CPU and never validated on GPU.
22/22 [==============================] - 60s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.0012 - factorized_top_k/top_5_categorical_accuracy: 0.0069 - factorized_top_k/top_10_categorical_accuracy: 0.0119 - factorized_top_k/top_50_categorical_accuracy: 0.0417 - factorized_top_k/top_100_categorical_accuracy: 0.0723 - loss: 73623.2884 - regularization_loss: 0.0000e+00 - total_loss: 73623.2884
Epoch 2/10
22/22 [==============================] - 58s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.1111 - factorized_top_k/top_5_categorical_accuracy: 0.3763 - factorized_top_k/top_10_categorical_accuracy: 0.4694 - factorized_top_k/top_50_categorical_accuracy: 0.7125 - factorized_top_k/top_100_categorical_accuracy: 0.8116 - loss: 72270.3940 - regularization_loss: 0.0000e+00 - total_loss: 72270.3940
Epoch 3/10
22/22 [==============================] - 58s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.2303 - factorized_top_k/top_5_categorical_accuracy: 0.8340 - factorized_top_k/top_10_categorical_accuracy: 0.9057 - factorized_top_k/top_50_categorical_accuracy: 0.9773 - factorized_top_k/top_100_categorical_accuracy: 0.9872 - loss: 62244.9597 - regularization_loss: 0.0000e+00 - total_loss: 62244.9597
Epoch 4/10
22/22 [==============================] - 58s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.2718 - factorized_top_k/top_5_categorical_accuracy: 0.9634 - factorized_top_k/top_10_categorical_accuracy: 0.9769 - factorized_top_k/top_50_categorical_accuracy: 0.9909 - factorized_top_k/top_100_categorical_accuracy: 0.9950 - loss: 41646.2948 - regularization_loss: 0.0000e+00 - total_loss: 41646.2948
Epoch 5/10
22/22 [==============================] - 58s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.3255 - factorized_top_k/top_5_categorical_accuracy: 0.9841 - factorized_top_k/top_10_categorical_accuracy: 0.9897 - factorized_top_k/top_50_categorical_accuracy: 0.9969 - factorized_top_k/top_100_categorical_accuracy: 0.9985 - loss: 24961.5115 - regularization_loss: 0.0000e+00 - total_loss: 24961.5115
Epoch 6/10
22/22 [==============================] - 58s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.3383 - factorized_top_k/top_5_categorical_accuracy: 0.9920 - factorized_top_k/top_10_categorical_accuracy: 0.9958 - factorized_top_k/top_50_categorical_accuracy: 0.9990 - factorized_top_k/top_100_categorical_accuracy: 0.9995 - loss: 18497.3575 - regularization_loss: 0.0000e+00 - total_loss: 18497.3575
Epoch 7/10
22/22 [==============================] - 58s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.3607 - factorized_top_k/top_5_categorical_accuracy: 0.9946 - factorized_top_k/top_10_categorical_accuracy: 0.9973 - factorized_top_k/top_50_categorical_accuracy: 0.9994 - factorized_top_k/top_100_categorical_accuracy: 0.9997 - loss: 17173.3439 - regularization_loss: 0.0000e+00 - total_loss: 17173.3439
Epoch 8/10
22/22 [==============================] - 58s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.3774 - factorized_top_k/top_5_categorical_accuracy: 0.9957 - factorized_top_k/top_10_categorical_accuracy: 0.9979 - factorized_top_k/top_50_categorical_accuracy: 0.9996 - factorized_top_k/top_100_categorical_accuracy: 0.9998 - loss: 16789.0695 - regularization_loss: 0.0000e+00 - total_loss: 16789.0695
Epoch 9/10
22/22 [==============================] - 58s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.3819 - factorized_top_k/top_5_categorical_accuracy: 0.9962 - factorized_top_k/top_10_categorical_accuracy: 0.9984 - factorized_top_k/top_50_categorical_accuracy: 0.9997 - factorized_top_k/top_100_categorical_accuracy: 0.9999 - loss: 16584.2396 - regularization_loss: 0.0000e+00 - total_loss: 16584.2396
Epoch 10/10
22/22 [==============================] - 58s 3s/step - factorized_top_k/top_1_categorical_accuracy: 0.3935 - factorized_top_k/top_5_categorical_accuracy: 0.9967 - factorized_top_k/top_10_categorical_accuracy: 0.9986 - factorized_top_k/top_50_categorical_accuracy: 0.9998 - factorized_top_k/top_100_categorical_accuracy: 0.9999 - loss: 16452.5529 - regularization_loss: 0.0000e+00 - total_loss: 16452.5529
5/5 [==============================] - 6s 994ms/step - factorized_top_k/top_1_categorical_accuracy: 6.0000e-04 - factorized_top_k/top_5_categorical_accuracy: 0.0026 - factorized_top_k/top_10_categorical_accuracy: 0.0057 - factorized_top_k/top_50_categorical_accuracy: 0.0263 - factorized_top_k/top_100_categorical_accuracy: 0.0538 - loss: 34468.0189 - regularization_loss: 0.0000e+00 - total_loss: 34468.0189
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{'factorized_top_k/top_100_categorical_accuracy': 0.05375000089406967,
 'factorized_top_k/top_10_categorical_accuracy': 0.0056500001810491085,
 'factorized_top_k/top_1_categorical_accuracy': 0.0006000000284984708,
 'factorized_top_k/top_50_categorical_accuracy': 0.02630000002682209,
 'factorized_top_k/top_5_categorical_accuracy': 0.0026000000070780516,
 'loss': 31242.18359375,
 'regularization_loss': 0,
 'total_loss': 31242.18359375}</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Plotting-results">
<a class="anchor" href="#Plotting-results" aria-hidden="true"><span class="octicon octicon-link"></span></a>Plotting results<a class="anchor-link" href="#Plotting-results"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">epochs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">model_hist</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="s2">"factorized_top_k/top_100_categorical_accuracy"</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">"accuracy"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Accuracy vs epoch"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"epoch"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Top-100 accuracy"</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.legend.Legend at 0x7f484433f6d0&gt;</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Recommendations">
<a class="anchor" href="#Recommendations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Recommendations<a class="anchor-link" href="#Recommendations"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">tfrs</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">factorized_top_k</span><span class="o">.</span><span class="n">BruteForce</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">user_model</span><span class="p">)</span>

<span class="c1"># recommends products out of the entire product dataset.</span>
<span class="n">index</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">item_model</span><span class="p">),</span> <span class="n">items</span><span class="p">)</span>

<span class="c1"># Get recommendations.</span>
<span class="n">j</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">titles</span> <span class="o">=</span> <span class="n">index</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="n">j</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Recommendations for user %s: </span><span class="si">{</span><span class="n">titles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <span class="o">%</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Recommendations for user 20: [b'B002MAPS6W' b'B008I646WG' b'B0052SCU8U' b'B004YHVNWO' b'B004S4R5CK'
 b'B001S2RCXW' b'B00BIULEJC' b'B0015AE4CE' b'B001TUYTZM' b'B0011Z44UA']
</pre>
</div>
</div>

</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="recohut/notebook"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/tfrs/tensorflow/surprise/retail/amazondataset/2021/07/28/rating-predictions-tfrs.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Jupyter notebook database.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/recohut" target="_blank" title="recohut"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
