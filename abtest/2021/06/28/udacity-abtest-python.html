<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>AB Testing With Python | reconb</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="AB Testing With Python" />
<meta name="author" content="<a href='https://www.kaggle.com/tammyrotem/ab-tests-with-python'>Tammy Rotem</a>" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Walkthrough on a Udacity Course on AB testing" />
<meta property="og:description" content="Walkthrough on a Udacity Course on AB testing" />
<link rel="canonical" href="https://nb.recohut.com/abtest/2021/06/28/udacity-abtest-python.html" />
<meta property="og:url" content="https://nb.recohut.com/abtest/2021/06/28/udacity-abtest-python.html" />
<meta property="og:site_name" content="reconb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-28T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="AB Testing With Python" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"<a href='https://www.kaggle.com/tammyrotem/ab-tests-with-python'>Tammy Rotem</a>"},"dateModified":"2021-06-28T00:00:00-05:00","datePublished":"2021-06-28T00:00:00-05:00","description":"Walkthrough on a Udacity Course on AB testing","headline":"AB Testing With Python","mainEntityOfPage":{"@type":"WebPage","@id":"https://nb.recohut.com/abtest/2021/06/28/udacity-abtest-python.html"},"url":"https://nb.recohut.com/abtest/2021/06/28/udacity-abtest-python.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nb.recohut.com/feed.xml" title="reconb" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">reconb</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">AB Testing With Python</h1><p class="page-description">Walkthrough on a Udacity Course on AB testing</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-06-28T00:00:00-05:00" itemprop="datePublished">
        Jun 28, 2021
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name"><a href='https://www.kaggle.com/tammyrotem/ab-tests-with-python'>Tammy Rotem</a></span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      24 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#ABTest">ABTest</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/recohut/notebook/tree/master/_notebooks/2021-06-28-udacity-abtest-python.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/recohut/notebook/master?filepath=_notebooks%2F2021-06-28-udacity-abtest-python.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/recohut/notebook/blob/master/_notebooks/2021-06-28-udacity-abtest-python.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Frecohut%2Fnotebook%2Fblob%2Fmaster%2F_notebooks%2F2021-06-28-udacity-abtest-python.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#1-Udacity's-A/B-Testing-Course-">1 Udacity&#39;s A/B Testing Course  </a></li>
<li class="toc-entry toc-h2"><a href="#2-Experiment-Overview-">2 Experiment Overview  </a>
<ul>
<li class="toc-entry toc-h3"><a href="#2.1-Current-Conditions-Before-Change-">2.1 Current Conditions Before Change  </a></li>
<li class="toc-entry toc-h3"><a href="#2.2-Description-of-Experimented-Change-">2.2 Description of Experimented Change  </a></li>
<li class="toc-entry toc-h3"><a href="#2.3-Experiment-Hypothesis-">2.3 Experiment Hypothesis  </a></li>
<li class="toc-entry toc-h3"><a href="#2.4-Experiment-Details-">2.4 Experiment Details  </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#3-Metric-Choice-">3 Metric Choice  </a>
<ul>
<li class="toc-entry toc-h3"><a href="#3.1-Invariate-Metrics---Sanity-Checks-">3.1 Invariate Metrics - Sanity Checks  </a></li>
<li class="toc-entry toc-h3"><a href="#3.2-Evaluation-Metrics---Performance-Indicators-">3.2 Evaluation Metrics - Performance Indicators  </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#4-Estimating-the-baseline-values-of-metrics-">4 Estimating the baseline values of metrics  </a>
<ul>
<li class="toc-entry toc-h3"><a href="#4.1-Collecting-estimators-data-">4.1 Collecting estimators data  </a></li>
<li class="toc-entry toc-h3"><a href="#4.2-Estimating-Standard-Deviation-">4.2 Estimating Standard Deviation  </a>
<ul>
<li class="toc-entry toc-h4"><a href="#4.2.1-Scaling-Collected-Data-">4.2.1 Scaling Collected Data  </a></li>
<li class="toc-entry toc-h4"><a href="#4.2.2-Estimating-Analytically-">4.2.2 Estimating Analytically  </a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#5-Experiment-Sizing-">5 Experiment Sizing  </a>
<ul>
<li class="toc-entry toc-h3"><a href="#5.1-Get-z-score-critical-value-and-Standard-Deviations-">5.1 Get z-score critical value and Standard Deviations  </a></li>
<li class="toc-entry toc-h3"><a href="#5.2-Calculate-Sample-Size-per-Metric-">5.2 Calculate Sample Size per Metric  </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#6-Analyzing-Collected-Data-">6 Analyzing Collected Data  </a>
<ul>
<li class="toc-entry toc-h3"><a href="#6.1-Loading-collected-data-">6.1 Loading collected data  </a></li>
<li class="toc-entry toc-h3"><a href="#6.2-Sanity-Checks-">6.2 Sanity Checks  </a>
<ul>
<li class="toc-entry toc-h4"><a href="#6.2.1-Sanity-Checks-for-differences-between-counts-">6.2.1 Sanity Checks for differences between counts  </a></li>
<li class="toc-entry toc-h4"><a href="#6.2.2-Sanity-Checks-for-differences-between-probabilities-">6.2.2 Sanity Checks for differences between probabilities  </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#6.3-Examining-effect-size-">6.3 Examining effect size  </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#6.4-Double-check-with-Sign-Tests-">6.4 Double check with Sign Tests  </a>
<ul>
<li class="toc-entry toc-h3"><a href="#6.4.1-Data-Preparation-">6.4.1 Data Preparation  </a></li>
<li class="toc-entry toc-h3"><a href="#6.4.2-Building-a-Sign-Test-">6.4.2 Building a Sign Test  </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#7-Conclusions-&-Recommendations-">7 Conclusions &amp; Recommendations  </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-06-28-udacity-abtest-python.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">mt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1-Udacity's-A/B-Testing-Course-">
<a class="anchor" href="#1-Udacity's-A/B-Testing-Course-" aria-hidden="true"><span class="octicon octicon-link"></span></a>1 Udacity's A/B Testing Course <a class="anchor" id="about"></a><a class="anchor-link" href="#1-Udacity's-A/B-Testing-Course-"> </a>
</h2>
<p><a href="https://www.udacity.com/">Udacity</a> published a great free course for <a href="https://en.wikipedia.org/wiki/A/B_testing">A/B Testing</a>, also known as split tests, which are online experiments used to test potential improvements to a website or mobile app.
This Python notebook is a walkthrough solution of the final project.</p>
<p>Udacity's <a href="https://www.udacity.com/course/ab-testing--ud257">AB Testing course</a> is presented by Google and focuses on design and analysis of A/B tests. The course covers how to choose and characterize metrics to evaluate your experiments, how to design an experiment with enough statistical power and how to analyze the results and draw valid conclusions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="2-Experiment-Overview-">
<a class="anchor" href="#2-Experiment-Overview-" aria-hidden="true"><span class="octicon octicon-link"></span></a>2 Experiment Overview <a class="anchor" id="overview"></a><a class="anchor-link" href="#2-Experiment-Overview-"> </a>
</h2>
<p><strong>Experiment Name:</strong> "Free Trial" Screener. <br>
It is conducted by Udacity, a website dedicated to teaching online - with the overall business goal of maximizing course completion by students.</p>
<h3 id="2.1-Current-Conditions-Before-Change-">
<a class="anchor" href="#2.1-Current-Conditions-Before-Change-" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.1 Current Conditions Before Change <a class="anchor" id="current"></a><a class="anchor-link" href="#2.1-Current-Conditions-Before-Change-"> </a>
</h3>
<ul>
<li>At the time of this experiment, Udacity courses currently have two options on the course overview page: "start free trial", and "access course materials". <br>
</li>
<li>If the student clicks "start free trial", they will be asked to enter their credit card information, and then they will be enrolled in a free trial for the paid version of the course. After 14 days, they will automatically be charged unless they cancel first.</li>
<li>If the student clicks "access course materials", they will be able to view the videos and take the quizzes for free, but they will not receive coaching support or a verified certificate, and they will not submit their final project for feedback.</li>
</ul>
<h3 id="2.2-Description-of-Experimented-Change-">
<a class="anchor" href="#2.2-Description-of-Experimented-Change-" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.2 Description of Experimented Change <a class="anchor" id="description"></a><a class="anchor-link" href="#2.2-Description-of-Experimented-Change-"> </a>
</h3>
<ul>
<li>In the experiment, Udacity tested a change where if the student clicked "start free trial", they were asked how much time they had available to devote to the course.</li>
<li>If the student indicated 5 or more hours per week, they would be taken through the checkout process as usual. If they indicated fewer than 5 hours per week, a message would appear indicating that Udacity courses usually require a greater time commitment for successful completion, and suggesting that the student might like to access the course materials for free.</li>
<li>At this point, the student would have the option to continue enrolling in the free trial, or access the course materials for free instead. <a href="https://drive.google.com/file/d/0ByAfiG8HpNUMakVrS0s4cGN2TjQ/view">This screenshot</a> shows what the experiment looks like.</li>
</ul>
<h3 id="2.3-Experiment-Hypothesis-">
<a class="anchor" href="#2.3-Experiment-Hypothesis-" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.3 Experiment Hypothesis <a class="anchor" id="hypothesis"></a><a class="anchor-link" href="#2.3-Experiment-Hypothesis-"> </a>
</h3>
<p>The hypothesis was that this might set clearer expectations for students upfront, thus reducing the number of frustrated students who left the free trial because they didn't have enough time—without significantly reducing the number of students to continue past the free trial and eventually complete the course. If this hypothesis held true, Udacity could improve the overall student experience and improve coaches' capacity to support students who are likely to complete the course.</p>
<h3 id="2.4-Experiment-Details-">
<a class="anchor" href="#2.4-Experiment-Details-" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.4 Experiment Details <a class="anchor" id="details"></a><a class="anchor-link" href="#2.4-Experiment-Details-"> </a>
</h3>
<p>The unit of diversion is a cookie, although if the student enrolls in the free trial, they are tracked by user-id from that point forward. The same user-id cannot enroll in the free trial twice. For users that do not enroll, their user-id is not tracked in the experiment, even if they were signed in when they visited the course overview page.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="3-Metric-Choice-">
<a class="anchor" href="#3-Metric-Choice-" aria-hidden="true"><span class="octicon octicon-link"></span></a>3 Metric Choice <a class="anchor" id="metric"></a><a class="anchor-link" href="#3-Metric-Choice-"> </a>
</h2>
<p>We need two types of metrics for a successful experiment (or at least, a safe one); Invariate and evaluation metrics.
Invariate metrics are used for "sanity checks", that is, to make sure our experiment (the way we presented a change to a part of the population, as well as the way we collected the data) is not inherently wrong. Basically, this means we pick metrics which we consider not to change (not to be affected) because of our experiment and later make sure these metrics don't change drastically between our control and experiment groups.<br>
Evaluation metrics on the other hand, are the metrics in which we expect to see a change, and are relevant to the business goals we aim to achieve. For each metric we state a $Dmin$ - which marks the minimum change which is practically significant to the business. For instance, stating that any increase in retention that is under 2%, even if statistically significant, is not practical to the business.</p>
<h3 id="3.1-Invariate-Metrics---Sanity-Checks-">
<a class="anchor" href="#3.1-Invariate-Metrics---Sanity-Checks-" aria-hidden="true"><span class="octicon octicon-link"></span></a>3.1 Invariate Metrics - Sanity Checks <a class="anchor" id="invariate"></a><a class="anchor-link" href="#3.1-Invariate-Metrics---Sanity-Checks-"> </a>
</h3>
<table>
<thead>
<tr>
<th style="text-align:center">Metric Name</th>
<th style="text-align:center">Metric Formula</th>
<th style="text-align:center">$Dmin$</th>
<th style="text-align:center">Notation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Number of Cookies in Course Overview Page</td>
<td style="text-align:center"># unique daily cookies on page</td>
<td style="text-align:center">3000 cookies</td>
<td style="text-align:center">$C_k$</td>
</tr>
<tr>
<td style="text-align:center">Number of Clicks on Free Trial Button</td>
<td style="text-align:center"># unique daily cookies who clicked</td>
<td style="text-align:center">240 clicks</td>
<td style="text-align:center">$C_l$</td>
</tr>
<tr>
<td style="text-align:center">Free Trial button Click-Through-Probability</td>
<td style="text-align:center">$\frac{C_l}{C_k}$</td>
<td style="text-align:center">0.01</td>
<td style="text-align:center">$CTP$</td>
</tr>
</tbody>
</table>
<h3 id="3.2-Evaluation-Metrics---Performance-Indicators-">
<a class="anchor" href="#3.2-Evaluation-Metrics---Performance-Indicators-" aria-hidden="true"><span class="octicon octicon-link"></span></a>3.2 Evaluation Metrics - Performance Indicators <a class="anchor" id="evaluation"></a><a class="anchor-link" href="#3.2-Evaluation-Metrics---Performance-Indicators-"> </a>
</h3>
<table>
<thead>
<tr>
<th style="text-align:center">Metric Name</th>
<th style="text-align:center">Metric Formula</th>
<th style="text-align:center">$Dmin$</th>
<th style="text-align:center">Notation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Gross Conversion</td>
<td style="text-align:center">$\frac{enrolled}{C_l}$</td>
<td style="text-align:center">0.01</td>
<td style="text-align:center">$Conversion_{Gross}$</td>
</tr>
<tr>
<td style="text-align:center">Retention</td>
<td style="text-align:center">$\frac{paid}{enrolled}$</td>
<td style="text-align:center">0.01</td>
<td style="text-align:center">$Retention$</td>
</tr>
<tr>
<td style="text-align:center">Net Conversion</td>
<td style="text-align:center">$\frac{paid}{C_l}$</td>
<td style="text-align:center">0.0075</td>
<td style="text-align:center">$Conversion_{Net}$</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="4-Estimating-the-baseline-values-of-metrics-">
<a class="anchor" href="#4-Estimating-the-baseline-values-of-metrics-" aria-hidden="true"><span class="octicon octicon-link"></span></a>4 Estimating the baseline values of metrics <a class="anchor" id="baseline"></a><a class="anchor-link" href="#4-Estimating-the-baseline-values-of-metrics-"> </a>
</h2>
<p>Before we start our experiment we should know how these metrics behave before the change - that is, what are their baseline values.</p>
<h3 id="4.1-Collecting-estimators-data-">
<a class="anchor" href="#4.1-Collecting-estimators-data-" aria-hidden="true"><span class="octicon octicon-link"></span></a>4.1 Collecting estimators data <a class="anchor" id="collect"></a><a class="anchor-link" href="#4.1-Collecting-estimators-data-"> </a>
</h3>
<p>Udacity gives the following rough estimates for these metrics (presumably collected from aggregates on daily traffic) <br></p>
<table>
<thead>
<tr>
<th style="text-align:center">Item</th>
<th style="text-align:center">Description</th>
<th style="text-align:center">Estimator</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Number of cookies</td>
<td style="text-align:center">Daily unique cookies to view course overview page</td>
<td style="text-align:center">40,000</td>
</tr>
<tr>
<td style="text-align:center">Number of clicks</td>
<td style="text-align:center">Daily unique cookies to click Free Trial button</td>
<td style="text-align:center">3,200</td>
</tr>
<tr>
<td style="text-align:center">Number of enrollments</td>
<td style="text-align:center">Free Trial enrollments per day</td>
<td style="text-align:center">660</td>
</tr>
<tr>
<td style="text-align:center">CTP</td>
<td style="text-align:center">CTP on Free Trial button</td>
<td style="text-align:center">0.08</td>
</tr>
<tr>
<td style="text-align:center">Gross Conversion</td>
<td style="text-align:center">Probability of enrolling, given a click</td>
<td style="text-align:center">0.20625</td>
</tr>
<tr>
<td style="text-align:center">Retention</td>
<td style="text-align:center">Probability of payment, given enrollment</td>
<td style="text-align:center">0.53</td>
</tr>
<tr>
<td style="text-align:center">Net Conversion</td>
<td style="text-align:center">Probability of payment, given click</td>
<td style="text-align:center">0.109313</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">baseline</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Cookies"</span><span class="p">:</span><span class="mi">40000</span><span class="p">,</span><span class="s2">"Clicks"</span><span class="p">:</span><span class="mi">3200</span><span class="p">,</span><span class="s2">"Enrollments"</span><span class="p">:</span><span class="mi">660</span><span class="p">,</span><span class="s2">"CTP"</span><span class="p">:</span><span class="mf">0.08</span><span class="p">,</span><span class="s2">"GConversion"</span><span class="p">:</span><span class="mf">0.20625</span><span class="p">,</span>
           <span class="s2">"Retention"</span><span class="p">:</span><span class="mf">0.53</span><span class="p">,</span><span class="s2">"NConversion"</span><span class="p">:</span><span class="mf">0.109313</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="4.2-Estimating-Standard-Deviation-">
<a class="anchor" href="#4.2-Estimating-Standard-Deviation-" aria-hidden="true"><span class="octicon octicon-link"></span></a>4.2 Estimating Standard Deviation <a class="anchor" id="sd"></a><a class="anchor-link" href="#4.2-Estimating-Standard-Deviation-"> </a>
</h3>
<p>Once we collected these estimates, we should estimate the standard deviation of a metric, this is computed for sample size calculations and confidence intervals for our results. The more variant a metric is, the harder it is to reach a significant result. Assuming a sample size of 5,000 cookies visiting the course overview page per day (as given in project's instructions) - we want to estimate a standard deviation, for the evaluation metrics only. The sample size we are considering should be smaller than the "population" we collected and small enough to have two groups with that size.</p>
<h4 id="4.2.1-Scaling-Collected-Data-">
<a class="anchor" href="#4.2.1-Scaling-Collected-Data-" aria-hidden="true"><span class="octicon octicon-link"></span></a>4.2.1 Scaling Collected Data <a class="anchor" id="scale"></a><a class="anchor-link" href="#4.2.1-Scaling-Collected-Data-"> </a>
</h4>
<p>For all the calculations to follow we need to scale our collected counts estimates of metrics with the sample size we specified for variance estimation. In this case, from 40000 unique cookies to visit the course overview page per day, to 5000.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">baseline</span><span class="p">[</span><span class="s2">"Cookies"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">baseline</span><span class="p">[</span><span class="s2">"Clicks"</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">"Clicks"</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">5000</span><span class="o">/</span><span class="mi">40000</span><span class="p">)</span>
<span class="n">baseline</span><span class="p">[</span><span class="s2">"Enrollments"</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">"Enrollments"</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">5000</span><span class="o">/</span><span class="mi">40000</span><span class="p">)</span>
<span class="n">baseline</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{'CTP': 0.08,
 'Clicks': 400.0,
 'Cookies': 5000,
 'Enrollments': 82.5,
 'GConversion': 0.20625,
 'NConversion': 0.109313,
 'Retention': 0.53}</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="4.2.2-Estimating-Analytically-">
<a class="anchor" href="#4.2.2-Estimating-Analytically-" aria-hidden="true"><span class="octicon octicon-link"></span></a>4.2.2 Estimating Analytically <a class="anchor" id="estimate"></a><a class="anchor-link" href="#4.2.2-Estimating-Analytically-"> </a>
</h4>
<p>In order to estimate variance analytically, we can assume metrics which are probabilities ($\hat{p}$) are binomially distributed, so we can use this formula for the standard deviation: <br></p>
<p></p>
<center><font size="4">$SD=\sqrt{\frac{\hat{p}*(1-\hat{p})}{n}}$</font></center>
<br>
This assumption is only valid when the <strong>unit of diversion</strong> of the experiment is equal to the <strong>unit of analysis</strong> (the denominator of the metric formula). In the cases when this is not valid, the actual variance might be different and it is recommended to estimate it empirically.
<p>For each metric, we need to plug two variables into the formula: <br>
$\hat{p}$ - baseline probability of the event to occur <br>
$ n $ - sample size <br></p>
<ul>
<li>
<strong>Gross Conversion</strong> - The baseline probability for Gross Conversion can be calculated by the number of users to enroll in a free trial divided by the number of cookies clicking the free trial. In other words, the probability of enrollment given a click. In this case, the unit of diversion (Cookies), that is the element by which we differentiate samples and assign them to control and experiment groups, is equall to the unit of analysis (cookies who click), that is the denominator of the formula to calculate Gross Conversion (GC). When this is the case, this analytic estimate of variance is sufficient.</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># and compute the Stansard Deviation(sd) rounded to 4 decimal digits.</span>
<span class="n">GC</span><span class="o">=</span><span class="p">{}</span>
<span class="n">GC</span><span class="p">[</span><span class="s2">"d_min"</span><span class="p">]</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">GC</span><span class="p">[</span><span class="s2">"p"</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">"GConversion"</span><span class="p">]</span>
<span class="c1">#p is given in this case - or we could calculate it from enrollments/clicks</span>
<span class="n">GC</span><span class="p">[</span><span class="s2">"n"</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">"Clicks"</span><span class="p">]</span>
<span class="n">GC</span><span class="p">[</span><span class="s2">"sd"</span><span class="p">]</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">GC</span><span class="p">[</span><span class="s2">"p"</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">GC</span><span class="p">[</span><span class="s2">"p"</span><span class="p">]))</span><span class="o">/</span><span class="n">GC</span><span class="p">[</span><span class="s2">"n"</span><span class="p">]),</span><span class="mi">4</span><span class="p">)</span>
<span class="n">GC</span><span class="p">[</span><span class="s2">"sd"</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.0202</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<strong>Retention</strong> - The baseline probability for retention is the number of paying users (enrolled after 14 free days) divided by the number of total enrolled users. In other words, the probability of payment, given enrollment. The sample size is the number of enrolled users. In this case, unit of diversion is not equal to unit of analysis (users who enrolled) so an analytical estimation is not enough - if we had the data for these estimates, we would want to estimate this variance empirically as well.</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># and compute the Stansard Deviation(sd) rounded to 4 decimal digits.</span>
<span class="n">R</span><span class="o">=</span><span class="p">{}</span>
<span class="n">R</span><span class="p">[</span><span class="s2">"d_min"</span><span class="p">]</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">R</span><span class="p">[</span><span class="s2">"p"</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">"Retention"</span><span class="p">]</span>
<span class="n">R</span><span class="p">[</span><span class="s2">"n"</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">"Enrollments"</span><span class="p">]</span>
<span class="n">R</span><span class="p">[</span><span class="s2">"sd"</span><span class="p">]</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">R</span><span class="p">[</span><span class="s2">"p"</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="s2">"p"</span><span class="p">]))</span><span class="o">/</span><span class="n">R</span><span class="p">[</span><span class="s2">"n"</span><span class="p">]),</span><span class="mi">4</span><span class="p">)</span>
<span class="n">R</span><span class="p">[</span><span class="s2">"sd"</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.0549</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>
<strong>Net Conversion</strong> - The baseline probability for the net conversion is the number of paying users divided by the number of cookies that clicked the free trial button. In other words, the probability of payment, given a click. The sample size is the number of cookies that clicked. In this case, the unit of analysis and diversion are equal so we expect a good enough estimation analytically.</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># and compute the Standard Deviation (sd) rounded to 4 decimal digits.</span>
<span class="n">NC</span><span class="o">=</span><span class="p">{}</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">"d_min"</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0075</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">"p"</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">"NConversion"</span><span class="p">]</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">"n"</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">"Clicks"</span><span class="p">]</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">"sd"</span><span class="p">]</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">NC</span><span class="p">[</span><span class="s2">"p"</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">NC</span><span class="p">[</span><span class="s2">"p"</span><span class="p">]))</span><span class="o">/</span><span class="n">NC</span><span class="p">[</span><span class="s2">"n"</span><span class="p">]),</span><span class="mi">4</span><span class="p">)</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">"sd"</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.0156</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="5-Experiment-Sizing-">
<a class="anchor" href="#5-Experiment-Sizing-" aria-hidden="true"><span class="octicon octicon-link"></span></a>5 Experiment Sizing <a class="anchor" id="sizing"></a><a class="anchor-link" href="#5-Experiment-Sizing-"> </a>
</h2>
<p>At this point, once we have estimated our metrics in the baseline (most importantly, their estimated variance) we cancalculate the munumal number of samples we need so that our experiment will have enough statistical power, as well as siginificance.</p>
<p>Given $\alpha=0.05$ (significance level ) and $\beta=0.2$ (power), we want to estimate how many total pageviews (cookies who viewed the course overview page) we need in the experiment. This amount will be divided into tthe two groups: control and experiment. This calculation can be done using an <a href="http://www.evanmiller.org/ab-testing/sample-size.html">online calculator</a> or by calculating directly using the required formula.</p>
<p>The minimum sample size for control and experiment groups, which provides probability of Type I Error $\alpha$, Power $1-\beta$, detectable effect $d$ and baseline conversion rate $p$ (simple hypothesis $H_0 : P_{cont} - P_{exp} = 0$ against simple alternative $H_A : P_{cont} - P_{exp} = d$  is:</p>
<p></p>
<center> <font size="5"> $n = \frac{(Z_{1-\frac{\alpha}{2}}sd_1 + Z_{1-\beta}sd_2)^2}{d^2}$</font>, with: <br><br>
$sd_1 = \sqrt{p(1-p)+p(1-p)}$<br><br>
$sd_2 = \sqrt{p(1-p)+(p+d)(1-(1-(p+d))}$ </center>
<br>
<p>Now, let's break down what inputs we need and which calculations still need to be made. Regarding inputs, we have all the data we need:
Type 1 error ($\alpha$), power ($1-\beta$), detectable change ($d = D_{min}$) and baseline conversion rate (our $\hat{p}$ ).
What we need to calculate:</p>
<ul>
<li>Get Z score for $1-\frac{\alpha}{2}$ and for $1-\beta$</li>
<li>Get standard deviations 1 &amp; 2, that is for both the baseline and for expected changed rate
All these components will finally yield the number we need.</li>
</ul>
<h3 id="5.1-Get-z-score-critical-value-and-Standard-Deviations-">
<a class="anchor" href="#5.1-Get-z-score-critical-value-and-Standard-Deviations-" aria-hidden="true"><span class="octicon octicon-link"></span></a>5.1 Get z-score critical value and Standard Deviations <a class="anchor" id="side_methods"></a><a class="anchor-link" href="#5.1-Get-z-score-critical-value-and-Standard-Deviations-"> </a>
</h3>
<p>We are used to looking up this value in a table, but gladly we can use python's <code>scipy.stats.norm</code> package to get all the required methods for normal distribution. The <code>ppf</code> method gives us access to the <a href="https://en.wikipedia.org/wiki/Quantile_function">Percent Point Function (ppf)</a> or Quantile Function, and besides it being the inverse of the <a href="https://en.wikipedia.org/wiki/Cumulative_distribution_function">Cummulative Distribution Function (cdf)</a>, this is the functions that will give back our required critical z-score.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_sds</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="n">sd1</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">))</span>
    <span class="n">sd2</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">d</span><span class="p">)))</span>
    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">sd1</span><span class="p">,</span><span class="n">sd2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#Returns: z-score for given alpha</span>
<span class="k">def</span> <span class="nf">get_z_score</span><span class="p">(</span><span class="n">alpha</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>

<span class="c1"># Inputs p-baseline conversion rate which is our estimated p and d-minimum detectable change</span>
<span class="c1"># Returns</span>
<span class="k">def</span> <span class="nf">get_sds</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="n">sd1</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">))</span>
    <span class="n">sd2</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">d</span><span class="p">)))</span>
    <span class="n">sds</span><span class="o">=</span><span class="p">[</span><span class="n">sd1</span><span class="p">,</span><span class="n">sd2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sds</span>

<span class="c1"># Inputs:sd1-sd for the baseline,sd2-sd for the expected change,alpha,beta,d-d_min,p-baseline estimate p</span>
<span class="c1"># Returns: the minimum sample size required per group according to metric denominator</span>
<span class="k">def</span> <span class="nf">get_sampSize</span><span class="p">(</span><span class="n">sds</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="n">n</span><span class="o">=</span><span class="nb">pow</span><span class="p">((</span><span class="n">get_z_score</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">sds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">get_z_score</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="n">sds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">pow</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="5.2-Calculate-Sample-Size-per-Metric-">
<a class="anchor" href="#5.2-Calculate-Sample-Size-per-Metric-" aria-hidden="true"><span class="octicon octicon-link"></span></a>5.2 Calculate Sample Size per Metric <a class="anchor" id="calc"></a><a class="anchor-link" href="#5.2-Calculate-Sample-Size-per-Metric-"> </a>
</h3>
<p>OK! Looks like we set up all the tools required for this part. We are now going to calculate the number of samples required for the experiment per metric, and we are subected to the fact that the highest sample size will be the effective size. This size should be considered in terms of efficacy of duration and exposure: how long will it take to get this many samples for the experiment.</p>
<p>So, to work more easily, let's add the d parameter to each of the metrics characteristics of each metric:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">GC</span><span class="p">[</span><span class="s2">"d"</span><span class="p">]</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">R</span><span class="p">[</span><span class="s2">"d"</span><span class="p">]</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">"d"</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0075</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, for the calculations</p>
<ul>
<li><strong>Gross Conversion</strong></li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">GC</span><span class="p">[</span><span class="s2">"SampSize"</span><span class="p">]</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_sampSize</span><span class="p">(</span><span class="n">get_sds</span><span class="p">(</span><span class="n">GC</span><span class="p">[</span><span class="s2">"p"</span><span class="p">],</span><span class="n">GC</span><span class="p">[</span><span class="s2">"d"</span><span class="p">]),</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">GC</span><span class="p">[</span><span class="s2">"d"</span><span class="p">]))</span>
<span class="n">GC</span><span class="p">[</span><span class="s2">"SampSize"</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>25835</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This means we need at least 25,835 cookies who click the Free Trial button - per group! That means that if we got 400 clicks out of 5000 pageviews (<code>400/5000 = 0.08</code>) -&gt; So, we are going to need <code>GC["SampSize"]/0.08 = 322,938</code> pageviews, again ; per group! Finally, the total amount of samples per the Gross Conversion metric is:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">GC</span><span class="p">[</span><span class="s2">"SampSize"</span><span class="p">]</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">GC</span><span class="p">[</span><span class="s2">"SampSize"</span><span class="p">]</span><span class="o">/</span><span class="mf">0.08</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="n">GC</span><span class="p">[</span><span class="s2">"SampSize"</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>645875</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Retention</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">R</span><span class="p">[</span><span class="s2">"SampSize"</span><span class="p">]</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_sampSize</span><span class="p">(</span><span class="n">get_sds</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="s2">"p"</span><span class="p">],</span><span class="n">R</span><span class="p">[</span><span class="s2">"d"</span><span class="p">]),</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">R</span><span class="p">[</span><span class="s2">"d"</span><span class="p">]))</span>
<span class="n">R</span><span class="p">[</span><span class="s2">"SampSize"</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>39087</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This means that we need 39,087 users who enrolled per group! We have to first convert this to cookies who clicked, and then to cookies who viewed the page, then finally to multipky by two for both groups.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">R</span><span class="p">[</span><span class="s2">"SampSize"</span><span class="p">]</span><span class="o">=</span><span class="n">R</span><span class="p">[</span><span class="s2">"SampSize"</span><span class="p">]</span><span class="o">/</span><span class="mf">0.08</span><span class="o">/</span><span class="mf">0.20625</span><span class="o">*</span><span class="mi">2</span>
<span class="n">R</span><span class="p">[</span><span class="s2">"SampSize"</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>4737818.181818182</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This takes us as high as over 4 million page views total, this is practically impossible because we know we get about 40,000 a day, this would take well over 100 days. This means we have to drop this metric and not continue to work with it because results from our experiment (which is much smaller) will be biased.</p>
<ul>
<li><strong>Net Conversion</strong></li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">NC</span><span class="p">[</span><span class="s2">"SampSize"</span><span class="p">]</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_sampSize</span><span class="p">(</span><span class="n">get_sds</span><span class="p">(</span><span class="n">NC</span><span class="p">[</span><span class="s2">"p"</span><span class="p">],</span><span class="n">NC</span><span class="p">[</span><span class="s2">"d"</span><span class="p">]),</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">NC</span><span class="p">[</span><span class="s2">"d"</span><span class="p">]))</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">"SampSize"</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>27413</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So, needing 27,413 cookies who click per group takes us all the way up to:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">NC</span><span class="p">[</span><span class="s2">"SampSize"</span><span class="p">]</span><span class="o">=</span><span class="n">NC</span><span class="p">[</span><span class="s2">"SampSize"</span><span class="p">]</span><span class="o">/</span><span class="mf">0.08</span><span class="o">*</span><span class="mi">2</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">"SampSize"</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>685325.0</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We are all the way up to 685,325 cookies who view the page. This is more than what was needed for Gross Conversion, so this will be our number. Assuming we take 80% of each days pageviews, the data collection period for this experiment (the period in which the experiment is revealed) will be about 3 weeks.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="6-Analyzing-Collected-Data-">
<a class="anchor" href="#6-Analyzing-Collected-Data-" aria-hidden="true"><span class="octicon octicon-link"></span></a>6 Analyzing Collected Data <a class="anchor" id="analysis"></a><a class="anchor-link" href="#6-Analyzing-Collected-Data-"> </a>
</h2>
<p>Finally, the moment we've all been waiting for, after so much preparation we finally get to see what this experiment will prove!
The data is presented as two spreadsheets. I will load each spreadshot into a pandas dataframe.</p>
<h3 id="6.1-Loading-collected-data-">
<a class="anchor" href="#6.1-Loading-collected-data-" aria-hidden="true"><span class="octicon octicon-link"></span></a>6.1 Loading collected data <a class="anchor" id="collect_results"></a><a class="anchor-link" href="#6.1-Loading-collected-data-"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">control</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"https://github.com/baumanab/udacity_ABTesting/raw/master/data/Final%20Project%20Results%20-%20Control.csv"</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"https://github.com/baumanab/udacity_ABTesting/raw/master/data/Final%20Project%20Results%20-</span><span class="si">%20E</span><span class="s2">xperiment.csv"</span><span class="p">)</span>
<span class="n">control</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Pageviews</th>
      <th>Clicks</th>
      <th>Enrollments</th>
      <th>Payments</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Sat, Oct 11</td>
      <td>7723</td>
      <td>687</td>
      <td>134.0</td>
      <td>70.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Sun, Oct 12</td>
      <td>9102</td>
      <td>779</td>
      <td>147.0</td>
      <td>70.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Mon, Oct 13</td>
      <td>10511</td>
      <td>909</td>
      <td>167.0</td>
      <td>95.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Tue, Oct 14</td>
      <td>9871</td>
      <td>836</td>
      <td>156.0</td>
      <td>105.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Wed, Oct 15</td>
      <td>10014</td>
      <td>837</td>
      <td>163.0</td>
      <td>64.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="6.2-Sanity-Checks-">
<a class="anchor" href="#6.2-Sanity-Checks-" aria-hidden="true"><span class="octicon octicon-link"></span></a>6.2 Sanity Checks <a class="anchor" id="sanity"></a><a class="anchor-link" href="#6.2-Sanity-Checks-"> </a>
</h3>
<p>First thing we have to do before even beginning to analyze this experiment's results is sanity checks. These checks help verify that the experiment was conducted as expected and that other factors did not influence the data which we collected. This also makes sure that data collection was correct.</p>
<p>We have 3 Invariant metrics::</p>
<ul>
<li>Number of Cookies in Course Overview Page</li>
<li>Number of Clicks on Free Trial Button</li>
<li>Free Trial button Click-Through-Probability</li>
</ul>
<p>Two of these metrics are simple counts like number of cookies or number of clicks and the third is a probability (CTP). We will use two different ways of checking whether these obsereved values are like we expect (if in fact the experiment was not damaged.</p>
<h4 id="6.2.1-Sanity-Checks-for-differences-between-counts-">
<a class="anchor" href="#6.2.1-Sanity-Checks-for-differences-between-counts-" aria-hidden="true"><span class="octicon octicon-link"></span></a>6.2.1 Sanity Checks for differences between counts <a class="anchor" id="check_counts"></a><a class="anchor-link" href="#6.2.1-Sanity-Checks-for-differences-between-counts-"> </a>
</h4>
<ul>
<li>
<strong>Number of cookies who viewed the course overview page</strong> - Starting from this simpel invariant metric, we want to count the total amount of cookie pageviews we diverted to each group and see if there is a significant difference int he amount of cookies. A significant difference will imply a biased experiment that we should not rely on it's results.</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pageviews_cont</span><span class="o">=</span><span class="n">control</span><span class="p">[</span><span class="s1">'Pageviews'</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">pageviews_exp</span><span class="o">=</span><span class="n">experiment</span><span class="p">[</span><span class="s1">'Pageviews'</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">pageviews_total</span><span class="o">=</span><span class="n">pageviews_cont</span><span class="o">+</span><span class="n">pageviews_exp</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">"number of pageviews in control:"</span><span class="p">,</span> <span class="n">pageviews_cont</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">"number of Pageviewsin experiment:"</span> <span class="p">,</span><span class="n">pageviews_exp</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>number of pageviews in control: 345543
number of Pageviewsin experiment: 344660
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ok so these look like pretty close numbers. Now, let's make sure this difference in amounts is not significant and is random and even like we expected. We can model this diversion in the following way: <br>
We expect the amount of pageviews in the control group to be about a half (50%) of the total pageviews in both groups, so we can define a random variable with an easy to use distribution. <br>
A binomial random variable will be the number of successes we can expect to get out of N experiments, given the probability of a single success. So, if we consider being assigned to a group (control, for example) a success with probability 0.5 (random!), the number of samples which get assigned to the group is the value of our random binomial variable! <br></p>
<p>This get's easier thanks to the central limit theorem which let's us approximate the binomial distribution to a normal distribution (when n is large enough) with a mean of $p$ and a standard deviation $\sqrt{\frac{p(1-p)}{N}}$</p>
<p></p>
<center> <font size="4"> $ X$~$N( p,\sqrt{\frac{p(1-p)}{N}})$ </font>
</center>
What we want to test is whether our observed $\hat{p}$ (number of samples in control divided by total number of damples in both groups) is not significantly different than $p=0.5$. In order to do that we can calculate the margin of error acceptable at a 95% confidence level:
<p></p>
<center> <font size="4"> $ ME=Z_{1-\frac{\alpha}{2}}SD$ </font>
</center>
Finally, a <a href="https://en.wikipedia.org/wiki/Confidence_interval">confidence interval</a> can be derived to tell us in which range an observed $p$ can exist and be acceptable as "the same" as the expected value.
<p></p>
<center> <font size="4"> $ CI=[\hat{p}-ME,\hat{p}+ME]$ </font>
</center>
When our obsereved $\hat{p}$ is within this range, all is well and the test was passed.

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p</span><span class="o">=</span><span class="mf">0.5</span>
<span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span>
<span class="n">p_hat</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">pageviews_cont</span><span class="o">/</span><span class="p">(</span><span class="n">pageviews_total</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<span class="n">sd</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">pageviews_total</span><span class="p">))</span>
<span class="n">ME</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_z_score</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">sd</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">"The confidence interval is between"</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="n">ME</span><span class="p">,</span><span class="s2">"and"</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="n">ME</span><span class="p">,</span><span class="s2">"; Is"</span><span class="p">,</span><span class="n">p_hat</span><span class="p">,</span><span class="s2">"inside this range?"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The confidence interval is between 0.4988 and 0.5012 ; Is 0.5006 inside this range?
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our observed $\hat{p}$ is inside this range which means the difference in number of samples between groups is expected. So far so good, since this invariant metric sanity test passes!</p>
<ul>
<li>
<strong>Number of cookies who clicked the Free Trial Button</strong>
We are going to address this count with the same strategy as before.</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clicks_cont</span><span class="o">=</span><span class="n">control</span><span class="p">[</span><span class="s1">'Clicks'</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">clicks_exp</span><span class="o">=</span><span class="n">experiment</span><span class="p">[</span><span class="s1">'Clicks'</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">clicks_total</span><span class="o">=</span><span class="n">clicks_cont</span><span class="o">+</span><span class="n">clicks_exp</span>

<span class="n">p_hat</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">clicks_cont</span><span class="o">/</span><span class="n">clicks_total</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">sd</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">clicks_total</span><span class="p">)</span>
<span class="n">ME</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_z_score</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">sd</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">"The confidence interval is between"</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="n">ME</span><span class="p">,</span><span class="s2">"and"</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="n">ME</span><span class="p">,</span><span class="s2">"; Is"</span><span class="p">,</span><span class="n">p_hat</span><span class="p">,</span><span class="s2">"inside this range?"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The confidence interval is between 0.4959 and 0.5041 ; Is 0.5005 inside this range?
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We have another pass! Great, so far it still seems all is well with our experiment results. Now, for the final metric which is a probability.</p>
<h4 id="6.2.2-Sanity-Checks-for-differences-between-probabilities-">
<a class="anchor" href="#6.2.2-Sanity-Checks-for-differences-between-probabilities-" aria-hidden="true"><span class="octicon octicon-link"></span></a>6.2.2 Sanity Checks for differences between probabilities <a class="anchor" id="check_prob"></a><a class="anchor-link" href="#6.2.2-Sanity-Checks-for-differences-between-probabilities-"> </a>
</h4>
<ul>
<li>
<strong> Click-through-probability of the Free Trial Button</strong>
In this case, we want to make sure the proportion of clicks given a pageview (our observed CTP) is about the same in both groups (since this was not expected to change due to the experiment). In order to check this out we will calculate the CTP in each group and calculate a confidence interval for the expected difference between them. </li>
</ul>
<p>In other words, we expect to see no difference ($CTP_{exp}-CTP_{cont}=0$), with an acceptable margin of error, dictated by our calculated confidence interval. The changes we should notice are for the calculation of the standard error - which in this case is a pooled standard error.</p>
<p></p>
<center><font size="4">$SD_{pool}=\sqrt{\hat{p_{pool}}(1-\hat{p_{pool}}(\frac{1}{N_{cont}}+\frac{1}{N_{exp}})}$</font></center>
with <br> <center><font size="5"> $\hat{p_{pool}}=\frac{x_{cont}+x_{exp}}{N_{cont}+N_{exp}}$ </font></center>
We should understand that CTP is a proportion in a population (amount of events x in a population n) like the amount of clicks out of the amount of pageviews..

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ctp_cont</span><span class="o">=</span><span class="n">clicks_cont</span><span class="o">/</span><span class="n">pageviews_cont</span>
<span class="n">ctp_exp</span><span class="o">=</span><span class="n">clicks_exp</span><span class="o">/</span><span class="n">pageviews_exp</span>
<span class="n">d_hat</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">ctp_exp</span><span class="o">-</span><span class="n">ctp_cont</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">p_pooled</span><span class="o">=</span><span class="n">clicks_total</span><span class="o">/</span><span class="n">pageviews_total</span>
<span class="n">sd_pooled</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p_pooled</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p_pooled</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">pageviews_cont</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">pageviews_exp</span><span class="p">))</span>
<span class="n">ME</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_z_score</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">sd_pooled</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">"The confidence interval is between"</span><span class="p">,</span><span class="mi">0</span><span class="o">-</span><span class="n">ME</span><span class="p">,</span><span class="s2">"and"</span><span class="p">,</span><span class="mi">0</span><span class="o">+</span><span class="n">ME</span><span class="p">,</span><span class="s2">"; Is"</span><span class="p">,</span><span class="n">d_hat</span><span class="p">,</span><span class="s2">"within this range?"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The confidence interval is between -0.0013 and 0.0013 ; Is 0.0001 within this range?
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Wonderful. It seems this test has passed with flying colors as well.</p>
<h3 id="6.3-Examining-effect-size-">
<a class="anchor" href="#6.3-Examining-effect-size-" aria-hidden="true"><span class="octicon octicon-link"></span></a>6.3 Examining effect size <a class="anchor" id="effect"></a><a class="anchor-link" href="#6.3-Examining-effect-size-"> </a>
</h3>
<p>The next step is looking at the changes between the control and experiment groups with regard to our evaluation metrics to make sure the difference is there, that it is statistically significant and most importantly practically significant (the difference is "big" enough to make the experimented change beneficial to the company).</p>
<p>Now, all that is left is to measure for each evaluation metric, the difference between the values from both groups. Then, we compute the confidence interval for that difference and test whether or not this confidence interval is both statistically and practically significant.</p>
<ul>
<li>
<strong>Gross Conversion</strong>
A metric is statistically significant if the confidence interval does not include 0 (that is, you can be confident there was a change), and it is practically significant if the confidence interval does not include the practical significance boundary (that is, you can be confident there is a change that matters to the business.)<blockquote>
<p><strong>Important:</strong> The given spreadsheet lists pageviews and clicks for 39 days, while it only lists enrollments and payments for 23 days. So, when working with enrollments and payments we should notice using only the corresponding pageviews and clicks, and not all of them.</p>
</blockquote>
</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">clicks_cont</span><span class="o">=</span><span class="n">control</span><span class="p">[</span><span class="s2">"Clicks"</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">control</span><span class="p">[</span><span class="s2">"Enrollments"</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">clicks_exp</span><span class="o">=</span><span class="n">experiment</span><span class="p">[</span><span class="s2">"Clicks"</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">experiment</span><span class="p">[</span><span class="s2">"Enrollments"</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">enrollments_cont</span><span class="o">=</span><span class="n">control</span><span class="p">[</span><span class="s2">"Enrollments"</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">enrollments_exp</span><span class="o">=</span><span class="n">experiment</span><span class="p">[</span><span class="s2">"Enrollments"</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">GC_cont</span><span class="o">=</span><span class="n">enrollments_cont</span><span class="o">/</span><span class="n">clicks_cont</span>
<span class="n">GC_exp</span><span class="o">=</span><span class="n">enrollments_exp</span><span class="o">/</span><span class="n">clicks_exp</span>
<span class="n">GC_pooled</span><span class="o">=</span><span class="p">(</span><span class="n">enrollments_cont</span><span class="o">+</span><span class="n">enrollments_exp</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">clicks_cont</span><span class="o">+</span><span class="n">clicks_exp</span><span class="p">)</span>
<span class="n">GC_sd_pooled</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GC_pooled</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">GC_pooled</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">clicks_cont</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">clicks_exp</span><span class="p">))</span>
<span class="n">GC_ME</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_z_score</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">GC_sd_pooled</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">GC_diff</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">GC_exp</span><span class="o">-</span><span class="n">GC_cont</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"The change due to the experiment is"</span><span class="p">,</span><span class="n">GC_diff</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="s2">"%"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Confidence Interval: ["</span><span class="p">,</span><span class="n">GC_diff</span><span class="o">-</span><span class="n">GC_ME</span><span class="p">,</span><span class="s2">","</span><span class="p">,</span><span class="n">GC_diff</span><span class="o">+</span><span class="n">GC_ME</span><span class="p">,</span><span class="s2">"]"</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">"The change is statistically significant if the CI doesn't include 0. In that case, it is practically significant if"</span><span class="p">,</span><span class="o">-</span><span class="n">GC</span><span class="p">[</span><span class="s2">"d_min"</span><span class="p">],</span><span class="s2">"is not in the CI as well."</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The change due to the experiment is -2.06 %
Confidence Interval: [ -0.0292 , -0.012 ]
The change is statistically significant if the CI doesn't include 0. In that case, it is practically significant if -0.01 is not in the CI as well.
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>According to this result there was a change due to the experiment, that change was both statistically and practically significant. 
We have a negative change of 2.06%, when we were willing to accept any change greater than 1%. This means the Gross Conversion rate of the experiment group (the one exposed to the change, i.e. asked how many hours they can devote to studying) has decreased as expected by 2% and this change was significant. This means  less people enrolled in the Free Trial after due to the pop-up.</p>
<ul>
<li>
<strong>Net Conversion</strong> 
The hypothesis is the same as before just with net conversion instead of gross. At this point we expect the fraction of payers (out of the clicks) to decrease as well.</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">payments_cont</span><span class="o">=</span><span class="n">control</span><span class="p">[</span><span class="s2">"Payments"</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">payments_exp</span><span class="o">=</span><span class="n">experiment</span><span class="p">[</span><span class="s2">"Payments"</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">NC_cont</span><span class="o">=</span><span class="n">payments_cont</span><span class="o">/</span><span class="n">clicks_cont</span>
<span class="n">NC_exp</span><span class="o">=</span><span class="n">payments_exp</span><span class="o">/</span><span class="n">clicks_exp</span>
<span class="n">NC_pooled</span><span class="o">=</span><span class="p">(</span><span class="n">payments_cont</span><span class="o">+</span><span class="n">payments_exp</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">clicks_cont</span><span class="o">+</span><span class="n">clicks_exp</span><span class="p">)</span>
<span class="n">NC_sd_pooled</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">NC_pooled</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">NC_pooled</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">clicks_cont</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">clicks_exp</span><span class="p">))</span>
<span class="n">NC_ME</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_z_score</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">NC_sd_pooled</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">NC_diff</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">NC_exp</span><span class="o">-</span><span class="n">NC_cont</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"The change due to the experiment is"</span><span class="p">,</span><span class="n">NC_diff</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="s2">"%"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Confidence Interval: ["</span><span class="p">,</span><span class="n">NC_diff</span><span class="o">-</span><span class="n">NC_ME</span><span class="p">,</span><span class="s2">","</span><span class="p">,</span><span class="n">NC_diff</span><span class="o">+</span><span class="n">NC_ME</span><span class="p">,</span><span class="s2">"]"</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">"The change is statistically significant if the CI doesn't include 0. In that case, it is practically significant if"</span><span class="p">,</span><span class="n">NC</span><span class="p">[</span><span class="s2">"d_min"</span><span class="p">],</span><span class="s2">"is not in the CI as well."</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The change due to the experiment is -0.49 %
Confidence Interval: [ -0.0116 , 0.0018000000000000004 ]
The change is statistically significant if the CI doesn't include 0. In that case, it is practically significant if 0.0075 is not in the CI as well.
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this case we got a change size of less than a 0.5%, a very small decrease which is not statistically significant, and as such not practically significant.</p>
<h2 id="6.4-Double-check-with-Sign-Tests-">
<a class="anchor" href="#6.4-Double-check-with-Sign-Tests-" aria-hidden="true"><span class="octicon octicon-link"></span></a>6.4 Double check with Sign Tests <a class="anchor" id="sign_tests"></a><a class="anchor-link" href="#6.4-Double-check-with-Sign-Tests-"> </a>
</h2>
<p>In a sign test we get another angle at analyzing the results we got - we check if the trend of change we observed (increase or decrease) was evident in the daily data. We are goint to compute the metric's value per day and then count on how many days the metric was lower in the experiment group and this will be the number of succssesses for our binomial variable. Once this is defined we can look at the proportion of days of success out of all the available days.</p>
<h3 id="6.4.1-Data-Preparation-">
<a class="anchor" href="#6.4.1-Data-Preparation-" aria-hidden="true"><span class="octicon octicon-link"></span></a>6.4.1 Data Preparation <a class="anchor" id="prep"></a><a class="anchor-link" href="#6.4.1-Data-Preparation-"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># start by merging the two datasets</span>
<span class="n">full</span><span class="o">=</span><span class="n">control</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">experiment</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s2">"inner"</span><span class="p">,</span><span class="n">lsuffix</span><span class="o">=</span><span class="s2">"_cont"</span><span class="p">,</span><span class="n">rsuffix</span><span class="o">=</span><span class="s2">"_exp"</span><span class="p">)</span>
<span class="c1">#Let's look at what we got</span>
<span class="n">full</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Date_cont           37
Pageviews_cont      37
Clicks_cont         37
Enrollments_cont    23
Payments_cont       23
Date_exp            37
Pageviews_exp       37
Clicks_exp          37
Enrollments_exp     23
Payments_exp        23
dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">full</span><span class="o">=</span><span class="n">full</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">full</span><span class="p">[</span><span class="s2">"Enrollments_cont"</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>
<span class="n">full</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Date_cont           23
Pageviews_cont      23
Clicks_cont         23
Enrollments_cont    23
Payments_cont       23
Date_exp            23
Pageviews_exp       23
Clicks_exp          23
Enrollments_exp     23
Payments_exp        23
dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># We need a 1 if the experiment value is greater than the control value=</span>
<span class="n">x</span><span class="o">=</span><span class="n">full</span><span class="p">[</span><span class="s1">'Enrollments_cont'</span><span class="p">]</span><span class="o">/</span><span class="n">full</span><span class="p">[</span><span class="s1">'Clicks_cont'</span><span class="p">]</span>
<span class="n">y</span><span class="o">=</span><span class="n">full</span><span class="p">[</span><span class="s1">'Enrollments_exp'</span><span class="p">]</span><span class="o">/</span><span class="n">full</span><span class="p">[</span><span class="s1">'Clicks_exp'</span><span class="p">]</span>
<span class="n">full</span><span class="p">[</span><span class="s1">'GC'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># The same now for net conversion</span>
<span class="n">z</span><span class="o">=</span><span class="n">full</span><span class="p">[</span><span class="s1">'Payments_cont'</span><span class="p">]</span><span class="o">/</span><span class="n">full</span><span class="p">[</span><span class="s1">'Clicks_cont'</span><span class="p">]</span>
<span class="n">w</span><span class="o">=</span><span class="n">full</span><span class="p">[</span><span class="s1">'Payments_exp'</span><span class="p">]</span><span class="o">/</span><span class="n">full</span><span class="p">[</span><span class="s1">'Clicks_exp'</span><span class="p">]</span>
<span class="n">full</span><span class="p">[</span><span class="s1">'NC'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">z</span><span class="o">&lt;</span><span class="n">w</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">full</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date_cont</th>
      <th>Pageviews_cont</th>
      <th>Clicks_cont</th>
      <th>Enrollments_cont</th>
      <th>Payments_cont</th>
      <th>Date_exp</th>
      <th>Pageviews_exp</th>
      <th>Clicks_exp</th>
      <th>Enrollments_exp</th>
      <th>Payments_exp</th>
      <th>GC</th>
      <th>NC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Sat, Oct 11</td>
      <td>7723</td>
      <td>687</td>
      <td>134.0</td>
      <td>70.0</td>
      <td>Sat, Oct 11</td>
      <td>7716</td>
      <td>686</td>
      <td>105.0</td>
      <td>34.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Sun, Oct 12</td>
      <td>9102</td>
      <td>779</td>
      <td>147.0</td>
      <td>70.0</td>
      <td>Sun, Oct 12</td>
      <td>9288</td>
      <td>785</td>
      <td>116.0</td>
      <td>91.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Mon, Oct 13</td>
      <td>10511</td>
      <td>909</td>
      <td>167.0</td>
      <td>95.0</td>
      <td>Mon, Oct 13</td>
      <td>10480</td>
      <td>884</td>
      <td>145.0</td>
      <td>79.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Tue, Oct 14</td>
      <td>9871</td>
      <td>836</td>
      <td>156.0</td>
      <td>105.0</td>
      <td>Tue, Oct 14</td>
      <td>9867</td>
      <td>827</td>
      <td>138.0</td>
      <td>92.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Wed, Oct 15</td>
      <td>10014</td>
      <td>837</td>
      <td>163.0</td>
      <td>64.0</td>
      <td>Wed, Oct 15</td>
      <td>9793</td>
      <td>832</td>
      <td>140.0</td>
      <td>94.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">GC_x</span><span class="o">=</span><span class="n">full</span><span class="o">.</span><span class="n">GC</span><span class="p">[</span><span class="n">full</span><span class="p">[</span><span class="s2">"GC"</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">NC_x</span><span class="o">=</span><span class="n">full</span><span class="o">.</span><span class="n">NC</span><span class="p">[</span><span class="n">full</span><span class="p">[</span><span class="s2">"NC"</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">n</span><span class="o">=</span><span class="n">full</span><span class="o">.</span><span class="n">NC</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"No. of cases for GC:"</span><span class="p">,</span><span class="n">GC_x</span><span class="p">,</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span>
      <span class="s2">"No. of cases for NC:"</span><span class="p">,</span><span class="n">NC_x</span><span class="p">,</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span>
      <span class="s2">"No. of total cases"</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>No. of cases for GC: 4 
 No. of cases for NC: 10 
 No. of total cases 23
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="6.4.2-Building-a-Sign-Test-">
<a class="anchor" href="#6.4.2-Building-a-Sign-Test-" aria-hidden="true"><span class="octicon octicon-link"></span></a>6.4.2 Building a Sign Test <a class="anchor" id="sign"></a><a class="anchor-link" href="#6.4.2-Building-a-Sign-Test-"> </a>
</h3>
<p>We can forget all about this part and just use an <a href="https://www.graphpad.com/quickcalcs/binomial2/">online sign test calculator</a>, but for me that is just no fun - so I will implement the calculations behind it. <br>
What we want to do after we count the amount of days in which the experiment group had a higher metric value than that of the control group, is to see if that number is likely to be seen again in a new experiment (significance). We assume the chance of a day like this is random (50% chance to happen) and then use the binomial distribution with $p=0.5$ and the number of experiments (days) to tell us the probability of this happening according to a random chance.<br>
So, according to the binomial distribution with $p=0.5$ and $n=$total number of days; we want to now the probability of $x$ days being a success (higher metric value in experiment). Because we are doing a two-tailed test we want to double this probability and once we have we can call it the $p-value$ and compare it to our $\alpha$. If the $p-value$ is greater than the $\alpha$ the result is not significant and vice-versa.<br></p>
<p></p>
<center><font size="4"> $p(successes )=\frac{n!}{x!(n-x)!}p^x(1-p)^{n-x}$ </font></center>
Recall that a $p-value$ is the probability of observing a test statistic as or more extreme than that observed. If we observed 2 days like that, the $p-value$ for the test is: $p-value = P(x &lt;= 2)$. We only need to remember the following:<br>
<p></p>
<center>$P(x&lt;=2)=P(0)+P(1)+P(2)$.</center>
<br>For more detailed information, visit <a href="http://sphweb.bumc.bu.edu/otlt/mph-modules/bs/bs704_nonparametric/BS704_Nonparametric5.html">this excellent page</a>.

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_prob</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="n">p</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">mt</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">mt</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">mt</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">x</span><span class="p">))</span><span class="o">*</span><span class="mf">0.5</span><span class="o">**</span><span class="n">x</span><span class="o">*</span><span class="mf">0.5</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">x</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span>
<span class="c1">#next a function to compute the pvalue from probabilities of maximum x</span>
<span class="k">def</span> <span class="nf">get_2side_pvalue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="n">p</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">+</span><span class="n">get_prob</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">p</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, to conduct the sign test itself: we will calculate the p-value for each metric, using the counts <code>GC_x</code>,<code>NC_x</code> and <code>n</code> and the function <code>get_2side_pvalue</code>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s2">"GC Change is significant if"</span><span class="p">,</span><span class="n">get_2side_pvalue</span><span class="p">(</span><span class="n">GC_x</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="s2">"is smaller than 0.05"</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">"NC Change is significant if"</span><span class="p">,</span><span class="n">get_2side_pvalue</span><span class="p">(</span><span class="n">NC_x</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="s2">"is smaller than 0.05"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>GC Change is significant if 0.0026000000000000003 is smaller than 0.05
NC Change is significant if 0.6774 is smaller than 0.05
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We get the same conclusions as we got from our effect size calculation: the change in Gross conversion was indeed significant, while the change in Net conversion was not.</p>
<h2 id="7-Conclusions-&amp;-Recommendations-">
<a class="anchor" href="#7-Conclusions-&amp;-Recommendations-" aria-hidden="true"><span class="octicon octicon-link"></span></a>7 Conclusions &amp; Recommendations <a class="anchor" id="conclusions"></a><a class="anchor-link" href="#7-Conclusions-&amp;-Recommendations-"> </a>
</h2>
<p>At this point, once we have seen that the actual underlying goal we had was not reached (increase fraction of paying users by asking them in advance if they have the time to invest in the course), we can only recommend to not continue with change. It may have caused a change in Gross conversion, but it didn't for net conversion.</p>
<p>A wonderful summary of this experiment, analysis and results, by the amazing Andrew Bauman, can be found <a href="https://github.com/baumanab/udacity_ABTesting#summary">here</a>.</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="recohut/notebook"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/abtest/2021/06/28/udacity-abtest-python.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Jupyter notebook database.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/recohut" target="_blank" title="recohut"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
