<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Offline Replayer Evaluation II - Recogym small | reconb</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Offline Replayer Evaluation II - Recogym small" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Running recogym for offline simulation and evaluation with small number of users and items" />
<meta property="og:description" content="Running recogym for offline simulation and evaluation with small number of users and items" />
<link rel="canonical" href="https://nb.recohut.com/bandit/2021/06/17/recostep-tutorial-offline-replayer-eval-recogym-small.html" />
<meta property="og:url" content="https://nb.recohut.com/bandit/2021/06/17/recostep-tutorial-offline-replayer-eval-recogym-small.html" />
<meta property="og:site_name" content="reconb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-17T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Offline Replayer Evaluation II - Recogym small" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-06-17T00:00:00-05:00","datePublished":"2021-06-17T00:00:00-05:00","description":"Running recogym for offline simulation and evaluation with small number of users and items","headline":"Offline Replayer Evaluation II - Recogym small","mainEntityOfPage":{"@type":"WebPage","@id":"https://nb.recohut.com/bandit/2021/06/17/recostep-tutorial-offline-replayer-eval-recogym-small.html"},"url":"https://nb.recohut.com/bandit/2021/06/17/recostep-tutorial-offline-replayer-eval-recogym-small.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nb.recohut.com/feed.xml" title="reconb" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">reconb</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Offline Replayer Evaluation II - Recogym small</h1><p class="page-description">Running recogym for offline simulation and evaluation with small number of users and items</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-06-17T00:00:00-05:00" itemprop="datePublished">
        Jun 17, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      14 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#bandit">bandit</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/recohut/notebook/tree/master/_notebooks/2021-06-17-recostep-tutorial-offline-replayer-eval-recogym-small.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/recohut/notebook/master?filepath=_notebooks%2F2021-06-17-recostep-tutorial-offline-replayer-eval-recogym-small.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/recohut/notebook/blob/master/_notebooks/2021-06-17-recostep-tutorial-offline-replayer-eval-recogym-small.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Frecohut%2Fnotebook%2Fblob%2Fmaster%2F_notebooks%2F2021-06-17-recostep-tutorial-offline-replayer-eval-recogym-small.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#Environment-setup">Environment setup </a></li>
<li class="toc-entry toc-h2"><a href="#Defining-evaluation-methods">Defining evaluation methods </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Traditional-evaluation">Traditional evaluation </a></li>
<li class="toc-entry toc-h3"><a href="#Counterfactual-evaluation">Counterfactual evaluation </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Creating-agents">Creating agents </a>
<ul>
<li class="toc-entry toc-h3"><a href="#SVD-agent">SVD agent </a></li>
<li class="toc-entry toc-h3"><a href="#Item-KNN-agent">Item-KNN agent </a></li>
<li class="toc-entry toc-h3"><a href="#User-KNN-agent">User-KNN agent </a></li>
<li class="toc-entry toc-h3"><a href="#Agent-initializations">Agent initializations </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Offline-evaluation">Offline evaluation </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Generating-test-logs">Generating test logs </a></li>
<li class="toc-entry toc-h3"><a href="#(Util)-helper-function-to-plot-barchart">(Util) helper function to plot barchart </a></li>
<li class="toc-entry toc-h3"><a href="#Leave-one-out-evaluation">Leave-one-out evaluation </a></li>
<li class="toc-entry toc-h3"><a href="#IPS-Estimators">IPS Estimators </a></li>
<li class="toc-entry toc-h3"><a href="#A/B-tests">A/B tests </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-06-17-recostep-tutorial-offline-replayer-eval-recogym-small.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Environment-setup">
<a class="anchor" href="#Environment-setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Environment setup<a class="anchor-link" href="#Environment-setup"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">recogym</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.random.mtrand</span> <span class="kn">import</span> <span class="n">RandomState</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">logsumexp</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.stats.distributions</span> <span class="kn">import</span> <span class="n">beta</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">csr_matrix</span>
<span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">svds</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">FormatStrFormatter</span>

<span class="kn">import</span> <span class="nn">gym</span><span class="o">,</span> <span class="nn">recogym</span>
<span class="kn">from</span> <span class="nn">recogym</span> <span class="kn">import</span> <span class="n">env_1_args</span><span class="p">,</span> <span class="n">Configuration</span>
<span class="kn">from</span> <span class="nn">recogym.agents</span> <span class="kn">import</span> <span class="n">OrganicUserEventCounterAgent</span><span class="p">,</span> <span class="n">organic_user_count_args</span>
<span class="kn">from</span> <span class="nn">recogym.agents.organic_count</span> <span class="kn">import</span> <span class="n">OrganicCount</span><span class="p">,</span> <span class="n">organic_count_args</span><span class="p">,</span> <span class="n">to_categorical</span>
<span class="kn">from</span> <span class="nn">recogym</span> <span class="kn">import</span> <span class="n">Configuration</span>
<span class="kn">from</span> <span class="nn">recogym.agents</span> <span class="kn">import</span> <span class="n">Agent</span>
<span class="kn">from</span> <span class="nn">recogym.envs.observation</span> <span class="kn">import</span> <span class="n">Observation</span>
<span class="kn">from</span> <span class="nn">recogym.agents</span> <span class="kn">import</span> <span class="n">RandomAgent</span><span class="p">,</span> <span class="n">random_args</span>
<span class="kn">from</span> <span class="nn">recogym</span> <span class="kn">import</span> <span class="n">verify_agents</span><span class="p">,</span> <span class="n">verify_agents_IPS</span>
<span class="kn">from</span> <span class="nn">recogym.evaluate_agent</span> <span class="kn">import</span> <span class="n">plot_verify_agents</span><span class="p">,</span> <span class="n">verify_agents_recall_at_k</span>

<span class="kn">from</span> <span class="nn">recogym.envs.session</span> <span class="kn">import</span> <span class="n">OrganicSessions</span>
<span class="kn">from</span> <span class="nn">recogym.envs.context</span> <span class="kn">import</span> <span class="n">DefaultContext</span>
<span class="kn">from</span> <span class="nn">recogym.envs.observation</span> <span class="kn">import</span> <span class="n">Observation</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">P</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># Number of Products</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># Number of Users</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">env_1_args</span><span class="p">[</span><span class="s1">'random_seed'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">env_1_args</span><span class="p">[</span><span class="s1">'num_products'</span><span class="p">]</span><span class="o">=</span> <span class="n">P</span>
<span class="n">env_1_args</span><span class="p">[</span><span class="s1">'phi_var'</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">env_1_args</span><span class="p">[</span><span class="s1">'number_of_flips'</span><span class="p">]</span><span class="o">=</span><span class="n">P</span><span class="o">//</span><span class="mi">2</span>
<span class="n">env_1_args</span><span class="p">[</span><span class="s1">'sigma_mu_organic'</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">env_1_args</span><span class="p">[</span><span class="s1">'sigma_omega'</span><span class="p">]</span><span class="o">=</span><span class="mf">0.05</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">'reco-gym-v1'</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">init_gym</span><span class="p">(</span><span class="n">env_1_args</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">reco_log</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">generate_logs</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
<span class="n">reco_log</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Organic Users: 0it [00:00, ?it/s]
Users: 100%|██████████| 50/50 [00:01&lt;00:00, 44.55it/s]
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>t</th>
      <th>u</th>
      <th>z</th>
      <th>v</th>
      <th>a</th>
      <th>c</th>
      <th>ps</th>
      <th>ps-a</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0</td>
      <td>organic</td>
      <td>6</td>
      <td>&lt;NA&gt;</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0</td>
      <td>organic</td>
      <td>6</td>
      <td>&lt;NA&gt;</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>0</td>
      <td>organic</td>
      <td>31</td>
      <td>&lt;NA&gt;</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.0</td>
      <td>0</td>
      <td>organic</td>
      <td>2</td>
      <td>&lt;NA&gt;</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.0</td>
      <td>0</td>
      <td>organic</td>
      <td>31</td>
      <td>&lt;NA&gt;</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5.0</td>
      <td>0</td>
      <td>organic</td>
      <td>32</td>
      <td>&lt;NA&gt;</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6.0</td>
      <td>0</td>
      <td>organic</td>
      <td>1</td>
      <td>&lt;NA&gt;</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7.0</td>
      <td>0</td>
      <td>bandit</td>
      <td>&lt;NA&gt;</td>
      <td>23</td>
      <td>0.0</td>
      <td>0.02</td>
      <td>()</td>
    </tr>
    <tr>
      <th>8</th>
      <td>8.0</td>
      <td>0</td>
      <td>bandit</td>
      <td>&lt;NA&gt;</td>
      <td>10</td>
      <td>0.0</td>
      <td>0.02</td>
      <td>()</td>
    </tr>
    <tr>
      <th>9</th>
      <td>9.0</td>
      <td>0</td>
      <td>bandit</td>
      <td>&lt;NA&gt;</td>
      <td>34</td>
      <td>0.0</td>
      <td>0.02</td>
      <td>()</td>
    </tr>
    <tr>
      <th>10</th>
      <td>10.0</td>
      <td>0</td>
      <td>bandit</td>
      <td>&lt;NA&gt;</td>
      <td>38</td>
      <td>0.0</td>
      <td>0.02</td>
      <td>()</td>
    </tr>
    <tr>
      <th>11</th>
      <td>11.0</td>
      <td>0</td>
      <td>bandit</td>
      <td>&lt;NA&gt;</td>
      <td>8</td>
      <td>0.0</td>
      <td>0.02</td>
      <td>()</td>
    </tr>
    <tr>
      <th>12</th>
      <td>12.0</td>
      <td>0</td>
      <td>bandit</td>
      <td>&lt;NA&gt;</td>
      <td>47</td>
      <td>0.0</td>
      <td>0.02</td>
      <td>()</td>
    </tr>
    <tr>
      <th>13</th>
      <td>13.0</td>
      <td>0</td>
      <td>bandit</td>
      <td>&lt;NA&gt;</td>
      <td>36</td>
      <td>0.0</td>
      <td>0.02</td>
      <td>()</td>
    </tr>
    <tr>
      <th>14</th>
      <td>14.0</td>
      <td>0</td>
      <td>bandit</td>
      <td>&lt;NA&gt;</td>
      <td>26</td>
      <td>0.0</td>
      <td>0.02</td>
      <td>()</td>
    </tr>
    <tr>
      <th>15</th>
      <td>15.0</td>
      <td>0</td>
      <td>bandit</td>
      <td>&lt;NA&gt;</td>
      <td>46</td>
      <td>0.0</td>
      <td>0.02</td>
      <td>()</td>
    </tr>
    <tr>
      <th>16</th>
      <td>16.0</td>
      <td>0</td>
      <td>bandit</td>
      <td>&lt;NA&gt;</td>
      <td>25</td>
      <td>0.0</td>
      <td>0.02</td>
      <td>()</td>
    </tr>
    <tr>
      <th>17</th>
      <td>17.0</td>
      <td>0</td>
      <td>bandit</td>
      <td>&lt;NA&gt;</td>
      <td>26</td>
      <td>0.0</td>
      <td>0.02</td>
      <td>()</td>
    </tr>
    <tr>
      <th>18</th>
      <td>18.0</td>
      <td>0</td>
      <td>bandit</td>
      <td>&lt;NA&gt;</td>
      <td>41</td>
      <td>0.0</td>
      <td>0.02</td>
      <td>()</td>
    </tr>
    <tr>
      <th>19</th>
      <td>19.0</td>
      <td>0</td>
      <td>bandit</td>
      <td>&lt;NA&gt;</td>
      <td>31</td>
      <td>0.0</td>
      <td>0.02</td>
      <td>()</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">n_events</span> <span class="o">=</span> <span class="n">reco_log</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">n_organic</span> <span class="o">=</span> <span class="n">reco_log</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reco_log</span><span class="p">[</span><span class="s1">'z'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'organic'</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Training on </span><span class="si">{0}</span><span class="s1"> organic and </span><span class="si">{1}</span><span class="s1"> bandit events'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_organic</span><span class="p">,</span> <span class="n">n_events</span> <span class="o">-</span> <span class="n">n_organic</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Training on 1117 organic and 3926 bandit events
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Defining-evaluation-methods">
<a class="anchor" href="#Defining-evaluation-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Defining evaluation methods<a class="anchor-link" href="#Defining-evaluation-methods"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Traditional-evaluation">
<a class="anchor" href="#Traditional-evaluation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Traditional evaluation<a class="anchor-link" href="#Traditional-evaluation"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">leave_one_out</span><span class="p">(</span><span class="n">reco_log</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">folds</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
    <span class="c1"># 1. Extract all organic events</span>
    <span class="n">reco_log</span> <span class="o">=</span> <span class="n">reco_log</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reco_log</span><span class="p">[</span><span class="s1">'z'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'organic'</span><span class="p">]</span>
    
    <span class="c1"># 2. For every user sequence - randomly sample out an item</span>
    <span class="n">hits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">folds</span><span class="p">):</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">history</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">OrganicSessions</span><span class="p">()</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reco_log</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
            <span class="c1"># If we have a new user</span>
            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">u</span> <span class="o">!=</span> <span class="n">user_id</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">last</span><span class="p">:</span>
                    <span class="c1"># Sample out last item</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">history</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Sample out a random item from the history</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">history</span><span class="p">),</span>
                                             <span class="n">replace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">test</span>  <span class="o">=</span> <span class="n">history</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">train</span> <span class="o">=</span> <span class="n">history</span><span class="p">[:</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="n">history</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>

                <span class="c1"># 3. Recreate the user sequence without these items - Let the agent observe the incomplete sequence</span>
                <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">train</span><span class="p">):</span>
                    <span class="n">session</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">DefaultContext</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">user_id</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

                <span class="c1"># 4. Generate a top-N set of recommendations by letting the agent act</span>
                <span class="c1"># TODO - For now only works for N = 1</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">prob_a</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">act</span><span class="p">(</span><span class="n">Observation</span><span class="p">(</span><span class="n">DefaultContext</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">user_id</span><span class="p">),</span> <span class="n">session</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)[</span><span class="s1">'ps-a'</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">prob_a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="n">P</span><span class="p">]</span> <span class="o">*</span> <span class="n">P</span>

                <span class="c1"># 5. Compute metrics checking whether the sampled test item is in the top-N</span>
                <span class="k">try</span><span class="p">:</span>
                  <span class="n">hits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prob_a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">except</span><span class="p">:</span>
                  <span class="n">hits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1"># Reset variables</span>
                <span class="n">user_id</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">u</span>
                <span class="n">history</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">session</span> <span class="o">=</span> <span class="n">OrganicSessions</span><span class="p">()</span>
                <span class="n">agent</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

            <span class="c1"># Save the organic interaction to the running average for the session</span>
            <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">row</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">row</span><span class="o">.</span><span class="n">v</span><span class="p">))</span>
    
    <span class="c1"># Error analysis</span>
    <span class="n">mean_hits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span>
    <span class="n">serr_hits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hits</span><span class="p">))</span>
    <span class="n">low_bound</span> <span class="o">=</span> <span class="n">mean_hits</span> <span class="o">-</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">serr_hits</span>
    <span class="n">upp_bound</span> <span class="o">=</span> <span class="n">mean_hits</span> <span class="o">+</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">serr_hits</span>
    
    <span class="k">return</span> <span class="n">mean_hits</span><span class="p">,</span> <span class="n">low_bound</span><span class="p">,</span> <span class="n">upp_bound</span>

<span class="k">def</span> <span class="nf">verify_agents_traditional</span><span class="p">(</span><span class="n">reco_log</span><span class="p">,</span> <span class="n">agents</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">folds</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
    <span class="c1"># Placeholder DataFrame for result</span>
    <span class="n">stat</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'Agent'</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">'0.025'</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">'0.500'</span> <span class="p">:</span> <span class="p">[],</span>
        <span class="s1">'0.975'</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>

    <span class="c1"># For every agent</span>
    <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">agents</span><span class="p">:</span>
        <span class="c1"># Compute HR@k</span>
        <span class="n">mean</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">upp</span> <span class="o">=</span> <span class="n">leave_one_out</span><span class="p">(</span><span class="n">reco_log</span><span class="p">,</span> <span class="n">agents</span><span class="p">[</span><span class="n">agent_id</span><span class="p">],</span> <span class="n">last</span> <span class="o">=</span> <span class="n">last</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span> <span class="n">folds</span> <span class="o">=</span> <span class="n">folds</span><span class="p">)</span>
        <span class="n">stat</span><span class="p">[</span><span class="s1">'Agent'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">stat</span><span class="p">[</span><span class="s1">'0.025'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">low</span><span class="p">)</span>
        <span class="n">stat</span><span class="p">[</span><span class="s1">'0.500'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span>
        <span class="n">stat</span><span class="p">[</span><span class="s1">'0.975'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">upp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Counterfactual-evaluation">
<a class="anchor" href="#Counterfactual-evaluation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Counterfactual evaluation<a class="anchor-link" href="#Counterfactual-evaluation"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">compute_ips_weights</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">reco_log</span><span class="p">):</span>
    <span class="c1"># Placeholder for return values</span>
    <span class="n">rewards</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Labels for actions</span>
    <span class="n">t_props</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Treatment propensities</span>
    <span class="n">l_props</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Logging propensities</span>
    
    <span class="c1"># For every logged interaction</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">OrganicSessions</span><span class="p">()</span>
    <span class="n">agent</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reco_log</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
        <span class="c1"># If we have a new user</span>
        <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">u</span> <span class="o">!=</span> <span class="n">user_id</span><span class="p">:</span>
            <span class="c1"># Reset</span>
            <span class="n">session</span> <span class="o">=</span> <span class="n">OrganicSessions</span><span class="p">()</span>
            <span class="n">agent</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="n">user_id</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">u</span>
        
        <span class="c1"># If we have an organic event</span>
        <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">z</span> <span class="o">==</span> <span class="s1">'organic'</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">DefaultContext</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">u</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">v</span><span class="p">))</span>        
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prob_a</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">act</span><span class="p">(</span><span class="n">Observation</span><span class="p">(</span><span class="n">DefaultContext</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">u</span><span class="p">),</span> <span class="n">session</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)[</span><span class="s1">'ps-a'</span><span class="p">]</span>
            <span class="n">rewards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
              <span class="n">t_props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prob_a</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">a</span><span class="p">)])</span>
            <span class="k">except</span><span class="p">:</span>
              <span class="n">t_props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">l_props</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">ps</span><span class="p">)</span>
            <span class="n">session</span> <span class="o">=</span> <span class="n">OrganicSessions</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rewards</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">t_props</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">l_props</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">verify_agents_counterfactual</span><span class="p">(</span><span class="n">reco_log</span><span class="p">,</span> <span class="n">agents</span><span class="p">,</span> <span class="n">cap</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
    <span class="c1"># Placeholder DataFrame for results</span>
    <span class="n">IPS_stat</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'Agent'</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">'0.025'</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">'0.500'</span> <span class="p">:</span> <span class="p">[],</span>
        <span class="s1">'0.975'</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>
    <span class="n">CIPS_stat</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'Agent'</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">'0.025'</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">'0.500'</span> <span class="p">:</span> <span class="p">[],</span>
        <span class="s1">'0.975'</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>
    <span class="n">SNIPS_stat</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'Agent'</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">'0.025'</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">'0.500'</span> <span class="p">:</span> <span class="p">[],</span>
        <span class="s1">'0.975'</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>

    <span class="c1"># For every agent</span>
    <span class="k">for</span> <span class="n">agent_id</span> <span class="ow">in</span> <span class="n">agents</span><span class="p">:</span>
        <span class="c1"># Get the rewards and propensities</span>
        <span class="n">rewards</span><span class="p">,</span> <span class="n">t_props</span><span class="p">,</span> <span class="n">l_props</span> <span class="o">=</span> <span class="n">compute_ips_weights</span><span class="p">(</span><span class="n">agents</span><span class="p">[</span><span class="n">agent_id</span><span class="p">],</span> <span class="n">reco_log</span><span class="p">)</span>
        
        <span class="c1"># Compute the sample weights - propensity ratios</span>
        <span class="n">p_ratio</span> <span class="o">=</span> <span class="n">t_props</span> <span class="o">/</span> <span class="n">l_props</span>

        <span class="c1"># Effective sample size for E_t estimate (from A. Owen)</span>
        <span class="n">n_e</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rewards</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p_ratio</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_ratio</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">n_e</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">n_e</span><span class="p">)</span> <span class="k">else</span> <span class="n">n_e</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Effective sample size for agent </span><span class="si">{}</span><span class="s2"> is </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">agent_id</span><span class="p">),</span> <span class="n">n_e</span><span class="p">))</span>
        
        <span class="c1"># Critical value from t-distribution as we have unknown variance</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="o">.</span><span class="mi">00125</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_e</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="c1">###############</span>
        <span class="c1"># VANILLA IPS #</span>
        <span class="c1">###############</span>
        <span class="c1"># Expected reward for pi_t</span>
        <span class="n">E_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rewards</span> <span class="o">*</span> <span class="n">p_ratio</span><span class="p">)</span>

        <span class="c1"># Variance of the estimate</span>
        <span class="n">var</span> <span class="o">=</span> <span class="p">((</span><span class="n">rewards</span> <span class="o">*</span> <span class="n">p_ratio</span> <span class="o">-</span> <span class="n">E_t</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">stddev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        
        <span class="c1"># C.I. assuming unknown variance - use t-distribution and effective sample size</span>
        <span class="n">min_bound</span> <span class="o">=</span> <span class="n">E_t</span> <span class="o">-</span> <span class="n">cv</span> <span class="o">*</span> <span class="n">stddev</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_e</span><span class="p">))</span>
        <span class="n">max_bound</span> <span class="o">=</span> <span class="n">E_t</span> <span class="o">+</span> <span class="n">cv</span> <span class="o">*</span> <span class="n">stddev</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_e</span><span class="p">))</span>
        
        <span class="c1"># Store result</span>
        <span class="n">IPS_stat</span><span class="p">[</span><span class="s1">'Agent'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">IPS_stat</span><span class="p">[</span><span class="s1">'0.025'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_bound</span><span class="p">)</span>
        <span class="n">IPS_stat</span><span class="p">[</span><span class="s1">'0.500'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_t</span><span class="p">)</span>
        <span class="n">IPS_stat</span><span class="p">[</span><span class="s1">'0.975'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_bound</span><span class="p">)</span>
        
        <span class="c1">############## </span>
        <span class="c1"># CAPPED IPS #</span>
        <span class="c1">##############</span>
        <span class="c1"># Cap ratios</span>
        <span class="n">p_ratio_capped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">p_ratio</span><span class="p">,</span> <span class="n">a_min</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">a_max</span> <span class="o">=</span> <span class="n">cap</span><span class="p">)</span>
        
        <span class="c1"># Expected reward for pi_t</span>
        <span class="n">E_t_capped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rewards</span> <span class="o">*</span> <span class="n">p_ratio_capped</span><span class="p">)</span>

        <span class="c1"># Variance of the estimate</span>
        <span class="n">var_capped</span> <span class="o">=</span> <span class="p">((</span><span class="n">rewards</span> <span class="o">*</span> <span class="n">p_ratio_capped</span> <span class="o">-</span> <span class="n">E_t_capped</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">stddev_capped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_capped</span><span class="p">)</span>        
        
        <span class="c1"># C.I. assuming unknown variance - use t-distribution and effective sample size</span>
        <span class="n">min_bound_capped</span> <span class="o">=</span> <span class="n">E_t_capped</span> <span class="o">-</span> <span class="n">cv</span> <span class="o">*</span> <span class="n">stddev_capped</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_e</span><span class="p">))</span>
        <span class="n">max_bound_capped</span> <span class="o">=</span> <span class="n">E_t_capped</span> <span class="o">+</span> <span class="n">cv</span> <span class="o">*</span> <span class="n">stddev_capped</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_e</span><span class="p">))</span>
        
        <span class="c1"># Store result</span>
        <span class="n">CIPS_stat</span><span class="p">[</span><span class="s1">'Agent'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">CIPS_stat</span><span class="p">[</span><span class="s1">'0.025'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_bound_capped</span><span class="p">)</span>
        <span class="n">CIPS_stat</span><span class="p">[</span><span class="s1">'0.500'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_t_capped</span><span class="p">)</span>
        <span class="n">CIPS_stat</span><span class="p">[</span><span class="s1">'0.975'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_bound_capped</span><span class="p">)</span>
        
        <span class="c1">##############</span>
        <span class="c1"># NORMED IPS #</span>
        <span class="c1">##############</span>
        <span class="c1"># Expected reward for pi_t</span>
        <span class="n">E_t_normed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rewards</span> <span class="o">*</span> <span class="n">p_ratio</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p_ratio</span><span class="p">)</span>

        <span class="c1"># Variance of the estimate</span>
        <span class="n">var_normed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">rewards</span> <span class="o">-</span> <span class="n">E_t_normed</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">p_ratio</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">p_ratio</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>    
        <span class="n">stddev_normed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_normed</span><span class="p">)</span>

        <span class="c1"># C.I. assuming unknown variance - use t-distribution and effective sample size</span>
        <span class="n">min_bound_normed</span> <span class="o">=</span> <span class="n">E_t_normed</span> <span class="o">-</span> <span class="n">cv</span> <span class="o">*</span> <span class="n">stddev_normed</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_e</span><span class="p">))</span>
        <span class="n">max_bound_normed</span> <span class="o">=</span> <span class="n">E_t_normed</span> <span class="o">+</span> <span class="n">cv</span> <span class="o">*</span> <span class="n">stddev_normed</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n_e</span><span class="p">))</span>

        <span class="c1"># Store result</span>
        <span class="n">SNIPS_stat</span><span class="p">[</span><span class="s1">'Agent'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">agent_id</span><span class="p">)</span>
        <span class="n">SNIPS_stat</span><span class="p">[</span><span class="s1">'0.025'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_bound_normed</span><span class="p">)</span>
        <span class="n">SNIPS_stat</span><span class="p">[</span><span class="s1">'0.500'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_t_normed</span><span class="p">)</span>
        <span class="n">SNIPS_stat</span><span class="p">[</span><span class="s1">'0.975'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_bound_normed</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">IPS_stat</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">CIPS_stat</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">SNIPS_stat</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Creating-agents">
<a class="anchor" href="#Creating-agents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating agents<a class="anchor-link" href="#Creating-agents"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="SVD-agent">
<a class="anchor" href="#SVD-agent" aria-hidden="true"><span class="octicon octicon-link"></span></a>SVD agent<a class="anchor-link" href="#SVD-agent"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">SVDAgent</span><span class="p">(</span><span class="n">Agent</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="n">U</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">,</span> <span class="n">K</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SVDAgent</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">RandomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">P</span> <span class="o">&gt;=</span> <span class="n">K</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">K</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">((</span><span class="n">U</span><span class="p">,</span><span class="n">P</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">P</span><span class="p">,</span><span class="n">K</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_history</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reco_log</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="n">U</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">):</span>
        <span class="c1"># Extract all organic user logs</span>
        <span class="n">reco_log</span> <span class="o">=</span> <span class="n">reco_log</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reco_log</span><span class="p">[</span><span class="s1">'z'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'organic'</span><span class="p">]</span>
        
        <span class="c1"># Generate ratings matrix for training, row-based for efficient row (user) retrieval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reco_log</span><span class="p">)),</span>
                            <span class="p">(</span><span class="n">reco_log</span><span class="p">[</span><span class="s1">'u'</span><span class="p">],</span><span class="n">reco_log</span><span class="p">[</span><span class="s1">'v'</span><span class="p">])),</span>
                            <span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">P</span><span class="p">))</span>

        <span class="c1"># Singular Value Decomposition</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">svds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">observation</span><span class="o">.</span><span class="n">sessions</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_history</span><span class="p">[</span><span class="n">session</span><span class="p">[</span><span class="s1">'v'</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">act</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">):</span>
        <span class="sd">"""Act method returns an Action based on current observation and past history"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">observation</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_history</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
        <span class="n">prob</span><span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="o">**</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">act</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">),</span>
            <span class="o">**</span><span class="p">{</span>
                <span class="s1">'a'</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span>
                <span class="s1">'ps'</span><span class="p">:</span> <span class="n">prob</span><span class="p">[</span><span class="n">action</span><span class="p">],</span>
                <span class="s1">'ps-a'</span><span class="p">:</span> <span class="n">prob</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_history</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Item-KNN-agent">
<a class="anchor" href="#Item-KNN-agent" aria-hidden="true"><span class="octicon octicon-link"></span></a>Item-KNN agent<a class="anchor-link" href="#Item-KNN-agent"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">itemkNNAgent</span><span class="p">(</span><span class="n">Agent</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="n">U</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">greedy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">itemkNNAgent</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">RandomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">greedy</span> <span class="o">=</span> <span class="n">greedy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rt</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">((</span><span class="n">P</span><span class="p">,</span><span class="n">U</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_history</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reco_log</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="n">U</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">):</span>
        <span class="c1"># Extract all organic user logs</span>
        <span class="n">reco_log</span> <span class="o">=</span> <span class="n">reco_log</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reco_log</span><span class="p">[</span><span class="s1">'z'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'organic'</span><span class="p">]</span>
        
        <span class="c1"># Generate ratings matrix for training, row-based for efficient row (user) retrieval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R_t</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reco_log</span><span class="p">)),</span>
                              <span class="p">(</span><span class="n">reco_log</span><span class="p">[</span><span class="s1">'v'</span><span class="p">],</span><span class="n">reco_log</span><span class="p">[</span><span class="s1">'u'</span><span class="p">])),</span>
                              <span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">U</span><span class="p">))</span>

        <span class="c1"># Set up nearest neighbours module</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span>
                              <span class="n">metric</span> <span class="o">=</span> <span class="s1">'cosine'</span><span class="p">)</span>

        <span class="c1"># Initialise placeholder for distances and indices</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">indices</span>   <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Dirty fix for multiprocessing backend being unable to pickle large objects</span>
        <span class="n">nn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R_t</span><span class="p">)</span>
        <span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R_t</span><span class="p">,</span> <span class="n">return_distance</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Precompute similarity matrix S</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">distances</span><span class="p">))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">([</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">P</span><span class="p">)))</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">indices</span><span class="p">))</span>
        
        <span class="c1"># (P,P)-matrix with cosine similarities between items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">((</span><span class="n">data</span><span class="p">,(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)),</span> <span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">P</span><span class="p">))</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">observation</span><span class="o">.</span><span class="n">sessions</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_history</span><span class="p">[</span><span class="n">session</span><span class="p">[</span><span class="s1">'v'</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">act</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">):</span>
        <span class="sd">"""Act method returns an Action based on current observation and past history"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">observation</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_history</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">)</span><span class="o">.</span><span class="n">A1</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">greedy</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="n">prob</span><span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scores</span> <span class="o">**=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
            <span class="n">prob</span> <span class="o">=</span> <span class="n">scores</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span> <span class="o">=</span> <span class="n">prob</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="o">**</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">act</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">),</span>
            <span class="o">**</span><span class="p">{</span>
                <span class="s1">'a'</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span>
                <span class="s1">'ps'</span><span class="p">:</span> <span class="n">prob</span><span class="p">[</span><span class="n">action</span><span class="p">],</span>
                <span class="s1">'ps-a'</span><span class="p">:</span> <span class="n">prob</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_history</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="User-KNN-agent">
<a class="anchor" href="#User-KNN-agent" aria-hidden="true"><span class="octicon octicon-link"></span></a>User-KNN agent<a class="anchor-link" href="#User-KNN-agent"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">class</span> <span class="nc">userkNNAgent</span><span class="p">(</span><span class="n">Agent</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="n">U</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">greedy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">userkNNAgent</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">RandomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">greedy</span> <span class="o">=</span> <span class="n">greedy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U</span> <span class="o">=</span> <span class="n">U</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">((</span><span class="n">U</span><span class="p">,</span><span class="n">P</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_history</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nn</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">'cosine'</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reco_log</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="n">U</span><span class="p">,</span> <span class="n">P</span> <span class="o">=</span> <span class="n">P</span><span class="p">):</span>
        <span class="c1"># Extract all organic user logs</span>
        <span class="n">reco_log</span> <span class="o">=</span> <span class="n">reco_log</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">reco_log</span><span class="p">[</span><span class="s1">'z'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'organic'</span><span class="p">]</span>
        
        <span class="c1"># Generate ratings matrix for training, row-based for efficient row (user) retrieval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">csr_matrix</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reco_log</span><span class="p">)),</span>
                            <span class="p">(</span><span class="n">reco_log</span><span class="p">[</span><span class="s1">'u'</span><span class="p">],</span><span class="n">reco_log</span><span class="p">[</span><span class="s1">'v'</span><span class="p">])),</span>
                            <span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">P</span><span class="p">))</span>

        <span class="c1"># Fit nearest neighbours</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">observation</span><span class="o">.</span><span class="n">sessions</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_history</span><span class="p">[</span><span class="n">session</span><span class="p">[</span><span class="s1">'v'</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">act</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">):</span>
        <span class="sd">"""Act method returns an Action based on current observation and past history"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">observation</span><span class="p">)</span>
        
        <span class="c1"># Get neighbouring users based on user history</span>
        <span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_history</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">reduce</span><span class="p">([</span><span class="n">dist</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">idx</span><span class="p">,:]</span> <span class="k">for</span> <span class="n">dist</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span><span class="n">indices</span><span class="p">)])</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">greedy</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="n">prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="n">prob</span><span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scores</span> <span class="o">**=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span>
            <span class="n">prob</span> <span class="o">=</span> <span class="n">scores</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">prob</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="o">**</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">act</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">),</span>
            <span class="o">**</span><span class="p">{</span>
                <span class="s1">'a'</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span>
                <span class="s1">'ps'</span><span class="p">:</span> <span class="n">prob</span><span class="p">[</span><span class="n">action</span><span class="p">],</span>
                <span class="s1">'ps-a'</span><span class="p">:</span> <span class="n">prob</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_history</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Agent-initializations">
<a class="anchor" href="#Agent-initializations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Agent initializations<a class="anchor-link" href="#Agent-initializations"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">SVD_agent</span> <span class="o">=</span> <span class="n">SVDAgent</span><span class="p">(</span><span class="n">Configuration</span><span class="p">(</span><span class="n">env_1_args</span><span class="p">),</span> <span class="n">U</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="c1"># item-kNN Agent</span>
<span class="n">itemkNN_agent</span> <span class="o">=</span> <span class="n">itemkNNAgent</span><span class="p">(</span><span class="n">Configuration</span><span class="p">(</span><span class="n">env_1_args</span><span class="p">),</span> <span class="n">U</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="n">greedy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># user-kNN Agent</span>
<span class="n">userkNN_agent</span> <span class="o">=</span> <span class="n">userkNNAgent</span><span class="p">(</span><span class="n">Configuration</span><span class="p">(</span><span class="n">env_1_args</span><span class="p">),</span> <span class="n">U</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">greedy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Generalised Popularity agent</span>
<span class="n">GPOP_agent</span> <span class="o">=</span> <span class="n">OrganicCount</span><span class="p">(</span><span class="n">Configuration</span><span class="p">({</span>
    <span class="o">**</span><span class="n">env_1_args</span><span class="p">,</span>
    <span class="s1">'select_randomly'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}))</span>

<span class="c1"># Generalised Popularity agent</span>
<span class="n">GPOP_agent_greedy</span> <span class="o">=</span> <span class="n">OrganicCount</span><span class="p">(</span><span class="n">Configuration</span><span class="p">({</span>
    <span class="o">**</span><span class="n">env_1_args</span><span class="p">,</span>
    <span class="s1">'select_randomly'</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}))</span>

<span class="c1"># Peronalised Popularity agent</span>
<span class="n">PPOP_agent</span> <span class="o">=</span> <span class="n">OrganicUserEventCounterAgent</span><span class="p">(</span><span class="n">Configuration</span><span class="p">({</span>
    <span class="o">**</span><span class="n">organic_user_count_args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">env_1_args</span><span class="p">,</span>
    <span class="s1">'select_randomly'</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}))</span>

<span class="c1"># Peronalised Popularity agent</span>
<span class="n">PPOP_agent_greedy</span> <span class="o">=</span> <span class="n">OrganicUserEventCounterAgent</span><span class="p">(</span><span class="n">Configuration</span><span class="p">({</span>
    <span class="o">**</span><span class="n">organic_user_count_args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">env_1_args</span><span class="p">,</span>
    <span class="s1">'select_randomly'</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}))</span>

<span class="c1"># Random Agent</span>
<span class="n">random_args</span><span class="p">[</span><span class="s1">'num_products'</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span>
<span class="n">RAND_agent</span> <span class="o">=</span> <span class="n">RandomAgent</span><span class="p">(</span><span class="n">Configuration</span><span class="p">({</span><span class="o">**</span><span class="n">env_1_args</span><span class="p">,</span> <span class="o">**</span><span class="n">random_args</span><span class="p">,}))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">SVD_agent</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">reco_log</span><span class="p">)</span>
<span class="n">itemkNN_agent</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">reco_log</span><span class="p">)</span>
<span class="n">userkNN_agent</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">reco_log</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Offline-evaluation">
<a class="anchor" href="#Offline-evaluation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Offline evaluation<a class="anchor-link" href="#Offline-evaluation"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Generating-test-logs">
<a class="anchor" href="#Generating-test-logs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Generating test logs<a class="anchor-link" href="#Generating-test-logs"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="c1"># Placeholder for agents</span>
<span class="n">agents</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'    Random'</span><span class="p">:</span> <span class="n">RAND_agent</span><span class="p">,</span>
    <span class="s1">'   Popular'</span><span class="p">:</span> <span class="n">GPOP_agent_greedy</span><span class="p">,</span>
    <span class="s1">'   User-pop'</span><span class="p">:</span> <span class="n">PPOP_agent</span><span class="p">,</span>
    <span class="s1">'  SVD'</span><span class="p">:</span>  <span class="n">SVD_agent</span><span class="p">,</span>
    <span class="s1">' User-kNN'</span><span class="p">:</span> <span class="n">userkNN_agent</span><span class="p">,</span>
    <span class="s1">'Item-kNN'</span><span class="p">:</span> <span class="n">itemkNN_agent</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">agent_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">agents</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="c1">#['SVD','GPOP','PPOP','RAND']</span>
<span class="c1"># Generate new logs, to be used for offline testing</span>
<span class="n">n_test_users</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># U</span>
<span class="n">test_log</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">generate_logs</span><span class="p">(</span><span class="n">n_test_users</span><span class="p">)</span>
<span class="n">n_events</span> <span class="o">=</span> <span class="n">test_log</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">n_organic</span> <span class="o">=</span> <span class="n">test_log</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">test_log</span><span class="p">[</span><span class="s1">'z'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'organic'</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Testing on </span><span class="si">{0}</span><span class="s1"> organic and </span><span class="si">{1}</span><span class="s1"> bandit events'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_organic</span><span class="p">,</span> <span class="n">n_events</span> <span class="o">-</span> <span class="n">n_organic</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Organic Users: 0it [00:00, ?it/s]
Users: 100%|██████████| 50/50 [00:01&lt;00:00, 39.77it/s]</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Testing on 1033 organic and 4264 bandit events
CPU times: user 1.29 s, sys: 75.4 ms, total: 1.36 s
Wall time: 1.3 s
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="(Util)-helper-function-to-plot-barchart">
<a class="anchor" href="#(Util)-helper-function-to-plot-barchart" aria-hidden="true"><span class="octicon octicon-link"></span></a>(Util) helper function to plot barchart<a class="anchor-link" href="#(Util)-helper-function-to-plot-barchart"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">plot_barchart</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span>  <span class="n">col</span> <span class="o">=</span> <span class="s1">'tab:red'</span><span class="p">,</span> <span class="n">figname</span> <span class="o">=</span> <span class="s1">'fig.eps'</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>
    <span class="n">n_agents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="n">yticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_agents</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">'0.500'</span><span class="p">]</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">'0.500'</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s1">'0.025'</span><span class="p">]</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">'0.975'</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s1">'0.500'</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">yticks</span><span class="p">,</span>
             <span class="n">mean</span><span class="p">,</span>
             <span class="n">height</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span><span class="p">,</span>
             <span class="n">xerr</span>  <span class="o">=</span> <span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">),</span>
             <span class="n">align</span> <span class="o">=</span> <span class="s1">'center'</span><span class="p">,</span>
             <span class="n">color</span> <span class="o">=</span> <span class="n">col</span><span class="p">,)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">'Agent'</span><span class="p">],</span> <span class="n">size</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">'</span><span class="si">%.2f</span><span class="s1">'</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">'tight'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Leave-one-out-evaluation">
<a class="anchor" href="#Leave-one-out-evaluation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Leave-one-out evaluation<a class="anchor-link" href="#Leave-one-out-evaluation"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="n">result_LOO</span> <span class="o">=</span> <span class="n">verify_agents_traditional</span><span class="p">(</span><span class="n">test_log</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">agents</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">result_LOO</span><span class="p">)</span>
<span class="n">plot_barchart</span><span class="p">(</span><span class="n">result_LOO</span><span class="p">,</span> <span class="s1">'Evaluate on Organic Feedback'</span><span class="p">,</span> <span class="s1">'HR@1'</span><span class="p">,</span> <span class="s1">'tab:red'</span><span class="p">,</span> <span class="s1">'traditional_eval.eps'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/usr/local/lib/python3.7/dist-packages/recogym/agents/organic_user_count.py:51: RuntimeWarning: invalid value encountered in true_divide
  action_proba = features / np.sum(features)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Agent</th>
      <th>0.025</th>
      <th>0.500</th>
      <th>0.975</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Random</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Popular</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>User-pop</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SVD</td>
      <td>0.273181</td>
      <td>0.314286</td>
      <td>0.355390</td>
    </tr>
    <tr>
      <th>4</th>
      <td>User-kNN</td>
      <td>0.080663</td>
      <td>0.108163</td>
      <td>0.135664</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Item-kNN</td>
      <td>0.261387</td>
      <td>0.302041</td>
      <td>0.342695</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 1.5 s, sys: 61.4 ms, total: 1.56 s
Wall time: 1.53 s
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="IPS-Estimators">
<a class="anchor" href="#IPS-Estimators" aria-hidden="true"><span class="octicon octicon-link"></span></a>IPS Estimators<a class="anchor-link" href="#IPS-Estimators"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">test_log_ppop</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">generate_logs</span><span class="p">(</span><span class="n">n_test_users</span><span class="p">,</span> <span class="n">agent</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">PPOP_agent</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Organic Users: 0it [00:00, ?it/s]
Users: 100%|██████████| 50/50 [00:01&lt;00:00, 27.14it/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">test_log_ppop</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>t</th>
      <th>u</th>
      <th>z</th>
      <th>v</th>
      <th>a</th>
      <th>c</th>
      <th>ps</th>
      <th>ps-a</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0</td>
      <td>organic</td>
      <td>7</td>
      <td>&lt;NA&gt;</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0</td>
      <td>organic</td>
      <td>9</td>
      <td>&lt;NA&gt;</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>0</td>
      <td>organic</td>
      <td>7</td>
      <td>&lt;NA&gt;</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.0</td>
      <td>0</td>
      <td>organic</td>
      <td>20</td>
      <td>&lt;NA&gt;</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.0</td>
      <td>0</td>
      <td>bandit</td>
      <td>&lt;NA&gt;</td>
      <td>20</td>
      <td>0.0</td>
      <td>0.25</td>
      <td>()</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="n">cap</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">result_IPS</span><span class="p">,</span> <span class="n">result_CIPS</span><span class="p">,</span> <span class="n">result_SNIPS</span> <span class="o">=</span> <span class="n">verify_agents_counterfactual</span><span class="p">(</span><span class="n">test_log_ppop</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">agents</span><span class="p">),</span> <span class="n">cap</span> <span class="o">=</span> <span class="n">cap</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">result_IPS</span><span class="p">)</span>
<span class="n">plot_barchart</span><span class="p">(</span><span class="n">result_IPS</span><span class="p">,</span> <span class="s1">'IPS'</span><span class="p">,</span> <span class="s1">'CTR'</span><span class="p">,</span> <span class="s1">'tab:blue'</span><span class="p">,</span> <span class="s1">'bandit_eval_noclip.eps'</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">result_CIPS</span><span class="p">)</span>
<span class="n">plot_barchart</span><span class="p">(</span><span class="n">result_CIPS</span><span class="p">,</span> <span class="s1">'Clipped IPS'</span><span class="p">,</span> <span class="s1">'CTR'</span><span class="p">,</span> <span class="s1">'tab:blue'</span><span class="p">,</span> <span class="s1">'bandit_eval_clip</span><span class="si">{0}</span><span class="s1">.eps'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cap</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:65: RuntimeWarning: invalid value encountered in double_scalars
/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:120: RuntimeWarning: invalid value encountered in double_scalars
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Effective sample size for agent     Random is 0
Effective sample size for agent    Popular is 0
Effective sample size for agent    User-pop is 0
Effective sample size for agent   SVD is 1120.7440758663975
Effective sample size for agent  User-kNN is 298.0127276763118
Effective sample size for agent Item-kNN is 889.7428242947079
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Agent</th>
      <th>0.025</th>
      <th>0.500</th>
      <th>0.975</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Random</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Popular</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>User-pop</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SVD</td>
      <td>-0.010231</td>
      <td>0.014218</td>
      <td>0.038666</td>
    </tr>
    <tr>
      <th>4</th>
      <td>User-kNN</td>
      <td>-0.024978</td>
      <td>0.005388</td>
      <td>0.035754</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Item-kNN</td>
      <td>-0.011787</td>
      <td>0.011767</td>
      <td>0.035322</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaUAAACwCAYAAACvvnEyAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4yLjIsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+WH4yJAAAWNUlEQVR4nO3deZRcZZ3G8e8DJGEJJECiTIIQkWVYRHDCIsIQD6hsHkGFQTAQJKyDO0hUloAGIwoiIqNhlS0sR0AcYBBkgoKAkwgGwqIsgUAIZIFsLNl+88f7Nt5UqjrdqequW83zOadOqu773nt/1Un61/fW7fsoIjAzMyuD1ZpdgJmZWRs3JTMzKw03JTMzKw03JTMzKw03JTMzKw03JTMzKw03JTMzKw03JbMWJWmqpL0ljZC0VNICSfMkPSrpgMK870p6Po+/JOmGZtZt1h43JbOe4cGI6Av0By4DbpS0vqQjgeHA3nl8KPCHJtZp1i43JbMeJCKWAZcDawEfAnYC7oqIZ/P4jIgY18QSzdq1RrMLMLPGkbQGMBJYAPwDeAi4UNLLwP8Cj0TE0iaWaNYuHymZ9Qy7SnoDmAF8ETgoIuZGxDXAV4BPA/cBr0k6tYl1mrXLR0pmPcNDEbF7tYGIuBa4VlIv4MD8/NGIuKtbKzTrAB8pmb1HRMTiiLgJmAxs1+x6zKrxkZJZDyZpBDAT+COwkHQab1vg4SaWZVaTm5JZzzYP+C5wDbA68AJwQkTc39SqzGqQQ/7MzKws/JmSmZmVhpuSmZmVhpuSmZmVhpuSmZmVhpuSmZmVhi8Jr8OAAQNiyJAhzS7DzKylTJo0aVZEDKw25qZUhyFDhjBx4sRml2Fm1lIkvVBrrKVP30kaIinynZHNzKzFNaQpVSRgluI3xQsN646K5ddIGp2fD8tzLq6Yc3++PYuZmXWjlj5S6qBdJO3WzvhCYLikId1TjpmZ1dLI015bAz8GeklaACyJiP6S+gBjgEOAPsAtwDci4i1Jw0j35LoQOBlYCpwALAIuAAYAP4mIczpSgKTPA+cBB5BCzgDOzfv/RI3V3sg1nQkc1Zk3/NjLcxky6vbOrGINMnXs/s0uwcy6QCOb0pPA8cDIilyXsaRY5h2AxcB1wBnAd/L4RsCawGBgBHAJcDfwb8AmwERJ4yPi+fZ2Luko4HvA3hHxTOHI52Lgq5L2joh7aqw+Bvi7pLER8XRH3/Di2S8x47pRHZ1uDTTsoR83uwSzbjNhwoRml9BtuvT0nSQBx5KOjOZExHzgHODQwrTFwJiIWAxcTzo6+llEzI+IKcATwEdWsquvA6cAwyLimYqxt0hN5we1Vo6IGcAvgbM78J6OlTRR0sRY5lRpM7NG6uqr1gYCawOTUn8CQKRb6LeZHRFt393fyn++Whh/C+gLkE8Lttmm8PwU4OyIeKlGHZcCp0j6TDu1/gh4VlK7DTAixgHjAPr8yxax0WFj25tuXWSCT9+Z9UiNbkqVORizSE1l24h4ue6NR/Qtvi6covsU8D+SZkTEb6qst0jSWcD3gSk1tj1b0gV5jpmZNUGjm9KrwMaSekfEoohYJukS4KeSToqI1yQNBraLiLsauN8pwD7AXZIWR8RtVeZcDYzK8/5RYzvnA8+RjuZW6sOD+zHRP7GbmTVMoz9TupfUIGZImpWXnQo8AzwkaR5wD7BVg/dLRPyNdNXdJZL2rTK+lHSBxQbtbGMe6Wq9mnPMzKzrOHm2DkOHDg3fZsjMrHMkTYqIodXG3gu/PGtmZi3CTcnMzErDTcnMzErDTcnMzErDTcnMzErDTcnMzErDTcnMzErDTcnMzEqjRzSlnB67ebPrMDOz+jQqDr0tenyNiuVXSqoZGdEdcl2PSVqtsOwHkq7Mz1cam25mZt2j5Y6UJK2+8lkrGMTyGU7VrCw23czMulhX5ym9K59eu4x/JtD+ISL+I4/9K/BzUtrsTOD0iLgxj11Jir/YFNgT+Czppq619rM7MB4YHhET8uJzgbMk3RgRS2qsurLY9BW0Why6I8TNrOy6rSmRcop+T/qm3xsYCiBpHVL8+RnAvsCHgbslPR4RT+R1DwP2I90FvHetHUjahxSn/vmI+Eth6GbgEFLc+qU1Vu9IbPpyWi0O3RHiZq2vp0ejd+fpu8Wko51BEfF2RNyflx8ATI2IKyJiSUQ8AvwGOLiw7m8j4oGIWBYRb9fY/sHAr4B9KxoSpPDB04HTJdVqaiuNTQfHoZuZdaVGHSm1nRLrVXje9npxfv5t0tHSXyS9DpwXEZeTGtUukt6oqOvqwutpbU8kTcnrQGpAf8rPvw5cFRGPVyswIu6Q9BJwXDvvY6Wx6a0ch+4IcTMru0Y1pVdIzWcI8GRh+QdJp+aIiBnAMfDu5z73SPojqeHcFxGfbGf774Y+RcS2NeYcDFwm6aWI+FmNOd8jfd40vupOOhCbbmZmXachTSkilkr6DTBG0jHAPOALwDbAnQCSDgYejIiXgNdJjWYZ8N/AWEnDgevzJncAFkTEk3TcdGAvYIKkRRHxX1XqnCDpceBI4Hc1ttOR2HTAcehmZo3WyM+UTgTmAJOB14CTgP0j4tU8vhPwsKQFwG3A1yLiuYiYD3yKdMn2dGAG8COgT2cLiIgXSY1plKSRNaadRvuR6CuNTTczs67hOPQ6OA7dzKzzHIduZmYtwU3JzMxKw03JzMxKw03JzMxKw03JzMxKw03JzMxKw03JzMxKw03JzMxKw03JzMxKo0c0JUlHS3pK0nxJr0q6Q9K6kkblm75Wzh8gaZGk7SSNkLRU0oL8eF7SFZK2bMZ7MTN7L2v5piRpT+Ac4IsRsS6wNXBDHr4G2E3SBytWOxR4rBBz8WBE9AX6AXuTspUmSdquy9+AmZm9qzuTZ7vKTqSm8ghARMwBfp3H5ku6FxgOnF1Y5wjgqsoN5ZuxPgucKGkTYDTpbudVtVoculXnmHiz8mj5G7JK2oMUs35u/nNiRLxTGD8cGB0RW+TXWwGPAYMjYqakEcDIiNi9YrtfBn4YEe+vte/Veq8VvTfavNFvybrZrptt2OwSzEqjO+LWe/QNWXPy7OeAjwK3A7MlnS9p9TzlFuD9knbLr48A7oyImSvZ9HSqxFc4Dt3MrOv0hNN3RMSdwJ2SVgM+AdwEPA38KiLelHQTcISkB4HDgW91YLODSflQlftq2Th0q84x8Wbl0SOaUpuIWAb8IX+OVLxI4dfArcDNwLrUTp0tOgj4U3sTnDxrZtZYLd+UJH0WWAu4C3iDdOHDnsDXC9P+lMfGAddHxKIa21od2AT4JjAM+FiXFW5mZito+c+UgNeBY4B/APNIl4H/OCKubZsQ6WqOq4BNqXLVHfCxHNM+D5gArAfsFBGPdW3pZmZW1PJX3zWT49DNzDqvR199Z2ZmPYebkpmZlYabkpmZlYabkpmZlYabkpmZlYabkpmZlYabkpmZlYabkpmZlYabkpmZlUZDm1KOFr+/yvKpkvZu5L7MzKznackjJUktfyNZMzNbUbc3JUn7SXpC0nxJL0s6uTB2gKRHJb0h6c+Sti+MTZV0qqTJwMLKxiRpmKSXJH1X0qw8//DCeD9JV0maKekFSafl/KW2I7wHJF0kaa6kpyTt1Q1fDjMzK2jGkdJlwHERsS4p8+heAEk7ApcDxwEbAr8CbpPUp7DuF4H9gf4RsaTKtjcCBpAC+o4ExuX4c4CfA/2AzUjRFkcARxXW3QV4Nq9/JnCzpBWSZ83MrOs0oyktBraRtF5EvB4Rf83LjyUlxT4cEUsj4tfAO8CuhXUvjIhpEfFWO9s/PSLeiYj7SPHoh+ScpEOB70TE/IiYCpwHDC+s9xpwQUQsjogbSMm1KyT4FePQZ85cWaK6mZl1RqOb0hKgV5XlvUjNCODzwH7AC5Luk9QWpLcp8K186u4NSW8AHwAGFbYzDUDSJpIWtD0K469HxMLC6xfy+gNyDS9UjA0uvH45ls/xaFt3ORExLiKGRsTQgQMHVvsamJnZKmp0U3oR2ESS2hZIWht4H7khRMT/RcRn87JbgRvz1GnAmIjoX3isHRHjC9uPvI0XI6Jv26Mwvr6kdQqvNwGmA7NITXHTirGXC68HF+surGtmZt2k0U3pYeBtYJSkNXODGAtMJB0Z9ZZ0uKR+EbGYlPS6LK97CXC8pF2UrCNpf0nrdrKGs/J+9gAOAG6KiKWk5jdG0rqSNiVFnl9TWO99wFcl9ZJ0MLA1cMeqfRnMzGxVNLQpRcQ7pM9hhgEvAc+RToEdUjg1NhyYKmkecDxweF53IinW/CJSxPkzwIhOljAjrzsduBY4PiKeymNfARbmmu4HriNdWNHmYWAL0lHVGOALETG7k/s3M7M69Jg4dEnDgGsiYuNVWHcEMDIidu/Meo5DNzPrPMehm5lZS3BTMjOz0ugxTSkiJqzKqbu87pWdPXVnZmaN12OakpmZtT43JTMzKw03JTMzKw03JTMzKw03JTMzK433TFOSFJI2b3YdZmZWWzNC/oZJWpbv8D1f0tOSjlr5mmZm1tM160hper6793rAqcAlkrZpUi3tcvS6mVn3aerpu0huJd1EdRtJfSRdIGl6flzQljzbgbjzCZJGFl6PkHR/tf3mu48/ImmepGmSRhfGhuRTfUdLepGcjGtmZl2vqU1J0mqSDgL6A48B3yMlze4AfATYGTitsEp7ceedsZAUh96fdFfzEyQdWDFnT1J8xadXYftmZrYKmtWUBuVk2VnAmcDwiHiaFGNxdkS8FhEzgbNYPrIcqsSdd3bn+ZZEj0XEsoiYDIwnNaGi0RGxsDJ63XHoZmZdp1mfl0yvcZ+6QawYWV6MJK8Vd94pknYhhQ9uB/QG+gA3VUybVm3diBgHjIMUXdHZfZuZWW1luyR8OitGlhcjyWvFnUM6Jbd2YWyjdvZzHXAb8IGI6Af8ElDFHDccM7NuVramNB44TdJASQOAM1g+shyqxJ3n5Y8Cn5O0dv59pKPb2c+6wJyIeFvSzsBhjX0bZma2Ksp2ufMPSJeJT86vb8rL2hTjzt9k+bjznwI7Aa/m9a8F9q6xnxOB8yRdBNwH3Ei66MHMzJqoZeLQ64k77yqOQzcz6zzHoZuZWUtwUzIzs9Io22dKNUXEBKA0p+7MzKzxfKRkZmal4aZkZmal4aZkZmal4aZkZmal4aZkZmal0aOakiPPzcxaW5c2pRy0tzRHn8+T9DdJB3TlPs3MrHV1x5HSgzn6vD9wMXC9JN9nzszMVtBtp+8iYhlwNbAOsAWApA9JulfS7Bxxfm2xYeXI85MlTZY0V9INktYsjJ8i6ZUcnf7l4v4k9ZN0laSZkl6QdJqk1fLYCEkPSPqppDckPSdpt7x8mqTXJB3ZLV8YMzN7V7c1JUmrA0cBi/lnkJ+AH5KC+rYGPgCMrlj1EGAf4IPA9sCIvL19gJOBT5KaXOUdwX8O9AM2I6XKHpH332YX0t3ENyTlK11Pusv45sCXgIsk9V3lN2xmZp3WHU1p1xx9/jbwE+BLEfEaQEQ8ExF353jzmcD5rBhLfmFETI+IOcDvgB3y8kOAKyLi8ZxGO7pthdwADwW+ExHzI2IqcB7LR6s/HxFXRMRS4AZSQzw71/J7YBGpQS3HcehmZl2nO5rSQxHRH1iflPa6R9uApPdLul7Sy5LmkQL9BlSsP6Pw/E2g7ehlEMtHlhdj1AcAvVgxWn1w4fWrhedvAURE5bIVjpQiYlxEDI2IoQMHDqwcNjOzOnTnZ0oLgBOA4ZJ2zIvPIcWOfzgi1iOdNquMJa/lFdLRTZtNCs9nkU4TVkarv7wKpZuZWTfp1t9TyqfgLiXFnEOKJV8AzJU0GDilE5u7ERghaRtJawNnFvazNI+PkbSupE2Bb7JitLqZmZVIM3559gJgP0nbA2cBHwXmArcDN3d0IxFxZ97WvcAz+c+irwALgeeA+0kXM1xeb/FmZtZ1WiYOvYwch25m1nmOQzczs5bgI6U6SJoPPN3sOtoxgHTRR1m5vvq4vvq4vvrUU9+mEVH18uWWiUMvqadrHYKWgaSJrm/Vub76uL76vFfr8+k7MzMrDTclMzMrDTel+oxrdgEr4frq4/rq4/rq856szxc6mJlZafhIyczMSsNNyczMSsNNqYKkDSTdImlhDgc8rMY8SfpRDiicnZ+rML6DpEmS3sx/7lBtO02sb5ykpyUtkzSiEbW5vnLUJ2lLSb9VCricI+kuSVuVqL4BSiGbs5VCNh+U9HHX17H6KuYdISkkjewx9UWEH4UHMJ6Ur9QX2J10X75tq8w7jvSLsxuTIjGeAI7PY71JURnfAPoAX82ve5ehvjz+n8BewERgRJm+fq6v7n9/OwNHAxuQIly+DzxVovrWBLYi/VAs4EBgDrCG6+vYv788Z33gKeBxYGRZ/n7rra8h/5F6yoMU1b4I2LKw7GpgbJW5fwaOLbw+mpQdBfApUkyGCuMvAvuUob6KeffToG+qrq989eWxDUgRMRuWrT7SN/7P5Pre5/o6Xh/wS+BEYAINaEplqc+n75a3JbAkIv5eWPY3YNsqc7fNY9XmbQtMjvw3k02usZ1m1NdVXF99uqq+fwdmRMTsMtUnaTIpkfo24NLIidSub+X1SdoZGEr6xt8opajPtxlaXl9gXsWyuaTcp2pz51bM65vPq1aOtbedbq+volk2kusrWX2SNgZ+QcoTK1V9EbG9pDWBg0invF1fB+ojHb1dDJwUEcuqfJTT0vW5KS1vAbBexbL1gPkdmLsesCAiQlJnttPt9dVZQ3tcX30aWp+kgcDvgYsjYnzZ6gOIiLeB8ZKelPRoRBR/+nZ9VeqTdCLpTMxDddRS2vp8+m55fwfWkLRFYdlHgClV5k7JY9XmTQG2r7gaZfsa22lGfV3F9dWnYfVJWp/UkG6LiDFlq6+KXsBmrq9D9e0FHCRphqQZwG7AeZIu6hH11fvhWE97ANeTrkBZB/g4ta8+OR54knTlyaD8F1J59d3XSFffnUTjrr6ru75CjWsCDwDH5Oerub7Wr4/0U+tfgItK+v9jV9KVXb2BtYBTST+ND3J9HaqvP7BR4fFn0unZfj2hvob+g+0JD9KVSreSotRfBA7Ly/cgHZ62zRNwLulS0Tn5efFqux2BScBbwF+BHUtW3wTSFUXFxzDX1/r1AUfmehaSTrO0PTYpSX17kj4Yn5/H7gP+vSz/P8peX5VtTqBxl4Q3vT7f+87MzErDnymZmVlpuCmZmVlpuCmZmVlpuCmZmVlpuCmZmVlpuCmZmVlpuCmZmVlpuCmZtRhJh0maKGmBpFck3Snpnvx6gaRFkhYXXt8paUgOW2tbNlXSqGa/F7NKviGrWQuR9E1gFOk2L3eR8m/2Id1xYO88ZzSweUR8qbDekPy0f0QskTQUuE/SpIi4u/vegVn73JTMWoSkfsDZwFERcXNh6Hf50WERMVHSFGAHwE3JSsOn78xax8dIN369pd4NSdoV2A54pt5tmTWSj5TMWseGwKyIWFLHNmZJ6kNqbueRbr5pVho+UjJrHbOBAZLq+WFyACk19FvAMFJOkFlpuCmZtY4HgXeAA+vZSEQsjYjzgbeBExtRmFmjuCmZtYiImAucAfxC0oGS1pbUS9K+ks5dhU2OBb4tac3GVmq26tyUzFpIRJxHSvE8DZgJTCMlG6/KZ0O3A6+TknPNSsEhf2ZmVho+UjIzs9JwUzIzs9JwUzIzs9JwUzIzs9JwUzIzs9JwUzIzs9JwUzIzs9JwUzIzs9JwUzIzs9L4f3xD2fGWGwT5AAAAAElFTkSuQmCC%0A">
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Agent</th>
      <th>0.025</th>
      <th>0.500</th>
      <th>0.975</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Random</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Popular</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>User-pop</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SVD</td>
      <td>-0.010231</td>
      <td>0.014218</td>
      <td>0.038666</td>
    </tr>
    <tr>
      <th>4</th>
      <td>User-kNN</td>
      <td>-0.024978</td>
      <td>0.005388</td>
      <td>0.035754</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Item-kNN</td>
      <td>-0.011787</td>
      <td>0.011767</td>
      <td>0.035322</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 5.97 s, sys: 120 ms, total: 6.09 s
Wall time: 6.03 s
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="A/B-tests">
<a class="anchor" href="#A/B-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>A/B tests<a class="anchor-link" href="#A/B-tests"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">n_test_users</span> <span class="o">=</span> <span class="mi">50</span> <span class="c1"># U</span>

<span class="n">agents</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'    Random'</span><span class="p">:</span> <span class="n">RAND_agent</span><span class="p">,</span>
    <span class="s1">'   Popular'</span><span class="p">:</span> <span class="n">GPOP_agent_greedy</span><span class="p">,</span>
    <span class="s1">'   User-pop'</span><span class="p">:</span> <span class="n">PPOP_agent</span><span class="p">,</span>
    <span class="s1">'  SVD'</span><span class="p">:</span>  <span class="n">SVD_agent</span><span class="p">,</span>
    <span class="s1">' User-kNN'</span><span class="p">:</span> <span class="n">userkNN_agent</span><span class="p">,</span>
    <span class="s1">'Item-kNN'</span><span class="p">:</span> <span class="n">itemkNN_agent</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="n">result_AB</span> <span class="o">=</span> <span class="n">verify_agents</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">n_test_users</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">agents</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">result_AB</span><span class="p">)</span>
<span class="n">plot_barchart</span><span class="p">(</span><span class="n">result_AB</span><span class="p">,</span> <span class="s1">'A/B-test'</span><span class="p">,</span> <span class="s1">'CTR'</span><span class="p">,</span> <span class="s1">'tab:green'</span><span class="p">,</span> <span class="s1">'ABtest_eval.eps'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Organic Users: 0it [00:00, ?it/s]
Users: 100%|██████████| 50/50 [00:01&lt;00:00, 36.23it/s]
Organic Users: 0it [00:00, ?it/s]
Users: 100%|██████████| 50/50 [00:01&lt;00:00, 41.71it/s]
Organic Users: 0it [00:00, ?it/s]
Users: 100%|██████████| 50/50 [00:01&lt;00:00, 28.04it/s]
Organic Users: 0it [00:00, ?it/s]
Users: 100%|██████████| 50/50 [00:01&lt;00:00, 35.95it/s]
Organic Users: 0it [00:00, ?it/s]
Users: 100%|██████████| 50/50 [00:06&lt;00:00,  7.86it/s]
Organic Users: 0it [00:00, ?it/s]
Users: 100%|██████████| 50/50 [00:01&lt;00:00, 33.91it/s]
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Agent</th>
      <th>0.025</th>
      <th>0.500</th>
      <th>0.975</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Random</td>
      <td>0.007624</td>
      <td>0.010324</td>
      <td>0.013590</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Popular</td>
      <td>0.008203</td>
      <td>0.010997</td>
      <td>0.014357</td>
    </tr>
    <tr>
      <th>2</th>
      <td>User-pop</td>
      <td>0.011879</td>
      <td>0.015227</td>
      <td>0.019140</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SVD</td>
      <td>0.012572</td>
      <td>0.015994</td>
      <td>0.019976</td>
    </tr>
    <tr>
      <th>4</th>
      <td>User-kNN</td>
      <td>0.011999</td>
      <td>0.015350</td>
      <td>0.019263</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Item-kNN</td>
      <td>0.012174</td>
      <td>0.015545</td>
      <td>0.019477</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 14 s, sys: 445 ms, total: 14.4 s
Wall time: 14.1 s
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="k">def</span> <span class="nf">combine_barchart</span><span class="p">(</span><span class="n">resultAB</span><span class="p">,</span> <span class="n">resultCIPS</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span>  <span class="n">figname</span> <span class="o">=</span> <span class="s1">'fig.eps'</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>
    <span class="n">n_agents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">resultAB</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">colour</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([(</span><span class="s1">'A/B-test'</span><span class="p">,</span> <span class="s1">'tab:green'</span><span class="p">,</span> <span class="n">result_AB</span><span class="p">),(</span><span class="s1">'CIPS'</span><span class="p">,</span> <span class="s1">'tab:blue'</span><span class="p">,</span> <span class="n">result_CIPS</span><span class="p">)]):</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">'0.500'</span><span class="p">]</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">'0.500'</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s1">'0.025'</span><span class="p">]</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">'0.975'</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="s1">'0.500'</span><span class="p">]</span>
        <span class="n">height</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">height</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_agents</span><span class="p">)]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">yticks</span><span class="p">,</span>
                 <span class="n">mean</span><span class="p">,</span>
                 <span class="n">height</span> <span class="o">=</span> <span class="n">height</span><span class="p">,</span>
                 <span class="n">xerr</span>  <span class="o">=</span> <span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">),</span>
                 <span class="n">align</span> <span class="o">=</span> <span class="s1">'edge'</span><span class="p">,</span>
                 <span class="n">label</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>
                 <span class="n">color</span> <span class="o">=</span> <span class="n">colour</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">'Agent'</span><span class="p">],</span> <span class="n">size</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'lower right'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">'</span><span class="si">%.3f</span><span class="s1">'</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span><span class="p">,</span> <span class="n">bbox_inches</span> <span class="o">=</span> <span class="s1">'tight'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">combine_barchart</span><span class="p">(</span><span class="n">result_AB</span><span class="p">,</span> <span class="n">result_CIPS</span><span class="p">,</span> <span class="s1">'Evaluate on Bandit Feedback'</span><span class="p">,</span> <span class="s1">'CTR'</span><span class="p">,</span> <span class="s1">'ABtest_CIPS.eps'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>The PostScript backend does not support transparency; partially transparent artists will be rendered opaque.
The PostScript backend does not support transparency; partially transparent artists will be rendered opaque.
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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TpIkaWNavXo111xzDV/5yle48MILn1ne09PDvHnz+lx/iy22YNNNN33O8ieeeIKPf/zjXHTRRcyePZuLLrqINWvWcMIJJ7D//vuz77778r3vfQ+AG2+8kf3335/Zs2ez9957c+utt3LyySfz29/+ltmzZ/PhDw/ljru+jcRTxpIkSePC9773PQ455BB23313pk2bxuLFi5kzZw6XX345b37zm59Z77jjjmPSpEnceuutfPazn31eIJw4cSKf+MQnnjND+NGPfpTXve51fPWrX2XlypXsv//+HHzwwXzxi1/kgx/8IMcddxxPPPEEa9eu5cwzz+SGG27gF794zqfjbTADocadpWcs7XYJzzHv3HndLmFIenp6ul2CJI1aF1xwAR/84AcBOPbYY7nggguYM2cO1157LZ/+9KefWe/rX/86c+fO5b777uNVr3oVhxxyCDvvvHN/mwXgiiuu4JJLLnlmO4899hh33HEHBx54IKeffjrLli3jqKOO4mUve1nHj8tAKEmSNAgPPPAAV111FUuWLCEJa9euJQnvfe972WmnnZ53jyDAi1/8Yl7xilfwk5/8hJ/97GfP3HP45S9/+XnrllL41re+xR577PGc5TNnzuSAAw7g0ksv5dBDD+VLX/oSM2bM6OixGQg17sw4pbN/SIarZ35Pt0uQJHXAN7/5TY4//ni+9KUvPbPsoIMO4vzzz+eQQw7ps88jjzzCz3/+cz7ykY8wZ84cjjzyyGfabr/9dlatWvXM+ze84Q18/vOf5/Of/zxJ+PnPf86+++7L0qVLmTFjBh/4wAe44447uP7669lnn32e03e4fKhEkiRpEC644ILnBDqAo48+muuuu+55gfC4445j9uzZzJkzhwULFjBnzpznbe8P/uAPuOmmm555qOTUU0/lySefZO+992bWrFmceuqpAFx88cXsueeezJ49mxtuuIF3vvOdTJs2jVe/+tXsueeeHXmoxI+dGQY/dkaD4cfOSFJn9PVRKt32+OOP8+pXv5pFixZ1u5Tn8GNnJEmSRsikSZNGXRjcEAZCSZKkyhkIJUmSKmcglCRJqpyBUJIkqXJ+DuEwzJo2i0Xzx/6NpJIkqW7OEEqSJA3SPffcw7HHHsuuu+7KnDlzOPTQQ/n1r3/NnnvuCbS+/nOrrbZi9uzZzJw585lvJnnkkUc47rjj2Guvvdhzzz15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%0A">
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-python"><pre><span></span><span class="n">plot_barchart</span><span class="p">(</span><span class="n">result_LOO</span><span class="p">,</span> <span class="s1">'Evaluate on Organic Feedback'</span><span class="p">,</span> <span class="s1">'HR@1'</span><span class="p">,</span> <span class="s1">'tab:red'</span><span class="p">,</span> <span class="s1">'traditional_eval.eps'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="recohut/notebook"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/bandit/2021/06/17/recostep-tutorial-offline-replayer-eval-recogym-small.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Jupyter notebook database.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/recohut" target="_blank" title="recohut"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
