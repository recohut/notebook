<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Amazon Personalize Batch Job | reconb</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Amazon Personalize Batch Job" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Train and create batch recommendations using Amazon Personalize. Expected completion time is 1.5-2 hours" />
<meta property="og:description" content="Train and create batch recommendations using Amazon Personalize. Expected completion time is 1.5-2 hours" />
<link rel="canonical" href="https://nb.recohut.com/amazonpersonalize/batch/movie/hrnn/2021/06/20/amazon-personalize-batch-job.html" />
<meta property="og:url" content="https://nb.recohut.com/amazonpersonalize/batch/movie/hrnn/2021/06/20/amazon-personalize-batch-job.html" />
<meta property="og:site_name" content="reconb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-20T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Amazon Personalize Batch Job" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-06-20T00:00:00-05:00","datePublished":"2021-06-20T00:00:00-05:00","description":"Train and create batch recommendations using Amazon Personalize. Expected completion time is 1.5-2 hours","headline":"Amazon Personalize Batch Job","mainEntityOfPage":{"@type":"WebPage","@id":"https://nb.recohut.com/amazonpersonalize/batch/movie/hrnn/2021/06/20/amazon-personalize-batch-job.html"},"url":"https://nb.recohut.com/amazonpersonalize/batch/movie/hrnn/2021/06/20/amazon-personalize-batch-job.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nb.recohut.com/feed.xml" title="reconb" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">reconb</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Amazon Personalize Batch Job</h1><p class="page-description">Train and create batch recommendations using Amazon Personalize. Expected completion time is 1.5-2 hours</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-06-20T00:00:00-05:00" itemprop="datePublished">
        Jun 20, 2021
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      21 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#amazonpersonalize">amazonpersonalize</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#batch">batch</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#movie">movie</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#hrnn">hrnn</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/recohut/notebook/tree/master/_notebooks/2021-06-20-amazon-personalize-batch-job.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/recohut/notebook/master?filepath=_notebooks%2F2021-06-20-amazon-personalize-batch-job.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/recohut/notebook/blob/master/_notebooks/2021-06-20-amazon-personalize-batch-job.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Frecohut%2Fnotebook%2Fblob%2Fmaster%2F_notebooks%2F2021-06-20-amazon-personalize-batch-job.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#Prepare-Data">Prepare Data </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Get-dataset">Get dataset </a></li>
<li class="toc-entry toc-h3"><a href="#Prepare-data">Prepare data </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Create-related-datasets-and-a-dataset-group.">Create related datasets and a dataset group. </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Create-the-personalize-dataset-group">Create the personalize dataset group </a></li>
<li class="toc-entry toc-h3"><a href="#CHECKPOINT-#1---Wait-for-dataset-group-creation-to-complete">CHECKPOINT #1 - Wait for dataset group creation to complete </a></li>
<li class="toc-entry toc-h3"><a href="#Create-the-dataset">Create the dataset </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Configuring-S3-and-IAM">Configuring S3 and IAM </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Attach-Policy-to-S3-Bucket">Attach Policy to S3 Bucket </a></li>
<li class="toc-entry toc-h3"><a href="#Create-Personalize-Role">Create Personalize Role </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Upload-dataset-to-S3">Upload dataset to S3 </a></li>
<li class="toc-entry toc-h2"><a href="#Importing-the-Interactions-Data">Importing the Interactions Data </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Create-Dataset-Import-Job">Create Dataset Import Job </a></li>
<li class="toc-entry toc-h3"><a href="#CHECKPOINT-#2---Wait-for-Dataset-Import-Job-to-Have-ACTIVE-Status">CHECKPOINT #2 - Wait for Dataset Import Job to Have ACTIVE Status </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Create-solution">Create solution </a></li>
<li class="toc-entry toc-h2"><a href="#Create-the-solution-version">Create the solution version </a>
<ul>
<li class="toc-entry toc-h3"><a href="#CHECKPOINT-#3---Wait-for-solution-version-creation-to-be-completed">CHECKPOINT #3 - Wait for solution version creation to be completed </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Viewing-Solution-Creation-Status">Viewing Solution Creation Status </a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Evaluate-solution-metrics">Evaluate solution metrics </a></li>
<li class="toc-entry toc-h2"><a href="#Batch-Recommendation">Batch Recommendation </a>
<ul>
<li class="toc-entry toc-h3"><a href="#CHECKPOINT-#4---Wait-for-batch-recommendation-job-to-complete">CHECKPOINT #4 - Wait for batch recommendation job to complete </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Challenge">Challenge </a></li>
<li class="toc-entry toc-h2"><a href="#Cleanup">Cleanup </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-06-20-amazon-personalize-batch-job.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Amazon Personalize Workflow</strong></p>
<p>The general workflow for training, deploying, and getting recommendations from a campaign is as follows:</p>
<ol>
<li>
<p>Prepare data</p>
</li>
<li>
<p>Create related datasets and a dataset group.</p>
</li>
<li>
<p>Get training data.</p>
<ul>
<li>
<p>Import historical data to the dataset group.</p>
</li>
<li>
<p>Record user events to the dataset group.</p>
</li>
</ul>
</li>
<li>
<p>Create a solution version (trained model) using a recipe.</p>
</li>
<li>
<p>Evaluate the solution version using metrics.</p>
</li>
<li>
<p>Create a campaign (deploy the solution version).</p>
</li>
<li>
<p>Provide recommendations for users by running Batch Recommendation.</p>
</li>
</ol>
<p>In this lab, we will step through the workflow and with some additional steps to setup your IAM permissions and S3 buckets as a data source for your dataset and output for the batch recommendations.</p>
<p><strong>Note:</strong> This lab will not cover the deployment of a real-time personalize campaign.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Prepare-Data">
<a class="anchor" href="#Prepare-Data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Prepare Data<a class="anchor-link" href="#Prepare-Data"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Get-dataset">
<a class="anchor" href="#Get-dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get dataset<a class="anchor-link" href="#Get-dataset"> </a>
</h3>
<p>In thie lab, we will be using the the <a href="http://grouplens.org/datasets/movielens/">Movielens dataset</a> to train and make movie recommendations.</p>
<p>Movielens provide several datasets. To achieve better model accuracy, it is recommendeded to train the Personalize model with a large dataset, however the tradeoff would mean a longer training time. To minimise the time required to complete this lab, we will be sacrificing accuracy for time and will be using the small dataset.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">"movie_data"</span>
<span class="o">!</span>mkdir <span class="nv">$data_dir</span>
<span class="o">!</span><span class="nb">cd</span> <span class="nv">$data_dir</span> <span class="o">&amp;&amp;</span> wget http://files.grouplens.org/datasets/movielens/ml-latest-small.zip
<span class="o">!</span><span class="nb">cd</span> <span class="nv">$data_dir</span> <span class="o">&amp;&amp;</span> unzip ml-latest-small.zip
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>--2020-04-16 06:45:48--  http://files.grouplens.org/datasets/movielens/ml-latest-small.zip
Resolving files.grouplens.org (files.grouplens.org)... 128.101.65.152
Connecting to files.grouplens.org (files.grouplens.org)|128.101.65.152|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 978202 (955K) [application/zip]
Saving to: â€˜ml-latest-small.zipâ€™

ml-latest-small.zip 100%[===================&gt;] 955.28K  5.70MB/s    in 0.2s    

2020-04-16 06:45:48 (5.70 MB/s) - â€˜ml-latest-small.zipâ€™ saved [978202/978202]

Archive:  ml-latest-small.zip
   creating: ml-latest-small/
  inflating: ml-latest-small/links.csv  
  inflating: ml-latest-small/tags.csv  
  inflating: ml-latest-small/ratings.csv  
  inflating: ml-latest-small/README.txt  
  inflating: ml-latest-small/movies.csv  
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Prepare-data">
<a class="anchor" href="#Prepare-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Prepare data<a class="anchor-link" href="#Prepare-data"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">uuid</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Load the dataset and preview the data.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">original_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s1">'/ml-latest-small/ratings.csv'</span><span class="p">)</span>
<span class="n">original_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>movieId</th>
      <th>rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
      <td>964982703</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>3</td>
      <td>4.0</td>
      <td>964981247</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>6</td>
      <td>4.0</td>
      <td>964982224</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>47</td>
      <td>5.0</td>
      <td>964983815</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>50</td>
      <td>5.0</td>
      <td>964982931</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>70</td>
      <td>3.0</td>
      <td>964982400</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>101</td>
      <td>5.0</td>
      <td>964980868</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1</td>
      <td>110</td>
      <td>4.0</td>
      <td>964982176</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1</td>
      <td>151</td>
      <td>5.0</td>
      <td>964984041</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1</td>
      <td>157</td>
      <td>5.0</td>
      <td>964984100</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the lab, we will be using the movie rating dataset and considering movies with ratings greater or equal to 4 to use for the recommendation as we only want to recommend movies that have been positively rated.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interactions_df</span> <span class="o">=</span> <span class="n">original_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Only want ratings greater or equal to 4, filter out ratings less than 4</span>
<span class="n">interactions_df</span> <span class="o">=</span> <span class="n">interactions_df</span><span class="p">[</span><span class="n">interactions_df</span><span class="p">[</span><span class="s1">'rating'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">4.0</span><span class="p">]</span>

<span class="n">interactions_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>movieId</th>
      <th>rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
      <td>964982703</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>3</td>
      <td>4.0</td>
      <td>964981247</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>6</td>
      <td>4.0</td>
      <td>964982224</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>47</td>
      <td>5.0</td>
      <td>964983815</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>50</td>
      <td>5.0</td>
      <td>964982931</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>101</td>
      <td>5.0</td>
      <td>964980868</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1</td>
      <td>110</td>
      <td>4.0</td>
      <td>964982176</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1</td>
      <td>151</td>
      <td>5.0</td>
      <td>964984041</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1</td>
      <td>157</td>
      <td>5.0</td>
      <td>964984100</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1</td>
      <td>163</td>
      <td>5.0</td>
      <td>964983650</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The next step is to map the dataset to the personalize schema by renaming the column name.</p>
<p>For more information about the schema, refer to the following URL: <a href="https://docs.aws.amazon.com/personalize/latest/dg/how-it-works-dataset-schema.html">https://docs.aws.amazon.com/personalize/latest/dg/how-it-works-dataset-schema.html</a></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interactions_df</span> <span class="o">=</span> <span class="n">interactions_df</span><span class="p">[[</span><span class="s1">'userId'</span><span class="p">,</span> <span class="s1">'movieId'</span><span class="p">,</span> <span class="s1">'timestamp'</span><span class="p">]]</span>
<span class="n">interactions_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">interactions_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'userId'</span><span class="p">:</span><span class="s1">'USER_ID'</span><span class="p">,</span> <span class="s1">'movieId'</span><span class="p">:</span><span class="s1">'ITEM_ID'</span><span class="p">,</span> 
                              <span class="s1">'timestamp'</span><span class="p">:</span><span class="s1">'TIMESTAMP'</span><span class="p">},</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, we save the dataset to CSV file which we will later upload to S3 for Personalize to use.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interactions_filename</span> <span class="o">=</span> <span class="s2">"interactions.csv"</span>
<span class="n">interactions_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">((</span><span class="n">data_dir</span><span class="o">+</span><span class="s2">"/"</span><span class="o">+</span><span class="n">interactions_filename</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">'</span><span class="si">%.0f</span><span class="s1">'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-related-datasets-and-a-dataset-group.">
<a class="anchor" href="#Create-related-datasets-and-a-dataset-group." aria-hidden="true"><span class="octicon octicon-link"></span></a>Create related datasets and a dataset group.<a class="anchor-link" href="#Create-related-datasets-and-a-dataset-group."> </a>
</h2>
<p>In this section, we will setup the Amazon Personalize dataset group and load the inteaction dataset into Amazon Personalize which will be used for training.</p>
<p>Amazon Personalize requires data, stored in Amazon Personalize datasets, in order to train a model.</p>
<p>There are two ways to provide the training data. You can import historical data from an Amazon S3 bucket, and you can record event data as it is created.</p>
<p>A dataset group contains related datasets. Three types of historical datasets are created by the customer (users, items, and interactions), and one type is created by Amazon Personalize for live-event interactions. A dataset group can contain only one of each kind of dataset.</p>
<p>You can create dataset groups to serve different purposes. For example, you might have an application that provides recommendations for purchasing shoes and another that provides recommendations for places to visit in Europe. In Amazon Personalize, each application would have its own dataset group.</p>
<p>Historical data must be provided in a CSV file. Each dataset type has a unique schema that specifies the contents of the CSV file.</p>
<p>There is a <a href="https://docs.aws.amazon.com/personalize/latest/dg/limits.html">minimum amount of data</a> that is necessary to train a model. Using existing data allows you to immediately start training a model. If you rely on recorded data as it is created, and there is no historical data, it can take a while before training can begin.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">personalize</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">'personalize'</span><span class="p">)</span>
<span class="n">personalize_runtime</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">'personalize-runtime'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-the-personalize-dataset-group">
<a class="anchor" href="#Create-the-personalize-dataset-group" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create the personalize dataset group<a class="anchor-link" href="#Create-the-personalize-dataset-group"> </a>
</h3>
<p>We start by creating the personalize dataset group named "<strong>personalize-devlab-movies-dataset-group</strong>" which will be used to to store our interactive (ratings) dataset we prepared earlier.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">create_dataset_group_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_dataset_group</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"personalize-devlab-movies-dataset-group"</span>
<span class="p">)</span>

<span class="n">dataset_group_arn</span> <span class="o">=</span> <span class="n">create_dataset_group_response</span><span class="p">[</span><span class="s1">'datasetGroupArn'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_dataset_group_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "datasetGroupArn": "arn:aws:personalize:us-east-2:931343413930:dataset-group/personalize-devlab-movies-dataset-group",
  "ResponseMetadata": {
    "RequestId": "0374647e-baae-470f-87b1-0664f3d225d5",
    "HTTPStatusCode": 200,
    "HTTPHeaders": {
      "content-type": "application/x-amz-json-1.1",
      "date": "Thu, 16 Apr 2020 06:46:00 GMT",
      "x-amzn-requestid": "0374647e-baae-470f-87b1-0664f3d225d5",
      "content-length": "118",
      "connection": "keep-alive"
    },
    "RetryAttempts": 0
  }
}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="CHECKPOINT-#1---Wait-for-dataset-group-creation-to-complete">
<a class="anchor" href="#CHECKPOINT-#1---Wait-for-dataset-group-creation-to-complete" aria-hidden="true"><span class="octicon octicon-link"></span></a>CHECKPOINT #1 - Wait for dataset group creation to complete<a class="anchor-link" href="#CHECKPOINT-#1---Wait-for-dataset-group-creation-to-complete"> </a>
</h3>
<p>The dataset group will take some time to be created. <strong>Execute the following cell and wait for it to show "ACTIVE" before proceeding to the next step.</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Started on: "</span><span class="p">,</span> <span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%I:%M:%S %p"</span><span class="p">))</span>

<span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_dataset_group_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_dataset_group</span><span class="p">(</span>
        <span class="n">datasetGroupArn</span> <span class="o">=</span> <span class="n">dataset_group_arn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_dataset_group_response</span><span class="p">[</span><span class="s2">"datasetGroup"</span><span class="p">][</span><span class="s2">"status"</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"DatasetGroup: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"ACTIVE"</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"CREATE FAILED"</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

<span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Completed on: "</span><span class="p">,</span> <span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%I:%M:%S %p"</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Started on:  06:46:03 AM
DatasetGroup: CREATE PENDING
DatasetGroup: ACTIVE
Completed on:  06:47:03 AM
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-the-dataset">
<a class="anchor" href="#Create-the-dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create the dataset<a class="anchor-link" href="#Create-the-dataset"> </a>
</h3>
<p>Once the dataset group have been complete, the next step is to defined the interaction schema and we will name it "<strong>personalize-devlab-movies-interactions-schema</strong>".</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interactions_schema</span> <span class="o">=</span> <span class="n">schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"record"</span><span class="p">,</span>
    <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Interactions"</span><span class="p">,</span>
    <span class="s2">"namespace"</span><span class="p">:</span> <span class="s2">"com.amazonaws.personalize.schema"</span><span class="p">,</span>
    <span class="s2">"fields"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"USER_ID"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"string"</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"ITEM_ID"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"string"</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"TIMESTAMP"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"long"</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"1.0"</span>
<span class="p">}</span>

<span class="n">create_schema_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_schema</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"personalize-devlab-movies-interactions-schema"</span><span class="p">,</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">interactions_schema</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">schema_arn</span> <span class="o">=</span> <span class="n">create_schema_response</span><span class="p">[</span><span class="s1">'schemaArn'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_schema_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "schemaArn": "arn:aws:personalize:us-east-2:931343413930:schema/personalize-devlab-movies-interactions-schema",
  "ResponseMetadata": {
    "RequestId": "82e560cc-a51a-4061-9b1e-38c607985d04",
    "HTTPStatusCode": 200,
    "HTTPHeaders": {
      "content-type": "application/x-amz-json-1.1",
      "date": "Thu, 16 Apr 2020 06:47:20 GMT",
      "x-amzn-requestid": "82e560cc-a51a-4061-9b1e-38c607985d04",
      "content-length": "111",
      "connection": "keep-alive"
    },
    "RetryAttempts": 0
  }
}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Once the schema has been defined, we will define the interactiion dataset using the schema we created above and provide it with the following name "personalize-devlab-movies-interactions-dataset"</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset_type</span> <span class="o">=</span> <span class="s2">"INTERACTIONS"</span>
<span class="n">create_dataset_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"personalize-devlab-movies-interactions-dataset"</span><span class="p">,</span>
    <span class="n">datasetType</span> <span class="o">=</span> <span class="n">dataset_type</span><span class="p">,</span>
    <span class="n">datasetGroupArn</span> <span class="o">=</span> <span class="n">dataset_group_arn</span><span class="p">,</span>
    <span class="n">schemaArn</span> <span class="o">=</span> <span class="n">schema_arn</span>
<span class="p">)</span>

<span class="n">dataset_arn</span> <span class="o">=</span> <span class="n">create_dataset_response</span><span class="p">[</span><span class="s1">'datasetArn'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_dataset_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "datasetArn": "arn:aws:personalize:us-east-2:931343413930:dataset/personalize-devlab-movies-dataset-group/INTERACTIONS",
  "ResponseMetadata": {
    "RequestId": "8d113327-296b-45fd-8f40-1b97a195f699",
    "HTTPStatusCode": 200,
    "HTTPHeaders": {
      "content-type": "application/x-amz-json-1.1",
      "date": "Thu, 16 Apr 2020 06:47:21 GMT",
      "x-amzn-requestid": "8d113327-296b-45fd-8f40-1b97a195f699",
      "content-length": "120",
      "connection": "keep-alive"
    },
    "RetryAttempts": 0
  }
}
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interactions_dataset_arn</span> <span class="o">=</span> <span class="n">dataset_arn</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Configuring-S3-and-IAM">
<a class="anchor" href="#Configuring-S3-and-IAM" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring S3 and IAM<a class="anchor-link" href="#Configuring-S3-and-IAM"> </a>
</h2>
<p>Amazon Personalize will need an S3 bucket to act as the source of your data, as well as IAM roles for accessing it. The code below will set all that up.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now using the metada stored on this instance of a SageMaker Notebook determine the region we are operating in. If you are using a Jupyter Notebook outside of SageMaker simply define region as the string that indicates the region you would like to use for Forecast and S3.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'/opt/ml/metadata/resource-metadata.json'</span><span class="p">)</span> <span class="k">as</span> <span class="n">notebook_info</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">notebook_info</span><span class="p">)</span>
    <span class="n">resource_arn</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">'ResourceArn'</span><span class="p">]</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">resource_arn</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">':'</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
    
<span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">region_name</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
<span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">'s3'</span><span class="p">)</span>
<span class="n">account_id</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">'sts'</span><span class="p">)</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'Account'</span><span class="p">)</span>
<span class="n">bucket_name</span> <span class="o">=</span> <span class="n">account_id</span> <span class="o">+</span> <span class="s2">"personalizedevlab"</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>
<span class="k">if</span> <span class="n">region</span> <span class="o">!=</span> <span class="s2">"us-east-1"</span><span class="p">:</span>
    <span class="n">s3</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">CreateBucketConfiguration</span><span class="o">=</span><span class="p">{</span><span class="s1">'LocationConstraint'</span><span class="p">:</span> <span class="n">region</span><span class="p">})</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">s3</span><span class="o">.</span><span class="n">create_bucket</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>us-east-2
931343413930personalizedevlab
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Attach-Policy-to-S3-Bucket">
<a class="anchor" href="#Attach-Policy-to-S3-Bucket" aria-hidden="true"><span class="octicon octicon-link"></span></a>Attach Policy to S3 Bucket<a class="anchor-link" href="#Attach-Policy-to-S3-Bucket"> </a>
</h3>
<p>Amazon Personalize needs to be able to read the content of your S3 bucket that you created earlier. The lines below will do that.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">"s3"</span><span class="p">)</span>

<span class="n">policy</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"Version"</span><span class="p">:</span> <span class="s2">"2012-10-17"</span><span class="p">,</span>
    <span class="s2">"Id"</span><span class="p">:</span> <span class="s2">"PersonalizeS3BucketAccessPolicy"</span><span class="p">,</span>
    <span class="s2">"Statement"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"Sid"</span><span class="p">:</span> <span class="s2">"PersonalizeS3BucketAccessPolicy"</span><span class="p">,</span>
            <span class="s2">"Effect"</span><span class="p">:</span> <span class="s2">"Allow"</span><span class="p">,</span>
            <span class="s2">"Principal"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"Service"</span><span class="p">:</span> <span class="s2">"personalize.amazonaws.com"</span>
            <span class="p">},</span>
            <span class="s2">"Action"</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">"s3:*Object"</span><span class="p">,</span>
                <span class="s2">"s3:ListBucket"</span>
            <span class="p">],</span>
            <span class="s2">"Resource"</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">"arn:aws:s3:::</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">),</span>
                <span class="s2">"arn:aws:s3:::</span><span class="si">{}</span><span class="s2">/*"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">s3</span><span class="o">.</span><span class="n">put_bucket_policy</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Policy</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">policy</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{'ResponseMetadata': {'RequestId': '039C39BD0ADB3BFE',
  'HostId': 'C6i18rymISNGlhn+y6WXKM/YIw/lVDWD6082jKgk3ggJq43St4JOKljBFBSRd07X+1h6jNRczCA=',
  'HTTPStatusCode': 204,
  'HTTPHeaders': {'x-amz-id-2': 'C6i18rymISNGlhn+y6WXKM/YIw/lVDWD6082jKgk3ggJq43St4JOKljBFBSRd07X+1h6jNRczCA=',
   'x-amz-request-id': '039C39BD0ADB3BFE',
   'date': 'Thu, 16 Apr 2020 06:48:30 GMT',
   'server': 'AmazonS3'},
  'RetryAttempts': 0}}</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-Personalize-Role">
<a class="anchor" href="#Create-Personalize-Role" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create Personalize Role<a class="anchor-link" href="#Create-Personalize-Role"> </a>
</h3>
<p>Also Amazon Personalize needs the ability to assume Roles in AWS in order to have the permissions to execute certain tasks, the lines below grant that.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iam</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">"iam"</span><span class="p">)</span>

<span class="n">role_name</span> <span class="o">=</span> <span class="s2">"PersonalizeRoleDevLab"</span>
<span class="n">assume_role_policy_document</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"Version"</span><span class="p">:</span> <span class="s2">"2012-10-17"</span><span class="p">,</span>
    <span class="s2">"Statement"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">"Effect"</span><span class="p">:</span> <span class="s2">"Allow"</span><span class="p">,</span>
          <span class="s2">"Principal"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"Service"</span><span class="p">:</span> <span class="s2">"personalize.amazonaws.com"</span>
          <span class="p">},</span>
          <span class="s2">"Action"</span><span class="p">:</span> <span class="s2">"sts:AssumeRole"</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">create_role_response</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">create_role</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="n">role_name</span><span class="p">,</span>
    <span class="n">AssumeRolePolicyDocument</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">assume_role_policy_document</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># AmazonPersonalizeFullAccess provides access to any S3 bucket with a name that includes "personalize" or "Personalize" </span>
<span class="c1"># if you would like to use a bucket with a different name, please consider creating and attaching a new policy</span>
<span class="c1"># that provides read access to your bucket or attaching the AmazonS3ReadOnlyAccess policy to the role</span>
<span class="n">policy_arn</span> <span class="o">=</span> <span class="s2">"arn:aws:iam::aws:policy/service-role/AmazonPersonalizeFullAccess"</span>
<span class="n">iam</span><span class="o">.</span><span class="n">attach_role_policy</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="n">role_name</span><span class="p">,</span>
    <span class="n">PolicyArn</span> <span class="o">=</span> <span class="n">policy_arn</span>
<span class="p">)</span>

<span class="c1"># Now add S3 support</span>
<span class="n">iam</span><span class="o">.</span><span class="n">attach_role_policy</span><span class="p">(</span>
    <span class="n">PolicyArn</span><span class="o">=</span><span class="s1">'arn:aws:iam::aws:policy/AmazonS3FullAccess'</span><span class="p">,</span>
    <span class="n">RoleName</span><span class="o">=</span><span class="n">role_name</span>
<span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span> <span class="c1"># wait for a minute to allow IAM role policy attachment to propagate</span>

<span class="n">role_arn</span> <span class="o">=</span> <span class="n">create_role_response</span><span class="p">[</span><span class="s2">"Role"</span><span class="p">][</span><span class="s2">"Arn"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">role_arn</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>arn:aws:iam::931343413930:role/PersonalizeRoleDevLab
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Upload-dataset-to-S3">
<a class="anchor" href="#Upload-dataset-to-S3" aria-hidden="true"><span class="octicon octicon-link"></span></a>Upload dataset to S3<a class="anchor-link" href="#Upload-dataset-to-S3"> </a>
</h2>
<p>Before Personalize can import the data, it needs to be in S3.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interactions_file_path</span> <span class="o">=</span> <span class="n">data_dir</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="n">interactions_filename</span>
<span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">'s3'</span><span class="p">)</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">interactions_filename</span><span class="p">)</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">interactions_file_path</span><span class="p">)</span>
<span class="n">interactions_s3DataPath</span> <span class="o">=</span> <span class="s2">"s3://"</span><span class="o">+</span><span class="n">bucket_name</span><span class="o">+</span><span class="s2">"/"</span><span class="o">+</span><span class="n">interactions_filename</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Importing-the-Interactions-Data">
<a class="anchor" href="#Importing-the-Interactions-Data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Importing the Interactions Data<a class="anchor-link" href="#Importing-the-Interactions-Data"> </a>
</h2>
<p>Earlier you created the DatasetGroup and Dataset to house your information, now you will execute an import job that will load the data from S3 into Amazon Personalize for usage building your model.</p>
<h4 id="Create-Dataset-Import-Job">
<a class="anchor" href="#Create-Dataset-Import-Job" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create Dataset Import Job<a class="anchor-link" href="#Create-Dataset-Import-Job"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">create_dataset_import_job_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_dataset_import_job</span><span class="p">(</span>
    <span class="n">jobName</span> <span class="o">=</span> <span class="s2">"personalize-devlab-import1"</span><span class="p">,</span>
    <span class="n">datasetArn</span> <span class="o">=</span> <span class="n">interactions_dataset_arn</span><span class="p">,</span>
    <span class="n">dataSource</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"dataLocation"</span><span class="p">:</span> <span class="s2">"s3://</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">interactions_filename</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">roleArn</span> <span class="o">=</span> <span class="n">role_arn</span>
<span class="p">)</span>

<span class="n">dataset_import_job_arn</span> <span class="o">=</span> <span class="n">create_dataset_import_job_response</span><span class="p">[</span><span class="s1">'datasetImportJobArn'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_dataset_import_job_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "datasetImportJobArn": "arn:aws:personalize:us-east-2:931343413930:dataset-import-job/personalize-devlab-import1",
  "ResponseMetadata": {
    "RequestId": "185c9da7-fa80-4af1-b6ca-ed7dafc83c17",
    "HTTPStatusCode": 200,
    "HTTPHeaders": {
      "content-type": "application/x-amz-json-1.1",
      "date": "Thu, 16 Apr 2020 06:59:06 GMT",
      "x-amzn-requestid": "185c9da7-fa80-4af1-b6ca-ed7dafc83c17",
      "content-length": "114",
      "connection": "keep-alive"
    },
    "RetryAttempts": 0
  }
}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="CHECKPOINT-#2---Wait-for-Dataset-Import-Job-to-Have-ACTIVE-Status">
<a class="anchor" href="#CHECKPOINT-#2---Wait-for-Dataset-Import-Job-to-Have-ACTIVE-Status" aria-hidden="true"><span class="octicon octicon-link"></span></a>CHECKPOINT #2 - Wait for Dataset Import Job to Have ACTIVE Status<a class="anchor-link" href="#CHECKPOINT-#2---Wait-for-Dataset-Import-Job-to-Have-ACTIVE-Status"> </a>
</h3>
<p>It can take a while before the import job completes. <strong>Execute the following cell and wait for it to show "ACTIVE" before proceeding to the next step.</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Started on: "</span><span class="p">,</span> <span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%I:%M:%S %p"</span><span class="p">))</span>

<span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_dataset_import_job_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_dataset_import_job</span><span class="p">(</span>
        <span class="n">datasetImportJobArn</span> <span class="o">=</span> <span class="n">dataset_import_job_arn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_dataset_import_job_response</span><span class="p">[</span><span class="s2">"datasetImportJob"</span><span class="p">][</span><span class="s1">'status'</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"DatasetImportJob: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"ACTIVE"</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"CREATE FAILED"</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

<span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Completed on: "</span><span class="p">,</span> <span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%I:%M:%S %p"</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Started on:  06:59:09 AM
DatasetImportJob: CREATE PENDING
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: ACTIVE
Completed on:  07:11:09 AM
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-solution">
<a class="anchor" href="#Create-solution" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create solution<a class="anchor-link" href="#Create-solution"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this section we will define a solution using the HRNN recipe to generate user personalization recommendation. There are several other recipes available such as HRNN-Metadata, HRNN-Coldstart etc. More information about the additional recipes can be found here:
<a href="https://docs.aws.amazon.com/personalize/latest/dg/working-with-predefined-recipes.html">https://docs.aws.amazon.com/personalize/latest/dg/working-with-predefined-recipes.html</a></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">HRNN_recipe_arn</span> <span class="o">=</span> <span class="s2">"arn:aws:personalize:::recipe/aws-hrnn"</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hrnn_create_solution_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_solution</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"personalize-devlab-hrnn"</span><span class="p">,</span>
    <span class="n">datasetGroupArn</span> <span class="o">=</span> <span class="n">dataset_group_arn</span><span class="p">,</span>
    <span class="n">recipeArn</span> <span class="o">=</span> <span class="n">HRNN_recipe_arn</span>
<span class="p">)</span>

<span class="n">hrnn_solution_arn</span> <span class="o">=</span> <span class="n">hrnn_create_solution_response</span><span class="p">[</span><span class="s1">'solutionArn'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">hrnn_create_solution_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "solutionArn": "arn:aws:personalize:us-east-2:931343413930:solution/personalize-devlab-hrnn",
  "ResponseMetadata": {
    "RequestId": "ab61bc26-fe23-471e-8ebc-9929535840c8",
    "HTTPStatusCode": 200,
    "HTTPHeaders": {
      "content-type": "application/x-amz-json-1.1",
      "date": "Thu, 16 Apr 2020 07:11:17 GMT",
      "x-amzn-requestid": "ab61bc26-fe23-471e-8ebc-9929535840c8",
      "content-length": "93",
      "connection": "keep-alive"
    },
    "RetryAttempts": 0
  }
}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-the-solution-version">
<a class="anchor" href="#Create-the-solution-version" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create the solution version<a class="anchor-link" href="#Create-the-solution-version"> </a>
</h2>
<p>In this section we will train a solution version using the dataset that we loaded and using the HRNN recipe.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hrnn_create_solution_version_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_solution_version</span><span class="p">(</span>
    <span class="n">solutionArn</span> <span class="o">=</span> <span class="n">hrnn_solution_arn</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hrnn_solution_version_arn</span> <span class="o">=</span> <span class="n">hrnn_create_solution_version_response</span><span class="p">[</span><span class="s1">'solutionVersionArn'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">hrnn_create_solution_version_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "solutionVersionArn": "arn:aws:personalize:us-east-2:931343413930:solution/personalize-devlab-hrnn/960341f6",
  "ResponseMetadata": {
    "RequestId": "007a14cd-6ac0-4248-97a0-5e666c8a03e8",
    "HTTPStatusCode": 200,
    "HTTPHeaders": {
      "content-type": "application/x-amz-json-1.1",
      "date": "Thu, 16 Apr 2020 07:11:19 GMT",
      "x-amzn-requestid": "007a14cd-6ac0-4248-97a0-5e666c8a03e8",
      "content-length": "109",
      "connection": "keep-alive"
    },
    "RetryAttempts": 0
  }
}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="CHECKPOINT-#3---Wait-for-solution-version-creation-to-be-completed">
<a class="anchor" href="#CHECKPOINT-#3---Wait-for-solution-version-creation-to-be-completed" aria-hidden="true"><span class="octicon octicon-link"></span></a>CHECKPOINT #3 - Wait for solution version creation to be completed<a class="anchor-link" href="#CHECKPOINT-#3---Wait-for-solution-version-creation-to-be-completed"> </a>
</h3>
<p>Training the solution version will take some time to complete training. <strong>Execute the following cell and wait for it to show "ACTIVE" before proceeding to the next step.</strong></p>
<h4 id="Viewing-Solution-Creation-Status">
<a class="anchor" href="#Viewing-Solution-Creation-Status" aria-hidden="true"><span class="octicon octicon-link"></span></a>Viewing Solution Creation Status<a class="anchor-link" href="#Viewing-Solution-Creation-Status"> </a>
</h4>
<p>You can also view the status updates in the console. To do so,</p>
<ul>
<li>In another browser tab you should already have the AWS Console up from opening this notebook instance. </li>
<li>Switch to that tab and search at the top for the service <code>Personalize</code>, then go to that service page. </li>
<li>Click <code>View dataset groups</code>.</li>
<li>Click the name of your dataset group, most likely something with DevLab in the name.</li>
<li>Click <code>Solutions and recipes</code>.</li>
<li>You will now see a list of all of the solutions you created above. Click any one of them. </li>
<li>Note in <code>Solution versions</code> the job that is in progress. Once it is <code>Active</code> you solution is ready to be reviewed. It is also capable of being deployed.</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Started on: "</span><span class="p">,</span> <span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%I:%M:%S %p"</span><span class="p">))</span>

<span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_solution_version_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_solution_version</span><span class="p">(</span>
        <span class="n">solutionVersionArn</span> <span class="o">=</span> <span class="n">hrnn_solution_version_arn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_solution_version_response</span><span class="p">[</span><span class="s2">"solutionVersion"</span><span class="p">][</span><span class="s1">'status'</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"SolutionVersion Status: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"ACTIVE"</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"CREATE FAILED"</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
    
<span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Completed on: "</span><span class="p">,</span> <span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%I:%M:%S %p"</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Started on:  07:11:21 AM
SolutionVersion Status: CREATE PENDING
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: CREATE IN_PROGRESS
SolutionVersion Status: ACTIVE
Completed on:  07:45:24 AM
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Evaluate-solution-metrics">
<a class="anchor" href="#Evaluate-solution-metrics" aria-hidden="true"><span class="octicon octicon-link"></span></a>Evaluate solution metrics<a class="anchor-link" href="#Evaluate-solution-metrics"> </a>
</h2>
<p>In this section we will run the function to get the solution metrics. More information about the Personalize solution metrics can be found here: <a href="https://docs.aws.amazon.com/personalize/latest/dg/working-with-training-metrics.html">https://docs.aws.amazon.com/personalize/latest/dg/working-with-training-metrics.html</a></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hrnn_solution_metrics_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">get_solution_metrics</span><span class="p">(</span>
    <span class="n">solutionVersionArn</span> <span class="o">=</span> <span class="n">hrnn_solution_version_arn</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">hrnn_solution_metrics_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "solutionVersionArn": "arn:aws:personalize:us-east-2:931343413930:solution/personalize-devlab-hrnn/960341f6",
  "metrics": {
    "coverage": 0.0149,
    "mean_reciprocal_rank_at_25": 0.0241,
    "normalized_discounted_cumulative_gain_at_10": 0.0267,
    "normalized_discounted_cumulative_gain_at_25": 0.0544,
    "normalized_discounted_cumulative_gain_at_5": 0.0174,
    "precision_at_10": 0.0091,
    "precision_at_25": 0.0095,
    "precision_at_5": 0.0109
  },
  "ResponseMetadata": {
    "RequestId": "85884607-49b5-44a8-9459-83a61b954ade",
    "HTTPStatusCode": 200,
    "HTTPHeaders": {
      "content-type": "application/x-amz-json-1.1",
      "date": "Thu, 16 Apr 2020 07:45:56 GMT",
      "x-amzn-requestid": "85884607-49b5-44a8-9459-83a61b954ade",
      "content-length": "407",
      "connection": "keep-alive"
    },
    "RetryAttempts": 0
  }
}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Batch-Recommendation">
<a class="anchor" href="#Batch-Recommendation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Batch Recommendation<a class="anchor-link" href="#Batch-Recommendation"> </a>
</h2>
<p>In the section, we will generate a random sample of users to generate batch recommendations for.</p>
<p>First, we will load the movie database so that we can visualize the recommended movie.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s1">'/ml-latest-small/movies.csv'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Render some sample data</span>
<span class="n">items_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>genres</th>
    </tr>
    <tr>
      <th>movieId</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Toy Story (1995)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Jumanji (1995)</td>
      <td>Adventure|Children|Fantasy</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Grumpier Old Men (1995)</td>
      <td>Comedy|Romance</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Waiting to Exhale (1995)</td>
      <td>Comedy|Drama|Romance</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Father of the Bride Part II (1995)</td>
      <td>Comedy</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_movie_by_id</span><span class="p">(</span><span class="n">movie_id</span><span class="p">,</span> <span class="n">movie_df</span><span class="o">=</span><span class="n">items_df</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">movie_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">movie_id</span><span class="p">)][</span><span class="s1">'title'</span><span class="p">]</span> <span class="o">+</span> <span class="s2">" - "</span> <span class="o">+</span> <span class="n">movie_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">movie_id</span><span class="p">)][</span><span class="s1">'genres'</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">"Error obtaining movie"</span> <span class="o">+</span> <span class="n">movie_id</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">users_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s1">'/ml-latest-small/ratings.csv'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">batch_users</span> <span class="o">=</span> <span class="n">users_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Write the file to disk</span>
<span class="n">json_input_filename</span> <span class="o">=</span> <span class="s2">"json_input.json"</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="n">json_input_filename</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_input</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">batch_users</span><span class="p">:</span>
        <span class="n">json_input</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'{"userId": "'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'"}</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat <span class="nv">$data_dir</span><span class="s2">"/"</span><span class="nv">$json_input_filename</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{"userId": "302"}
{"userId": "393"}
{"userId": "57"}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Upload the users generate batch recommendations for to S3</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">'s3'</span><span class="p">)</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">json_input_filename</span><span class="p">)</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">data_dir</span><span class="o">+</span><span class="s2">"/"</span><span class="o">+</span><span class="n">json_input_filename</span><span class="p">)</span>
<span class="n">s3_input_path</span> <span class="o">=</span> <span class="s2">"s3://"</span> <span class="o">+</span> <span class="n">bucket_name</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="n">json_input_filename</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s3_input_path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>s3://931343413930personalizedevlab/json_input.json
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the next cell, we define output bucket of where we will store the batch recommendation results.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s3_output_path</span> <span class="o">=</span> <span class="s2">"s3://"</span> <span class="o">+</span> <span class="n">bucket_name</span> <span class="o">+</span> <span class="s2">"/"</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s3_output_path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>s3://931343413930personalizedevlab/
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Run the batch inference process</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">batchInferenceJobArn</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_batch_inference_job</span> <span class="p">(</span>
    <span class="n">solutionVersionArn</span> <span class="o">=</span> <span class="n">hrnn_solution_version_arn</span><span class="p">,</span>
    <span class="n">jobName</span> <span class="o">=</span> <span class="s2">"Personalize-devlab-Batch-Inference-Job-HRNN"</span><span class="o">+</span><span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%I%M%S"</span><span class="p">),</span>
    <span class="n">roleArn</span> <span class="o">=</span> <span class="n">role_arn</span><span class="p">,</span>
    <span class="n">jobInput</span> <span class="o">=</span> 
     <span class="p">{</span><span class="s2">"s3DataSource"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"path"</span><span class="p">:</span> <span class="n">s3_input_path</span><span class="p">}},</span>
    <span class="n">jobOutput</span> <span class="o">=</span> 
     <span class="p">{</span><span class="s2">"s3DataDestination"</span><span class="p">:{</span><span class="s2">"path"</span><span class="p">:</span> <span class="n">s3_output_path</span><span class="p">}}</span>
<span class="p">)</span>
<span class="n">batchInferenceJobArn</span> <span class="o">=</span> <span class="n">batchInferenceJobArn</span><span class="p">[</span><span class="s1">'batchInferenceJobArn'</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="CHECKPOINT-#4---Wait-for-batch-recommendation-job-to-complete">
<a class="anchor" href="#CHECKPOINT-#4---Wait-for-batch-recommendation-job-to-complete" aria-hidden="true"><span class="octicon octicon-link"></span></a>CHECKPOINT #4 - Wait for batch recommendation job to complete<a class="anchor-link" href="#CHECKPOINT-#4---Wait-for-batch-recommendation-job-to-complete"> </a>
</h3>
<p>It can take a while before the batch recommendation job completes. <strong>Execute the following cell and wait for it to show "ACTIVE" before proceeding to the next step.</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Import Started on: "</span><span class="p">,</span> <span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%I:%M:%S %p"</span><span class="p">))</span>

<span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_dataset_inference_job_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_batch_inference_job</span><span class="p">(</span>
        <span class="n">batchInferenceJobArn</span> <span class="o">=</span> <span class="n">batchInferenceJobArn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_dataset_inference_job_response</span><span class="p">[</span><span class="s2">"batchInferenceJob"</span><span class="p">][</span><span class="s1">'status'</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"DatasetInferenceJob: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"ACTIVE"</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"CREATE FAILED"</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
    
<span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Import Completed on: "</span><span class="p">,</span> <span class="n">current_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%I:%M:%S %p"</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Import Started on:  07:49:42 AM
DatasetInferenceJob: CREATE PENDING
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: CREATE IN_PROGRESS
DatasetInferenceJob: ACTIVE
Import Completed on:  08:14:43 AM
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Download and Visualize batch recommendation</strong></p>
<p>Once the batch recommendation job has been completed, we will now download and visualize the results from the batch job.</p>
<p>The results of the batch job will be stored in the S3 output folder that was specified earlier. It will be returned in a json format similar to the following:</p>

<pre><code>{"input":{"userId":"448"},"output":{"recommendedItems":["5810","53322","2003","6957","92535","8917","3105","6873","1249","26133","2657","4865","2420","1345","4621","34437","2010","4128","2076","1203","52973","4246","2871","8641","162"],"scores":[0.0031413,0.0022093,0.0021377,0.0020497,0.001922,0.0018058,0.0017834,0.0017671,0.0017457,0.0016255,0.0015854,0.001539,0.0014838,0.0014573,0.001374,0.001372,0.0013563,0.0013385,0.0013196,0.0013065,0.0012714,0.0012507,0.001228,0.0012243,0.0012083]},"error":null}
{"input":{"userId":"409"},"output":{"recommendedItems":["2571","50","527","296","1196","111","110","1258","2858","1214","6874","1265","648","750","912","588","608","2329","858","2762","1291","541","1387","260","1200"],"scores":[0.0151337,0.0129099,0.0094722,0.0081178,0.0070135,0.0061934,0.0059672,0.0049986,0.0048773,0.0048134,0.0046837,0.0044422,0.0044251,0.0042917,0.0042376,0.0042309,0.0039795,0.0038287,0.0037793,0.0036532,0.0036527,0.0035218,0.0035178,0.0034306,0.0034158]},"error":null}
{"input":{"userId":"288"},"output":{"recommendedItems":["5989","49272","6377","4963","4995","68157","4886","48394","8368","80463","54001","8961","91658","8950","5418","5445","109374","8360","1136","81834","5618","1265","48780","8949","4720"],"scores":[0.0177912,0.0114374,0.0107343,0.0098669,0.009329,0.0067548,0.0057784,0.0057611,0.0056522,0.0053493,0.0050671,0.0050291,0.0047089,0.0046453,0.0045933,0.0045281,0.0041894,0.0040642,0.0040296,0.003935,0.0037718,0.0036896,0.0036616,0.0036362,0.0036019]},"error":null}</code></pre>
<p>An typical use case for this is to use the batch recommendation output to generate a personalized recommendation email that can be fed into a popular email marketing service such as <strong><a href="https://aws.amazon.com/pinpoint/">Amazon Pinpoint</a></strong> or your favourate email marketing service.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">'s3'</span><span class="p">)</span>
<span class="n">export_name</span> <span class="o">=</span> <span class="n">json_input_filename</span> <span class="o">+</span> <span class="s2">".out"</span>
<span class="n">s3</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">export_name</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">+</span><span class="s2">"/"</span><span class="o">+</span><span class="n">export_name</span><span class="p">)</span>

<span class="c1"># Update DF rendering</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_rows'</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_dir</span><span class="o">+</span><span class="s2">"/"</span><span class="o">+</span><span class="n">export_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
    <span class="c1"># Get the first line and parse it</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_file</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
    <span class="c1"># Do the same for the other lines</span>
    <span class="k">while</span> <span class="n">line</span><span class="p">:</span>
        <span class="c1"># extract the user ID </span>
        <span class="n">col_header</span> <span class="o">=</span> <span class="s2">"User: "</span> <span class="o">+</span> <span class="n">line</span><span class="p">[</span><span class="s1">'input'</span><span class="p">][</span><span class="s1">'userId'</span><span class="p">]</span>
        <span class="c1"># Create a list for all the artists</span>
        <span class="n">recommendation_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Add all the entries</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="s1">'output'</span><span class="p">][</span><span class="s1">'recommendedItems'</span><span class="p">]:</span>
            <span class="n">movie</span> <span class="o">=</span> <span class="n">get_movie_by_id</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">recommendation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">'bulk_recommendations_df'</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
            <span class="n">new_rec_DF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendation_list</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col_header</span><span class="p">])</span>
            <span class="n">bulk_recommendations_df</span> <span class="o">=</span> <span class="n">bulk_recommendations_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_rec_DF</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bulk_recommendations_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendation_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col_header</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_file</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">bulk_recommendations_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>User: 302</th>
      <th>User: 393</th>
      <th>User: 57</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Braveheart (1995) - Action|Drama|War</td>
      <td>Star Trek: First Contact (1996) - Action|Adven...</td>
      <td>Pulp Fiction (1994) - Comedy|Crime|Drama|Thriller</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Raiders of the Lost Ark (Indiana Jones and the...</td>
      <td>Harry Potter and the Sorcerer's Stone (a.k.a. ...</td>
      <td>Star Trek: First Contact (1996) - Action|Adven...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Lord of the Rings: The Fellowship of the Ring,...</td>
      <td>Pulp Fiction (1994) - Comedy|Crime|Drama|Thriller</td>
      <td>Harry Potter and the Sorcerer's Stone (a.k.a. ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Seven (a.k.a. Se7en) (1995) - Mystery|Thriller</td>
      <td>Heat (1995) - Action|Crime|Thriller</td>
      <td>Heat (1995) - Action|Crime|Thriller</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Die Hard: With a Vengeance (1995) - Action|Cri...</td>
      <td>2001: A Space Odyssey (1968) - Adventure|Drama...</td>
      <td>X-Men (2000) - Action|Adventure|Sci-Fi</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Shawshank Redemption, The (1994) - Crime|Drama</td>
      <td>Shrek (2001) - Adventure|Animation|Children|Co...</td>
      <td>2001: A Space Odyssey (1968) - Adventure|Drama...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Terminator 2: Judgment Day (1991) - Action|Sci-Fi</td>
      <td>Avatar (2009) - Action|Adventure|Sci-Fi|IMAX</td>
      <td>Forrest Gump (1994) - Comedy|Drama|Romance|War</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Jurassic Park (1993) - Action|Adventure|Sci-Fi...</td>
      <td>Fifth Element, The (1997) - Action|Adventure|C...</td>
      <td>Avatar (2009) - Action|Adventure|Sci-Fi|IMAX</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Star Wars: Episode IV - A New Hope (1977) - Ac...</td>
      <td>X-Men (2000) - Action|Adventure|Sci-Fi</td>
      <td>Fifth Element, The (1997) - Action|Adventure|C...</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Schindler's List (1993) - Drama|War</td>
      <td>Dead Poets Society (1989) - Drama</td>
      <td>Dead Poets Society (1989) - Drama</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Star Wars: Episode V - The Empire Strikes Back...</td>
      <td>Harry Potter and the Chamber of Secrets (2002)...</td>
      <td>Shrek (2001) - Adventure|Animation|Children|Co...</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Indiana Jones and the Last Crusade (1989) - Ac...</td>
      <td>Green Mile, The (1999) - Crime|Drama</td>
      <td>Harry Potter and the Chamber of Secrets (2002)...</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Gladiator (2000) - Action|Adventure|Drama</td>
      <td>Rear Window (1954) - Mystery|Thriller</td>
      <td>Rear Window (1954) - Mystery|Thriller</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Crimson Tide (1995) - Drama|Thriller|War</td>
      <td>Ratatouille (2007) - Animation|Children|Drama</td>
      <td>Bourne Identity, The (2002) - Action|Mystery|T...</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Star Wars: Episode VI - Return of the Jedi (19...</td>
      <td>28 Days Later (2002) - Action|Horror|Sci-Fi</td>
      <td>Willy Wonka &amp; the Chocolate Factory (1971) - C...</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Usual Suspects, The (1995) - Crime|Mystery|Thr...</td>
      <td>Spider-Man (2002) - Action|Adventure|Sci-Fi|Th...</td>
      <td>Green Mile, The (1999) - Crime|Drama</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Fugitive, The (1993) - Thriller</td>
      <td>Inside Out (2015) - Adventure|Animation|Childr...</td>
      <td>Patriot, The (2000) - Action|Drama|War</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Saving Private Ryan (1998) - Action|Drama|War</td>
      <td>Dark Knight Rises, The (2012) - Action|Adventu...</td>
      <td>Spider-Man (2002) - Action|Adventure|Sci-Fi|Th...</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Aladdin (1992) - Adventure|Animation|Children|...</td>
      <td>Patriot, The (2000) - Action|Drama|War</td>
      <td>Indiana Jones and the Temple of Doom (1984) - ...</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Silence of the Lambs, The (1991) - Crime|Horro...</td>
      <td>Scarface (1983) - Action|Crime|Drama</td>
      <td>Ratatouille (2007) - Animation|Children|Drama</td>
    </tr>
    <tr>
      <th>20</th>
      <td>True Lies (1994) - Action|Adventure|Comedy|Rom...</td>
      <td>Bourne Identity, The (2002) - Action|Mystery|T...</td>
      <td>Breakfast Club, The (1985) - Comedy|Drama</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Lion King, The (1994) - Adventure|Animation|Ch...</td>
      <td>Forrest Gump (1994) - Comedy|Drama|Romance|War</td>
      <td>Die Hard (1988) - Action|Crime|Thriller</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Inception (2010) - Action|Crime|Drama|Mystery|...</td>
      <td>Beautiful Mind, A (2001) - Drama|Romance</td>
      <td>Beautiful Mind, A (2001) - Drama|Romance</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Dark Knight, The (2008) - Action|Crime|Drama|IMAX</td>
      <td>Breakfast Club, The (1985) - Comedy|Drama</td>
      <td>Dark Knight Rises, The (2012) - Action|Adventu...</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Die Hard (1988) - Action|Crime|Thriller</td>
      <td>Willy Wonka &amp; the Chocolate Factory (1971) - C...</td>
      <td>Spirited Away (Sen to Chihiro no kamikakushi) ...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Congratulations, you have now completed the lab. You can either continue to the challenge section to see if you can improve the model by using a larger dataset or proceed to the cleanup section to delete the resources from this lab.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Challenge">
<a class="anchor" href="#Challenge" aria-hidden="true"><span class="octicon octicon-link"></span></a>Challenge<a class="anchor-link" href="#Challenge"> </a>
</h2>
<p>Before wrapping up the lab, let's see if you can try and improve the recommendation accuracy by usingn the large dataset from <a href="https://grouplens.org/datasets/movielens/">movielens</a>.</p>
<p>You can use the same dataset group, however, please note that you don't need to redefine the data set schema.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Cleanup">
<a class="anchor" href="#Cleanup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cleanup<a class="anchor-link" href="#Cleanup"> </a>
</h2>
<p><strong>IMPORTANT</strong>
Once you're done with the lab, the final step is to clean up your environment by decommissioning the resources we created for this devlab. Please run the following cells in the following order to clean up your environment.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>1. Delete the solution</strong></p>
<p>Delete the HRNN solution we created for the Personalize dataset group</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">personalize</span><span class="o">.</span><span class="n">delete_solution</span><span class="p">(</span>
    <span class="n">solutionArn</span> <span class="o">=</span> <span class="n">hrnn_solution_arn</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>2. Delete the dataset</strong></p>
<p>Delete the datasets created for the personalize dataset group.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">personalize</span><span class="o">.</span><span class="n">delete_dataset</span><span class="p">(</span>
    <span class="n">datasetArn</span> <span class="o">=</span> <span class="n">dataset_arn</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Run the following cell to verify that non-required dataset has been deleted and if required run the subsequent cell with the correct ARN.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">paginator</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">get_paginator</span><span class="p">(</span><span class="s1">'list_datasets'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">paginate_result</span> <span class="ow">in</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">datasets</span> <span class="ow">in</span> <span class="n">paginate_result</span><span class="p">[</span><span class="s2">"datasets"</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">datasets</span><span class="p">[</span><span class="s2">"datasetArn"</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">personalize</span><span class="o">.</span><span class="n">delete_dataset</span><span class="p">(</span>
    <span class="n">datasetArn</span> <span class="o">=</span> <span class="s2">"INSERT ARN HERE"</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>3. Delete the schema</strong></p>
<p>Delete the personalize schema used for the datasets.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">personalize</span><span class="o">.</span><span class="n">delete_schema</span><span class="p">(</span>
    <span class="n">schemaArn</span> <span class="o">=</span> <span class="n">schema_arn</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Run the following cell to verify that non-required schema has been deleted and if required run the subsequent cell with the correct ARN.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">paginator</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">get_paginator</span><span class="p">(</span><span class="s1">'list_schemas'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">paginate_result</span> <span class="ow">in</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="n">paginate_result</span><span class="p">[</span><span class="s2">"schemas"</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">schema</span><span class="p">[</span><span class="s2">"schemaArn"</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">personalize</span><span class="o">.</span><span class="n">delete_schema</span><span class="p">(</span>
    <span class="n">schemaArn</span> <span class="o">=</span> <span class="s2">"INSERT ARN HERE"</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>4. Delete the dataset group</strong></p>
<p>Deletes the personalize dataset group</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">personalize</span><span class="o">.</span><span class="n">delete_dataset_group</span><span class="p">(</span>
    <span class="n">datasetGroupArn</span> <span class="o">=</span> <span class="n">dataset_group_arn</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>5. Detach the policy from the personalize devlab role</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iam</span><span class="o">.</span><span class="n">detach_role_policy</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="s2">"PersonalizeRoleDevLab"</span><span class="p">,</span>
    <span class="n">PolicyArn</span> <span class="o">=</span> <span class="s2">"arn:aws:iam::aws:policy/AmazonS3FullAccess"</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iam</span><span class="o">.</span><span class="n">detach_role_policy</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="s2">"PersonalizeRoleDevLab"</span><span class="p">,</span>
    <span class="n">PolicyArn</span> <span class="o">=</span> <span class="s2">"arn:aws:iam::aws:policy/service-role/AmazonPersonalizeFullAccess"</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check that all policies have been detached from the role, if not run the subsequent cell to detached the appropriate roles</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iam</span><span class="o">.</span><span class="n">list_attached_role_policies</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="s2">"PersonalizeRoleDevLab"</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iam</span><span class="o">.</span><span class="n">detach_role_policy</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="s2">"PersonalizeRoleDevLab"</span><span class="p">,</span>
    <span class="n">PolicyArn</span> <span class="o">=</span> <span class="s2">"INSERT ARN HERE"</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>6. Delete the IAM role</strong></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iam</span><span class="o">.</span><span class="n">delete_role</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="s2">"PersonalizeRoleDevLab"</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="recohut/notebook"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/amazonpersonalize/batch/movie/hrnn/2021/06/20/amazon-personalize-batch-job.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Jupyter notebook database.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/recohut" target="_blank" title="recohut"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
