<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Amazon Personalize Workshop Part 4 - Security best practices (optional) | reconb</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Amazon Personalize Workshop Part 4 - Security best practices (optional)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="We are using a pre-made dataset that hasn’t been encrypted so there is no need to decrypt this dataset. However, it would be a good security practice to store your datasets encrypted." />
<meta property="og:description" content="We are using a pre-made dataset that hasn’t been encrypted so there is no need to decrypt this dataset. However, it would be a good security practice to store your datasets encrypted." />
<link rel="canonical" href="https://nb.recohut.com/amazonpersonalize/movie/security/privacy/2021/06/20/amazon-personalize-workshop-part-4.html" />
<meta property="og:url" content="https://nb.recohut.com/amazonpersonalize/movie/security/privacy/2021/06/20/amazon-personalize-workshop-part-4.html" />
<meta property="og:site_name" content="reconb" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-06-20T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Amazon Personalize Workshop Part 4 - Security best practices (optional)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-06-20T00:00:00-05:00","datePublished":"2021-06-20T00:00:00-05:00","description":"We are using a pre-made dataset that hasn’t been encrypted so there is no need to decrypt this dataset. However, it would be a good security practice to store your datasets encrypted.","headline":"Amazon Personalize Workshop Part 4 - Security best practices (optional)","mainEntityOfPage":{"@type":"WebPage","@id":"https://nb.recohut.com/amazonpersonalize/movie/security/privacy/2021/06/20/amazon-personalize-workshop-part-4.html"},"url":"https://nb.recohut.com/amazonpersonalize/movie/security/privacy/2021/06/20/amazon-personalize-workshop-part-4.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nb.recohut.com/feed.xml" title="reconb" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">reconb</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Amazon Personalize Workshop Part 4 - Security best practices (optional)</h1><p class="page-description">We are using a pre-made dataset that hasn't been encrypted so there is no need to decrypt this dataset. However, it would be a good security practice to store your datasets encrypted.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-06-20T00:00:00-05:00" itemprop="datePublished">
        Jun 20, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      11 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#amazonpersonalize">amazonpersonalize</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#movie">movie</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#security">security</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#privacy">privacy</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/recohut/notebook/tree/master/_notebooks/2021-06-20-amazon-personalize-workshop-part-4.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/recohut/notebook/master?filepath=_notebooks%2F2021-06-20-amazon-personalize-workshop-part-4.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/recohut/notebook/blob/master/_notebooks/2021-06-20-amazon-personalize-workshop-part-4.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Frecohut%2Fnotebook%2Fblob%2Fmaster%2F_notebooks%2F2021-06-20-amazon-personalize-workshop-part-4.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h3"><a href="#Get-the-Personalize-boto3-Client">Get the Personalize boto3 Client </a></li>
<li class="toc-entry toc-h3"><a href="#Specify-a-Bucket-and-Data-Output-Location">Specify a Bucket and Data Output Location </a></li>
<li class="toc-entry toc-h3"><a href="#Download,-Prepare,-and-Upload-Training-Data">Download, Prepare, and Upload Training Data </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Download-and-Explore-the-Dataset">Download and Explore the Dataset </a></li>
<li class="toc-entry toc-h4"><a href="#Optional-security-practice:-Protect-data-at-rest---Encrypt/decrypt-your-dataset">Optional security practice: Protect data at rest - Encrypt/decrypt your dataset </a></li>
<li class="toc-entry toc-h4"><a href="#Optional-security-practice:-Protect-data-in-transit---SSL-access-only-for-S3-bucket">Optional security practice: Protect data in transit - SSL access only for S3 bucket </a></li>
<li class="toc-entry toc-h4"><a href="#Additional-security-note:">Additional security note: </a></li>
<li class="toc-entry toc-h4"><a href="#Optional-security-practice:-validate-bucket-owner-matches-your-account-canonical-id">Optional security practice: validate bucket owner matches your account canonical id </a></li>
<li class="toc-entry toc-h4"><a href="#Optional-security-practice:-Protect-data-integrity---Enable-S3-bucket-versioning">Optional security practice: Protect data integrity - Enable S3 bucket versioning </a></li>
<li class="toc-entry toc-h4"><a href="#Prepare-and-Upload-Data">Prepare and Upload Data </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#Create-Schema">Create Schema </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Optional-security-practice---Protect-data-at-rest---Encrypt-datasets-under-Personalize">Optional security practice - Protect data at rest - Encrypt datasets under Personalize </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#Create-and-Wait-for-Encrypted-Dataset-Group">Create and Wait for Encrypted Dataset Group </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Create-Encrypted-Dataset-Group">Create Encrypted Dataset Group </a></li>
<li class="toc-entry toc-h4"><a href="#Wait-for-Dataset-Group-to-Have-ACTIVE-Status">Wait for Dataset Group to Have ACTIVE Status </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#Create-Dataset">Create Dataset </a></li>
<li class="toc-entry toc-h3"><a href="#Prepare,-Create,-and-Wait-for-Dataset-Import-Job">Prepare, Create, and Wait for Dataset Import Job </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Attach-Policy-to-S3-Bucket">Attach Policy to S3 Bucket </a></li>
<li class="toc-entry toc-h4"><a href="#Create-Personalize-Role">Create Personalize Role </a></li>
<li class="toc-entry toc-h4"><a href="#Create-Dataset-Import-Job">Create Dataset Import Job </a></li>
<li class="toc-entry toc-h4"><a href="#Wait-for-Dataset-Import-Job-to-Have-ACTIVE-Status">Wait for Dataset Import Job to Have ACTIVE Status </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#Select-Recipe">Select Recipe </a></li>
<li class="toc-entry toc-h3"><a href="#Create-and-Wait-for-Solution">Create and Wait for Solution </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Create-Solution">Create Solution </a></li>
<li class="toc-entry toc-h4"><a href="#Create-Solution-Version">Create Solution Version </a></li>
<li class="toc-entry toc-h4"><a href="#Wait-for-Solution-Version-to-Have-ACTIVE-Status">Wait for Solution Version to Have ACTIVE Status </a></li>
<li class="toc-entry toc-h4"><a href="#Get-Metrics-of-Solution">Get Metrics of Solution </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#Create-and-Wait-for-Campaign">Create and Wait for Campaign </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Create-Campaign">Create Campaign </a></li>
<li class="toc-entry toc-h4"><a href="#Wait-for-Campaign-to-Have-ACTIVE-Status">Wait for Campaign to Have ACTIVE Status </a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#Get-Recommendations">Get Recommendations </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Select-a-User-and-an-Item">Select a User and an Item </a></li>
<li class="toc-entry toc-h4"><a href="#Call-GetRecommendations">Call GetRecommendations </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-06-20-amazon-personalize-workshop-part-4.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Get-the-Personalize-boto3-Client">
<a class="anchor" href="#Get-the-Personalize-boto3-Client" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get the Personalize boto3 Client<a class="anchor-link" href="#Get-the-Personalize-boto3-Client"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">boto3</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">personalize</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">'personalize'</span><span class="p">)</span>
<span class="n">personalize_runtime</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">'personalize-runtime'</span><span class="p">)</span>
<span class="n">iam</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">"iam"</span><span class="p">)</span>
<span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">"s3"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Specify-a-Bucket-and-Data-Output-Location">
<a class="anchor" href="#Specify-a-Bucket-and-Data-Output-Location" aria-hidden="true"><span class="octicon octicon-link"></span></a>Specify a Bucket and Data Output Location<a class="anchor-link" href="#Specify-a-Bucket-and-Data-Output-Location"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bucket</span> <span class="o">=</span> <span class="s2">"personalize-demo"</span>       <span class="c1"># replace with the name of your S3 bucket</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">"movie-lens-100k.csv"</span>  <span class="c1"># replace with a name that you want to save the dataset under</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Download,-Prepare,-and-Upload-Training-Data">
<a class="anchor" href="#Download,-Prepare,-and-Upload-Training-Data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download, Prepare, and Upload Training Data<a class="anchor-link" href="#Download,-Prepare,-and-Upload-Training-Data"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Download-and-Explore-the-Dataset">
<a class="anchor" href="#Download-and-Explore-the-Dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download and Explore the Dataset<a class="anchor-link" href="#Download-and-Explore-the-Dataset"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>wget -N http://files.grouplens.org/datasets/movielens/ml-100k.zip
<span class="o">!</span>unzip -o ml-100k.zip
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'./ml-100k/u.data'</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">'</span><span class="se">\t</span><span class="s1">'</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">'USER_ID'</span><span class="p">,</span> <span class="s1">'ITEM_ID'</span><span class="p">,</span> <span class="s1">'RATING'</span><span class="p">,</span> <span class="s1">'TIMESTAMP'</span><span class="p">])</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_rows'</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>--2020-05-05 09:38:29--  http://files.grouplens.org/datasets/movielens/ml-100k.zip
Resolving files.grouplens.org (files.grouplens.org)... 128.101.65.152
Connecting to files.grouplens.org (files.grouplens.org)|128.101.65.152|:80... connected.
HTTP request sent, awaiting response... 304 Not Modified
File ‘ml-100k.zip’ not modified on server. Omitting download.

Archive:  ml-100k.zip
  inflating: ml-100k/allbut.pl       
  inflating: ml-100k/mku.sh          
  inflating: ml-100k/README          
  inflating: ml-100k/u.data          
  inflating: ml-100k/u.genre         
  inflating: ml-100k/u.info          
  inflating: ml-100k/u.item          
  inflating: ml-100k/u.occupation    
  inflating: ml-100k/u.user          
  inflating: ml-100k/u1.base         
  inflating: ml-100k/u1.test         
  inflating: ml-100k/u2.base         
  inflating: ml-100k/u2.test         
  inflating: ml-100k/u3.base         
  inflating: ml-100k/u3.test         
  inflating: ml-100k/u4.base         
  inflating: ml-100k/u4.test         
  inflating: ml-100k/u5.base         
  inflating: ml-100k/u5.test         
  inflating: ml-100k/ua.base         
  inflating: ml-100k/ua.test         
  inflating: ml-100k/ub.base         
  inflating: ml-100k/ub.test         
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USER_ID</th>
      <th>ITEM_ID</th>
      <th>RATING</th>
      <th>TIMESTAMP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>196</td>
      <td>242</td>
      <td>3</td>
      <td>881250949</td>
    </tr>
    <tr>
      <th>1</th>
      <td>186</td>
      <td>302</td>
      <td>3</td>
      <td>891717742</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>99998</th>
      <td>13</td>
      <td>225</td>
      <td>2</td>
      <td>882399156</td>
    </tr>
    <tr>
      <th>99999</th>
      <td>12</td>
      <td>203</td>
      <td>3</td>
      <td>879959583</td>
    </tr>
  </tbody>
</table>
<p>100000 rows × 4 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Optional-security-practice:-Protect-data-at-rest---Encrypt/decrypt-your-dataset">
<a class="anchor" href="#Optional-security-practice:-Protect-data-at-rest---Encrypt/decrypt-your-dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Optional security practice: Protect data at rest - Encrypt/decrypt your dataset<a class="anchor-link" href="#Optional-security-practice:-Protect-data-at-rest---Encrypt/decrypt-your-dataset"> </a>
</h4>
<p>We are using a pre-made dataset that hasn't been encrypted so there is no need to decrypt this dataset. However, it would be a good security practice to store your datasets encrypted.</p>
<p>For more information on encrypting your data when using S3, visit <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/KMSUsingRESTAPI.html">https://docs.aws.amazon.com/AmazonS3/latest/dev/KMSUsingRESTAPI.html</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Optional-security-practice:-Protect-data-in-transit---SSL-access-only-for-S3-bucket">
<a class="anchor" href="#Optional-security-practice:-Protect-data-in-transit---SSL-access-only-for-S3-bucket" aria-hidden="true"><span class="octicon octicon-link"></span></a>Optional security practice: Protect data in transit - SSL access only for S3 bucket<a class="anchor-link" href="#Optional-security-practice:-Protect-data-in-transit---SSL-access-only-for-S3-bucket"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">requires_ssl_access_policy</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"Version"</span><span class="p">:</span> <span class="s2">"2012-10-17"</span><span class="p">,</span>
    <span class="s2">"Id"</span><span class="p">:</span> <span class="s2">"RequireSSLAccess"</span><span class="p">,</span>
    <span class="s2">"Statement"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"Sid"</span><span class="p">:</span> <span class="s2">"RequireSSLAccess"</span><span class="p">,</span>
            <span class="s2">"Effect"</span><span class="p">:</span> <span class="s2">"Deny"</span><span class="p">,</span>
            <span class="s2">"Principal"</span><span class="p">:</span> <span class="s2">"*"</span><span class="p">,</span>
            <span class="s2">"Action"</span><span class="p">:</span> <span class="s2">"*"</span><span class="p">,</span>
            <span class="s2">"Resource"</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">"arn:aws:s3:::</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">),</span>
                <span class="s2">"arn:aws:s3:::</span><span class="si">{}</span><span class="s2">/*"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="s2">"Condition"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"Bool"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"aws:SecureTransport"</span><span class="p">:</span> <span class="s2">"false"</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">s3</span><span class="o">.</span><span class="n">put_bucket_policy</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Policy</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">requires_ssl_access_policy</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{'ResponseMetadata': {'RequestId': 'FA2BA6A24A738415',
  'HostId': 'PWU2HsPCLALBFzYHzVEUK5EuODQkMTrj2l9IuCs3x+GBDlM24tg2k4BF1fMlnmzCAwy/KRVplQw=',
  'HTTPStatusCode': 204,
  'HTTPHeaders': {'x-amz-id-2': 'PWU2HsPCLALBFzYHzVEUK5EuODQkMTrj2l9IuCs3x+GBDlM24tg2k4BF1fMlnmzCAwy/KRVplQw=',
   'x-amz-request-id': 'FA2BA6A24A738415',
   'date': 'Tue, 05 May 2020 16:38:34 GMT',
   'server': 'AmazonS3'},
  'RetryAttempts': 0}}</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Additional-security-note:">
<a class="anchor" href="#Additional-security-note:" aria-hidden="true"><span class="octicon octicon-link"></span></a>Additional security note:<a class="anchor-link" href="#Additional-security-note:"> </a>
</h4>
<p>Some users prevent accidental information disclosure by limiting S3 access to only come from a VPC. Another common security practice is to validate this limited access. It should be noted that this security check will fail when performed against S3 buckets used for Personalize - as Personalize copies data from the user's S3 into the internal systems used by Personalize (during dataset import jobs).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Optional-security-practice:-validate-bucket-owner-matches-your-account-canonical-id">
<a class="anchor" href="#Optional-security-practice:-validate-bucket-owner-matches-your-account-canonical-id" aria-hidden="true"><span class="octicon octicon-link"></span></a>Optional security practice: validate bucket owner matches your account canonical id<a class="anchor-link" href="#Optional-security-practice:-validate-bucket-owner-matches-your-account-canonical-id"> </a>
</h4>
<p><a href="https://docs.aws.amazon.com/general/latest/gr/acct-identifiers.html#FindingCanonicalId">More information about canonical ids here</a></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bucket_owner_id</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">'s3'</span><span class="p">)</span><span class="o">.</span><span class="n">get_bucket_acl</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">)[</span><span class="s1">'Owner'</span><span class="p">][</span><span class="s1">'ID'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"This bucket belongs to: </span><span class="si">{}</span><span class="s2"> "</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket_owner_id</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>This bucket belongs to: 28398dc6b1acac01a4a73b246b5f9c9a688f50b9ce70240f74c0f90ebf5e2c61 
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Optional-security-practice:-Protect-data-integrity---Enable-S3-bucket-versioning">
<a class="anchor" href="#Optional-security-practice:-Protect-data-integrity---Enable-S3-bucket-versioning" aria-hidden="true"><span class="octicon octicon-link"></span></a>Optional security practice: Protect data integrity - Enable S3 bucket versioning<a class="anchor-link" href="#Optional-security-practice:-Protect-data-integrity---Enable-S3-bucket-versioning"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">s3_resource</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">'s3'</span><span class="p">)</span>
<span class="n">bucket_versioning</span> <span class="o">=</span> <span class="n">s3_resource</span><span class="o">.</span><span class="n">BucketVersioning</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
<span class="n">bucket_versioning</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{'ResponseMetadata': {'RequestId': '4C3AA32EF96CA240',
  'HostId': 'HQaKmMvUTbXTRsxLL/9BubrfD09xisEO8x72cpQP0syhAH9dXKRx7gqmzchq3TbERdwprUKcRmQ=',
  'HTTPStatusCode': 200,
  'HTTPHeaders': {'x-amz-id-2': 'HQaKmMvUTbXTRsxLL/9BubrfD09xisEO8x72cpQP0syhAH9dXKRx7gqmzchq3TbERdwprUKcRmQ=',
   'x-amz-request-id': '4C3AA32EF96CA240',
   'date': 'Mon, 04 May 2020 20:46:23 GMT',
   'content-length': '0',
   'server': 'AmazonS3'},
  'RetryAttempts': 0}}</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Prepare-and-Upload-Data">
<a class="anchor" href="#Prepare-and-Upload-Data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Prepare and Upload Data<a class="anchor-link" href="#Prepare-and-Upload-Data"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">'RATING'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">3.6</span><span class="p">]</span>                <span class="c1"># keep only movies rated 3.6 and above</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">'USER_ID'</span><span class="p">,</span> <span class="s1">'ITEM_ID'</span><span class="p">,</span> <span class="s1">'TIMESTAMP'</span><span class="p">]]</span> <span class="c1"># select columns that match the columns in the schema below</span>
<span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">'s3'</span><span class="p">)</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-Schema">
<a class="anchor" href="#Create-Schema" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create Schema<a class="anchor-link" href="#Create-Schema"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"record"</span><span class="p">,</span>
    <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Interactions"</span><span class="p">,</span>
    <span class="s2">"namespace"</span><span class="p">:</span> <span class="s2">"com.amazonaws.personalize.schema"</span><span class="p">,</span>
    <span class="s2">"fields"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"USER_ID"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"string"</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"ITEM_ID"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"string"</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"TIMESTAMP"</span><span class="p">,</span>
            <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"long"</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"1.0"</span>
<span class="p">}</span>

<span class="n">create_schema_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_schema</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"DEMO-schema"</span><span class="p">,</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">schema_arn</span> <span class="o">=</span> <span class="n">create_schema_response</span><span class="p">[</span><span class="s1">'schemaArn'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_schema_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "schemaArn": "arn:aws:personalize:us-west-2:237539672711:schema/DEMO-schema", 
  "ResponseMetadata": {
    "RetryAttempts": 0, 
    "HTTPStatusCode": 200, 
    "RequestId": "12eb7cba-2b64-4be9-9f6e-eeebff7629a5", 
    "HTTPHeaders": {
      "date": "Tue, 04 Dec 2018 05:49:04 GMT", 
      "x-amzn-requestid": "12eb7cba-2b64-4be9-9f6e-eeebff7629a5", 
      "content-length": "79", 
      "content-type": "application/x-amz-json-1.1", 
      "connection": "keep-alive"
    }
  }
}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Optional-security-practice---Protect-data-at-rest---Encrypt-datasets-under-Personalize">
<a class="anchor" href="#Optional-security-practice---Protect-data-at-rest---Encrypt-datasets-under-Personalize" aria-hidden="true"><span class="octicon octicon-link"></span></a>Optional security practice - Protect data at rest - Encrypt datasets under Personalize<a class="anchor-link" href="#Optional-security-practice---Protect-data-at-rest---Encrypt-datasets-under-Personalize"> </a>
</h4>
<p>If you skip this step, do not pass kmsKeyArn or roleArn when you create your dataset group.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kmsKeyArn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">'kms'</span><span class="p">)</span><span class="o">.</span><span class="n">create_key</span><span class="p">(</span><span class="n">Description</span><span class="o">=</span><span class="s2">"personalize-data"</span><span class="p">)[</span><span class="s1">'KeyMetadata'</span><span class="p">][</span><span class="s1">'Arn'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kmsKeyArn</span><span class="p">)</span>
<span class="n">key_accessor_policy_name</span> <span class="o">=</span> <span class="s2">"AccessPersonalizeDatasetPolicy"</span>
<span class="n">key_accessor_policy</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"Version"</span><span class="p">:</span> <span class="s2">"2012-10-17"</span><span class="p">,</span>
  <span class="s2">"Statement"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"Effect"</span><span class="p">:</span> <span class="s2">"Allow"</span><span class="p">,</span>
    <span class="s2">"Action"</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">"kms:*"</span>
    <span class="p">],</span>
    <span class="s2">"Resource"</span><span class="p">:</span> <span class="p">[</span> <span class="n">kmsKeyArn</span> <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">key_access_policy</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">create_policy</span><span class="p">(</span>
    <span class="n">PolicyName</span> <span class="o">=</span> <span class="n">key_accessor_policy_name</span><span class="p">,</span>
    <span class="n">PolicyDocument</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">key_accessor_policy</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">key_access_role_name</span> <span class="o">=</span> <span class="s2">"AccessPersonalizeDatasetRole"</span>
<span class="n">assume_role_policy_document</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"Version"</span><span class="p">:</span> <span class="s2">"2012-10-17"</span><span class="p">,</span>
    <span class="s2">"Statement"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">"Effect"</span><span class="p">:</span> <span class="s2">"Allow"</span><span class="p">,</span>
          <span class="s2">"Principal"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"Service"</span><span class="p">:</span> <span class="s2">"personalize.amazonaws.com"</span>
          <span class="p">},</span>
          <span class="s2">"Action"</span><span class="p">:</span> <span class="s2">"sts:AssumeRole"</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">create_role_response</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">create_role</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="n">key_access_role_name</span><span class="p">,</span>
    <span class="n">AssumeRolePolicyDocument</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">assume_role_policy_document</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">iam</span><span class="o">.</span><span class="n">attach_role_policy</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="n">create_role_response</span><span class="p">[</span><span class="s2">"Role"</span><span class="p">][</span><span class="s2">"RoleName"</span><span class="p">],</span>
    <span class="n">PolicyArn</span> <span class="o">=</span> <span class="n">key_access_policy</span><span class="p">[</span><span class="s2">"Policy"</span><span class="p">][</span><span class="s2">"Arn"</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">keyAccessRoleArn</span> <span class="o">=</span> <span class="n">create_role_response</span><span class="p">[</span><span class="s2">"Role"</span><span class="p">][</span><span class="s2">"Arn"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">keyAccessRoleArn</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>arn:aws:kms:us-west-2:001513653716:key/f5be82af-a160-4c49-813e-e5448fa95693
arn:aws:iam::001513653716:role/AccessPersonalizeDatasetRole
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-and-Wait-for-Encrypted-Dataset-Group">
<a class="anchor" href="#Create-and-Wait-for-Encrypted-Dataset-Group" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create and Wait for Encrypted Dataset Group<a class="anchor-link" href="#Create-and-Wait-for-Encrypted-Dataset-Group"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-Encrypted-Dataset-Group">
<a class="anchor" href="#Create-Encrypted-Dataset-Group" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create Encrypted Dataset Group<a class="anchor-link" href="#Create-Encrypted-Dataset-Group"> </a>
</h4>
<p>If you did not create a KMS Key and IAM role from the last step, then do not pass in roleArn or kmsKeyArn.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">create_dataset_group_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_dataset_group</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"DEMO-dataset-group"</span><span class="p">,</span>
    <span class="n">roleArn</span> <span class="o">=</span> <span class="n">keyAccessRoleArn</span><span class="p">,</span>
    <span class="n">kmsKeyArn</span> <span class="o">=</span> <span class="n">kmsKeyArn</span>
<span class="p">)</span>

<span class="n">dataset_group_arn</span> <span class="o">=</span> <span class="n">create_dataset_group_response</span><span class="p">[</span><span class="s1">'datasetGroupArn'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_dataset_group_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ClientError</span>                               Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-5-d867662faf2d&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>     name <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">"DEMO-dataset-group-aadata"</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     roleArn <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">"arn:aws:iam::261294318658:role/AccessPersonalizeDatasetRole"</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">----&gt; 4</span><span class="ansi-red-fg">     </span>kmsKeyArn <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">"arn:aws:kms:us-west-2:261294318658:key/be6db2bb-1fe8-43a5-8134-0762740a22b9"</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> )
<span class="ansi-green-intense-fg ansi-bold">      6</span> 

<span class="ansi-green-fg">~/boto3/src/botocore/botocore/client.py</span> in <span class="ansi-cyan-fg">_api_call</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    314</span>                     "%s() only accepts keyword arguments." % py_operation_name)
<span class="ansi-green-intense-fg ansi-bold">    315</span>             <span class="ansi-red-fg"># The "self" in this scope is referring to the BaseClient.</span>
<span class="ansi-green-fg">--&gt; 316</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_make_api_call<span class="ansi-blue-fg">(</span>operation_name<span class="ansi-blue-fg">,</span> kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    317</span> 
<span class="ansi-green-intense-fg ansi-bold">    318</span>         _api_call<span class="ansi-blue-fg">.</span>__name__ <span class="ansi-blue-fg">=</span> str<span class="ansi-blue-fg">(</span>py_operation_name<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/boto3/src/botocore/botocore/client.py</span> in <span class="ansi-cyan-fg">_make_api_call</span><span class="ansi-blue-fg">(self, operation_name, api_params)</span>
<span class="ansi-green-intense-fg ansi-bold">    633</span>             error_code <span class="ansi-blue-fg">=</span> parsed_response<span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"Error"</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">}</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"Code"</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    634</span>             error_class <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>exceptions<span class="ansi-blue-fg">.</span>from_code<span class="ansi-blue-fg">(</span>error_code<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 635</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">raise</span> error_class<span class="ansi-blue-fg">(</span>parsed_response<span class="ansi-blue-fg">,</span> operation_name<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    636</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    637</span>             <span class="ansi-green-fg">return</span> parsed_response

<span class="ansi-red-fg">ClientError</span>: An error occurred (AccessDeniedException) when calling the CreateDatasetGroup operation: Cross-account pass role is not allowed.</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Wait-for-Dataset-Group-to-Have-ACTIVE-Status">
<a class="anchor" href="#Wait-for-Dataset-Group-to-Have-ACTIVE-Status" aria-hidden="true"><span class="octicon octicon-link"></span></a>Wait for Dataset Group to Have ACTIVE Status<a class="anchor-link" href="#Wait-for-Dataset-Group-to-Have-ACTIVE-Status"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_dataset_group_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_dataset_group</span><span class="p">(</span>
        <span class="n">datasetGroupArn</span> <span class="o">=</span> <span class="n">dataset_group_arn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_dataset_group_response</span><span class="p">[</span><span class="s2">"datasetGroup"</span><span class="p">][</span><span class="s2">"status"</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"DatasetGroup: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"ACTIVE"</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"CREATE FAILED"</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>DatasetGroup: CREATE PENDING
DatasetGroup: CREATE FAILED
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-Dataset">
<a class="anchor" href="#Create-Dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create Dataset<a class="anchor-link" href="#Create-Dataset"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset_type</span> <span class="o">=</span> <span class="s2">"INTERACTIONS"</span>
<span class="n">create_dataset_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"DEMO-dataset"</span><span class="p">,</span>
    <span class="n">datasetType</span> <span class="o">=</span> <span class="n">dataset_type</span><span class="p">,</span>
    <span class="n">datasetGroupArn</span> <span class="o">=</span> <span class="n">dataset_group_arn</span><span class="p">,</span>
    <span class="n">schemaArn</span> <span class="o">=</span> <span class="n">schema_arn</span>
<span class="p">)</span>

<span class="n">dataset_arn</span> <span class="o">=</span> <span class="n">create_dataset_response</span><span class="p">[</span><span class="s1">'datasetArn'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_dataset_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "ResponseMetadata": {
    "RetryAttempts": 0, 
    "HTTPStatusCode": 200, 
    "RequestId": "29ab75c8-df6e-4807-943f-1b48014181d1", 
    "HTTPHeaders": {
      "date": "Tue, 04 Dec 2018 05:50:19 GMT", 
      "x-amzn-requestid": "29ab75c8-df6e-4807-943f-1b48014181d1", 
      "content-length": "101", 
      "content-type": "application/x-amz-json-1.1", 
      "connection": "keep-alive"
    }
  }, 
  "datasetArn": "arn:aws:personalize:us-west-2:237539672711:dataset/DEMO-dataset-group/INTERACTIONS"
}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Prepare,-Create,-and-Wait-for-Dataset-Import-Job">
<a class="anchor" href="#Prepare,-Create,-and-Wait-for-Dataset-Import-Job" aria-hidden="true"><span class="octicon octicon-link"></span></a>Prepare, Create, and Wait for Dataset Import Job<a class="anchor-link" href="#Prepare,-Create,-and-Wait-for-Dataset-Import-Job"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Attach-Policy-to-S3-Bucket">
<a class="anchor" href="#Attach-Policy-to-S3-Bucket" aria-hidden="true"><span class="octicon octicon-link"></span></a>Attach Policy to S3 Bucket<a class="anchor-link" href="#Attach-Policy-to-S3-Bucket"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">policy</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"Version"</span><span class="p">:</span> <span class="s2">"2012-10-17"</span><span class="p">,</span>
    <span class="s2">"Id"</span><span class="p">:</span> <span class="s2">"PersonalizeS3BucketAccessPolicy"</span><span class="p">,</span>
    <span class="s2">"Statement"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"Sid"</span><span class="p">:</span> <span class="s2">"PersonalizeS3BucketAccessPolicy"</span><span class="p">,</span>
            <span class="s2">"Effect"</span><span class="p">:</span> <span class="s2">"Allow"</span><span class="p">,</span>
            <span class="s2">"Principal"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"Service"</span><span class="p">:</span> <span class="s2">"personalize.amazonaws.com"</span>
            <span class="p">},</span>
            <span class="s2">"Action"</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">"s3:GetObject"</span><span class="p">,</span>
                <span class="s2">"s3:ListBucket"</span>
            <span class="p">],</span>
            <span class="s2">"Resource"</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">"arn:aws:s3:::</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">),</span>
                <span class="s2">"arn:aws:s3:::</span><span class="si">{}</span><span class="s2">/*"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">s3</span><span class="o">.</span><span class="n">put_bucket_policy</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Policy</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">policy</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-Personalize-Role">
<a class="anchor" href="#Create-Personalize-Role" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create Personalize Role<a class="anchor-link" href="#Create-Personalize-Role"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">role_name</span> <span class="o">=</span> <span class="s2">"PersonalizeRole"</span>
<span class="n">assume_role_policy_document</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"Version"</span><span class="p">:</span> <span class="s2">"2012-10-17"</span><span class="p">,</span>
    <span class="s2">"Statement"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">"Effect"</span><span class="p">:</span> <span class="s2">"Allow"</span><span class="p">,</span>
          <span class="s2">"Principal"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"Service"</span><span class="p">:</span> <span class="s2">"personalize.amazonaws.com"</span>
          <span class="p">},</span>
          <span class="s2">"Action"</span><span class="p">:</span> <span class="s2">"sts:AssumeRole"</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">create_role_response</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">create_role</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="n">role_name</span><span class="p">,</span>
    <span class="n">AssumeRolePolicyDocument</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">assume_role_policy_document</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># AmazonPersonalizeFullAccess provides access to any S3 bucket with a name that includes "personalize" or "Personalize" </span>
<span class="c1"># if you would like to use a bucket with a different name, please consider creating and attaching a new policy</span>
<span class="c1"># that provides read access to your bucket or attaching the AmazonS3ReadOnlyAccess policy to the role</span>
<span class="n">policy_arn</span> <span class="o">=</span> <span class="s2">"arn:aws:iam::aws:policy/service-role/AmazonPersonalizeFullAccess"</span>
<span class="n">iam</span><span class="o">.</span><span class="n">attach_role_policy</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="n">role_name</span><span class="p">,</span>
    <span class="n">PolicyArn</span> <span class="o">=</span> <span class="n">policy_arn</span>
<span class="p">)</span>

<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span> <span class="c1"># wait for a minute to allow IAM role policy attachment to propagate</span>

<span class="n">role_arn</span> <span class="o">=</span> <span class="n">create_role_response</span><span class="p">[</span><span class="s2">"Role"</span><span class="p">][</span><span class="s2">"Arn"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">role_arn</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>arn:aws:iam::660166145966:role/PersonalizeRole2
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-Dataset-Import-Job">
<a class="anchor" href="#Create-Dataset-Import-Job" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create Dataset Import Job<a class="anchor-link" href="#Create-Dataset-Import-Job"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">create_dataset_import_job_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_dataset_import_job</span><span class="p">(</span>
    <span class="n">jobName</span> <span class="o">=</span> <span class="s2">"DEMO-dataset-import-job"</span><span class="p">,</span>
    <span class="n">datasetArn</span> <span class="o">=</span> <span class="n">dataset_arn</span><span class="p">,</span>
    <span class="n">dataSource</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"dataLocation"</span><span class="p">:</span> <span class="s2">"s3://</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">roleArn</span> <span class="o">=</span> <span class="n">role_arn</span>
<span class="p">)</span>

<span class="n">dataset_import_job_arn</span> <span class="o">=</span> <span class="n">create_dataset_import_job_response</span><span class="p">[</span><span class="s1">'datasetImportJobArn'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_dataset_import_job_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "datasetImportJobArn": "arn:aws:personalize:us-west-2:237539672711:dataset-import-job/DEMO-dataset-import-job", 
  "ResponseMetadata": {
    "RetryAttempts": 0, 
    "HTTPStatusCode": 200, 
    "RequestId": "3c77fe8d-d9fe-4ca5-ad03-b18e937acbb3", 
    "HTTPHeaders": {
      "date": "Tue, 04 Dec 2018 05:50:55 GMT", 
      "x-amzn-requestid": "3c77fe8d-d9fe-4ca5-ad03-b18e937acbb3", 
      "content-length": "113", 
      "content-type": "application/x-amz-json-1.1", 
      "connection": "keep-alive"
    }
  }
}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Wait-for-Dataset-Import-Job-to-Have-ACTIVE-Status">
<a class="anchor" href="#Wait-for-Dataset-Import-Job-to-Have-ACTIVE-Status" aria-hidden="true"><span class="octicon octicon-link"></span></a>Wait for Dataset Import Job to Have ACTIVE Status<a class="anchor-link" href="#Wait-for-Dataset-Import-Job-to-Have-ACTIVE-Status"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_dataset_import_job_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_dataset_import_job</span><span class="p">(</span>
        <span class="n">datasetImportJobArn</span> <span class="o">=</span> <span class="n">dataset_import_job_arn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_dataset_import_job_response</span><span class="p">[</span><span class="s2">"datasetImportJob"</span><span class="p">][</span><span class="s1">'status'</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"DatasetImportJob: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"ACTIVE"</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"CREATE FAILED"</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>DatasetImportJob: CREATE PENDING
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: ACTIVE
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Select-Recipe">
<a class="anchor" href="#Select-Recipe" aria-hidden="true"><span class="octicon octicon-link"></span></a>Select Recipe<a class="anchor-link" href="#Select-Recipe"> </a>
</h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">list_recipes_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">list_recipes</span><span class="p">()</span>
<span class="n">recipe_arn</span> <span class="o">=</span> <span class="s2">"arn:aws:personalize:::recipe/aws-hrnn"</span> <span class="c1"># aws-hrnn selected for demo purposes</span>
<span class="n">list_recipes_response</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{'ResponseMetadata': {'HTTPHeaders': {'connection': 'keep-alive',
   'content-length': '1287',
   'content-type': 'application/x-amz-json-1.1',
   'date': 'Fri, 22 Mar 2019 19:28:37 GMT',
   'x-amzn-requestid': '275695de-45b2-4077-82d4-c961ceeaf367'},
  'HTTPStatusCode': 200,
  'RequestId': '275695de-45b2-4077-82d4-c961ceeaf367',
  'RetryAttempts': 0},
 u'recipes': [{u'creationDateTime': datetime.datetime(2018, 11, 25, 16, 0, tzinfo=tzlocal()),
   u'lastUpdatedDateTime': datetime.datetime(1969, 12, 31, 16, 0, tzinfo=tzlocal()),
   u'name': u'aws-hrnn',
   u'recipeArn': u'arn:aws:personalize:::recipe/aws-hrnn',
   u'status': u'ACTIVE'},
  {u'creationDateTime': datetime.datetime(2018, 11, 25, 16, 0, tzinfo=tzlocal()),
   u'lastUpdatedDateTime': datetime.datetime(1969, 12, 31, 16, 0, tzinfo=tzlocal()),
   u'name': u'aws-hrnn-coldstart',
   u'recipeArn': u'arn:aws:personalize:::recipe/aws-hrnn-coldstart',
   u'status': u'ACTIVE'},
  {u'creationDateTime': datetime.datetime(2018, 11, 25, 16, 0, tzinfo=tzlocal()),
   u'lastUpdatedDateTime': datetime.datetime(1969, 12, 31, 16, 0, tzinfo=tzlocal()),
   u'name': u'aws-hrnn-metadata',
   u'recipeArn': u'arn:aws:personalize:::recipe/aws-hrnn-metadata',
   u'status': u'ACTIVE'},
  {u'creationDateTime': datetime.datetime(2018, 11, 25, 16, 0, tzinfo=tzlocal()),
   u'lastUpdatedDateTime': datetime.datetime(1969, 12, 31, 16, 0, tzinfo=tzlocal()),
   u'name': u'aws-personalized-ranking',
   u'recipeArn': u'arn:aws:personalize:::recipe/aws-personalized-ranking',
   u'status': u'ACTIVE'},
  {u'creationDateTime': datetime.datetime(2018, 11, 25, 16, 0, tzinfo=tzlocal()),
   u'lastUpdatedDateTime': datetime.datetime(1969, 12, 31, 16, 0, tzinfo=tzlocal()),
   u'name': u'aws-popularity-count',
   u'recipeArn': u'arn:aws:personalize:::recipe/aws-popularity-count',
   u'status': u'ACTIVE'},
  {u'creationDateTime': datetime.datetime(2018, 11, 25, 16, 0, tzinfo=tzlocal()),
   u'lastUpdatedDateTime': datetime.datetime(1969, 12, 31, 16, 0, tzinfo=tzlocal()),
   u'name': u'aws-sims',
   u'recipeArn': u'arn:aws:personalize:::recipe/aws-sims',
   u'status': u'ACTIVE'}]}</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-and-Wait-for-Solution">
<a class="anchor" href="#Create-and-Wait-for-Solution" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create and Wait for Solution<a class="anchor-link" href="#Create-and-Wait-for-Solution"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-Solution">
<a class="anchor" href="#Create-Solution" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create Solution<a class="anchor-link" href="#Create-Solution"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">create_solution_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_solution</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"DEMO-solution"</span><span class="p">,</span>
    <span class="n">datasetGroupArn</span> <span class="o">=</span> <span class="n">dataset_group_arn</span><span class="p">,</span>
    <span class="n">recipeArn</span> <span class="o">=</span> <span class="n">recipe_arn</span>
<span class="p">)</span>

<span class="n">solution_arn</span> <span class="o">=</span> <span class="n">create_solution_response</span><span class="p">[</span><span class="s1">'solutionArn'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_solution_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "solutionArn": "arn:aws:personalize:us-west-2:237539672711:solution/DEMO-solution", 
  "ResponseMetadata": {
    "RetryAttempts": 0, 
    "HTTPStatusCode": 200, 
    "RequestId": "2042832f-0775-43e2-86de-53a061be1f63", 
    "HTTPHeaders": {
      "date": "Mon, 03 Dec 2018 23:55:17 GMT", 
      "x-amzn-requestid": "2042832f-0775-43e2-86de-53a061be1f63", 
      "content-length": "83", 
      "content-type": "application/x-amz-json-1.1", 
      "connection": "keep-alive"
    }
  }
}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-Solution-Version">
<a class="anchor" href="#Create-Solution-Version" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create Solution Version<a class="anchor-link" href="#Create-Solution-Version"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">create_solution_version_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_solution_version</span><span class="p">(</span>
    <span class="n">solutionArn</span> <span class="o">=</span> <span class="n">solution_arn</span>
<span class="p">)</span>

<span class="n">solution_version_arn</span> <span class="o">=</span> <span class="n">create_solution_version_response</span><span class="p">[</span><span class="s1">'solutionVersionArn'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_solution_version_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "solutionVersionArn": "arn:aws:personalize:us-west-2:237539672711:solution/DEMO-solution/702e0792", 
  "ResponseMetadata": {
    "RetryAttempts": 0, 
    "HTTPStatusCode": 200, 
    "RequestId": "2042832f-0775-43e2-86de-53a061be1f65", 
    "HTTPHeaders": {
      "date": "Mon, 03 Dec 2018 23:55:17 GMT", 
      "x-amzn-requestid": "2042832f-0775-43e2-86de-53a061be1f65", 
      "content-length": "90", 
      "content-type": "application/x-amz-json-1.1", 
      "connection": "keep-alive"
    }
  }
}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Wait-for-Solution-Version-to-Have-ACTIVE-Status">
<a class="anchor" href="#Wait-for-Solution-Version-to-Have-ACTIVE-Status" aria-hidden="true"><span class="octicon octicon-link"></span></a>Wait for Solution Version to Have ACTIVE Status<a class="anchor-link" href="#Wait-for-Solution-Version-to-Have-ACTIVE-Status"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_solution_version_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_solution_version</span><span class="p">(</span>
        <span class="n">solutionVersionArn</span> <span class="o">=</span> <span class="n">solution_version_arn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_solution_version_response</span><span class="p">[</span><span class="s2">"solutionVersion"</span><span class="p">][</span><span class="s2">"status"</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"SolutionVersion: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"ACTIVE"</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"CREATE FAILED"</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SolutionVersion: CREATE PENDING
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: ACTIVE
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Get-Metrics-of-Solution">
<a class="anchor" href="#Get-Metrics-of-Solution" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get Metrics of Solution<a class="anchor-link" href="#Get-Metrics-of-Solution"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_solution_metrics_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">get_solution_metrics</span><span class="p">(</span>
    <span class="n">solutionVersionArn</span> <span class="o">=</span> <span class="n">solution_version_arn</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">get_solution_metrics_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "metrics": {
    "coverage": 0.2603, 
    "mean_reciprocal_rank_at_25": 0.0539, 
    "normalized_discounted_cumulative_gain_at_5": 0.0486, 
    "normalized_discounted_cumulative_gain_at_10": 0.0649, 
    "normalized_discounted_cumulative_gain_at_25": 0.0918, 
    "precision_at_5": 0.0109, 
    "precision_at_10": 0.0098, 
    "precision_at_25": 0.0083, 
  }, 
  "solutionVersionArn": "arn:aws:personalize:us-west-2:237539672711:solution/DEMO-solution/702e0792", 
  "ResponseMetadata": {
    "RetryAttempts": 0, 
    "HTTPStatusCode": 200, 
    "RequestId": "5b5f4f4f-5249-4c0e-9f83-45e3fe22f09f", 
    "HTTPHeaders": {
      "date": "Tue, 04 Dec 2018 00:53:54 GMT", 
      "x-amzn-requestid": "5b5f4f4f-5249-4c0e-9f83-45e3fe22f09f", 
      "content-length": "724", 
      "content-type": "application/x-amz-json-1.1", 
      "connection": "keep-alive"
    }
  }
}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-and-Wait-for-Campaign">
<a class="anchor" href="#Create-and-Wait-for-Campaign" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create and Wait for Campaign<a class="anchor-link" href="#Create-and-Wait-for-Campaign"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-Campaign">
<a class="anchor" href="#Create-Campaign" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create Campaign<a class="anchor-link" href="#Create-Campaign"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">create_campaign_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_campaign</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">"DEMO-campaign"</span><span class="p">,</span>
    <span class="n">solutionVersionArn</span> <span class="o">=</span> <span class="n">solution_version_arn</span><span class="p">,</span>
    <span class="n">minProvisionedTPS</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">)</span>

<span class="n">campaign_arn</span> <span class="o">=</span> <span class="n">create_campaign_response</span><span class="p">[</span><span class="s1">'campaignArn'</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_campaign_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
  "campaignArn": "arn:aws:personalize:us-west-2:237539672711:campaign/DEMO-campaign", 
  "ResponseMetadata": {
    "RetryAttempts": 0, 
    "HTTPStatusCode": 200, 
    "RequestId": "527e97ba-683c-4dc7-8218-00716f22c904", 
    "HTTPHeaders": {
      "date": "Tue, 04 Dec 2018 00:54:17 GMT", 
      "x-amzn-requestid": "527e97ba-683c-4dc7-8218-00716f22c904", 
      "content-length": "83", 
      "content-type": "application/x-amz-json-1.1", 
      "connection": "keep-alive"
    }
  }
}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Wait-for-Campaign-to-Have-ACTIVE-Status">
<a class="anchor" href="#Wait-for-Campaign-to-Have-ACTIVE-Status" aria-hidden="true"><span class="octicon octicon-link"></span></a>Wait for Campaign to Have ACTIVE Status<a class="anchor-link" href="#Wait-for-Campaign-to-Have-ACTIVE-Status"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_campaign_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_campaign</span><span class="p">(</span>
        <span class="n">campaignArn</span> <span class="o">=</span> <span class="n">campaign_arn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_campaign_response</span><span class="p">[</span><span class="s2">"campaign"</span><span class="p">][</span><span class="s2">"status"</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Campaign: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"ACTIVE"</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">"CREATE FAILED"</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Campaign: CREATE PENDING
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: ACTIVE
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Get-Recommendations">
<a class="anchor" href="#Get-Recommendations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get Recommendations<a class="anchor-link" href="#Get-Recommendations"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Select-a-User-and-an-Item">
<a class="anchor" href="#Select-a-User-and-an-Item" aria-hidden="true"><span class="octicon octicon-link"></span></a>Select a User and an Item<a class="anchor-link" href="#Select-a-User-and-an-Item"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'./ml-100k/u.item'</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">'|'</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'latin-1'</span><span class="p">)</span>
<span class="n">items</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'ITEM_ID'</span><span class="p">,</span> <span class="s1">'TITLE'</span><span class="p">]</span>

<span class="n">user_id</span><span class="p">,</span> <span class="n">item_id</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">item_title</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="s1">'ITEM_ID'</span><span class="p">]</span> <span class="o">==</span> <span class="n">item_id</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"USER: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user_id</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"ITEM: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item_title</span><span class="p">))</span>

<span class="n">items</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>USER: 711
ITEM: Silence of the Lambs, The (1991)
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ITEM_ID</th>
      <th>TITLE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Toy Story (1995)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>GoldenEye (1995)</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1680</th>
      <td>1681</td>
      <td>You So Crazy (1994)</td>
    </tr>
    <tr>
      <th>1681</th>
      <td>1682</td>
      <td>Scream of Stone (Schrei aus Stein) (1991)</td>
    </tr>
  </tbody>
</table>
<p>1682 rows × 2 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Call-GetRecommendations">
<a class="anchor" href="#Call-GetRecommendations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Call GetRecommendations<a class="anchor-link" href="#Call-GetRecommendations"> </a>
</h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_recommendations_response</span> <span class="o">=</span> <span class="n">personalize_runtime</span><span class="o">.</span><span class="n">get_recommendations</span><span class="p">(</span>
    <span class="n">campaignArn</span> <span class="o">=</span> <span class="n">campaign_arn</span><span class="p">,</span>
    <span class="n">userId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
    <span class="n">itemId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">item_list</span> <span class="o">=</span> <span class="n">get_recommendations_response</span><span class="p">[</span><span class="s1">'itemList'</span><span class="p">]</span>
<span class="n">title_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="s1">'ITEM_ID'</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">'itemId'</span><span class="p">])]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Recommendations: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">title_list</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Recommendations: [
  "Godfather, The (1972)", 
  "Contact (1997)", 
  "Titanic (1997)", 
  "Star Wars (1977)", 
  "Fargo (1996)", 
  "Liar Liar (1997)", 
  "Evita (1996)", 
  "Jerry Maguire (1996)", 
  "Scream (1996)", 
  "Devil's Advocate, The (1997)", 
  "Full Monty, The (1997)", 
  "Conspiracy Theory (1997)", 
  "Edge, The (1997)", 
  "Sense and Sensibility (1995)", 
  "English Patient, The (1996)", 
  "Twelve Monkeys (1995)", 
  "L.A. Confidential (1997)", 
  "As Good As It Gets (1997)", 
  "In &amp; Out (1997)", 
  "Rock, The (1996)", 
  "Return of the Jedi (1983)", 
  "Amistad (1997)", 
  "Men in Black (1997)", 
  "Truth About Cats &amp; Dogs, The (1996)", 
  "Alien: Resurrection (1997)"
]
</pre>
</div>
</div>

</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="recohut/notebook"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/amazonpersonalize/movie/security/privacy/2021/06/20/amazon-personalize-workshop-part-4.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Jupyter notebook database.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/recohut" target="_blank" title="recohut"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
